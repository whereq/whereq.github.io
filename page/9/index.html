<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="WhereQ">
<meta property="og:url" content="https://www.whereq.com/page/9/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Dazhi Zhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">WhereQ</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">122</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">112</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">71</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Kubernetes-StatefulSet-and-Deployment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Kubernetes-StatefulSet-and-Deployment/" class="post-title-link" itemprop="url">Kubernetes StatefulSet and Deployment</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 16:57:24 / Modified: 16:58:19" itemprop="dateCreated datePublished" datetime="2024-10-27T16:57:24-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In Kubernetes, <strong>StatefulSet</strong> and <strong>Deployment</strong> are two important concepts for managing workloads, each tailored to specific types of applications. </p>
<hr>
<h3 id="Overview-StatefulSet-vs-Deployment"><a href="#Overview-StatefulSet-vs-Deployment" class="headerlink" title="Overview: StatefulSet vs. Deployment"></a>Overview: StatefulSet vs. Deployment</h3><h4 id="1-Deployment"><a href="#1-Deployment" class="headerlink" title="1. Deployment"></a>1. <strong>Deployment</strong></h4><ul>
<li>A <strong>Deployment</strong> manages stateless applications, where each instance (Pod) is identical and can be easily replaced without any dependency on the previous instance’s state.</li>
<li>It allows for easy scaling up or down, rolling updates, and rollback.</li>
<li>Deployments are ideal for applications that don’t need unique identities or persistent storage tied to each Pod.</li>
</ul>
<h4 id="2-StatefulSet"><a href="#2-StatefulSet" class="headerlink" title="2. StatefulSet"></a>2. <strong>StatefulSet</strong></h4><ul>
<li>A <strong>StatefulSet</strong> is used to manage stateful applications where each Pod maintains a unique identity and persistent storage.</li>
<li>Pods created by StatefulSets are given fixed identities, which are essential for applications that depend on stable network IDs or persistent data volumes.</li>
<li>It ensures an ordered and predictable sequence for Pod creation, deletion, and scaling operations, making it suitable for stateful applications.</li>
</ul>
<hr>
<h3 id="Key-Differences-Between-Deployment-and-StatefulSet"><a href="#Key-Differences-Between-Deployment-and-StatefulSet" class="headerlink" title="Key Differences Between Deployment and StatefulSet"></a>Key Differences Between Deployment and StatefulSet</h3><table>
<thead>
<tr>
<th>Feature</th>
<th><strong>Deployment</strong></th>
<th><strong>StatefulSet</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Use Case</strong></td>
<td>Stateless applications</td>
<td>Stateful applications</td>
</tr>
<tr>
<td><strong>Pod Identity</strong></td>
<td>All Pods are identical</td>
<td>Each Pod has a unique, stable identity</td>
</tr>
<tr>
<td><strong>Persistent Storage</strong></td>
<td>Not tied to specific Pods; ephemeral by default</td>
<td>Persistent Volume Claims (PVC) linked to each Pod</td>
</tr>
<tr>
<td><strong>Pod Management</strong></td>
<td>Unordered Pod creation, deletion, or scaling</td>
<td>Ordered Pod creation, deletion, and scaling</td>
</tr>
<tr>
<td><strong>Scaling</strong></td>
<td>Independent scaling; any Pod can be replaced</td>
<td>Scaling maintains Pod identity; Pods are replaced in order</td>
</tr>
<tr>
<td><strong>Networking</strong></td>
<td>Pods are accessed via a common service name</td>
<td>Each Pod gets a unique DNS endpoint</td>
</tr>
</tbody></table>
<hr>
<h3 id="When-to-Use-Deployment-vs-StatefulSet"><a href="#When-to-Use-Deployment-vs-StatefulSet" class="headerlink" title="When to Use Deployment vs. StatefulSet"></a>When to Use Deployment vs. StatefulSet</h3><h4 id="Deployment-Use-Cases"><a href="#Deployment-Use-Cases" class="headerlink" title="Deployment Use Cases:"></a><strong>Deployment</strong> Use Cases:</h4><ul>
<li><strong>Stateless Applications</strong>: For applications that don’t require persistent storage or a unique identity, like web servers, RESTful APIs, front-end services, and microservices.</li>
<li><strong>Scale-Out Workloads</strong>: When you need to scale the application horizontally with many replicas, such as with compute-intensive tasks (e.g., image processing).</li>
<li><strong>CI&#x2F;CD Pipelines</strong>: Deployment objects are suitable for managing frequent updates and rollbacks in stateless applications.</li>
<li><strong>Load-Balanced Services</strong>: For applications where all instances serve the same purpose and can respond to requests in a round-robin or load-balanced fashion.</li>
</ul>
<p>   Example:<br>   <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">frontend</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">frontend</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">frontend</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br></pre></td></tr></table></figure></p>
<h4 id="StatefulSet-Use-Cases"><a href="#StatefulSet-Use-Cases" class="headerlink" title="StatefulSet Use Cases:"></a><strong>StatefulSet</strong> Use Cases:</h4><ul>
<li><strong>Databases</strong>: For databases like MySQL, PostgreSQL, or Cassandra, where each instance needs persistent storage and must be able to rejoin the cluster with the same identity after a restart.</li>
<li><strong>Distributed Applications</strong>: For clustered or distributed applications that need stable network identities, such as Apache Kafka, Zookeeper, or Redis in a master-slave configuration.</li>
<li><strong>Ordered Processing</strong>: For workloads that require ordered startup and shutdown, maintaining consistency across the replicas.</li>
<li><strong>Persistent Storage Requirements</strong>: For applications that need durable storage across restarts, such as analytics applications or logging systems that rely on data persistence.</li>
</ul>
<p>   Example:<br>   <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">database</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;database-service&quot;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">database</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">database</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">db</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="Real-World-Scenarios"><a href="#Real-World-Scenarios" class="headerlink" title="Real-World Scenarios"></a>Real-World Scenarios</h3><ol>
<li><p><strong>Use StatefulSet for a Database Cluster</strong>: </p>
<ul>
<li>Applications like Cassandra or MongoDB require that each node (or replica) has a unique identifier, stable storage, and maintains a specific order in the cluster.</li>
<li>StatefulSet will ensure each database Pod keeps its persistent storage (e.g., transaction logs) and its network identity, allowing for seamless cluster membership and fault recovery.</li>
</ul>
</li>
<li><p><strong>Use Deployment for a Web Application Front-End</strong>:</p>
<ul>
<li>Stateless applications like front-end services, web servers, and microservices, which don’t require persistent storage, are best managed by Deployments.</li>
<li>Deployments allow fast horizontal scaling to handle fluctuating traffic, automated rolling updates to support frequent releases, and easy recovery from failure.</li>
</ul>
</li>
<li><p><strong>Use StatefulSet for Messaging Queues</strong>:</p>
<ul>
<li>Applications like Kafka, RabbitMQ, and Redis often require ordered replica management, durable storage, and unique identifiers for cluster consistency.</li>
<li>StatefulSet will ensure that the pods are started in sequence and keep their storage intact across restarts.</li>
</ul>
</li>
<li><p><strong>Use Deployment for API Gateways</strong>:</p>
<ul>
<li>API Gateways, which act as proxies or load balancers for backend services, are stateless by design. Deployments allow for fast failover and load distribution while handling updates without data dependency concerns.</li>
</ul>
</li>
</ol>
<hr>
<p>In summary, choose <strong>StatefulSet</strong> for workloads needing state persistence, stable identities, and ordered management (typically databases and clustered applications). Opt for <strong>Deployment</strong> for stateless, load-balanced, and horizontally scalable applications that need easy updates and high availability.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-Redis-Integration-With-Spring-Boot-Application/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-Redis-Integration-With-Spring-Boot-Application/" class="post-title-link" itemprop="url">Deep Dive Redis Integration With Spring Boot Application</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 16:49:33 / Modified: 16:50:22" itemprop="dateCreated datePublished" datetime="2024-10-27T16:49:33-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/" itemprop="url" rel="index"><span itemprop="name">Cache</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/Redis/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Deep-Dive-into-Cache-Mechanisms-for-Distributed-Systems"><a href="#Deep-Dive-into-Cache-Mechanisms-for-Distributed-Systems" class="headerlink" title="Deep Dive into Cache Mechanisms for Distributed Systems"></a>Deep Dive into Cache Mechanisms for Distributed Systems</h1><h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul>
<li><a href="#deep-dive-into-cache-mechanisms-for-distributed-systems">Deep Dive into Cache Mechanisms for Distributed Systems</a><ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#high-level-architecture-design">High-Level Architecture Design</a><ul>
<li><a href="#diagram">Diagram</a></li>
<li><a href="#explanation">Explanation</a></li>
</ul>
</li>
<li><a href="#detail-designs">Detail Designs</a><ul>
<li><a href="#cache-layer">Cache Layer</a><ul>
<li><a href="#redis-setup-and-integration">Redis Setup and Integration</a><ul>
<li><a href="#step-1-install-redis">Step 1: Install Redis</a></li>
<li><a href="#step-2-start-redis-server">Step 2: Start Redis Server</a></li>
<li><a href="#step-3-verify-redis-installation">Step 3: Verify Redis Installation</a></li>
</ul>
</li>
<li><a href="#redis-configuration">Redis Configuration</a></li>
<li><a href="#redis-integration-with-spring-boot">Redis Integration with Spring Boot</a><ul>
<li><a href="#step-1-add-dependencies">Step 1: Add Dependencies</a></li>
<li><a href="#step-2-configure-redis-connection">Step 2: Configure Redis Connection</a></li>
<li><a href="#step-3-enable-caching">Step 3: Enable Caching</a></li>
<li><a href="#step-4-use-redis-cache">Step 4: Use Redis Cache</a></li>
</ul>
</li>
<li><a href="#best-practices-for-redis-in-kubernetes">Best Practices for Redis in Kubernetes</a><ul>
<li><a href="#step-1-deploy-redis-in-kubernetes">Step 1: Deploy Redis in Kubernetes</a></li>
<li><a href="#step-2-create-a-headless-service">Step 2: Create a Headless Service</a></li>
<li><a href="#step-3-configure-redis-access-in-spring-boot">Step 3: Configure Redis Access in Spring Boot</a></li>
<li><a href="#step-4-enable-redis-persistence">Step 4: Enable Redis Persistence</a></li>
<li><a href="#step-5-secure-redis">Step 5: Secure Redis</a></li>
<li><a href="#step-6-monitor-redis">Step 6: Monitor Redis</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#data-storage-layer">Data Storage Layer</a><ul>
<li><a href="#diagram-1">Diagram</a></li>
<li><a href="#sample-code">Sample Code</a></li>
</ul>
</li>
<li><a href="#service-layer">Service Layer</a><ul>
<li><a href="#diagram-2">Diagram</a></li>
<li><a href="#sample-code-1">Sample Code</a></li>
</ul>
</li>
<li><a href="#load-balancer">Load Balancer</a><ul>
<li><a href="#diagram-3">Diagram</a></li>
<li><a href="#sample-code-2">Sample Code</a></li>
</ul>
</li>
<li><a href="#monitoring-and-metrics">Monitoring and Metrics</a><ul>
<li><a href="#diagram-4">Diagram</a></li>
<li><a href="#sample-code-3">Sample Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#complex-scenario-1-flow-control-and-backpressure-handling">Complex Scenario 1: Flow Control and Backpressure Handling</a><ul>
<li><a href="#problem-statement">Problem Statement</a></li>
<li><a href="#solution-architecture">Solution Architecture</a></li>
<li><a href="#flow-chart">Flow Chart</a></li>
<li><a href="#sample-code-4">Sample Code</a></li>
</ul>
</li>
<li><a href="#complex-scenario-2-cache-invalidation-and-data-synchronization">Complex Scenario 2: Cache Invalidation and Data Synchronization</a><ul>
<li><a href="#problem-statement-1">Problem Statement</a></li>
<li><a href="#solution-architecture-1">Solution Architecture</a></li>
<li><a href="#sequence-diagram">Sequence Diagram</a></li>
<li><a href="#sample-code-5">Sample Code</a></li>
</ul>
</li>
<li><a href="#complex-scenario-3-cache-stampede-prevention">Complex Scenario 3: Cache Stampede Prevention</a><ul>
<li><a href="#problem-statement-2">Problem Statement</a></li>
<li><a href="#solution-architecture-2">Solution Architecture</a></li>
<li><a href="#flow-chart-1">Flow Chart</a></li>
<li><a href="#sample-code-6">Sample Code</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In distributed systems, caching is a critical mechanism to improve performance by reducing the load on backend services and databases. This article delves into the design and implementation of cache mechanisms for distributed systems, covering high-level architecture, detailed designs, and sample code for various scenarios.</p>
<hr>
<p><a name="high-level-architecture-design"></a></p>
<h2 id="High-Level-Architecture-Design"><a href="#High-Level-Architecture-Design" class="headerlink" title="High-Level Architecture Design"></a>High-Level Architecture Design</h2><h3 id="Diagram"><a href="#Diagram" class="headerlink" title="Diagram"></a>Diagram</h3><pre><code class="highlight mermaid">graph TD
    A[Client] --&gt; B[Load Balancer]
    B --&gt; C[Service Layer]
    C --&gt; D[Cache Layer]
    C --&gt; E[Data Storage Layer]
    D --&gt; E
    F[Monitoring and Metrics] --&gt; C
    F --&gt; D
    F --&gt; E</code></pre>

<h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><ol>
<li><strong>Client</strong>: The client sends requests to the distributed system.</li>
<li><strong>Load Balancer</strong>: Distributes incoming requests across multiple instances of the service layer.</li>
<li><strong>Service Layer</strong>: Handles business logic and interacts with the cache and data storage layers.</li>
<li><strong>Cache Layer</strong>: Stores frequently accessed data to reduce the load on the data storage layer.</li>
<li><strong>Data Storage Layer</strong>: The primary data store (e.g., database) where data is persisted.</li>
<li><strong>Monitoring and Metrics</strong>: Collects and monitors performance metrics for the entire system.</li>
</ol>
<hr>
<p><a name="detail-designs"></a></p>
<h2 id="Detail-Designs"><a href="#Detail-Designs" class="headerlink" title="Detail Designs"></a>Detail Designs</h2><h3 id="Cache-Layer"><a href="#Cache-Layer" class="headerlink" title="Cache Layer"></a><a name="cache-layer"></a>Cache Layer</h3><p>The cache layer is responsible for storing frequently accessed data to reduce the load on the data storage layer. It can be implemented using distributed caching solutions like Redis or Hazelcast.</p>
<h4 id="Redis-Setup-and-Integration"><a href="#Redis-Setup-and-Integration" class="headerlink" title="Redis Setup and Integration"></a><a name="redis-setup-and-integration"></a>Redis Setup and Integration</h4><p>Redis is an in-memory data structure store that can be used as a distributed cache. It supports various data structures like strings, hashes, lists, sets, and sorted sets.</p>
<h5 id="Step-1-Install-Redis"><a href="#Step-1-Install-Redis" class="headerlink" title="Step 1: Install Redis"></a>Step 1: Install Redis</h5><p>You can install Redis on your local machine or use a cloud-based Redis service like AWS ElastiCache or Redis Labs.</p>
<p>For local installation on Linux:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install redis-server</span><br></pre></td></tr></table></figure>

<p>For local installation on macOS:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install redis</span><br></pre></td></tr></table></figure>

<h5 id="Step-2-Start-Redis-Server"><a href="#Step-2-Start-Redis-Server" class="headerlink" title="Step 2: Start Redis Server"></a>Step 2: Start Redis Server</h5><p>Start the Redis server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure>

<h5 id="Step-3-Verify-Redis-Installation"><a href="#Step-3-Verify-Redis-Installation" class="headerlink" title="Step 3: Verify Redis Installation"></a>Step 3: Verify Redis Installation</h5><p>Verify that Redis is running:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli ping</span><br></pre></td></tr></table></figure>

<p>If Redis is running correctly, you should see <code>PONG</code> as the response.</p>
<h4 id="Redis-Configuration"><a href="#Redis-Configuration" class="headerlink" title="Redis Configuration"></a><a name="redis-configuration"></a>Redis Configuration</h4><p>Redis configuration can be managed through the <code>redis.conf</code> file. Common configurations include setting the maximum memory limit, configuring persistence, and setting up replication.</p>
<p>Example <code>redis.conf</code> snippet:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxmemory 256mb</span><br><span class="line">maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure>

<h4 id="Redis-Integration-with-Spring-Boot"><a href="#Redis-Integration-with-Spring-Boot" class="headerlink" title="Redis Integration with Spring Boot"></a><a name="redis-integration-with-spring-boot"></a>Redis Integration with Spring Boot</h4><p>To integrate Redis with a Spring Boot application, you need to add the necessary dependencies and configure the Redis connection.</p>
<h5 id="Step-1-Add-Dependencies"><a href="#Step-1-Add-Dependencies" class="headerlink" title="Step 1: Add Dependencies"></a>Step 1: Add Dependencies</h5><p>Add the following dependencies to your <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Step-2-Configure-Redis-Connection"><a href="#Step-2-Configure-Redis-Connection" class="headerlink" title="Step 2: Configure Redis Connection"></a>Step 2: Configure Redis Connection</h5><p>Configure the Redis connection in your <code>application.yml</code>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>

<h5 id="Step-3-Enable-Caching"><a href="#Step-3-Enable-Caching" class="headerlink" title="Step 3: Enable Caching"></a>Step 3: Enable Caching</h5><p>Enable caching in your Spring Boot application by adding the <code>@EnableCaching</code> annotation to your main application class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Step-4-Use-Redis-Cache"><a href="#Step-4-Use-Redis-Cache" class="headerlink" title="Step 4: Use Redis Cache"></a>Step 4: Use Redis Cache</h5><p>Use the <code>@Cacheable</code> annotation to cache method results in Redis:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Fetch user from data storage layer</span></span><br><span class="line">        <span class="keyword">return</span> fetchUserFromDatabase(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Best-Practices-for-Redis-in-Kubernetes"><a href="#Best-Practices-for-Redis-in-Kubernetes" class="headerlink" title="Best Practices for Redis in Kubernetes"></a><a name="best-practices-for-redis-in-kubernetes"></a>Best Practices for Redis in Kubernetes</h4><p>When deploying Redis in Kubernetes, it’s important to follow best practices to ensure high availability, scalability, and security.</p>
<h5 id="Step-1-Deploy-Redis-in-Kubernetes"><a href="#Step-1-Deploy-Redis-in-Kubernetes" class="headerlink" title="Step 1: Deploy Redis in Kubernetes"></a>Step 1: Deploy Redis in Kubernetes</h5><p>You can deploy Redis in Kubernetes using a StatefulSet for stateful applications or a Deployment for stateless applications. Here’s an example of deploying Redis using a StatefulSet:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">1Gi</span></span><br></pre></td></tr></table></figure>

<h5 id="Step-2-Create-a-Headless-Service"><a href="#Step-2-Create-a-Headless-Service" class="headerlink" title="Step 2: Create a Headless Service"></a>Step 2: Create a Headless Service</h5><p>Create a headless service to manage the Redis StatefulSet:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<h5 id="Step-3-Configure-Redis-Access-in-Spring-Boot"><a href="#Step-3-Configure-Redis-Access-in-Spring-Boot" class="headerlink" title="Step 3: Configure Redis Access in Spring Boot"></a>Step 3: Configure Redis Access in Spring Boot</h5><p>When deploying your Spring Boot application in Kubernetes, you should use the service name to access Redis. Update your <code>application.yml</code> to use the service name:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>

<h5 id="Step-4-Enable-Redis-Persistence"><a href="#Step-4-Enable-Redis-Persistence" class="headerlink" title="Step 4: Enable Redis Persistence"></a>Step 4: Enable Redis Persistence</h5><p>To enable Redis persistence, configure the <code>redis.conf</code> file to use either RDB (Redis Database Backup) or AOF (Append-Only File) persistence:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<h5 id="Step-5-Secure-Redis"><a href="#Step-5-Secure-Redis" class="headerlink" title="Step 5: Secure Redis"></a>Step 5: Secure Redis</h5><p>Secure Redis by setting a password and enabling TLS:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">requirepass yourpassword</span><br><span class="line">tls-port 6379</span><br><span class="line">tls-cert-file /path/to/redis.crt</span><br><span class="line">tls-key-file /path/to/redis.key</span><br><span class="line">tls-ca-cert-file /path/to/ca.crt</span><br></pre></td></tr></table></figure>

<h5 id="Step-6-Monitor-Redis"><a href="#Step-6-Monitor-Redis" class="headerlink" title="Step 6: Monitor Redis"></a>Step 6: Monitor Redis</h5><p>Use Prometheus and Grafana to monitor Redis performance and health. Deploy a Redis exporter to expose Redis metrics:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-exporter</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis-exporter</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis-exporter</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-exporter</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">oliver006/redis_exporter:latest</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--redis.addr=redis:6379</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--redis.password=yourpassword</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9121</span></span><br></pre></td></tr></table></figure>

<p>Create a service to expose the Redis exporter:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-exporter</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis-exporter</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9121</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">9121</span></span><br></pre></td></tr></table></figure>

<h3 id="Data-Storage-Layer"><a href="#Data-Storage-Layer" class="headerlink" title="Data Storage Layer"></a><a name="data-storage-layer"></a>Data Storage Layer</h3><p>The data storage layer is the primary data store where data is persisted. It can be a relational database, NoSQL database, or any other storage solution.</p>
<h4 id="Diagram-1"><a href="#Diagram-1" class="headerlink" title="Diagram"></a>Diagram</h4><pre><code class="highlight mermaid">graph TD
    A[Service Layer] --&gt; B[Data Storage Layer]
    B --&gt; C[Relational Database]
    B --&gt; D[NoSQL Database]</code></pre>

<h4 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// Database save logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Service-Layer"><a href="#Service-Layer" class="headerlink" title="Service Layer"></a><a name="service-layer"></a>Service Layer</h3><p>The service layer handles business logic and interacts with the cache and data storage layers. It is responsible for managing the flow of data between the client, cache, and data storage.</p>
<h4 id="Diagram-2"><a href="#Diagram-2" class="headerlink" title="Diagram"></a>Diagram</h4><pre><code class="highlight mermaid">graph TD
    A[Client] --&gt; B[Service Layer]
    B --&gt; C[Cache Layer]
    B --&gt; D[Data Storage Layer]</code></pre>

<h4 id="Sample-Code-1"><a href="#Sample-Code-1" class="headerlink" title="Sample Code"></a>Sample Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CacheService cacheService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> cacheService.getUserById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            user = userRepository.findById(userId);</span><br><span class="line">            cacheService.saveUser(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        cacheService.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Load-Balancer"><a href="#Load-Balancer" class="headerlink" title="Load Balancer"></a><a name="load-balancer"></a>Load Balancer</h3><p>The load balancer distributes incoming requests across multiple instances of the service layer to ensure high availability and scalability.</p>
<h4 id="Diagram-3"><a href="#Diagram-3" class="headerlink" title="Diagram"></a>Diagram</h4><pre><code class="highlight mermaid">graph TD
    A[Client] --&gt; B[Load Balancer]
    B --&gt; C[Service Instance 1]
    B --&gt; D[Service Instance 2]
    B --&gt; E[Service Instance 3]</code></pre>

<h4 id="Sample-Code-2"><a href="#Sample-Code-2" class="headerlink" title="Sample Code"></a>Sample Code</h4><p>Load balancers are typically implemented using infrastructure components like NGINX, HAProxy, or cloud-provided load balancers (e.g., AWS ELB, Google Cloud Load Balancer).</p>
<h3 id="Monitoring-and-Metrics"><a href="#Monitoring-and-Metrics" class="headerlink" title="Monitoring and Metrics"></a><a name="monitoring-and-metrics"></a>Monitoring and Metrics</h3><p>Monitoring and metrics collection are essential for tracking the performance and health of the distributed system. Tools like Prometheus, Grafana, and ELK stack can be used for this purpose.</p>
<h4 id="Diagram-4"><a href="#Diagram-4" class="headerlink" title="Diagram"></a>Diagram</h4><pre><code class="highlight mermaid">graph TD
    A[Service Layer] --&gt; B[Monitoring and Metrics]
    B --&gt; C[Prometheus]
    B --&gt; D[Grafana]
    B --&gt; E[ELK Stack]</code></pre>

<h4 id="Sample-Code-3"><a href="#Sample-Code-3" class="headerlink" title="Sample Code"></a>Sample Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.prometheus.client.Counter;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.Gauge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheHits</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_hits_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache hits.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheMisses</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_misses_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache misses.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Gauge</span> <span class="variable">cacheSize</span> <span class="operator">=</span> Gauge.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_size&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Current size of the cache.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recordCacheHit</span><span class="params">()</span> &#123;</span><br><span class="line">        cacheHits.inc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recordCacheMiss</span><span class="params">()</span> &#123;</span><br><span class="line">        cacheMisses.inc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCacheSize</span><span class="params">(<span class="type">long</span> size)</span> &#123;</span><br><span class="line">        cacheSize.set(size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="complex-scenario-1-flow-control-and-backpressure-handling"></a></p>
<h2 id="Complex-Scenario-1-Flow-Control-and-Backpressure-Handling"><a href="#Complex-Scenario-1-Flow-Control-and-Backpressure-Handling" class="headerlink" title="Complex Scenario 1: Flow Control and Backpressure Handling"></a>Complex Scenario 1: Flow Control and Backpressure Handling</h2><h3 id="Problem-Statement"><a href="#Problem-Statement" class="headerlink" title="Problem Statement"></a>Problem Statement</h3><p>In high-traffic scenarios, the cache might become a bottleneck if not properly managed. Flow control and backpressure handling are essential to prevent the cache from being overwhelmed.</p>
<h3 id="Solution-Architecture"><a href="#Solution-Architecture" class="headerlink" title="Solution Architecture"></a>Solution Architecture</h3><ol>
<li><strong>Rate Limiting</strong>: Implement rate limiting to control the number of requests hitting the cache.</li>
<li><strong>Circuit Breaker</strong>: Use a circuit breaker to handle failures gracefully and prevent cascading failures.</li>
<li><strong>Backpressure Handling</strong>: Implement backpressure mechanisms to manage the flow of data between services.</li>
</ol>
<h3 id="Flow-Chart"><a href="#Flow-Chart" class="headerlink" title="Flow Chart"></a>Flow Chart</h3><pre><code class="highlight mermaid">graph TD
    A[Client Request] --&gt; B&#123;Rate Limiter&#125;
    B --&gt;|Allowed| C[Cache Lookup]
    B --&gt;|Denied| D[Fallback to Database]
    C --&gt; E&#123;Cache Hit?&#125;
    E --&gt;|Yes| F[Return Cached Data]
    E --&gt;|No| G[Fetch from Database]
    G --&gt; H[Update Cache]
    H --&gt; F
    D --&gt; G</code></pre>

<h3 id="Sample-Code-4"><a href="#Sample-Code-4" class="headerlink" title="Sample Code"></a>Sample Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Fetch user from database</span></span><br><span class="line">        <span class="keyword">return</span> fetchUserFromDatabase(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="complex-scenario-2-cache-invalidation-and-data-synchronization"></a></p>
<h2 id="Complex-Scenario-2-Cache-Invalidation-and-Data-Synchronization"><a href="#Complex-Scenario-2-Cache-Invalidation-and-Data-Synchronization" class="headerlink" title="Complex Scenario 2: Cache Invalidation and Data Synchronization"></a>Complex Scenario 2: Cache Invalidation and Data Synchronization</h2><h3 id="Problem-Statement-1"><a href="#Problem-Statement-1" class="headerlink" title="Problem Statement"></a>Problem Statement</h3><p>Ensuring that the cache remains consistent with the underlying data store is challenging, especially in distributed systems.</p>
<h3 id="Solution-Architecture-1"><a href="#Solution-Architecture-1" class="headerlink" title="Solution Architecture"></a>Solution Architecture</h3><ol>
<li><strong>Event-Driven Invalidation</strong>: Use event-driven mechanisms to invalidate the cache when data changes.</li>
<li><strong>Distributed Locking</strong>: Use distributed locking to ensure that only one service updates the cache at a time.</li>
<li><strong>TTL-Based Invalidation</strong>: Use Time-to-Live (TTL) to automatically invalidate cache entries after a certain period.</li>
</ol>
<h3 id="Sequence-Diagram"><a href="#Sequence-Diagram" class="headerlink" title="Sequence Diagram"></a>Sequence Diagram</h3><pre><code class="highlight mermaid">sequenceDiagram
    participant Client
    participant Service
    participant Cache
    participant Database

    Client-&gt;&gt;Service: Update User
    Service-&gt;&gt;Database: Update User in Database
    Database--&gt;&gt;Service: User Updated
    Service-&gt;&gt;Cache: Invalidate User Cache
    Cache--&gt;&gt;Service: Cache Invalidated
    Service--&gt;&gt;Client: User Updated</code></pre>

<h3 id="Sample-Code-5"><a href="#Sample-Code-5" class="headerlink" title="Sample Code"></a>Sample Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(Long userId, User user)</span> &#123;</span><br><span class="line">        <span class="comment">// Update user in database</span></span><br><span class="line">        updateUserInDatabase(userId, user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateUserInDatabase</span><span class="params">(Long userId, User user)</span> &#123;</span><br><span class="line">        <span class="comment">// Database update logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="complex-scenario-3-cache-stampede-prevention"></a></p>
<h2 id="Complex-Scenario-3-Cache-Stampede-Prevention"><a href="#Complex-Scenario-3-Cache-Stampede-Prevention" class="headerlink" title="Complex Scenario 3: Cache Stampede Prevention"></a>Complex Scenario 3: Cache Stampede Prevention</h2><h3 id="Problem-Statement-2"><a href="#Problem-Statement-2" class="headerlink" title="Problem Statement"></a>Problem Statement</h3><p>A cache stampede occurs when multiple requests for the same data hit the cache simultaneously, leading to a spike in database load.</p>
<h3 id="Solution-Architecture-2"><a href="#Solution-Architecture-2" class="headerlink" title="Solution Architecture"></a>Solution Architecture</h3><ol>
<li><strong>Probabilistic Early Expiration</strong>: Use probabilistic early expiration to spread out cache expiration times.</li>
<li><strong>Locking Mechanism</strong>: Implement a locking mechanism to ensure that only one request populates the cache at a time.</li>
<li><strong>Background Refresh</strong>: Use background refresh to keep the cache up-to-date without impacting the user experience.</li>
</ol>
<h3 id="Flow-Chart-1"><a href="#Flow-Chart-1" class="headerlink" title="Flow Chart"></a>Flow Chart</h3><pre><code class="highlight mermaid">graph TD
    A[Client Request] --&gt; B&#123;Cache Hit?&#125;
    B --&gt;|Yes| C[Return Cached Data]
    B --&gt;|No| D&#123;Lock Acquired?&#125;
    D --&gt;|Yes| E[Fetch from Database]
    D --&gt;|No| F[Wait for Lock]
    E --&gt; G[Update Cache]
    G --&gt; C
    F --&gt; B</code></pre>

<h3 id="Sample-Code-6"><a href="#Sample-Code-6" class="headerlink" title="Sample Code"></a>Sample Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">// Double-check to ensure the cache is still empty</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">cachedUser</span> <span class="operator">=</span> fetchUserFromCache(userId);</span><br><span class="line">            <span class="keyword">if</span> (cachedUser != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> cachedUser;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Fetch user from database</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> fetchUserFromDatabase(userId);</span><br><span class="line">            <span class="comment">// Update cache</span></span><br><span class="line">            updateCache(userId, user);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromCache</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Cache lookup logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateCache</span><span class="params">(Long userId, User user)</span> &#123;</span><br><span class="line">        <span class="comment">// Cache update logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Caching is a powerful mechanism for improving the performance and scalability of distributed systems. By understanding the high-level architecture and detailed designs, you can effectively implement cache mechanisms that handle various complex scenarios like flow control, cache invalidation, and cache stampede prevention. Use the provided sample code and diagrams to implement efficient caching in your distributed system.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-Caching-for-Distributed-Systems/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-into-Caching-for-Distributed-Systems/" class="post-title-link" itemprop="url">Deep Dive into Caching for Distributed Systems</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 15:07:03 / Modified: 16:36:15" itemprop="dateCreated datePublished" datetime="2024-10-27T15:07:03-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/" itemprop="url" rel="index"><span itemprop="name">Cache</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/Distributed-System/" itemprop="url" rel="index"><span itemprop="name">Distributed System</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#1-overview-and-high-level-architecture">1. Overview and High-Level Architecture</a><ul>
<li><a href="#high-level-architecture-diagram">High-Level Architecture Diagram</a></li>
</ul>
</li>
<li><a href="#2-cache-design-patterns">2. Cache Design Patterns</a><ul>
<li><a href="#21-read-through-cache">2.1 Read-Through Cache</a></li>
<li><a href="#22-write-through-cache">2.2 Write-Through Cache</a></li>
<li><a href="#23-write-behind-cache">2.3 Write-Behind Cache</a></li>
<li><a href="#24-cache-aside-pattern">2.4 Cache-Aside Pattern</a></li>
<li><a href="#25-differences-between-read-through-and-cache-aside-patterns">2.5 Differences between Read-Through and Cache-Aside Patterns</a></li>
</ul>
</li>
<li><a href="#3-cache-topologies">3. Cache Topologies</a><ul>
<li><a href="#31-single-node-cache">3.1 Single Node Cache</a></li>
<li><a href="#32-distributed-cache">3.2 Distributed Cache</a></li>
<li><a href="#33-hierarchical-cache">3.3 Hierarchical Cache</a></li>
</ul>
</li>
<li><a href="#4-detailed-design-and-components">4. Detailed Design and Components</a><ul>
<li><a href="#41-cache-consistency">4.1 Cache Consistency</a></li>
<li><a href="#42-cache-invalidation-strategies">4.2 Cache Invalidation Strategies</a></li>
<li><a href="#43-eviction-policies">4.3 Eviction Policies</a></li>
</ul>
</li>
<li><a href="#5-implementation">5. Implementation</a><ul>
<li><a href="#51-cache-layer-implementation">5.1 Cache Layer Implementation</a></li>
<li><a href="#52-cache-invalidation-mechanisms">5.2 Cache Invalidation Mechanisms</a></li>
</ul>
</li>
<li><a href="#6-monitoring-and-metrics">6. Monitoring and Metrics</a></li>
<li><a href="#7-conclusion">7. Conclusion</a></li>
</ul>
<hr>
<p>Effective caching can significantly improve the performance and scalability of distributed systems by reducing the load on databases and backend services. This document covers high-level architecture, detailed design, and sample code for implementing caching in distributed systems.</p>
<p><a name="overview-and-high-level-architecture"></a></p>
<h2 id="1-Overview-and-High-Level-Architecture"><a href="#1-Overview-and-High-Level-Architecture" class="headerlink" title="1. Overview and High-Level Architecture"></a>1. Overview and High-Level Architecture</h2><p>Caching in distributed systems improves data retrieval speeds, reduces network latency, and offloads backend databases. A typical caching architecture includes clients, a caching layer, and a backend data source. The caching layer can reside in-memory on the application server or be a distributed cache like <strong>Redis</strong>, <strong>Memcached</strong>, or <strong>Hazelcast</strong>.</p>
<h3 id="High-Level-Architecture-Diagram"><a href="#High-Level-Architecture-Diagram" class="headerlink" title="High-Level Architecture Diagram"></a>High-Level Architecture Diagram</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+----------+        +--------------+        +--------------------+</span><br><span class="line">|  Clients | &lt;----&gt; |  Cache Layer | &lt;----&gt; | Backend Data Store |</span><br><span class="line">+----------+        +--------------+        +--------------------+</span><br></pre></td></tr></table></figure>

<p><strong>Components:</strong></p>
<ul>
<li><strong>Clients</strong>: The applications or services making requests for data.</li>
<li><strong>Cache Layer</strong>: Responsible for storing frequently accessed data, reducing read times.</li>
<li><strong>Backend Data Source</strong>: The main data storage, typically a database or another service.</li>
</ul>
<p><a name="cache-design-patterns"></a></p>
<h2 id="2-Cache-Design-Patterns"><a href="#2-Cache-Design-Patterns" class="headerlink" title="2. Cache Design Patterns"></a>2. Cache Design Patterns</h2><p>Caching strategies are essential in defining how data is managed between the cache and the main data store.</p>
<p><a name="read-through-cache"></a></p>
<h3 id="2-1-Read-Through-Cache"><a href="#2-1-Read-Through-Cache" class="headerlink" title="2.1 Read-Through Cache"></a>2.1 Read-Through Cache</h3><p>In a read-through cache, requests for data are directed to the cache. If the data is not in the cache, it retrieves it from the database, caches it, and then serves the data.</p>
<p><strong>Diagram</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">         +--------------+        +----------+        +--------------+</span><br><span class="line">Request  |  Application | -----&gt; |   Cache  | -----&gt; |  Database    |</span><br><span class="line">         +--------------+        +----------+        +--------------+</span><br><span class="line">               |                       |                    </span><br><span class="line">               +-----------------------+                        </span><br><span class="line">             (Data cached after first retrieval)</span><br></pre></td></tr></table></figure>

<p><strong>Code Example</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadThroughCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Cache cache;</span><br><span class="line">    <span class="keyword">private</span> Database database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Data <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">Data</span> <span class="variable">data</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">            data = database.get(key);</span><br><span class="line">            cache.put(key, data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="write-through-cache"></a></p>
<h3 id="2-2-Write-Through-Cache"><a href="#2-2-Write-Through-Cache" class="headerlink" title="2.2 Write-Through Cache"></a>2.2 Write-Through Cache</h3><p>In this pattern, data is written to the cache and database simultaneously, ensuring cache consistency with the data source.</p>
<p><strong>Diagram</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">         +--------------+        +----------+        +--------------+</span><br><span class="line">Update   |  Application | -----&gt; |   Cache  | -----&gt; |  Database    |</span><br><span class="line">         +--------------+        +----------+        +--------------+</span><br><span class="line">                       (Writes to cache and database together)</span><br></pre></td></tr></table></figure>

<p><strong>Code Example</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WriteThroughCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Cache cache;</span><br><span class="line">    <span class="keyword">private</span> Database database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putData</span><span class="params">(String key, Data data)</span> &#123;</span><br><span class="line">        cache.put(key, data);</span><br><span class="line">        database.put(key, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="write-behind-cache"></a></p>
<h3 id="2-3-Write-Behind-Cache"><a href="#2-3-Write-Behind-Cache" class="headerlink" title="2.3 Write-Behind Cache"></a>2.3 Write-Behind Cache</h3><p>The write-behind cache writes data asynchronously to the backend, which enhances write performance but requires a queue to manage pending updates.</p>
<p><strong>Diagram</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">         +--------------+        +----------+        +--------------+</span><br><span class="line">Update   |  Application | -----&gt; |   Cache  | -----&gt; |   Queue      |</span><br><span class="line">         +--------------+        +----------+        +--------------+</span><br><span class="line">                              (Data asynchronously written to Database)</span><br></pre></td></tr></table></figure>

<p><strong>Code Example</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WriteBehindCacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Database database;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WriteBehindCacheService</span><span class="params">(Cache cache, Database database)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cache = cache;</span><br><span class="line">        <span class="built_in">this</span>.database = database;</span><br><span class="line">        <span class="built_in">this</span>.executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putData</span><span class="params">(String key, Data data)</span> &#123;</span><br><span class="line">        <span class="comment">// Step 1: Write to cache</span></span><br><span class="line">        cache.put(key, data);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 2: Asynchronously update the database</span></span><br><span class="line">        executorService.submit(() -&gt; database.put(key, data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Data <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache.get(key); <span class="comment">// Read from cache</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, when <code>putData</code> is called, the data is immediately written to the cache, and an asynchronous task is created to update the database. This method improves application performance by deferring the database write.</p>
<p><a name="cache-aside-pattern"></a></p>
<h3 id="2-4-Cache-Aside-Pattern"><a href="#2-4-Cache-Aside-Pattern" class="headerlink" title="2.4 Cache-Aside Pattern"></a>2.4 Cache-Aside Pattern</h3><p>With the cache-aside pattern, the application retrieves data directly from the cache. On a cache miss, it loads data from the main store, updates the cache, and returns the result.</p>
<p><strong>Diagram</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+--------------+       +----------+       +--------------+</span><br><span class="line">| Application  | ----&gt; |  Cache   | ----&gt; |  Database    |</span><br><span class="line">+--------------+       +----------+       +--------------+</span><br><span class="line">        |                          |</span><br><span class="line">       (Data fetched and cached when not found in cache)</span><br></pre></td></tr></table></figure>

<p><strong>Code Example</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheAsideService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Database database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CacheAsideService</span><span class="params">(Cache cache, Database database)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cache = cache;</span><br><span class="line">        <span class="built_in">this</span>.database = database;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Data <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// Step 1: Check cache first</span></span><br><span class="line">        <span class="type">Data</span> <span class="variable">data</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Step 2: Load from database on cache miss</span></span><br><span class="line">            data = database.get(key);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (data != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Step 3: Store data in cache for future requests</span></span><br><span class="line">                cache.put(key, data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putData</span><span class="params">(String key, Data data)</span> &#123;</span><br><span class="line">        <span class="comment">// Step 1: Write to database</span></span><br><span class="line">        database.put(key, data);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 2: Invalidate cache or update cache</span></span><br><span class="line">        cache.put(key, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example:</p>
<ul>
<li><strong>Read</strong>: <code>getData()</code> first tries to read from the cache. If there’s a cache miss, it fetches from the database, adds it to the cache, and returns the data.</li>
<li><strong>Write</strong>: <code>putData()</code> writes to the database first, then updates or invalidates the cache.</li>
</ul>
<p><a name="differences-between-read-through-and-cache-aside-patterns"></a></p>
<h3 id="2-5-Differences-between-Read-Through-and-Cache-Aside-Patterns"><a href="#2-5-Differences-between-Read-Through-and-Cache-Aside-Patterns" class="headerlink" title="2.5 Differences between Read-Through and Cache-Aside Patterns"></a>2.5 Differences between Read-Through and Cache-Aside Patterns</h3><ol>
<li><p><strong>Read-Through Pattern</strong>:</p>
<ul>
<li>The cache sits directly in front of the database, intercepting reads.</li>
<li>If data is requested, the cache checks if it’s present. If it’s a cache miss, it automatically fetches from the database, caches it, and returns the result.</li>
<li>This pattern works well for applications where you want to decouple the application logic from the cache management.</li>
<li>Common in systems where caching is managed as a service, like using a caching proxy or middleware.</li>
</ul>
</li>
<li><p><strong>Cache-Aside Pattern</strong>:</p>
<ul>
<li>The application controls cache management explicitly.</li>
<li>On a read operation, the application first checks the cache. If the data is not present (cache miss), the application fetches it from the database, then stores it in the cache for future use.</li>
<li>This pattern gives the application full control over what data is cached, which can optimize cache usage for applications with varying data access patterns.</li>
<li>Common in scenarios where cache storage is limited or there’s a need to frequently update specific items based on application logic.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Read-Through Pattern</th>
<th>Cache-Aside Pattern</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Cache Management</strong></td>
<td>Managed by the cache itself</td>
<td>Managed by the application</td>
</tr>
<tr>
<td><strong>Caching Behavior</strong></td>
<td>Automatically loads from DB on cache miss</td>
<td>Application decides when to cache</td>
</tr>
<tr>
<td><strong>Best Use Cases</strong></td>
<td>For systems requiring a cache as a service</td>
<td>For applications needing custom control over caching</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>Lower, as caching logic is handled internally</td>
<td>Higher, as caching must be managed in the application</td>
</tr>
</tbody></table>
<hr>
<p><a name="cache-topologies"></a></p>
<h2 id="3-Cache-Topologies"><a href="#3-Cache-Topologies" class="headerlink" title="3. Cache Topologies"></a>3. Cache Topologies</h2><p><a name="single-node-cache"></a></p>
<h3 id="3-1-Single-Node-Cache"><a href="#3-1-Single-Node-Cache" class="headerlink" title="3.1 Single Node Cache"></a>3.1 Single Node Cache</h3><p>Single-node caches store data locally on one machine and are simple to manage but lack scalability and resilience.</p>
<p><a name="distributed-cache"></a></p>
<h3 id="3-2-Distributed-Cache"><a href="#3-2-Distributed-Cache" class="headerlink" title="3.2 Distributed Cache"></a>3.2 Distributed Cache</h3><p>A distributed cache spreads data across multiple nodes for scalability, enabling data to be accessed from various locations in a distributed system.</p>
<p><strong>Diagram</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+----------+     +-------------+     +-------------+     +-------------+</span><br><span class="line">| Client 1 |&lt;---&gt;| Cache Node 1|&lt;---&gt;| Cache Node 2|&lt;---&gt;| Cache Node 3|</span><br><span class="line">+----------+     +-------------+     +-------------+     +-------------+</span><br></pre></td></tr></table></figure>

<p><a name="hierarchical-cache"></a></p>
<h3 id="3-3-Hierarchical-Cache"><a href="#3-3-Hierarchical-Cache" class="headerlink" title="3.3 Hierarchical Cache"></a>3.3 Hierarchical Cache</h3><p>Hierarchical caches use a layered approach to caching, with data stored at different levels depending on usage frequency.</p>
<p><strong>Diagram</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+               </span><br><span class="line">|  L1 Cache   |                 </span><br><span class="line">+-------------+               </span><br><span class="line">       |                              </span><br><span class="line">+-------------+                       </span><br><span class="line">|  L2 Cache   |                       </span><br><span class="line">+-------------+                       </span><br><span class="line">       |                              </span><br><span class="line">+-------------+                       </span><br><span class="line">|  Backend DB |                       </span><br><span class="line">+-------------+                       </span><br></pre></td></tr></table></figure>

<p><a name="detailed-design-and-components"></a></p>
<h2 id="4-Detailed-Design-and-Components"><a href="#4-Detailed-Design-and-Components" class="headerlink" title="4. Detailed Design and Components"></a>4. Detailed Design and Components</h2><p><a name="cache-consistency"></a></p>
<h3 id="4-1-Cache-Consistency"><a href="#4-1-Cache-Consistency" class="headerlink" title="4.1 Cache Consistency"></a>4.1 Cache Consistency</h3><p>Consistency in caching ensures that the data in the cache matches the data in the database. Techniques like cache synchronization and write-through strategies help maintain this consistency.</p>
<p><a name="cache-invalidation-strategies"></a></p>
<h3 id="4-2-Cache-Invalidation-Strategies"><a href="#4-2-Cache-Invalidation-Strategies" class="headerlink" title="4.2 Cache Invalidation Strategies"></a>4.2 Cache Invalidation Strategies</h3><p>Cache invalidation ensures that stale data is removed or updated within the cache. Common strategies include:</p>
<ul>
<li><strong>Time-based Expiration</strong>: Setting a TTL (Time to Live) for cache entries.</li>
<li><strong>Event-based Invalidation</strong>: Using events to invalidate cache entries based on specific triggers.</li>
</ul>
<p><a name="eviction-policies"></a></p>
<h3 id="4-3-Eviction-Policies"><a href="#4-3-Eviction-Policies" class="headerlink" title="4.3 Eviction Policies"></a>4.3 Eviction Policies</h3><p>Eviction policies determine how cache space is managed. Common policies include:</p>
<ul>
<li><strong>Least Recently Used (LRU)</strong>: Removes data that hasn’t been accessed recently.</li>
<li><strong>Least Frequently Used (LFU)</strong>: Removes data that is accessed least frequently.</li>
</ul>
<p><a name="implementation"></a></p>
<h2 id="5-Implementation"><a href="#5-Implementation" class="headerlink" title="5. Implementation"></a>5. Implementation</h2><p><a name="cache-layer-implementation"></a></p>
<h3 id="5-1-Cache-Layer-Implementation"><a href="#5-1-Cache-Layer-Implementation" class="headerlink" title="5.1 Cache Layer Implementation"></a>5.1 Cache Layer Implementation</h3><p>Using Redis as an example of a distributed cache layer:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        jedis.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jedis.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        jedis.del(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="cache-invalidation-mechanisms"></a></p>
<h3 id="5-2-Cache-Invalidation-Mechanisms"><a href="#5-2-Cache-Invalidation-Mechanisms" class="headerlink" title="5.2 Cache Invalidation Mechanisms"></a>5.2 Cache Invalidation Mechanisms</h3><p>Implementing cache invalidation using a TTL and a cache purge mechanism:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Cache</span> <span class="variable">cache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cache</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, Data value, <span class="type">long</span> ttl, TimeUnit unit)</span> &#123;</span><br><span class="line">        cache.put(key, value);</span><br><span class="line">        cache.expire(key, ttl, unit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="monitoring-and-metrics"></a></p>
<h2 id="6-Monitoring-and-Metrics"><a href="#6-Monitoring-and-Metrics" class="headerlink" title="6. Monitoring and Metrics"></a>6. Monitoring and Metrics</h2><p>Monitoring the cache layer provides insights into performance. Using tools like <strong>Prometheus</strong> and <strong>Grafana</strong> with metrics for cache hit&#x2F;miss rates, latency, and eviction rates is essential.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example Prometheus configuration for Redis</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;redis&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:6379&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="7-Conclusion"><a href="#7-Conclusion" class="headerlink" title="7. Conclusion"></a>7. Conclusion</h2><p>Distributed caching is a vital component of scalable systems. By understanding different patterns, topologies, and consistency mechanisms, developers can effectively improve system performance and reliability.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-Caffeine-Cache-and-Integration-with-Spring-Boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-into-Caffeine-Cache-and-Integration-with-Spring-Boot/" class="post-title-link" itemprop="url">Deep Dive into Caffeine Cache and Integration with Spring Boot</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 13:55:44 / Modified: 14:58:57" itemprop="dateCreated datePublished" datetime="2024-10-27T13:55:44-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/" itemprop="url" rel="index"><span itemprop="name">Cache</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#caffeine-cache-overview">Caffeine Cache Overview</a><ul>
<li><a href="#key-features">Key Features</a></li>
</ul>
</li>
<li><a href="#configuring-caffeine-cache-in-spring-boot">Configuring Caffeine Cache in Spring Boot</a><ul>
<li><a href="#adding-dependencies">Adding Dependencies</a></li>
<li><a href="#enabling-caching">Enabling Caching</a></li>
<li><a href="#configuring-cache-manager">Configuring Cache Manager</a></li>
<li><a href="#yaml-configuration">YAML Configuration</a></li>
<li><a href="#explanation-of-caffeine-cache-configuration">Explanation of Caffeine Cache Configuration</a></li>
</ul>
</li>
<li><a href="#how-caffeine-cache-works">How Caffeine Cache Works</a><ul>
<li><a href="#cache-population">Cache Population</a></li>
<li><a href="#cache-eviction">Cache Eviction</a></li>
<li><a href="#expiration">Expiration</a></li>
<li><a href="#statistics">Statistics</a><ul>
<li><a href="#statistics-recording">Statistics Recording</a></li>
<li><a href="#tracking-cache-hits-misses-and-evictions">Tracking Cache Hits, Misses, and Evictions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#caffeine-cache-internals">Caffeine Cache Internals</a><ul>
<li><a href="#cache-interface">Cache Interface</a></li>
<li><a href="#caffeine-class">Caffeine Class</a></li>
<li><a href="#boundedlocalcache-class">BoundedLocalCache Class</a></li>
<li><a href="#detailed-logic-in-caffeine-cache">Detailed Logic in Caffeine Cache</a><ul>
<li><a href="#cache-lookup">Cache Lookup</a></li>
<li><a href="#cache-miss-and-method-execution">Cache Miss and Method Execution</a></li>
<li><a href="#cache-update">Cache Update</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#real-life-production-use-cases">Real-Life Production Use Cases</a><ul>
<li><a href="#1-user-profile-caching">1. <strong>User Profile Caching</strong></a></li>
<li><a href="#2-product-catalog-caching">2. <strong>Product Catalog Caching</strong></a></li>
<li><a href="#3-api-response-caching">3. <strong>API Response Caching</strong></a></li>
<li><a href="#4-session-data-caching">4. <strong>Session Data Caching</strong></a></li>
</ul>
</li>
<li><a href="#sample-code">Sample Code</a><ul>
<li><a href="#caffeine-cache-configuration">Caffeine Cache Configuration</a></li>
<li><a href="#user-service-with-caching">User Service with Caching</a></li>
<li><a href="#flow-diagram">Flow Diagram</a></li>
<li><a href="#explanation-of-the-flow-diagram">Explanation of the Flow Diagram</a></li>
</ul>
</li>
<li><a href="#statistics-logging-tracking-and-mornitoring">Statistics Logging, Tracking and Mornitoring</a><ul>
<li><a href="#1-logging-cache-statistics">1. <strong>Logging Cache Statistics</strong></a><ul>
<li><a href="#example-logging-cache-statistics-with-slf4j">Example: Logging Cache Statistics with SLF4J</a></li>
</ul>
</li>
<li><a href="#2-integrating-with-gui-tools">2. <strong>Integrating with GUI Tools</strong></a><ul>
<li><a href="#step-1-add-prometheus-and-grafana-dependencies">Step 1: Add Prometheus and Grafana Dependencies</a></li>
<li><a href="#step-2-configure-prometheus-metrics-collector">Step 2: Configure Prometheus Metrics Collector</a></li>
<li><a href="#step-3-configure-prometheus-and-grafana">Step 3: Configure Prometheus and Grafana</a></li>
</ul>
</li>
<li><a href="#example-prometheus-configuration">Example: Prometheus Configuration</a></li>
<li><a href="#example-grafana-dashboard">Example: Grafana Dashboard</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Caffeine is a high-performance, near-optimal caching library for Java, widely used in Spring Boot applications to improve performance by reducing the load on databases and other backend services. This article delves into the details of Caffeine cache, its integration with Spring Boot, and how it works under the hood. We’ll also provide real-life production use cases and sample code to illustrate its usage.</p>
<hr>
<p><a name="caffeine-cache-overview"></a></p>
<h2 id="Caffeine-Cache-Overview"><a href="#Caffeine-Cache-Overview" class="headerlink" title="Caffeine Cache Overview"></a>Caffeine Cache Overview</h2><p>Caffeine is designed to be efficient and easy to use, providing advanced features like eviction policies, time-based expiration, and statistics recording. It uses a combination of data structures and algorithms to manage cache entries efficiently.</p>
<h3 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features"></a>Key Features</h3><ul>
<li><strong>High Performance</strong>: Optimized for fast read and write operations.</li>
<li><strong>Eviction Policies</strong>: Supports LRU, FIFO, and LFU eviction policies.</li>
<li><strong>Time-Based Expiration</strong>: Entries can be expired after a specified period of inactivity or since they were last written.</li>
<li><strong>Statistics Recording</strong>: Tracks cache hits, misses, and evictions for monitoring and tuning.</li>
</ul>
<hr>
<p><a name="configuring-caffeine-cache-in-spring-boot"></a></p>
<h2 id="Configuring-Caffeine-Cache-in-Spring-Boot"><a href="#Configuring-Caffeine-Cache-in-Spring-Boot" class="headerlink" title="Configuring Caffeine Cache in Spring Boot"></a>Configuring Caffeine Cache in Spring Boot</h2><h3 id="Adding-Dependencies"><a href="#Adding-Dependencies" class="headerlink" title="Adding Dependencies"></a><a name="adding-dependencies"></a>Adding Dependencies</h3><p>First, ensure you have the necessary dependencies in your <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>caffeine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Enabling-Caching"><a href="#Enabling-Caching" class="headerlink" title="Enabling Caching"></a><a name="enabling-caching"></a>Enabling Caching</h3><p>Enable caching in your Spring Boot application by adding the <code>@EnableCaching</code> annotation to your main application class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Cache-Manager"><a href="#Configuring-Cache-Manager" class="headerlink" title="Configuring Cache Manager"></a><a name="configuring-cache-manager"></a>Configuring Cache Manager</h3><p>Create a configuration class to set up Caffeine cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.caffeine.CaffeineCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CaffeineCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CaffeineCacheManager</span>(<span class="string">&quot;userCache&quot;</span>, <span class="string">&quot;productCache&quot;</span>);</span><br><span class="line">        cacheManager.setCaffeine(caffeineCacheBuilder());</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Caffeine&lt;Object, Object&gt; <span class="title function_">caffeineCacheBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">500</span>)</span><br><span class="line">                .expireAfterAccess(<span class="number">600</span>, TimeUnit.SECONDS)</span><br><span class="line">                .recordStats();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="YAML-Configuration"><a href="#YAML-Configuration" class="headerlink" title="YAML Configuration"></a><a name="yaml-configuration"></a>YAML Configuration</h3><p>You can also configure Caffeine cache using YAML:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">caffeine</span></span><br><span class="line">    <span class="attr">cache-names:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">userCache</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">productCache</span></span><br><span class="line">    <span class="attr">caffeine:</span></span><br><span class="line">      <span class="attr">spec:</span> <span class="string">maximumSize=500,expireAfterAccess=600s</span></span><br></pre></td></tr></table></figure>

<h3 id="Explanation-of-Caffeine-Cache-Configuration"><a href="#Explanation-of-Caffeine-Cache-Configuration" class="headerlink" title="Explanation of Caffeine Cache Configuration"></a>Explanation of Caffeine Cache Configuration</h3><ul>
<li><strong><code>CaffeineCacheManager</code></strong>: Manages multiple caches, each identified by a name.</li>
<li><strong>Cache Names</strong>: <code>&quot;userCache&quot;</code> and <code>&quot;productCache&quot;</code> are used to identify different caches.</li>
<li><strong><code>maximumSize(500)</code></strong>: Sets the maximum number of entries the cache can hold.</li>
<li><strong><code>expireAfterAccess(600, TimeUnit.SECONDS)</code></strong>: Specifies that entries should be expired after 600 seconds of inactivity.</li>
<li><strong><code>recordStats()</code></strong>: Enables statistics recording for monitoring cache performance.</li>
</ul>
<hr>
<p><a name="how-caffeine-cache-works"></a></p>
<h2 id="How-Caffeine-Cache-Works"><a href="#How-Caffeine-Cache-Works" class="headerlink" title="How Caffeine Cache Works"></a>How Caffeine Cache Works</h2><h3 id="Cache-Population"><a href="#Cache-Population" class="headerlink" title="Cache Population"></a><a name="cache-population"></a>Cache Population</h3><p>When a cache miss occurs, Caffeine fetches the data from the underlying data source (e.g., database) and stores it in the cache.</p>
<h3 id="Cache-Eviction"><a href="#Cache-Eviction" class="headerlink" title="Cache Eviction"></a><a name="cache-eviction"></a>Cache Eviction</h3><p>Caffeine uses various eviction policies to manage the cache size:</p>
<ul>
<li><strong>Least Recently Used (LRU)</strong>: Evicts the least recently used entries first.</li>
<li><strong>First In, First Out (FIFO)</strong>: Evicts the oldest entries first.</li>
<li><strong>Least Frequently Used (LFU)</strong>: Evicts the least frequently used entries first.</li>
</ul>
<h3 id="Expiration"><a href="#Expiration" class="headerlink" title="Expiration"></a><a name="expiration"></a>Expiration</h3><p>Caffeine supports time-based expiration:</p>
<ul>
<li><strong>Expire After Access</strong>: Entries are expired after a specified period of inactivity.</li>
<li><strong>Expire After Write</strong>: Entries are expired after a specified period since they were last written.</li>
</ul>
<h3 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a><a name="statistics"></a>Statistics</h3><p>Caffeine can record statistics such as cache hits, misses, and evictions, which can be useful for monitoring and tuning the cache.</p>
<h4 id="Statistics-Recording"><a href="#Statistics-Recording" class="headerlink" title="Statistics Recording"></a>Statistics Recording</h4><p>Caffeine provides a <code>recordStats()</code> method that enables the collection of cache statistics. This method returns a <code>Caffeine</code> instance that will record statistics for the cache.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Caffeine&lt;Object, Object&gt; <span class="title function_">caffeineCacheBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">500</span>)</span><br><span class="line">            .expireAfterAccess(<span class="number">600</span>, TimeUnit.SECONDS)</span><br><span class="line">            .recordStats();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Tracking-Cache-Hits-Misses-and-Evictions"><a href="#Tracking-Cache-Hits-Misses-and-Evictions" class="headerlink" title="Tracking Cache Hits, Misses, and Evictions"></a>Tracking Cache Hits, Misses, and Evictions</h4><p>Once statistics recording is enabled, you can access the statistics using the <code>stats()</code> method on the cache. This method returns a <code>CacheStats</code> object that contains various metrics:</p>
<ul>
<li><strong><code>hitCount()</code></strong>: The number of successful cache hits.</li>
<li><strong><code>missCount()</code></strong>: The number of cache misses.</li>
<li><strong><code>evictionCount()</code></strong>: The number of cache evictions.</li>
<li><strong><code>loadSuccessCount()</code></strong>: The number of times a cache miss was successfully loaded.</li>
<li><strong><code>loadFailureCount()</code></strong>: The number of times a cache miss failed to load.</li>
</ul>
<p>Here’s an example of how to access and log cache statistics:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.stats.CacheStats;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheStatisticsExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">100</span>)</span><br><span class="line">                .recordStats()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Perform cache operations</span></span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Access cache statistics</span></span><br><span class="line">        <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">        System.out.println(<span class="string">&quot;Cache Hits: &quot;</span> + stats.hitCount());</span><br><span class="line">        System.out.println(<span class="string">&quot;Cache Misses: &quot;</span> + stats.missCount());</span><br><span class="line">        System.out.println(<span class="string">&quot;Cache Evictions: &quot;</span> + stats.evictionCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="caffeine-cache-internals"></a></p>
<h2 id="Caffeine-Cache-Internals"><a href="#Caffeine-Cache-Internals" class="headerlink" title="Caffeine Cache Internals"></a>Caffeine Cache Internals</h2><h3 id="Cache-Interface"><a href="#Cache-Interface" class="headerlink" title="Cache Interface"></a><a name="cache-interface"></a>Cache Interface</h3><p>The <code>Cache</code> interface defines the core operations for interacting with the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span>&lt;K, V&gt; &#123;</span><br><span class="line">    V <span class="title function_">getIfPresent</span><span class="params">(K key)</span>;</span><br><span class="line">    V <span class="title function_">get</span><span class="params">(K key, Function&lt;? <span class="built_in">super</span> K, ? extends V&gt; mappingFunction)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">invalidate</span><span class="params">(K key)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">invalidateAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">long</span> <span class="title function_">estimatedSize</span><span class="params">()</span>;</span><br><span class="line">    CacheStats <span class="title function_">stats</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Caffeine-Class"><a href="#Caffeine-Class" class="headerlink" title="Caffeine Class"></a><a name="caffeine-class"></a>Caffeine Class</h3><p>The <code>Caffeine</code> class is the builder for creating cache instances:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Caffeine</span>&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Caffeine&lt;K, V&gt;newBuilder() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Caffeine</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Caffeine&lt;K, V&gt; <span class="title function_">maximumSize</span><span class="params">(<span class="type">long</span> maximumSize)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Caffeine&lt;K, V&gt; <span class="title function_">expireAfterAccess</span><span class="params">(<span class="type">long</span> duration, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cache&lt;K, V&gt; <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BoundedLocalCache</span>&lt;&gt;(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BoundedLocalCache-Class"><a href="#BoundedLocalCache-Class" class="headerlink" title="BoundedLocalCache Class"></a><a name="boundedlocalcache-class"></a>BoundedLocalCache Class</h3><p>The <code>BoundedLocalCache</code> class is the core implementation of the cache, handling operations like get, put, and eviction:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">BoundedLocalCache</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">LocalCache</span>&lt;K, V&gt; &#123;</span><br><span class="line">    BoundedLocalCache(Caffeine&lt;K, V&gt; builder) &#123;</span><br><span class="line">        <span class="comment">// Initialization</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">getIfPresent</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invalidate</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">estimatedSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CacheStats <span class="title function_">stats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Detailed-Logic-in-Caffeine-Cache"><a href="#Detailed-Logic-in-Caffeine-Cache" class="headerlink" title="Detailed Logic in Caffeine Cache"></a>Detailed Logic in Caffeine Cache</h3><h4 id="Cache-Lookup"><a href="#Cache-Lookup" class="headerlink" title="Cache Lookup"></a>Cache Lookup</h4><p>Caffeine uses a <code>ConcurrentHashMap</code> to store cache entries. When a lookup is performed, Caffeine checks if the key exists in the map:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">getIfPresent</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K, V&gt; node = data.get(key);</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Additional logic for expiration and eviction checks</span></span><br><span class="line">    <span class="keyword">return</span> node.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cache-Miss-and-Method-Execution"><a href="#Cache-Miss-and-Method-Execution" class="headerlink" title="Cache Miss and Method Execution"></a>Cache Miss and Method Execution</h4><p>If the key is not found in the cache, the method is executed, and the result is stored in the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(K key, Function&lt;? <span class="built_in">super</span> K, ? extends V&gt; mappingFunction)</span> &#123;</span><br><span class="line">    <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> getIfPresent(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    value = mappingFunction.apply(key);</span><br><span class="line">    put(key, value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cache-Update"><a href="#Cache-Update" class="headerlink" title="Cache Update"></a>Cache Update</h4><p>When the result is fetched from the database, it is stored in the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    Node&lt;K, V&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(key, value);</span><br><span class="line">    data.put(key, node);</span><br><span class="line">    <span class="comment">// Additional logic for eviction and expiration</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="real-life-production-use-cases"></a></p>
<h2 id="Real-Life-Production-Use-Cases"><a href="#Real-Life-Production-Use-Cases" class="headerlink" title="Real-Life Production Use Cases"></a>Real-Life Production Use Cases</h2><h3 id="1-User-Profile-Caching"><a href="#1-User-Profile-Caching" class="headerlink" title="1. User Profile Caching"></a>1. <strong>User Profile Caching</strong></h3><p>In a social media application, user profiles are frequently accessed. Caching user profiles can significantly reduce the load on the database and improve response times.</p>
<h3 id="2-Product-Catalog-Caching"><a href="#2-Product-Catalog-Caching" class="headerlink" title="2. Product Catalog Caching"></a>2. <strong>Product Catalog Caching</strong></h3><p>In an e-commerce application, product catalogs are often large and frequently accessed. Caching product data can improve performance and reduce database load.</p>
<h3 id="3-API-Response-Caching"><a href="#3-API-Response-Caching" class="headerlink" title="3. API Response Caching"></a>3. <strong>API Response Caching</strong></h3><p>In microservices, caching API responses can reduce the number of calls to downstream services, improving overall system performance.</p>
<h3 id="4-Session-Data-Caching"><a href="#4-Session-Data-Caching" class="headerlink" title="4. Session Data Caching"></a>4. <strong>Session Data Caching</strong></h3><p>In applications with user sessions, caching session data can reduce the load on session storage systems and improve scalability.</p>
<hr>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Caffeine-Cache-Configuration"><a href="#Caffeine-Cache-Configuration" class="headerlink" title="Caffeine Cache Configuration"></a>Caffeine Cache Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.caffeine.CaffeineCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CaffeineCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CaffeineCacheManager</span>(<span class="string">&quot;userCache&quot;</span>, <span class="string">&quot;productCache&quot;</span>);</span><br><span class="line">        cacheManager.setCaffeine(caffeineCacheBuilder());</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Caffeine&lt;Object, Object&gt; <span class="title function_">caffeineCacheBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">500</span>)</span><br><span class="line">                .expireAfterAccess(<span class="number">600</span>, TimeUnit.SECONDS)</span><br><span class="line">                .recordStats();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="User-Service-with-Caching"><a href="#User-Service-with-Caching" class="headerlink" title="User Service with Caching"></a>User Service with Caching</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Fetch user from database</span></span><br><span class="line">        <span class="keyword">return</span> fetchUserFromDatabase(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(userId, <span class="string">&quot;John Doe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flow-Diagram"><a href="#Flow-Diagram" class="headerlink" title="Flow Diagram"></a>Flow Diagram</h3><p>Here’s a textual diagram to illustrate the flow:</p>
<pre><code class="highlight mermaid">graph TD
    A[Client Request] --&gt; B&#123;Cache Lookup&#125;
    B --&gt;|Cache Hit| C[Return Cached Data]
    B --&gt;|Cache Miss| D[Execute Method]
    D --&gt; E[Fetch from Database]
    E --&gt; F[Update Cache]
    F --&gt; C</code></pre>

<h3 id="Explanation-of-the-Flow-Diagram"><a href="#Explanation-of-the-Flow-Diagram" class="headerlink" title="Explanation of the Flow Diagram"></a>Explanation of the Flow Diagram</h3><ol>
<li><strong>Client Request</strong>: The client makes a request to fetch a user by ID.</li>
<li><strong>Cache Lookup</strong>: The cache manager looks up the <code>userId</code> in the <code>&quot;userCache&quot;</code>.</li>
<li><strong>Cache Hit</strong>: If the user is found in the cache, the cached data is returned immediately.</li>
<li><strong>Cache Miss</strong>: If the user is not found in the cache, the method <code>getUserById(Long userId)</code> is executed.</li>
<li><strong>Execute Method</strong>: The method fetches the user from the database.</li>
<li><strong>Fetch from Database</strong>: The user is retrieved from the database.</li>
<li><strong>Update Cache</strong>: The fetched user is stored in the cache.</li>
<li><strong>Return Cached Data</strong>: The user data is returned to the client.</li>
</ol>
<hr>
<h2 id="Statistics-Logging-Tracking-and-Mornitoring"><a href="#Statistics-Logging-Tracking-and-Mornitoring" class="headerlink" title="Statistics Logging, Tracking and Mornitoring"></a>Statistics Logging, Tracking and Mornitoring</h2><p>Caffeine’s statistics can be tracked using logging tools and even integrated with GUI tools for better visualization and monitoring. </p>
<h3 id="1-Logging-Cache-Statistics"><a href="#1-Logging-Cache-Statistics" class="headerlink" title="1. Logging Cache Statistics"></a>1. <strong>Logging Cache Statistics</strong></h3><p>Log cache statistics using a logging framework like SLF4J or Log4j. This allows you to periodically log the cache metrics to a log file or console.</p>
<h4 id="Example-Logging-Cache-Statistics-with-SLF4J"><a href="#Example-Logging-Cache-Statistics-with-SLF4J" class="headerlink" title="Example: Logging Cache Statistics with SLF4J"></a>Example: Logging Cache Statistics with SLF4J</h4><p>First, add the necessary dependencies in <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Next, configure cache to log statistics periodically:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.stats.CacheStats;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheStatisticsLogger</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(CacheStatisticsLogger.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">100</span>)</span><br><span class="line">                .recordStats()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Perform cache operations</span></span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Log cache statistics</span></span><br><span class="line">        logCacheStats(cache);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logCacheStats</span><span class="params">(Cache&lt;?, ?&gt; cache)</span> &#123;</span><br><span class="line">        <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">        logger.info(<span class="string">&quot;Cache Hits: &#123;&#125;&quot;</span>, stats.hitCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Cache Misses: &#123;&#125;&quot;</span>, stats.missCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Cache Evictions: &#123;&#125;&quot;</span>, stats.evictionCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Load Success Count: &#123;&#125;&quot;</span>, stats.loadSuccessCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Load Failure Count: &#123;&#125;&quot;</span>, stats.loadFailureCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Integrating-with-GUI-Tools"><a href="#2-Integrating-with-GUI-Tools" class="headerlink" title="2. Integrating with GUI Tools"></a>2. <strong>Integrating with GUI Tools</strong></h3><p>Integrate Caffeine’s statistics with GUI tools like Grafana or Prometheus for better visualization and monitoring. Here’s an example of how to integrate with Prometheus and Grafana.</p>
<h4 id="Step-1-Add-Prometheus-and-Grafana-Dependencies"><a href="#Step-1-Add-Prometheus-and-Grafana-Dependencies" class="headerlink" title="Step 1: Add Prometheus and Grafana Dependencies"></a>Step 1: Add Prometheus and Grafana Dependencies</h4><p>Add the necessary dependencies to <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient_hotspot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient_servlet<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient_spring_boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Step-2-Configure-Prometheus-Metrics-Collector"><a href="#Step-2-Configure-Prometheus-Metrics-Collector" class="headerlink" title="Step 2: Configure Prometheus Metrics Collector"></a>Step 2: Configure Prometheus Metrics Collector</h4><p>Create a configuration class to collect cache statistics using Prometheus:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.stats.CacheStats;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.CollectorRegistry;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.Counter;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.Gauge;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.exporter.MetricsServlet;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.hotspot.DefaultExports;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrometheusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">100</span>)</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheHits</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_hits_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache hits.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheMisses</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_misses_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache misses.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheEvictions</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_evictions_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache evictions.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Gauge</span> <span class="variable">cacheSize</span> <span class="operator">=</span> Gauge.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_size&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Current size of the cache.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        DefaultExports.initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean&lt;MetricsServlet&gt; <span class="title function_">metricsServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CollectorRegistry</span> <span class="variable">collectorRegistry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CollectorRegistry</span>();</span><br><span class="line">        collectorRegistry.register(cacheHits);</span><br><span class="line">        collectorRegistry.register(cacheMisses);</span><br><span class="line">        collectorRegistry.register(cacheEvictions);</span><br><span class="line">        collectorRegistry.register(cacheSize);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MetricsServlet</span>(collectorRegistry), <span class="string">&quot;/metrics&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Cache&lt;String, String&gt; <span class="title function_">cache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Runnable <span class="title function_">cacheStatsCollector</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> () -&gt; &#123;</span><br><span class="line">            <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">            cacheHits.inc(stats.hitCount());</span><br><span class="line">            cacheMisses.inc(stats.missCount());</span><br><span class="line">            cacheEvictions.inc(stats.evictionCount());</span><br><span class="line">            cacheSize.set(cache.estimatedSize());</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Step-3-Configure-Prometheus-and-Grafana"><a href="#Step-3-Configure-Prometheus-and-Grafana" class="headerlink" title="Step 3: Configure Prometheus and Grafana"></a>Step 3: Configure Prometheus and Grafana</h4><ol>
<li><p><strong>Prometheus</strong>: Configure Prometheus to scrape the metrics endpoint (<code>/metrics</code>) of the Spring Boot application.</p>
</li>
<li><p><strong>Grafana</strong>: Set up Grafana to visualize the metrics collected by Prometheus. Dashboards can be created to display cache hits, misses, evictions, and other relevant metrics.</p>
</li>
</ol>
<h3 id="Example-Prometheus-Configuration"><a href="#Example-Prometheus-Configuration" class="headerlink" title="Example: Prometheus Configuration"></a>Example: Prometheus Configuration</h3><p>Create a <code>prometheus.yml</code> file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring-boot-app&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/metrics&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:8080&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Example-Grafana-Dashboard"><a href="#Example-Grafana-Dashboard" class="headerlink" title="Example: Grafana Dashboard"></a>Example: Grafana Dashboard</h3><ol>
<li><strong>Add Prometheus as a Data Source</strong> in Grafana.</li>
<li><strong>Create a Dashboard</strong> and add panels to visualize the cache metrics:<ul>
<li><strong>Cache Hits</strong>: <code>cache_hits_total</code></li>
<li><strong>Cache Misses</strong>: <code>cache_misses_total</code></li>
<li><strong>Cache Evictions</strong>: <code>cache_evictions_total</code></li>
<li><strong>Cache Size</strong>: <code>cache_size</code></li>
</ul>
</li>
</ol>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>By logging cache statistics using a logging framework like SLF4J or integrating with monitoring tools like Prometheus and Grafana, we can effectively track and visualize the performance of the Caffeine cache. This allows us to monitor cache hits, misses, evictions, and other metrics, helping us to tune and optimize the cache for better performance.</p>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Caffeine cache is a powerful tool for improving the performance and scalability of Spring Boot applications. By understanding how Caffeine works, including its eviction policies and expiration</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-Memory-Cache-in-Spring-Boot-Application/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-into-Memory-Cache-in-Spring-Boot-Application/" class="post-title-link" itemprop="url">Deep Dive into Memory Cache in Spring Boot Application</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 11:32:05 / Modified: 14:29:11" itemprop="dateCreated datePublished" datetime="2024-10-27T11:32:05-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/" itemprop="url" rel="index"><span itemprop="name">Cache</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/Spring-Boot/Microservice/" itemprop="url" rel="index"><span itemprop="name">Microservice</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Deep-Dive-into-Memory-Cache-Design-and-Implementation-in-Spring-Boot-Microservice-Applications"><a href="#Deep-Dive-into-Memory-Cache-Design-and-Implementation-in-Spring-Boot-Microservice-Applications" class="headerlink" title="Deep Dive into Memory Cache Design and Implementation in Spring Boot Microservice Applications"></a>Deep Dive into Memory Cache Design and Implementation in Spring Boot Microservice Applications</h1><h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul>
<li><a href="#deep-dive-into-memory-cache-design-and-implementation-in-spring-boot-microservice-applications">Deep Dive into Memory Cache Design and Implementation in Spring Boot Microservice Applications</a><ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#understanding-memory-cache">Understanding Memory Cache</a><ul>
<li><a href="#key-concepts">Key Concepts</a></li>
</ul>
</li>
<li><a href="#cache-design-principles">Cache Design Principles</a><ul>
<li><a href="#1-cache-hit-and-miss">1. <strong>Cache Hit and Miss</strong></a></li>
<li><a href="#2-cache-eviction-policies">2. <strong>Cache Eviction Policies</strong></a></li>
<li><a href="#3-cache-invalidation">3. <strong>Cache Invalidation</strong></a></li>
</ul>
</li>
<li><a href="#cache-implementation-in-spring-boot">Cache Implementation in Spring Boot</a><ul>
<li><a href="#spring-boot-cache-abstraction">Spring Boot Cache Abstraction</a></li>
<li><a href="#caffeine-cache-integration">Caffeine Cache Integration</a></li>
<li><a href="#cache-configuration">Cache Configuration</a></li>
<li><a href="#yaml-configuration">YAML Configuration</a></li>
<li><a href="#detailed-logic-in-caffeine-cache">Detailed Logic in Caffeine Cache</a><ul>
<li><a href="#cache-lookup">Cache Lookup</a></li>
<li><a href="#cache-miss-and-method-execution">Cache Miss and Method Execution</a></li>
<li><a href="#cache-update">Cache Update</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#microservice-architecture-and-cache">Microservice Architecture and Cache</a><ul>
<li><a href="#cache-consistency">Cache Consistency</a></li>
<li><a href="#cache-eviction-strategies">Cache Eviction Strategies</a></li>
</ul>
</li>
<li><a href="#complex-scenario-1-flow-control-and-backpressure-handling">Complex Scenario 1: Flow Control and Backpressure Handling</a><ul>
<li><a href="#problem-statement">Problem Statement</a></li>
<li><a href="#solution-architecture">Solution Architecture</a></li>
<li><a href="#flow-chart">Flow Chart</a></li>
<li><a href="#sample-code">Sample Code</a></li>
</ul>
</li>
<li><a href="#complex-scenario-2-cache-invalidation-and-data-synchronization">Complex Scenario 2: Cache Invalidation and Data Synchronization</a><ul>
<li><a href="#problem-statement-1">Problem Statement</a></li>
<li><a href="#solution-architecture-1">Solution Architecture</a></li>
<li><a href="#sequence-diagram">Sequence Diagram</a></li>
<li><a href="#sample-code-1">Sample Code</a></li>
</ul>
</li>
<li><a href="#complex-scenario-3-cache-stampede-prevention">Complex Scenario 3: Cache Stampede Prevention</a><ul>
<li><a href="#problem-statement-2">Problem Statement</a></li>
<li><a href="#solution-architecture-2">Solution Architecture</a></li>
<li><a href="#flow-chart-1">Flow Chart</a></li>
<li><a href="#sample-code-2">Sample Code</a></li>
</ul>
</li>
<li><a href="#real-life-production-use-cases">Real-Life Production Use Cases</a><ul>
<li><a href="#1-user-profile-caching">1. <strong>User Profile Caching</strong></a></li>
<li><a href="#2-product-catalog-caching">2. <strong>Product Catalog Caching</strong></a></li>
<li><a href="#3-api-response-caching">3. <strong>API Response Caching</strong></a></li>
<li><a href="#4-session-data-caching">4. <strong>Session Data Caching</strong></a></li>
</ul>
</li>
<li><a href="#sample-code-3">Sample Code</a><ul>
<li><a href="#caffeine-cache-configuration">Caffeine Cache Configuration</a></li>
<li><a href="#user-service-with-caching">User Service with Caching</a></li>
</ul>
</li>
<li><a href="#rate-limiting-for-cache-access">Rate Limiting for Cache Access</a><ul>
<li><a href="#why-rate-limiting-is-needed">Why Rate Limiting is Needed</a></li>
<li><a href="#example-rate-limiting-with-spring-boot">Example: Rate Limiting with Spring Boot</a><ul>
<li><a href="#add-dependencies">Add Dependencies</a></li>
<li><a href="#rate-limiting-configuration">Rate Limiting Configuration</a></li>
<li><a href="#service-implementation-with-rate-limiting">Service Implementation with Rate Limiting</a></li>
</ul>
</li>
<li><a href="#explanation">Explanation</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#conclusion-1">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In modern microservice architectures, performance and scalability are critical. Memory caching is a powerful technique to improve application performance by reducing the load on databases and other backend services. This article delves into the design and implementation of memory caches in Spring Boot applications, focusing on real-life project scenarios and the latest technology stack.</p>
<hr>
<p><a name="understanding-memory-cache"></a></p>
<h2 id="Understanding-Memory-Cache"><a href="#Understanding-Memory-Cache" class="headerlink" title="Understanding Memory Cache"></a>Understanding Memory Cache</h2><p>A memory cache is a high-speed data storage layer that stores a subset of data, typically transient in nature, so that future requests for that data are served faster. Caching can significantly improve the performance and scalability of applications by reducing the need to access slower underlying storage layers.</p>
<h3 id="Key-Concepts"><a href="#Key-Concepts" class="headerlink" title="Key Concepts"></a>Key Concepts</h3><ul>
<li><strong>Cache Hit</strong>: When the requested data is found in the cache.</li>
<li><strong>Cache Miss</strong>: When the requested data is not found in the cache.</li>
<li><strong>Cache Eviction</strong>: The process of removing data from the cache to make room for new data.</li>
</ul>
<hr>
<p><a name="cache-design-principles"></a></p>
<h2 id="Cache-Design-Principles"><a href="#Cache-Design-Principles" class="headerlink" title="Cache Design Principles"></a>Cache Design Principles</h2><h3 id="1-Cache-Hit-and-Miss"><a href="#1-Cache-Hit-and-Miss" class="headerlink" title="1. Cache Hit and Miss"></a>1. <strong>Cache Hit and Miss</strong></h3><ul>
<li><strong>Cache Hit</strong>: When the requested data is found in the cache.</li>
<li><strong>Cache Miss</strong>: When the requested data is not found in the cache.</li>
</ul>
<h3 id="2-Cache-Eviction-Policies"><a href="#2-Cache-Eviction-Policies" class="headerlink" title="2. Cache Eviction Policies"></a>2. <strong>Cache Eviction Policies</strong></h3><ul>
<li><strong>Least Recently Used (LRU)</strong>: Removes the least recently used items first.</li>
<li><strong>First In, First Out (FIFO)</strong>: Removes the oldest items first.</li>
<li><strong>Least Frequently Used (LFU)</strong>: Removes the least frequently used items first.</li>
</ul>
<h3 id="3-Cache-Invalidation"><a href="#3-Cache-Invalidation" class="headerlink" title="3. Cache Invalidation"></a>3. <strong>Cache Invalidation</strong></h3><ul>
<li><strong>Time-to-Live (TTL)</strong>: Data is automatically invalidated after a certain period.</li>
<li><strong>Event-Driven Invalidation</strong>: Data is invalidated based on specific events (e.g., data updates).</li>
</ul>
<hr>
<p><a name="cache-implementation-in-spring-boot"></a></p>
<h2 id="Cache-Implementation-in-Spring-Boot"><a href="#Cache-Implementation-in-Spring-Boot" class="headerlink" title="Cache Implementation in Spring Boot"></a>Cache Implementation in Spring Boot</h2><h3 id="Spring-Boot-Cache-Abstraction"><a href="#Spring-Boot-Cache-Abstraction" class="headerlink" title="Spring Boot Cache Abstraction"></a><a name="spring-boot-cache-abstraction"></a>Spring Boot Cache Abstraction</h3><p>Spring Boot provides a powerful cache abstraction that allows you to apply caching to your methods with minimal configuration. The core annotation is <code>@Cacheable</code>, which caches the result of a method invocation.</p>
<h3 id="Caffeine-Cache-Integration"><a href="#Caffeine-Cache-Integration" class="headerlink" title="Caffeine Cache Integration"></a><a name="caffeine-cache-integration"></a>Caffeine Cache Integration</h3><p>Caffeine is a high-performance, near-optimal caching library for Java. It is widely used in Spring Boot applications due to its efficiency and ease of integration.</p>
<h3 id="Cache-Configuration"><a href="#Cache-Configuration" class="headerlink" title="Cache Configuration"></a><a name="cache-configuration"></a>Cache Configuration</h3><p>To configure Caffeine cache in a Spring Boot application, you need to add the following dependencies:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>caffeine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Next, enable caching in your Spring Boot application by adding the <code>@EnableCaching</code> annotation to your main application class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="YAML-Configuration"><a href="#YAML-Configuration" class="headerlink" title="YAML Configuration"></a><a name="yaml-configuration"></a>YAML Configuration</h3><p>You can also configure Caffeine cache using YAML:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">caffeine</span></span><br><span class="line">    <span class="attr">cache-names:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">userCache</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">productCache</span></span><br><span class="line">    <span class="attr">caffeine:</span></span><br><span class="line">      <span class="attr">spec:</span> <span class="string">maximumSize=500,expireAfterAccess=600s</span></span><br></pre></td></tr></table></figure>

<h3 id="Detailed-Logic-in-Caffeine-Cache"><a href="#Detailed-Logic-in-Caffeine-Cache" class="headerlink" title="Detailed Logic in Caffeine Cache"></a>Detailed Logic in Caffeine Cache</h3><p>When you annotate a method with <code>@Cacheable</code> in Spring Boot, the cache manager will first check if the requested data is already present in the specified cache. If the data is found, it will be returned immediately, bypassing the method’s execution. If the data is not found, the method will be executed, and the result will be stored in the cache for future requests.</p>
<h4 id="Cache-Lookup"><a href="#Cache-Lookup" class="headerlink" title="Cache Lookup"></a>Cache Lookup</h4><p>Caffeine uses a <code>ConcurrentHashMap</code> to store cache entries. When a lookup is performed, Caffeine checks if the key exists in the map:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">getIfPresent</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K, V&gt; node = data.get(key);</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Additional logic for expiration and eviction checks</span></span><br><span class="line">    <span class="keyword">return</span> node.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cache-Miss-and-Method-Execution"><a href="#Cache-Miss-and-Method-Execution" class="headerlink" title="Cache Miss and Method Execution"></a>Cache Miss and Method Execution</h4><p>If the key is not found in the cache, the method is executed, and the result is stored in the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(K key, Function&lt;? <span class="built_in">super</span> K, ? extends V&gt; mappingFunction)</span> &#123;</span><br><span class="line">    <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> getIfPresent(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    value = mappingFunction.apply(key);</span><br><span class="line">    put(key, value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cache-Update"><a href="#Cache-Update" class="headerlink" title="Cache Update"></a>Cache Update</h4><p>When the result is fetched from the database, it is stored in the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    Node&lt;K, V&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(key, value);</span><br><span class="line">    data.put(key, node);</span><br><span class="line">    <span class="comment">// Additional logic for eviction and expiration</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="microservice-architecture-and-cache"></a></p>
<h2 id="Microservice-Architecture-and-Cache"><a href="#Microservice-Architecture-and-Cache" class="headerlink" title="Microservice Architecture and Cache"></a>Microservice Architecture and Cache</h2><h3 id="Cache-Consistency"><a href="#Cache-Consistency" class="headerlink" title="Cache Consistency"></a><a name="cache-consistency"></a>Cache Consistency</h3><p>Ensuring cache consistency is crucial in distributed systems. Techniques like cache invalidation, event-driven updates, and distributed locking can be used to maintain consistency.</p>
<h3 id="Cache-Eviction-Strategies"><a href="#Cache-Eviction-Strategies" class="headerlink" title="Cache Eviction Strategies"></a><a name="cache-eviction-strategies"></a>Cache Eviction Strategies</h3><p>Choosing the right eviction strategy is important. LRU is commonly used, but in scenarios with frequent updates, LFU or custom eviction policies might be more appropriate.</p>
<hr>
<p><a name="complex-scenario-1-flow-control-and-backpressure-handling"></a></p>
<h2 id="Complex-Scenario-1-Flow-Control-and-Backpressure-Handling"><a href="#Complex-Scenario-1-Flow-Control-and-Backpressure-Handling" class="headerlink" title="Complex Scenario 1: Flow Control and Backpressure Handling"></a>Complex Scenario 1: Flow Control and Backpressure Handling</h2><h3 id="Problem-Statement"><a href="#Problem-Statement" class="headerlink" title="Problem Statement"></a>Problem Statement</h3><p>In high-traffic scenarios, the cache might become a bottleneck if not properly managed. Flow control and backpressure handling are essential to prevent the cache from being overwhelmed.</p>
<h3 id="Solution-Architecture"><a href="#Solution-Architecture" class="headerlink" title="Solution Architecture"></a>Solution Architecture</h3><ol>
<li><strong>Rate Limiting</strong>: Implement rate limiting to control the number of requests hitting the cache.</li>
<li><strong>Circuit Breaker</strong>: Use a circuit breaker to handle failures gracefully and prevent cascading failures.</li>
<li><strong>Backpressure Handling</strong>: Implement backpressure mechanisms to manage the flow of data between services.</li>
</ol>
<h3 id="Flow-Chart"><a href="#Flow-Chart" class="headerlink" title="Flow Chart"></a>Flow Chart</h3><pre><code class="highlight mermaid">graph TD
    A[Client Request] --&gt; B&#123;Rate Limiter&#125;
    B --&gt;|Allowed| C[Cache Lookup]
    B --&gt;|Denied| D[Fallback to Database]
    C --&gt; E&#123;Cache Hit?&#125;
    E --&gt;|Yes| F[Return Cached Data]
    E --&gt;|No| G[Fetch from Database]
    G --&gt; H[Update Cache]
    H --&gt; F
    D --&gt; G</code></pre>

<h3 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Fetch user from database</span></span><br><span class="line">        <span class="keyword">return</span> fetchUserFromDatabase(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="complex-scenario-2-cache-invalidation-and-data-synchronization"></a></p>
<h2 id="Complex-Scenario-2-Cache-Invalidation-and-Data-Synchronization"><a href="#Complex-Scenario-2-Cache-Invalidation-and-Data-Synchronization" class="headerlink" title="Complex Scenario 2: Cache Invalidation and Data Synchronization"></a>Complex Scenario 2: Cache Invalidation and Data Synchronization</h2><h3 id="Problem-Statement-1"><a href="#Problem-Statement-1" class="headerlink" title="Problem Statement"></a>Problem Statement</h3><p>Ensuring that the cache remains consistent with the underlying data store is challenging, especially in distributed systems.</p>
<h3 id="Solution-Architecture-1"><a href="#Solution-Architecture-1" class="headerlink" title="Solution Architecture"></a>Solution Architecture</h3><ol>
<li><strong>Event-Driven Invalidation</strong>: Use event-driven mechanisms to invalidate the cache when data changes.</li>
<li><strong>Distributed Locking</strong>: Use distributed locking to ensure that only one service updates the cache at a time.</li>
<li><strong>TTL-Based Invalidation</strong>: Use Time-to-Live (TTL) to automatically invalidate cache entries after a certain period.</li>
</ol>
<h3 id="Sequence-Diagram"><a href="#Sequence-Diagram" class="headerlink" title="Sequence Diagram"></a>Sequence Diagram</h3><pre><code class="highlight mermaid">sequenceDiagram
    participant Client
    participant Service
    participant Cache
    participant Database

    Client-&gt;&gt;Service: Update User
    Service-&gt;&gt;Database: Update User in Database
    Database--&gt;&gt;Service: User Updated
    Service-&gt;&gt;Cache: Invalidate User Cache
    Cache--&gt;&gt;Service: Cache Invalidated
    Service--&gt;&gt;Client: User Updated</code></pre>

<h3 id="Sample-Code-1"><a href="#Sample-Code-1" class="headerlink" title="Sample Code"></a>Sample Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(Long userId, User user)</span> &#123;</span><br><span class="line">        <span class="comment">// Update user in database</span></span><br><span class="line">        updateUserInDatabase(userId, user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateUserInDatabase</span><span class="params">(Long userId, User user)</span> &#123;</span><br><span class="line">        <span class="comment">// Database update logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="complex-scenario-3-cache-stampede-prevention"></a></p>
<h2 id="Complex-Scenario-3-Cache-Stampede-Prevention"><a href="#Complex-Scenario-3-Cache-Stampede-Prevention" class="headerlink" title="Complex Scenario 3: Cache Stampede Prevention"></a>Complex Scenario 3: Cache Stampede Prevention</h2><h3 id="Problem-Statement-2"><a href="#Problem-Statement-2" class="headerlink" title="Problem Statement"></a>Problem Statement</h3><p>A cache stampede occurs when multiple requests for the same data hit the cache simultaneously, leading to a spike in database load.</p>
<h3 id="Solution-Architecture-2"><a href="#Solution-Architecture-2" class="headerlink" title="Solution Architecture"></a>Solution Architecture</h3><ol>
<li><strong>Probabilistic Early Expiration</strong>: Use probabilistic early expiration to spread out cache expiration times.</li>
<li><strong>Locking Mechanism</strong>: Implement a locking mechanism to ensure that only one request populates the cache at a time.</li>
<li><strong>Background Refresh</strong>: Use background refresh to keep the cache up-to-date without impacting the user experience.</li>
</ol>
<h3 id="Flow-Chart-1"><a href="#Flow-Chart-1" class="headerlink" title="Flow Chart"></a>Flow Chart</h3><pre><code class="highlight mermaid">graph TD
    A[Client Request] --&gt; B&#123;Cache Hit?&#125;
    B --&gt;|Yes| C[Return Cached Data]
    B --&gt;|No| D&#123;Lock Acquired?&#125;
    D --&gt;|Yes| E[Fetch from Database]
    D --&gt;|No| F[Wait for Lock]
    E --&gt; G[Update Cache]
    G --&gt; C
    F --&gt; B</code></pre>

<h3 id="Sample-Code-2"><a href="#Sample-Code-2" class="headerlink" title="Sample Code"></a>Sample Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">// Double-check to ensure the cache is still empty</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">cachedUser</span> <span class="operator">=</span> fetchUserFromCache(userId);</span><br><span class="line">            <span class="keyword">if</span> (cachedUser != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> cachedUser;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Fetch user from database</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> fetchUserFromDatabase(userId);</span><br><span class="line">            <span class="comment">// Update cache</span></span><br><span class="line">            updateCache(userId, user);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromCache</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Cache lookup logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateCache</span><span class="params">(Long userId, User user)</span> &#123;</span><br><span class="line">        <span class="comment">// Cache update logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="real-life-production-use-cases"></a></p>
<h2 id="Real-Life-Production-Use-Cases"><a href="#Real-Life-Production-Use-Cases" class="headerlink" title="Real-Life Production Use Cases"></a>Real-Life Production Use Cases</h2><h3 id="1-User-Profile-Caching"><a href="#1-User-Profile-Caching" class="headerlink" title="1. User Profile Caching"></a>1. <strong>User Profile Caching</strong></h3><p>In a social media application, user profiles are frequently accessed. Caching user profiles can significantly reduce the load on the database and improve response times.</p>
<h3 id="2-Product-Catalog-Caching"><a href="#2-Product-Catalog-Caching" class="headerlink" title="2. Product Catalog Caching"></a>2. <strong>Product Catalog Caching</strong></h3><p>In an e-commerce application, product catalogs are often large and frequently accessed. Caching product data can improve performance and reduce database load.</p>
<h3 id="3-API-Response-Caching"><a href="#3-API-Response-Caching" class="headerlink" title="3. API Response Caching"></a>3. <strong>API Response Caching</strong></h3><p>In microservices, caching API responses can reduce the number of calls to downstream services, improving overall system performance.</p>
<h3 id="4-Session-Data-Caching"><a href="#4-Session-Data-Caching" class="headerlink" title="4. Session Data Caching"></a>4. <strong>Session Data Caching</strong></h3><p>In applications with user sessions, caching session data can reduce the load on session storage systems and improve scalability.</p>
<hr>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code-3"><a href="#Sample-Code-3" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Caffeine-Cache-Configuration"><a href="#Caffeine-Cache-Configuration" class="headerlink" title="Caffeine Cache Configuration"></a>Caffeine Cache Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.caffeine.CaffeineCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CaffeineCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CaffeineCacheManager</span>(<span class="string">&quot;userCache&quot;</span>, <span class="string">&quot;productCache&quot;</span>);</span><br><span class="line">        cacheManager.setCaffeine(caffeineCacheBuilder());</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Caffeine&lt;Object, Object&gt; <span class="title function_">caffeineCacheBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">500</span>)</span><br><span class="line">                .expireAfterAccess(<span class="number">600</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="User-Service-with-Caching"><a href="#User-Service-with-Caching" class="headerlink" title="User Service with Caching"></a>User Service with Caching</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Fetch user from database</span></span><br><span class="line">        <span class="keyword">return</span> fetchUserFromDatabase(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="rate-limiting-for-cache-access"></a></p>
<h2 id="Rate-Limiting-for-Cache-Access"><a href="#Rate-Limiting-for-Cache-Access" class="headerlink" title="Rate Limiting for Cache Access"></a>Rate Limiting for Cache Access</h2><h3 id="Why-Rate-Limiting-is-Needed"><a href="#Why-Rate-Limiting-is-Needed" class="headerlink" title="Why Rate Limiting is Needed"></a>Why Rate Limiting is Needed</h3><p>Reading from a memory cache is generally very fast and should not be a bottleneck in terms of performance. However, there are several reasons why you might still want to implement rate limiting for cache access, even if the cache is in memory:</p>
<ol>
<li><p><strong>Resource Management</strong>: Even though reading from memory is fast, excessive concurrent requests can still consume a significant amount of CPU and memory resources. Rate limiting helps manage these resources more effectively, ensuring that the system remains responsive and does not become overwhelmed.</p>
</li>
<li><p><strong>Preventing Cache Stampede</strong>: While reading from the cache is fast, if the cache is not populated (cache miss), all concurrent requests will end up fetching the data from the database or another slow data source. This can lead to a cache stampede, where the database or other backend services are overwhelmed with requests. Rate limiting can help mitigate this by controlling the number of concurrent requests that can hit the cache.</p>
</li>
<li><p><strong>Graceful Degradation</strong>: In high-traffic scenarios, rate limiting ensures that the system can gracefully degrade its performance. By limiting the number of requests that can access the cache, you can prevent the system from becoming unresponsive or crashing under heavy load.</p>
</li>
<li><p><strong>Security and Denial of Service (DoS) Prevention</strong>: Rate limiting can also be a security measure to prevent Denial of Service (DoS) attacks. By limiting the number of requests from a single client or IP address, you can protect the system from being overwhelmed by malicious requests.</p>
</li>
<li><p><strong>Ensuring Fairness</strong>: Rate limiting ensures that all clients have fair access to the cache. Without rate limiting, a few clients with high request rates could monopolize the cache, leading to poor performance for other clients.</p>
</li>
<li><p><strong>Monitoring and Analytics</strong>: Rate limiting provides valuable data on the usage patterns of the cache. This data can be used for monitoring, analytics, and capacity planning.</p>
</li>
</ol>
<h3 id="Example-Rate-Limiting-with-Spring-Boot"><a href="#Example-Rate-Limiting-with-Spring-Boot" class="headerlink" title="Example: Rate Limiting with Spring Boot"></a>Example: Rate Limiting with Spring Boot</h3><p>Here’s an example of how you might implement rate limiting for cache access in a Spring Boot application using the <code>Bucket4j</code> library:</p>
<h4 id="Add-Dependencies"><a href="#Add-Dependencies" class="headerlink" title="Add Dependencies"></a>Add Dependencies</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.vladimir-bukhtoyarov<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bucket4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Rate-Limiting-Configuration"><a href="#Rate-Limiting-Configuration" class="headerlink" title="Rate Limiting Configuration"></a>Rate Limiting Configuration</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.github.bucket4j.Bandwidth;</span><br><span class="line"><span class="keyword">import</span> io.github.bucket4j.Bucket;</span><br><span class="line"><span class="keyword">import</span> io.github.bucket4j.Bucket4j;</span><br><span class="line"><span class="keyword">import</span> io.github.bucket4j.Refill;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitingConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Bucket <span class="title function_">cacheRateLimiter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Bandwidth</span> <span class="variable">limit</span> <span class="operator">=</span> Bandwidth.classic(<span class="number">100</span>, Refill.greedy(<span class="number">100</span>, Duration.ofMinutes(<span class="number">1</span>)));</span><br><span class="line">        <span class="keyword">return</span> Bucket4j.builder().addLimit(limit).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Service-Implementation-with-Rate-Limiting"><a href="#Service-Implementation-with-Rate-Limiting" class="headerlink" title="Service Implementation with Rate Limiting"></a>Service Implementation with Rate Limiting</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.github.bucket4j.Bucket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Bucket cacheRateLimiter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cacheRateLimiter.tryConsume(<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="comment">// Fetch user from database</span></span><br><span class="line">            <span class="keyword">return</span> fetchUserFromDatabase(userId);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Rate limit exceeded&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><ol>
<li><strong>Bucket4j Configuration</strong>: The <code>Bucket4j</code> library is used to configure a rate limiter with a limit of 100 requests per minute.</li>
<li><strong>Service Implementation</strong>: The <code>getUserById</code> method checks if the rate limit has been exceeded before fetching the user from the database. If the limit is exceeded, it throws an exception.</li>
</ol>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>While reading from a memory cache is fast and should not be a bottleneck, implementing rate limiting can provide several benefits, including resource management, preventing cache stampedes, ensuring fairness, and enhancing security. By using libraries like <code>Bucket4j</code>, you can easily implement rate limiting in your Spring Boot application to manage cache access effectively.</p>
<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Memory caching is a powerful tool for improving the performance and scalability of Spring Boot applications in a microservice architecture. By understanding the principles of cache design and implementing best practices, you can effectively manage cache performance, consistency, and reliability in real-life projects.</p>
<p>This article provides a comprehensive guide to memory cache design and implementation in Spring Boot, covering various scenarios and best practices. Use the provided sample code and diagrams to implement efficient caching in your microservice architecture.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/26/Deep-Dive-into-java-util-function-Package/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/26/Deep-Dive-into-java-util-function-Package/" class="post-title-link" itemprop="url">Deep Dive into java.util.function Package</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-26 22:52:06 / Modified: 22:53:26" itemprop="dateCreated datePublished" datetime="2024-10-26T22:52:06-04:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java-Core/" itemprop="url" rel="index"><span itemprop="name">Java Core</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#deep-dive-into-javautilfunction-package">Deep Dive into <code>java.util.function</code> Package</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#key-functional-interfaces">Key Functional Interfaces</a><ul>
<li><a href="#function">Function</a></li>
<li><a href="#consumer">Consumer</a></li>
<li><a href="#supplier">Supplier</a></li>
<li><a href="#predicate">Predicate</a></li>
<li><a href="#bifunction">BiFunction</a></li>
<li><a href="#biconsumer">BiConsumer</a></li>
<li><a href="#bipredicate">BiPredicate</a></li>
<li><a href="#unaryoperator">UnaryOperator</a></li>
<li><a href="#binaryoperator">BinaryOperator</a></li>
</ul>
</li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#real-life-use-cases">Real-Life Use Cases</a><ul>
<li><a href="#use-case-1-data-transformation">Use Case 1: Data Transformation</a></li>
<li><a href="#use-case-2-event-handling">Use Case 2: Event Handling</a></li>
<li><a href="#use-case-3-validation">Use Case 3: Validation</a></li>
</ul>
</li>
<li><a href="#sample-code">Sample Code</a><ul>
<li><a href="#function-1">Function</a></li>
<li><a href="#consumer-1">Consumer</a></li>
<li><a href="#supplier-1">Supplier</a></li>
<li><a href="#predicate-1">Predicate</a></li>
<li><a href="#bifunction-1">BiFunction</a></li>
<li><a href="#biconsumer-1">BiConsumer</a></li>
<li><a href="#bipredicate-1">BiPredicate</a></li>
<li><a href="#unaryoperator-1">UnaryOperator</a></li>
<li><a href="#binaryoperator-1">BinaryOperator</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Deep-Dive-into-java-util-function-Package"><a href="#Deep-Dive-into-java-util-function-Package" class="headerlink" title="Deep Dive into java.util.function Package"></a>Deep Dive into <code>java.util.function</code> Package</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>The <code>java.util.function</code> package in Java provides a set of functional interfaces that are used to represent various types of lambda expressions and method references. These interfaces are essential for writing concise and expressive code, especially when working with streams, collections, and other functional programming constructs in Java.</p>
<p>This article will deep dive into the key functional interfaces provided by the <code>java.util.function</code> package, discuss important points and techniques, provide best practices, and present real-life use cases with sample code.</p>
<p><a name="key-functional-interfaces"></a></p>
<h2 id="Key-Functional-Interfaces"><a href="#Key-Functional-Interfaces" class="headerlink" title="Key Functional Interfaces"></a>Key Functional Interfaces</h2><p>The <code>java.util.function</code> package includes several functional interfaces, each designed to represent a specific type of lambda expression. Here are the most commonly used ones:</p>
<p><a name="function"></a></p>
<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>The <code>Function&lt;T, R&gt;</code> interface represents a function that takes an argument of type <code>T</code> and returns a result of type <code>R</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Function&lt;String, Integer&gt; stringLength = s -&gt; s.length();</span><br><span class="line">        System.out.println(stringLength.apply(<span class="string">&quot;Hello, World!&quot;</span>)); <span class="comment">// Output: 13</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="consumer"></a></p>
<h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><p>The <code>Consumer&lt;T&gt;</code> interface represents an operation that takes an argument of type <code>T</code> and returns no result. It is typically used for side effects.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Consumer&lt;String&gt; printUpperCase = s -&gt; System.out.println(s.toUpperCase());</span><br><span class="line">        printUpperCase.accept(<span class="string">&quot;hello&quot;</span>); <span class="comment">// Output: HELLO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="supplier"></a></p>
<h3 id="Supplier"><a href="#Supplier" class="headerlink" title="Supplier"></a>Supplier</h3><p>The <code>Supplier&lt;T&gt;</code> interface represents a supplier of results. It takes no arguments and returns a result of type <code>T</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SupplierExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Supplier&lt;String&gt; randomString = () -&gt; <span class="string">&quot;Random String&quot;</span>;</span><br><span class="line">        System.out.println(randomString.get()); <span class="comment">// Output: Random String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="predicate"></a></p>
<h3 id="Predicate"><a href="#Predicate" class="headerlink" title="Predicate"></a>Predicate</h3><p>The <code>Predicate&lt;T&gt;</code> interface represents a predicate (boolean-valued function) of one argument. It returns <code>true</code> or <code>false</code> based on the input.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Predicate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PredicateExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Predicate&lt;Integer&gt; isEven = n -&gt; n % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">        System.out.println(isEven.test(<span class="number">4</span>)); <span class="comment">// Output: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="bifunction"></a></p>
<h3 id="BiFunction"><a href="#BiFunction" class="headerlink" title="BiFunction"></a>BiFunction</h3><p>The <code>BiFunction&lt;T, U, R&gt;</code> interface represents a function that takes two arguments of types <code>T</code> and <code>U</code> and returns a result of type <code>R</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BiFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BiFunctionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BiFunction&lt;Integer, Integer, Integer&gt; add = (a, b) -&gt; a + b;</span><br><span class="line">        System.out.println(add.apply(<span class="number">3</span>, <span class="number">5</span>)); <span class="comment">// Output: 8</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="biconsumer"></a></p>
<h3 id="BiConsumer"><a href="#BiConsumer" class="headerlink" title="BiConsumer"></a>BiConsumer</h3><p>The <code>BiConsumer&lt;T, U&gt;</code> interface represents an operation that takes two arguments of types <code>T</code> and <code>U</code> and returns no result.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BiConsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BiConsumerExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BiConsumer&lt;String, Integer&gt; printKeyValue = (k, v) -&gt; System.out.println(k + <span class="string">&quot;: &quot;</span> + v);</span><br><span class="line">        printKeyValue.accept(<span class="string">&quot;Age&quot;</span>, <span class="number">30</span>); <span class="comment">// Output: Age: 30</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="bipredicate"></a></p>
<h3 id="BiPredicate"><a href="#BiPredicate" class="headerlink" title="BiPredicate"></a>BiPredicate</h3><p>The <code>BiPredicate&lt;T, U&gt;</code> interface represents a predicate (boolean-valued function) of two arguments.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BiPredicate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BiPredicateExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BiPredicate&lt;String, String&gt; isSameLength = (s1, s2) -&gt; s1.length() == s2.length();</span><br><span class="line">        System.out.println(isSameLength.test(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)); <span class="comment">// Output: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="unaryoperator"></a></p>
<h3 id="UnaryOperator"><a href="#UnaryOperator" class="headerlink" title="UnaryOperator"></a>UnaryOperator</h3><p>The <code>UnaryOperator&lt;T&gt;</code> interface represents an operation on a single operand that produces a result of the same type as its operand.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.UnaryOperator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnaryOperatorExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        UnaryOperator&lt;Integer&gt; square = n -&gt; n * n;</span><br><span class="line">        System.out.println(square.apply(<span class="number">5</span>)); <span class="comment">// Output: 25</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="binaryoperator"></a></p>
<h3 id="BinaryOperator"><a href="#BinaryOperator" class="headerlink" title="BinaryOperator"></a>BinaryOperator</h3><p>The <code>BinaryOperator&lt;T&gt;</code> interface represents an operation upon two operands of the same type, producing a result of the same type as the operands.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BinaryOperator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryOperatorExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BinaryOperator&lt;Integer&gt; multiply = (a, b) -&gt; a * b;</span><br><span class="line">        System.out.println(multiply.apply(<span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// Output: 12</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="best-practices"></a></p>
<h2 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h2><ol>
<li><strong>Use Functional Interfaces Appropriately</strong>: Choose the right functional interface based on the number of arguments and the return type.</li>
<li><strong>Leverage Method References</strong>: Use method references where possible to make the code more concise and readable.</li>
<li><strong>Avoid Overusing Lambdas</strong>: While lambdas are powerful, overusing them can make the code harder to read and maintain.</li>
<li><strong>Combine Functional Interfaces</strong>: Use the <code>andThen</code>, <code>compose</code>, and <code>and</code> methods to combine multiple functional interfaces.</li>
<li><strong>Use Default Methods</strong>: Take advantage of default methods provided by functional interfaces to create more complex behaviors.</li>
</ol>
<p><a name="real-life-use-cases"></a></p>
<h2 id="Real-Life-Use-Cases"><a href="#Real-Life-Use-Cases" class="headerlink" title="Real-Life Use Cases"></a>Real-Life Use Cases</h2><p><a name="use-case-1-data-transformation"></a></p>
<h3 id="Use-Case-1-Data-Transformation"><a href="#Use-Case-1-Data-Transformation" class="headerlink" title="Use Case 1: Data Transformation"></a>Use Case 1: Data Transformation</h3><p>In data processing applications, <code>Function</code> and <code>UnaryOperator</code> can be used to transform data from one format to another.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataTransformationExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">        Function&lt;String, String&gt; toUpperCase = String::toUpperCase;</span><br><span class="line">        List&lt;String&gt; upperCaseNames = names.stream()</span><br><span class="line">                                           .map(toUpperCase)</span><br><span class="line">                                           .collect(Collectors.toList());</span><br><span class="line">        System.out.println(upperCaseNames); <span class="comment">// Output: [ALICE, BOB, CHARLIE]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="use-case-2-event-handling"></a></p>
<h3 id="Use-Case-2-Event-Handling"><a href="#Use-Case-2-Event-Handling" class="headerlink" title="Use Case 2: Event Handling"></a>Use Case 2: Event Handling</h3><p>In event-driven applications, <code>Consumer</code> can be used to handle events and perform side effects.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventHandlingExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Consumer&lt;String&gt; onEvent = s -&gt; System.out.println(<span class="string">&quot;Event received: &quot;</span> + s);</span><br><span class="line">        onEvent.accept(<span class="string">&quot;Button Clicked&quot;</span>); <span class="comment">// Output: Event received: Button Clicked</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="use-case-3-validation"></a></p>
<h3 id="Use-Case-3-Validation"><a href="#Use-Case-3-Validation" class="headerlink" title="Use Case 3: Validation"></a>Use Case 3: Validation</h3><p>In validation scenarios, <code>Predicate</code> can be used to check conditions and return a boolean result.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Predicate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidationExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Predicate&lt;String&gt; isValidEmail = s -&gt; s.contains(<span class="string">&quot;@&quot;</span>) &amp;&amp; s.contains(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        System.out.println(isValidEmail.test(<span class="string">&quot;test@example.com&quot;</span>)); <span class="comment">// Output: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Function-1"><a href="#Function-1" class="headerlink" title="Function"></a>Function</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Function&lt;String, Integer&gt; stringLength = s -&gt; s.length();</span><br><span class="line">        System.out.println(stringLength.apply(<span class="string">&quot;Hello, World!&quot;</span>)); <span class="comment">// Output: 13</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Consumer-1"><a href="#Consumer-1" class="headerlink" title="Consumer"></a>Consumer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Consumer&lt;String&gt; printUpperCase = s -&gt; System.out.println(s.toUpperCase());</span><br><span class="line">        printUpperCase.accept(<span class="string">&quot;hello&quot;</span>); <span class="comment">// Output: HELLO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Supplier-1"><a href="#Supplier-1" class="headerlink" title="Supplier"></a>Supplier</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SupplierExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Supplier&lt;String&gt; randomString = () -&gt; <span class="string">&quot;Random String&quot;</span>;</span><br><span class="line">        System.out.println(randomString.get()); <span class="comment">// Output: Random String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Predicate-1"><a href="#Predicate-1" class="headerlink" title="Predicate"></a>Predicate</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.Predicate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PredicateExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Predicate&lt;Integer&gt; isEven = n -&gt; n % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">        System.out.println(isEven.test(<span class="number">4</span>)); <span class="comment">// Output: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BiFunction-1"><a href="#BiFunction-1" class="headerlink" title="BiFunction"></a>BiFunction</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BiFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BiFunctionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BiFunction&lt;Integer, Integer, Integer&gt; add = (a, b) -&gt; a + b;</span><br><span class="line">        System.out.println(add.apply(<span class="number">3</span>, <span class="number">5</span>)); <span class="comment">// Output: 8</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BiConsumer-1"><a href="#BiConsumer-1" class="headerlink" title="BiConsumer"></a>BiConsumer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BiConsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BiConsumerExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BiConsumer&lt;String, Integer&gt; printKeyValue = (k, v) -&gt; System.out.println(k + <span class="string">&quot;: &quot;</span> + v);</span><br><span class="line">        printKeyValue.accept(<span class="string">&quot;Age&quot;</span>, <span class="number">30</span>); <span class="comment">// Output: Age: 30</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BiPredicate-1"><a href="#BiPredicate-1" class="headerlink" title="BiPredicate"></a>BiPredicate</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BiPredicate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BiPredicateExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BiPredicate&lt;String, String&gt; isSameLength = (s1, s2) -&gt; s1.length() == s2.length();</span><br><span class="line">        System.out.println(isSameLength.test(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)); <span class="comment">// Output: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UnaryOperator-1"><a href="#UnaryOperator-1" class="headerlink" title="UnaryOperator"></a>UnaryOperator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.UnaryOperator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnaryOperatorExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        UnaryOperator&lt;Integer&gt; square = n -&gt; n * n;</span><br><span class="line">        System.out.println(square.apply(<span class="number">5</span>)); <span class="comment">// Output: 25</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BinaryOperator-1"><a href="#BinaryOperator-1" class="headerlink" title="BinaryOperator"></a>BinaryOperator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BinaryOperator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryOperatorExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BinaryOperator&lt;Integer&gt; multiply = (a, b) -&gt; a * b;</span><br><span class="line">        System.out.println(multiply.apply(<span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// Output: 12</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>The <code>java.util.function</code> package provides a rich set of functional interfaces that are essential for writing modern, concise, and expressive Java code. By understanding and leveraging these interfaces, you can significantly improve the readability and maintainability of your code. Real-life use cases and sample code demonstrate how these interfaces can be applied in various scenarios, making them indispensable tools for Java developers.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/26/Deep-Dive-Comparing-Spring-REST-Clients-with-Spring-Cloud-OpenFeign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/26/Deep-Dive-Comparing-Spring-REST-Clients-with-Spring-Cloud-OpenFeign/" class="post-title-link" itemprop="url">Deep Dive: Comparing Spring REST Clients with Spring Cloud OpenFeign</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-26 19:42:35 / Modified: 19:45:53" itemprop="dateCreated datePublished" datetime="2024-10-26T19:42:35-04:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#overview-of-spring-rest-clients">Overview of Spring REST Clients</a></li>
<li><a href="#overview-of-spring-cloud-openfeign">Overview of Spring Cloud OpenFeign</a></li>
<li><a href="#key-differences">Key Differences</a></li>
<li><a href="#why-spring-rest-clients-are-replacing-openfeign">Why Spring REST Clients are Replacing OpenFeign</a></li>
<li><a href="#sample-code-comparison">Sample Code Comparison</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the realm of microservices and RESTful APIs, efficient and maintainable client-side HTTP communication is crucial. Spring provides two prominent solutions for this: Spring REST Clients and Spring Cloud OpenFeign. This article delves into a detailed comparison of these two approaches, highlighting their key differences and discussing why Spring REST Clients are increasingly replacing OpenFeign in modern applications.</p>
<p><a name="overview-of-spring-rest-clients"></a></p>
<h2 id="Overview-of-Spring-REST-Clients"><a href="#Overview-of-Spring-REST-Clients" class="headerlink" title="Overview of Spring REST Clients"></a>Overview of Spring REST Clients</h2><h3 id="What-is-Spring-REST-Clients"><a href="#What-is-Spring-REST-Clients" class="headerlink" title="What is Spring REST Clients?"></a>What is Spring REST Clients?</h3><p>Spring REST Clients, introduced in Spring 5, is a set of tools and libraries that facilitate HTTP client-side communication. It includes <code>RestTemplate</code> and <code>WebClient</code>, both of which are designed to simplify the process of making HTTP requests and handling responses.</p>
<h3 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features"></a>Key Features</h3><ul>
<li><strong>RestTemplate</strong>: A synchronous client that provides a simple, template method API over underlying HTTP client libraries.</li>
<li><strong>WebClient</strong>: A reactive, non-blocking client introduced in Spring 5, suitable for modern, asynchronous applications.</li>
<li><strong>Integration with Spring WebFlux</strong>: WebClient is part of the Spring WebFlux framework, making it ideal for reactive programming.</li>
<li><strong>Flexibility</strong>: Supports both synchronous and asynchronous operations.</li>
</ul>
<p><a name="overview-of-spring-cloud-openfeign"></a></p>
<h2 id="Overview-of-Spring-Cloud-OpenFeign"><a href="#Overview-of-Spring-Cloud-OpenFeign" class="headerlink" title="Overview of Spring Cloud OpenFeign"></a>Overview of Spring Cloud OpenFeign</h2><h3 id="What-is-Spring-Cloud-OpenFeign"><a href="#What-is-Spring-Cloud-OpenFeign" class="headerlink" title="What is Spring Cloud OpenFeign?"></a>What is Spring Cloud OpenFeign?</h3><p>Spring Cloud OpenFeign is a declarative HTTP client that simplifies the process of consuming RESTful services. It allows you to define interfaces with annotations to describe the REST API you want to consume, handling the HTTP requests and responses automatically.</p>
<h3 id="Key-Features-1"><a href="#Key-Features-1" class="headerlink" title="Key Features"></a>Key Features</h3><ul>
<li><strong>Declarative REST Client</strong>: Define interfaces with annotations to describe the REST API.</li>
<li><strong>Integration with Spring Boot</strong>: Automatically integrates with Spring Boot’s dependency injection and configuration mechanisms.</li>
<li><strong>Load Balancing</strong>: Integrates with Spring Cloud LoadBalancer for client-side load balancing.</li>
<li><strong>Error Handling</strong>: Provides mechanisms to handle errors and exceptions gracefully.</li>
<li><strong>Interceptors</strong>: Allows adding custom interceptors to modify requests and responses.</li>
</ul>
<p><a name="key-differences"></a></p>
<h2 id="Key-Differences"><a href="#Key-Differences" class="headerlink" title="Key Differences"></a>Key Differences</h2><h3 id="1-Programming-Model"><a href="#1-Programming-Model" class="headerlink" title="1. Programming Model"></a>1. <strong>Programming Model</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: Offers both synchronous (<code>RestTemplate</code>) and reactive (<code>WebClient</code>) models, providing flexibility based on the application’s needs.</li>
<li><strong>OpenFeign</strong>: Primarily declarative, focusing on defining interfaces with annotations for HTTP communication.</li>
</ul>
<h3 id="2-Reactive-Support"><a href="#2-Reactive-Support" class="headerlink" title="2. Reactive Support"></a>2. <strong>Reactive Support</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: WebClient provides full support for reactive programming, making it suitable for modern, asynchronous applications.</li>
<li><strong>OpenFeign</strong>: Limited reactive support; primarily designed for synchronous communication.</li>
</ul>
<h3 id="3-Integration-and-Ecosystem"><a href="#3-Integration-and-Ecosystem" class="headerlink" title="3. Integration and Ecosystem"></a>3. <strong>Integration and Ecosystem</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: Deeply integrated with the Spring ecosystem, including Spring WebFlux and Spring Boot.</li>
<li><strong>OpenFeign</strong>: Integrates well with Spring Cloud, providing additional features like load balancing and service discovery.</li>
</ul>
<h3 id="4-Error-Handling-and-Customization"><a href="#4-Error-Handling-and-Customization" class="headerlink" title="4. Error Handling and Customization"></a>4. <strong>Error Handling and Customization</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: Provides robust error handling and customization options through exception handling and interceptors.</li>
<li><strong>OpenFeign</strong>: Offers error handling through custom error decoders and interceptors, but with a more declarative approach.</li>
</ul>
<p><a name="why-spring-rest-clients-are-replacing-openfeign"></a></p>
<h2 id="Why-Spring-REST-Clients-are-Replacing-OpenFeign"><a href="#Why-Spring-REST-Clients-are-Replacing-OpenFeign" class="headerlink" title="Why Spring REST Clients are Replacing OpenFeign"></a>Why Spring REST Clients are Replacing OpenFeign</h2><h3 id="1-Reactive-Programming"><a href="#1-Reactive-Programming" class="headerlink" title="1. Reactive Programming"></a>1. <strong>Reactive Programming</strong></h3><p>With the rise of reactive programming and the need for non-blocking, asynchronous communication, <code>WebClient</code> has become the preferred choice over <code>RestTemplate</code> and OpenFeign. WebClient’s reactive nature aligns well with modern application architectures.</p>
<h3 id="2-Flexibility-and-Control"><a href="#2-Flexibility-and-Control" class="headerlink" title="2. Flexibility and Control"></a>2. <strong>Flexibility and Control</strong></h3><p>Spring REST Clients provide more flexibility and control over HTTP communication. Developers can choose between synchronous and asynchronous models based on their specific requirements, whereas OpenFeign is more opinionated and less flexible.</p>
<h3 id="3-Ecosystem-Integration"><a href="#3-Ecosystem-Integration" class="headerlink" title="3. Ecosystem Integration"></a>3. <strong>Ecosystem Integration</strong></h3><p>Spring REST Clients are deeply integrated with the broader Spring ecosystem, including Spring WebFlux and Spring Boot. This integration provides a seamless development experience and leverages the full capabilities of the Spring framework.</p>
<h3 id="4-Community-and-Support"><a href="#4-Community-and-Support" class="headerlink" title="4. Community and Support"></a>4. <strong>Community and Support</strong></h3><p>As part of the core Spring framework, Spring REST Clients benefit from continuous updates, improvements, and community support. OpenFeign, while powerful, is part of the Spring Cloud ecosystem and may not receive the same level of attention and updates.</p>
<p><a name="sample-code-comparison"></a></p>
<h2 id="Sample-Code-Comparison"><a href="#Sample-Code-Comparison" class="headerlink" title="Sample Code Comparison"></a>Sample Code Comparison</h2><h3 id="Using-Spring-REST-Clients-WebClient"><a href="#Using-Spring-REST-Clients-WebClient" class="headerlink" title="Using Spring REST Clients (WebClient)"></a>Using Spring REST Clients (<code>WebClient</code>)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProductServiceClient</span><span class="params">(WebClient.Builder webClientBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClient = webClientBuilder.baseUrl(<span class="string">&quot;http://localhost:8081&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Product&gt; <span class="title function_">getProduct</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.get()</span><br><span class="line">                        .uri(<span class="string">&quot;/products/&#123;productId&#125;&quot;</span>, productId)</span><br><span class="line">                        .retrieve()</span><br><span class="line">                        .bodyToMono(Product.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Spring-Cloud-OpenFeign"><a href="#Using-Spring-Cloud-OpenFeign" class="headerlink" title="Using Spring Cloud OpenFeign"></a>Using Spring Cloud OpenFeign</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;product-service&quot;, url = &quot;http://localhost:8081&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/products/&#123;productId&#125;&quot;)</span></span><br><span class="line">    Product <span class="title function_">getProduct</span><span class="params">(<span class="meta">@PathVariable(&quot;productId&quot;)</span> Long productId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>While Spring Cloud OpenFeign offers a declarative and simplified approach to HTTP client communication, Spring REST Clients provide more flexibility, reactive support, and deep integration with the Spring ecosystem. As modern applications increasingly adopt reactive programming and require more control over HTTP communication, Spring REST Clients, particularly <code>WebClient</code>, are becoming the preferred choice over OpenFeign. By understanding the key differences and advantages of each approach, developers can make informed decisions to build robust and scalable microservices architectures.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-openfeign">https://spring.io/projects/spring-cloud-openfeign</a><br><strong>Warning:</strong> As announced in <a target="_blank" rel="noopener" href="https://spring.io/blog/2022/12/16/spring-cloud-2022-0-0-codename-kilburn-has-been-released#spring-cloud-openfeign-feature-complete-announcement">Spring Cloud 2022.0.0 release blog entry</a>, Spring Cloud OpenFeign is now considered feature-complete. We will only be focusing on bug fixes and potentially merging small community feature pull requests. We recommend migrating to <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-http-interface">Spring Interface Clients</a> instead.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/26/Deep-Dive-into-Spring-Cloud-OpenFeign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/26/Deep-Dive-into-Spring-Cloud-OpenFeign/" class="post-title-link" itemprop="url">Deep Dive into Spring Cloud OpenFeign --- Deprecated</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-26 19:29:33 / Modified: 19:41:04" itemprop="dateCreated datePublished" datetime="2024-10-26T19:29:33-04:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/Spring-Cloud/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/Spring-Cloud/Deprecated/" itemprop="url" rel="index"><span itemprop="name">Deprecated</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#key-features">Key Features</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#real-production-use-case">Real Production Use Case</a></li>
<li><a href="#sample-code">Sample Code</a></li>
<li><a href="#deployment-and-usage">Deployment and Usage</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr>
<h1 id="Deep-Dive-into-Spring-Cloud-OpenFeign"><a href="#Deep-Dive-into-Spring-Cloud-OpenFeign" class="headerlink" title="Deep Dive into Spring Cloud OpenFeign"></a>Deep Dive into Spring Cloud OpenFeign</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Spring Cloud OpenFeign is a declarative HTTP client that simplifies the process of consuming RESTful services in Spring Boot applications. It integrates seamlessly with Spring’s dependency injection and configuration mechanisms, making it a powerful tool for microservices architectures. This article provides a deep dive into Spring Cloud OpenFeign, including a real production use case, sample code, and deployment strategies.</p>
<p><a name="key-features"></a></p>
<h2 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features"></a>Key Features</h2><ul>
<li><strong>Declarative REST Client</strong>: Define interfaces with annotations to describe the REST API you want to consume.</li>
<li><strong>Integration with Spring Boot</strong>: Automatically integrates with Spring Boot’s dependency injection and configuration mechanisms.</li>
<li><strong>Load Balancing</strong>: Integrates with Spring Cloud LoadBalancer for client-side load balancing.</li>
<li><strong>Error Handling</strong>: Provides mechanisms to handle errors and exceptions gracefully.</li>
<li><strong>Interceptors</strong>: Allows adding custom interceptors to modify requests and responses.</li>
</ul>
<p><a name="getting-started"></a></p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><p>To use Spring Cloud OpenFeign in your Spring Boot project, add the following dependency to your <code>pom.xml</code> (for Maven) or <code>build.gradle</code> (for Gradle):</p>
<p><strong>Maven:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Gradle:</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.springframework.cloud:spring-cloud-starter-openfeign&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Enable Feign in your Spring Boot application by adding the <code>@EnableFeignClients</code> annotation to your main application class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="real-production-use-case"></a></p>
<h2 id="Real-Production-Use-Case"><a href="#Real-Production-Use-Case" class="headerlink" title="Real Production Use Case"></a>Real Production Use Case</h2><h3 id="Scenario-Microservices-Communication-in-an-E-commerce-Platform"><a href="#Scenario-Microservices-Communication-in-an-E-commerce-Platform" class="headerlink" title="Scenario: Microservices Communication in an E-commerce Platform"></a>Scenario: Microservices Communication in an E-commerce Platform</h3><p>In an e-commerce platform, multiple microservices interact to handle various functionalities such as product catalog, user management, and order processing. OpenFeign is used to facilitate communication between these services.</p>
<h4 id="Example-Order-Service-Communicating-with-Product-Service"><a href="#Example-Order-Service-Communicating-with-Product-Service" class="headerlink" title="Example: Order Service Communicating with Product Service"></a>Example: Order Service Communicating with Product Service</h4><p>The Order Service needs to retrieve product details from the Product Service to process orders. OpenFeign simplifies this communication by allowing the Order Service to define a Feign client for the Product Service.</p>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Define-the-Feign-Client"><a href="#Define-the-Feign-Client" class="headerlink" title="Define the Feign Client"></a>Define the Feign Client</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;product-service&quot;, url = &quot;http://localhost:8081&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/products/&#123;productId&#125;&quot;)</span></span><br><span class="line">    Product <span class="title function_">getProduct</span><span class="params">(<span class="meta">@PathVariable(&quot;productId&quot;)</span> Long productId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Product-Class"><a href="#Product-Class" class="headerlink" title="Product Class"></a>Product Class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-the-Feign-Client-in-the-Order-Service"><a href="#Using-the-Feign-Client-in-the-Order-Service" class="headerlink" title="Using the Feign Client in the Order Service"></a>Using the Feign Client in the Order Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductServiceClient productServiceClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productServiceClient.getProduct(productId);</span><br><span class="line">        <span class="comment">// Process the order using the product details</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="deployment-and-usage"></a></p>
<h2 id="Deployment-and-Usage"><a href="#Deployment-and-Usage" class="headerlink" title="Deployment and Usage"></a>Deployment and Usage</h2><h3 id="Deployment-Strategy"><a href="#Deployment-Strategy" class="headerlink" title="Deployment Strategy"></a>Deployment Strategy</h3><ol>
<li><strong>Containerization</strong>: Use Docker to containerize your Spring Boot applications.</li>
<li><strong>Orchestration</strong>: Deploy your containers using Kubernetes for orchestration.</li>
<li><strong>Service Discovery</strong>: Integrate with a service discovery tool like Eureka or Consul.</li>
</ol>
<h3 id="Example-Deployment-with-Kubernetes"><a href="#Example-Deployment-with-Kubernetes" class="headerlink" title="Example Deployment with Kubernetes"></a>Example Deployment with Kubernetes</h3><h4 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/myapp.jar /myapp.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/myapp.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h4 id="Kubernetes-Deployment-YAML"><a href="#Kubernetes-Deployment-YAML" class="headerlink" title="Kubernetes Deployment YAML"></a>Kubernetes Deployment YAML</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">order-service</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h3 id="Usage-in-Production"><a href="#Usage-in-Production" class="headerlink" title="Usage in Production"></a>Usage in Production</h3><ol>
<li><strong>Monitoring</strong>: Use tools like Prometheus and Grafana to monitor your services.</li>
<li><strong>Logging</strong>: Implement centralized logging with ELK (Elasticsearch, Logstash, Kibana) stack.</li>
<li><strong>Security</strong>: Ensure secure communication using HTTPS and OAuth2 for authentication.</li>
</ol>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Spring Cloud OpenFeign is a powerful tool for building declarative HTTP clients in Spring Boot applications. Its integration with the Spring ecosystem, combined with active development and community support, makes it a reliable choice for microservices architectures. By following the steps outlined in this article, you can effectively use OpenFeign in your production environment, facilitating seamless communication between microservices.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIII-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIII-2/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XIII-2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 23:43:33" itemprop="dateCreated datePublished" datetime="2024-10-24T23:43:33-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-10-28 15:52:59" itemprop="dateModified" datetime="2024-10-28T15:52:59-04:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Spring-Cloud/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Spring-Cloud/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Spring-Cloud/Reactive/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#deep-dive-integrating-spring-webflux-with-microservices-architecture">Deep Dive: Integrating Spring WebFlux with Microservices Architecture</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#microservices-architecture-overview">Microservices Architecture Overview</a></li>
<li><a href="#integrating-spring-webflux-with-microservices">Integrating Spring WebFlux with Microservices</a></li>
<li><a href="#using-spring-cloud">Using Spring Cloud</a></li>
<li><a href="#service-registration-and-discovery">Service Registration and Discovery</a><ul>
<li><a href="#adding-dependencies">Adding Dependencies</a></li>
<li><a href="#configuring-service-registration-and-discovery">Configuring Service Registration and Discovery</a></li>
<li><a href="#annotating-the-main-class">Annotating the Main Class</a></li>
</ul>
</li>
<li><a href="#api-gateway">API Gateway</a><ul>
<li><a href="#adding-dependencies-1">Adding Dependencies</a></li>
<li><a href="#configuring-gateway-routes">Configuring Gateway Routes</a></li>
</ul>
</li>
<li><a href="#client-side-load-balancing">Client-Side Load Balancing</a><ul>
<li><a href="#adding-dependencies-2">Adding Dependencies</a></li>
<li><a href="#configuring-load-balancer">Configuring Load Balancer</a></li>
<li><a href="#using-load-balancer">Using Load Balancer</a></li>
</ul>
</li>
<li><a href="#circuit-breaker">Circuit Breaker</a><ul>
<li><a href="#adding-dependencies-3">Adding Dependencies</a></li>
<li><a href="#configuring-circuit-breaker">Configuring Circuit Breaker</a></li>
<li><a href="#using-circuit-breaker">Using Circuit Breaker</a></li>
<li><a href="#diagram">Diagram</a></li>
<li><a href="#real-life-production-use-cases">Real-Life Production Use Cases</a><ul>
<li><a href="#use-case-1-e-commerce-platform">Use Case 1: E-commerce Platform</a></li>
<li><a href="#example-order-service-communicating-with-product-service">Example: Order Service Communicating with Product Service</a></li>
<li><a href="#use-case-2-financial-services">Use Case 2: Financial Services</a></li>
<li><a href="#example-transaction-service-with-circuit-breaker">Example: Transaction Service with Circuit Breaker</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sample-code">Sample Code</a><ul>
<li><a href="#service-registration-and-discovery-1">Service Registration and Discovery</a></li>
<li><a href="#api-gateway-1">API Gateway</a></li>
<li><a href="#client-side-load-balancing-1">Client-Side Load Balancing</a></li>
<li><a href="#using-webclient-to-call-different-services">Using <code>WebClient</code> to Call Different Services</a></li>
<li><a href="#circuit-breaker-1">Circuit Breaker</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Deep-Dive-Integrating-Spring-WebFlux-with-Microservices-Architecture"><a href="#Deep-Dive-Integrating-Spring-WebFlux-with-Microservices-Architecture" class="headerlink" title="Deep Dive: Integrating Spring WebFlux with Microservices Architecture"></a>Deep Dive: Integrating Spring WebFlux with Microservices Architecture</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the previous articles, we have delved into the foundational concepts of Spring WebFlux, Reactor, error handling, data stream transformations, reactive database access, performance optimization, security, testing, deployment and operations, as well as best practices and common pitfalls. This article will focus on integrating Spring WebFlux with microservices architecture to build high-performance, scalable distributed systems.</p>
<p><a name="microservices-architecture-overview"></a></p>
<h2 id="Microservices-Architecture-Overview"><a href="#Microservices-Architecture-Overview" class="headerlink" title="Microservices Architecture Overview"></a>Microservices Architecture Overview</h2><p>Microservices architecture is an approach that breaks down an application into a set of small, independently deployable services, each running in its own process and communicating through lightweight mechanisms, typically HTTP or message queues. The benefits of microservices architecture include:</p>
<ul>
<li><strong>Independent Deployment</strong>: Each service can be deployed and updated independently, reducing system downtime.</li>
<li><strong>Scalability</strong>: Services can be scaled independently, improving resource utilization.</li>
<li><strong>Technological Diversity</strong>: Different services can use the most suitable technology stacks, increasing flexibility in technology choices.</li>
</ul>
<p><a name="integrating-spring-webflux-with-microservices"></a></p>
<h2 id="Integrating-Spring-WebFlux-with-Microservices"><a href="#Integrating-Spring-WebFlux-with-Microservices" class="headerlink" title="Integrating Spring WebFlux with Microservices"></a>Integrating Spring WebFlux with Microservices</h2><p>Spring WebFlux, as a reactive web framework within the Spring ecosystem, is well-suited for building high-concurrency, low-latency microservices. Here are some key points for integrating Spring WebFlux with microservices.</p>
<p><a name="using-spring-cloud"></a></p>
<h2 id="Using-Spring-Cloud"><a href="#Using-Spring-Cloud" class="headerlink" title="Using Spring Cloud"></a>Using Spring Cloud</h2><p>Spring Cloud provides a set of tools to simplify development and management in distributed systems, particularly in microservices architectures based on Spring Boot. Key components include:</p>
<ul>
<li><strong>Spring Cloud Kubernetes</strong>: Integrates with Kubernetes for service registration and discovery, configuration, and more.</li>
<li><strong>Spring Cloud Gateway</strong>: An API gateway built on Spring WebFlux, offering dynamic routing, monitoring, and rate limiting.</li>
<li><strong>Spring Cloud Config</strong>: Provides centralized configuration management for distributed systems.</li>
</ul>
<p><a name="service-registration-and-discovery"></a></p>
<h2 id="Service-Registration-and-Discovery"><a href="#Service-Registration-and-Discovery" class="headerlink" title="Service Registration and Discovery"></a>Service Registration and Discovery</h2><p>Service registration and discovery are crucial components in microservices architecture, allowing services to dynamically register themselves and discover other services. Spring Cloud Kubernetes integrates with Kubernetes’ native service discovery mechanisms.</p>
<h3 id="Adding-Dependencies"><a href="#Adding-Dependencies" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud Kubernetes dependencies to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Service-Registration-and-Discovery"><a href="#Configuring-Service-Registration-and-Discovery" class="headerlink" title="Configuring Service Registration and Discovery"></a>Configuring Service Registration and Discovery</h3><p>Configure service registration and discovery in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">spring.cloud.kubernetes.discovery.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="Annotating-the-Main-Class"><a href="#Annotating-the-Main-Class" class="headerlink" title="Annotating the Main Class"></a>Annotating the Main Class</h3><p>Annotate your Spring Boot main class with <code>@EnableDiscoveryClient</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="api-gateway"></a></p>
<h2 id="API-Gateway"><a href="#API-Gateway" class="headerlink" title="API Gateway"></a>API Gateway</h2><p>An API gateway is another critical component in microservices architecture, handling all external requests and routing them to the appropriate services. Spring Cloud Gateway is an API gateway built on Spring WebFlux.</p>
<h3 id="Adding-Dependencies-1"><a href="#Adding-Dependencies-1" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud Gateway dependency to your gateway service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Gateway-Routes"><a href="#Configuring-Gateway-Routes" class="headerlink" title="Configuring Gateway Routes"></a>Configuring Gateway Routes</h3><p>Configure routes in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.gateway.routes[0].id</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].uri</span>=<span class="string">lb://book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].predicates[0]</span>=<span class="string">Path=/books/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].id</span>=<span class="string">user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].uri</span>=<span class="string">lb://user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].predicates[0]</span>=<span class="string">Path=/users/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].id</span>=<span class="string">order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].uri</span>=<span class="string">lb://order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].predicates[0]</span>=<span class="string">Path=/orders/**</span></span><br></pre></td></tr></table></figure>

<p><a name="client-side-load-balancing"></a></p>
<h2 id="Client-Side-Load-Balancing"><a href="#Client-Side-Load-Balancing" class="headerlink" title="Client-Side Load Balancing"></a>Client-Side Load Balancing</h2><p>Spring Cloud provides client-side load balancing through Spring Cloud LoadBalancer, which allows services to distribute requests across multiple instances.</p>
<h3 id="Adding-Dependencies-2"><a href="#Adding-Dependencies-2" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud LoadBalancer dependency to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Load-Balancer"><a href="#Configuring-Load-Balancer" class="headerlink" title="Configuring Load Balancer"></a>Configuring Load Balancer</h3><p>Configure the load balancer in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.loadbalancer.ribbon.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Load-Balancer"><a href="#Using-Load-Balancer" class="headerlink" title="Using Load Balancer"></a>Using Load Balancer</h3><p>Use the load balancer in your service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> WebClient.Builder <span class="title function_">loadBalancedWebClientBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> WebClient.builder();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When you make a request using the <code>WebClient.Builder</code>, you typically specify the service name in the URI (e.g., <code>http://book-service/books</code>). The <code>@LoadBalanced</code> annotation tells Spring Cloud LoadBalancer to intercept this request and resolve the service name (<code>book-service</code>) to the actual service instances.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient.Builder webClientBuilder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(WebClient.Builder webClientBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClientBuilder = webClientBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://book-service/books/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(Book.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="circuit-breaker"></a></p>
<h2 id="Circuit-Breaker"><a href="#Circuit-Breaker" class="headerlink" title="Circuit Breaker"></a>Circuit Breaker</h2><p>Circuit breakers are an essential pattern in microservices architecture, handling service call failures to prevent fault propagation. Spring Cloud Circuit Breaker provides circuit breaker functionality with support for multiple implementations like Resilience4J.</p>
<h3 id="Adding-Dependencies-3"><a href="#Adding-Dependencies-3" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud Circuit Breaker and Resilience4J dependencies to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-circuitbreaker-reactor-resilience4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Circuit-Breaker"><a href="#Configuring-Circuit-Breaker" class="headerlink" title="Configuring Circuit Breaker"></a>Configuring Circuit Breaker</h3><p>Configure the circuit breaker in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.failureRateThreshold</span>=<span class="string">50</span></span><br><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.waitDurationInOpenState</span>=<span class="string">5s</span></span><br><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.ringBufferSizeInHalfOpenState</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.ringBufferSizeInClosedState</span>=<span class="string">100</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Circuit-Breaker"><a href="#Using-Circuit-Breaker" class="headerlink" title="Using Circuit Breaker"></a>Using Circuit Breaker</h3><p>Use the circuit breaker in your service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.ReactiveCircuitBreakerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveCircuitBreakerFactory circuitBreakerFactory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(ReactiveCircuitBreakerFactory circuitBreakerFactory, BookRepository bookRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreakerFactory = circuitBreakerFactory;</span><br><span class="line">        <span class="built_in">this</span>.bookRepository = bookRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">            .transform(it -&gt; circuitBreakerFactory.create(<span class="string">&quot;bookService&quot;</span>).run(it, throwable -&gt; Mono.just(<span class="keyword">new</span> <span class="title class_">Book</span>(id, <span class="string">&quot;Default Book&quot;</span>, <span class="string">&quot;Unknown&quot;</span>, <span class="number">0.0</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Diagram"><a href="#Diagram" class="headerlink" title="Diagram"></a>Diagram</h3><ul>
<li>Client-Side: WebClient - Alternative of Spring-Cloud OpenFeign</li>
<li>API Gateway: Routes</li>
<li>BookService: Integerated CircuitBreaker(Actual Implementation is resilience4j)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Client-Side       |       | API Gateway       |       | Actual BookService|</span><br><span class="line">| MultiServiceCaller|       |                   |       |                   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">| +-------------+   |       | +-------------+   |       | +-------------+   |</span><br><span class="line">| | WebClient   |   |       | | Routes      |   |       | | Circuit    |   |</span><br><span class="line">| |             |   |       | |             |   |       | | Breaker    |   |</span><br><span class="line">| | +---------+ |   |       | | +---------+ |   |       | | +---------+ |   |</span><br><span class="line">| | | Request | |   |       | | | Request | |   |       | | | Request | |   |</span><br><span class="line">| | +---------+ |   |       | | +---------+ |   |       | | +---------+ |   |</span><br><span class="line">| +-------------+   |       | +-------------+   |       | +-------------+   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br></pre></td></tr></table></figure>

<h3 id="Real-Life-Production-Use-Cases"><a href="#Real-Life-Production-Use-Cases" class="headerlink" title="Real-Life Production Use Cases"></a>Real-Life Production Use Cases</h3><h4 id="Use-Case-1-E-commerce-Platform"><a href="#Use-Case-1-E-commerce-Platform" class="headerlink" title="Use Case 1: E-commerce Platform"></a>Use Case 1: E-commerce Platform</h4><p>In an e-commerce platform, multiple microservices interact to handle various functionalities such as product catalog, user management, and order processing. Spring WebFlux and Spring Cloud components can be used to build a scalable and resilient system.</p>
<h4 id="Example-Order-Service-Communicating-with-Product-Service"><a href="#Example-Order-Service-Communicating-with-Product-Service" class="headerlink" title="Example: Order Service Communicating with Product Service"></a>Example: Order Service Communicating with Product Service</h4><p>The Order Service needs to retrieve product details from the Product Service to process orders. Spring Cloud Gateway can be used as an API gateway to route requests, and Spring Cloud LoadBalancer can be used for client-side load balancing.</p>
<h4 id="Use-Case-2-Financial-Services"><a href="#Use-Case-2-Financial-Services" class="headerlink" title="Use Case 2: Financial Services"></a>Use Case 2: Financial Services</h4><p>In financial services, microservices handle transactions, account management, and reporting. Spring WebFlux can be used to build high-performance services, and Spring Cloud Circuit Breaker can be used to handle failures gracefully.</p>
<h4 id="Example-Transaction-Service-with-Circuit-Breaker"><a href="#Example-Transaction-Service-with-Circuit-Breaker" class="headerlink" title="Example: Transaction Service with Circuit Breaker"></a>Example: Transaction Service with Circuit Breaker</h4><p>The Transaction Service needs to call the Account Service to validate account balances. If the Account Service is down, the circuit breaker can return a default response to prevent system failure.</p>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Service-Registration-and-Discovery-1"><a href="#Service-Registration-and-Discovery-1" class="headerlink" title="Service Registration and Discovery"></a>Service Registration and Discovery</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="API-Gateway-1"><a href="#API-Gateway-1" class="headerlink" title="API Gateway"></a>API Gateway</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.gateway.routes[0].id</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].uri</span>=<span class="string">lb://book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].predicates[0]</span>=<span class="string">Path=/books/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].id</span>=<span class="string">user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].uri</span>=<span class="string">lb://user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].predicates[0]</span>=<span class="string">Path=/users/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].id</span>=<span class="string">order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].uri</span>=<span class="string">lb://order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].predicates[0]</span>=<span class="string">Path=/orders/**</span></span><br></pre></td></tr></table></figure>

<h3 id="Client-Side-Load-Balancing-1"><a href="#Client-Side-Load-Balancing-1" class="headerlink" title="Client-Side Load Balancing"></a>Client-Side Load Balancing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> WebClient.Builder <span class="title function_">loadBalancedWebClientBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> WebClient.builder();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-WebClient-to-Call-Different-Services"><a href="#Using-WebClient-to-Call-Different-Services" class="headerlink" title="Using WebClient to Call Different Services"></a>Using <code>WebClient</code> to Call Different Services</h3><p>Create a service class that uses the <code>WebClient.Builder</code> to interact with different registered services:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiServiceCaller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient.Builder webClientBuilder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiServiceCaller</span><span class="params">(WebClient.Builder webClientBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClientBuilder = webClientBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://book-service/books/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(Book.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://user-service/users/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(User.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">getOrderById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://order-service/orders/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(Order.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Circuit-Breaker-1"><a href="#Circuit-Breaker-1" class="headerlink" title="Circuit Breaker"></a>Circuit Breaker</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.ReactiveCircuitBreakerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveCircuitBreakerFactory circuitBreakerFactory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(ReactiveCircuitBreakerFactory circuitBreakerFactory, BookRepository bookRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreakerFactory = circuitBreakerFactory;</span><br><span class="line">        <span class="built_in">this</span>.bookRepository = bookRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">            .transform(it -&gt; circuitBreakerFactory.create(<span class="string">&quot;bookService&quot;</span>).run(it, throwable -&gt; Mono.just(<span class="keyword">new</span> <span class="title class_">Book</span>(id, <span class="string">&quot;Default Book&quot;</span>, <span class="string">&quot;Unknown&quot;</span>, <span class="number">0.0</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to integrate Spring WebFlux with microservices architecture using the latest Spring Cloud components. By leveraging Spring Cloud Kubernetes, Spring Cloud Gateway, Spring Cloud LoadBalancer, and Spring Cloud Circuit Breaker, we can easily build high-performance, scalable distributed systems. Real-life production use cases and sample code demonstrate the practical application of these components in building resilient and scalable microservices.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice/" class="post-title-link" itemprop="url">Approaches to Rolling Back or Canceling Transactions in Microservice</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 23:17:16 / Modified: 23:19:37" itemprop="dateCreated datePublished" datetime="2024-10-24T23:17:16-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Transaction/" itemprop="url" rel="index"><span itemprop="name">Transaction</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Transaction/Microservice/" itemprop="url" rel="index"><span itemprop="name">Microservice</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Handling rollback or cancellation of transactions in a <strong>Microservice Architecture</strong> when multiple writes are involved is a complex process because each microservice typically has its own database, and there is no central point of coordination like in monolithic applications. Traditional database transactions (ACID) are difficult to apply in microservices, especially when services span across multiple databases, message brokers, and external APIs. Therefore, rollback in microservices needs a more sophisticated approach.</p>
<h3 id="Key-Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice-Architecture"><a href="#Key-Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice-Architecture" class="headerlink" title="Key Approaches to Rolling Back or Canceling Transactions in Microservice Architecture"></a>Key Approaches to Rolling Back or Canceling Transactions in Microservice Architecture</h3><p>There are several strategies to handle rollback or cancellation in microservices when multiple services and writes are involved. These include:</p>
<ul>
<li><a href="#1-saga-pattern">1. Saga Pattern</a><ul>
<li><a href="#a-choreography-based-saga">a. Choreography-based Saga</a></li>
<li><a href="#b-orchestration-based-saga">b. Orchestration-based Saga</a></li>
</ul>
</li>
<li><a href="#2-compensation-mechanism">2. Compensation Mechanism</a></li>
<li><a href="#3-two-phase-commit-2pc">3. Two-Phase Commit (2PC)</a><ul>
<li><a href="#how-2pc-works">How 2PC Works:</a></li>
</ul>
</li>
<li><a href="#4-eventual-consistency">4. Eventual Consistency</a><ul>
<li><a href="#how-to-handle-rollbacks-with-eventual-consistency">How to Handle Rollbacks with Eventual Consistency:</a></li>
</ul>
</li>
<li><a href="#5-idempotency-and-retries">5. Idempotency and Retries</a><ul>
<li><a href="#idempotency">Idempotency:</a></li>
<li><a href="#best-practices-for-idempotency">Best Practices for Idempotency:</a></li>
</ul>
</li>
<li><a href="#6-conclusion">6. Conclusion</a></li>
</ul>
<hr>
<p><a name="saga-pattern"></a></p>
<h2 id="1-Saga-Pattern"><a href="#1-Saga-Pattern" class="headerlink" title="1. Saga Pattern"></a>1. Saga Pattern</h2><p>The <strong>Saga Pattern</strong> is the most popular strategy for handling distributed transactions in microservices. It breaks a large transaction into a sequence of smaller, independent transactions, each handled by a microservice. If any part of the sequence fails, compensating actions (i.e., rollbacks) are triggered to undo the work done by previous steps.</p>
<p>There are two common approaches to implementing the Saga Pattern:</p>
<ul>
<li><strong>Choreography-based Saga</strong></li>
<li><strong>Orchestration-based Saga</strong></li>
</ul>
<p><a name="choreography-based-saga"></a></p>
<h3 id="a-Choreography-based-Saga"><a href="#a-Choreography-based-Saga" class="headerlink" title="a. Choreography-based Saga"></a>a. Choreography-based Saga</h3><p>In a <strong>Choreography-based Saga</strong>, each service involved in the transaction emits an event upon completion of its task. Other services listen to these events and take action accordingly. If an error occurs, the service responsible for the failed transaction emits a failure event, and other services listening for that failure event perform compensating actions.</p>
<p><strong>Example</strong>:<br>Imagine an e-commerce system where you place an order that spans multiple microservices:</p>
<ol>
<li><strong>Order Service</strong>: Creates the order.</li>
<li><strong>Inventory Service</strong>: Reserves the product.</li>
<li><strong>Payment Service</strong>: Charges the customer.</li>
<li><strong>Shipping Service</strong>: Ships the product.</li>
</ol>
<p>If the <strong>Payment Service</strong> fails after reserving the inventory, it can emit a failure event, and the <strong>Inventory Service</strong> would listen to this and release the reserved product (compensating action).</p>
<p><strong>Advantages</strong>:</p>
<ul>
<li>Fully decentralized and scalable.</li>
<li>Easy to add new services without affecting others.</li>
</ul>
<p><strong>Challenges</strong>:</p>
<ul>
<li>Harder to track and manage because there is no central coordinator.</li>
<li>More complex error handling logic in each service.</li>
</ul>
<p><a name="orchestration-based-saga"></a></p>
<h3 id="b-Orchestration-based-Saga"><a href="#b-Orchestration-based-Saga" class="headerlink" title="b. Orchestration-based Saga"></a>b. Orchestration-based Saga</h3><p>In an <strong>Orchestration-based Saga</strong>, a central coordinator (Orchestrator) is responsible for managing the workflow of the transaction. The Orchestrator sends commands to each service to execute a step in the transaction and handles failures by issuing compensating commands if any service fails.</p>
<p><strong>Example</strong>:</p>
<ul>
<li>The <strong>Orchestrator</strong> sends a command to the <strong>Order Service</strong> to create an order.</li>
<li>After receiving success, the Orchestrator asks the <strong>Inventory Service</strong> to reserve the product.</li>
<li>If the <strong>Payment Service</strong> fails, the Orchestrator issues a compensating command to the <strong>Inventory Service</strong> to release the product.</li>
</ul>
<p><strong>Advantages</strong>:</p>
<ul>
<li>Easier to implement because the Orchestrator handles the entire workflow.</li>
<li>Centralized error handling and compensations.</li>
</ul>
<p><strong>Challenges</strong>:</p>
<ul>
<li>The Orchestrator can become a single point of failure or bottleneck.</li>
<li>Needs to manage state and retries, making it potentially complex.</li>
</ul>
<hr>
<p><a name="compensation-mechanism"></a></p>
<h2 id="2-Compensation-Mechanism"><a href="#2-Compensation-Mechanism" class="headerlink" title="2. Compensation Mechanism"></a>2. Compensation Mechanism</h2><p>The <strong>Compensation Mechanism</strong> is the core of both the Saga Pattern and other eventual consistency models. A compensation transaction is essentially the “undo” operation that reverses the effects of a previously completed step in case of failure.</p>
<p><strong>How It Works</strong>:<br>Each microservice is responsible for defining and implementing compensating actions for its operations. For example:</p>
<ul>
<li>If the <strong>Inventory Service</strong> reserves stock but the <strong>Payment Service</strong> fails, the Inventory Service must implement logic to release the stock.</li>
<li>If the <strong>Payment Service</strong> successfully charges a customer but the <strong>Shipping Service</strong> fails, the Payment Service must issue a refund.</li>
</ul>
<p><strong>Key Considerations</strong>:</p>
<ul>
<li><strong>Compensation is not always straightforward</strong>: Rolling back a transaction isn’t always as simple as undoing a change. Some operations might be irreversible (e.g., shipping a product), requiring compensating actions that mitigate the issue (e.g., issuing a refund).</li>
<li><strong>State-driven compensation</strong>: Services must maintain state information to understand which transactions require compensation.</li>
</ul>
<hr>
<p><a name="two-phase-commit-2pc"></a></p>
<h2 id="3-Two-Phase-Commit-2PC"><a href="#3-Two-Phase-Commit-2PC" class="headerlink" title="3. Two-Phase Commit (2PC)"></a>3. Two-Phase Commit (2PC)</h2><p><strong>Two-Phase Commit (2PC)</strong> is a protocol used for coordinating distributed transactions across multiple systems. It’s traditionally used in tightly coupled distributed systems but is less popular in microservice architectures due to performance and complexity concerns.</p>
<h3 id="How-2PC-Works"><a href="#How-2PC-Works" class="headerlink" title="How 2PC Works:"></a>How 2PC Works:</h3><ol>
<li><strong>Prepare Phase</strong>: The transaction coordinator asks each microservice if they are ready to commit the transaction. The services reply with “yes” or “no.”</li>
<li><strong>Commit&#x2F;Rollback Phase</strong>: If all services reply with “yes,” the coordinator instructs them to commit. If any service replies with “no,” the coordinator sends a rollback command to all participating services.</li>
</ol>
<p><strong>Pros</strong>:</p>
<ul>
<li>Strong consistency guarantees.</li>
<li>Ensures atomicity across distributed systems.</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li><strong>Performance overhead</strong>: 2PC introduces a blocking wait time for services to prepare and commit, which can hurt performance in a microservices architecture.</li>
<li><strong>Risk of blocking</strong>: If one service crashes, it can leave other services waiting indefinitely, potentially causing system-wide issues.</li>
</ul>
<p>Given these challenges, 2PC is rarely used in modern, large-scale microservice architectures.</p>
<hr>
<p><a name="eventual-consistency"></a></p>
<h2 id="4-Eventual-Consistency"><a href="#4-Eventual-Consistency" class="headerlink" title="4. Eventual Consistency"></a>4. Eventual Consistency</h2><p>In distributed microservice architectures, <strong>eventual consistency</strong> is often the goal rather than strong consistency (ACID). Eventual consistency ensures that after some time, all participants in a distributed transaction will reach a consistent state, even if there are temporary inconsistencies.</p>
<h3 id="How-to-Handle-Rollbacks-with-Eventual-Consistency"><a href="#How-to-Handle-Rollbacks-with-Eventual-Consistency" class="headerlink" title="How to Handle Rollbacks with Eventual Consistency:"></a>How to Handle Rollbacks with Eventual Consistency:</h3><ul>
<li><strong>Delayed reconciliation</strong>: Some systems may use periodic reconciliation processes to detect inconsistencies and trigger compensating actions to ensure data integrity.</li>
<li><strong>State-based updates</strong>: Services track their state, and if a failure is detected, each service is responsible for ensuring consistency through compensation.</li>
</ul>
<p><strong>Example</strong>:<br>If a <strong>Payment Service</strong> charges a customer but the <strong>Shipping Service</strong> fails to ship the item, the system might temporarily be in an inconsistent state (payment made, no shipment). Over time, a reconciliation job or event listener detects the issue and initiates a refund to bring the system back to consistency.</p>
<p><strong>Pros</strong>:</p>
<ul>
<li>High scalability and resilience.</li>
<li>Tolerates temporary inconsistencies while ensuring long-term data integrity.</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>Complex to reason about, as temporary inconsistencies can confuse users and developers.</li>
<li>Some actions (e.g., shipping a product) may be difficult to compensate.</li>
</ul>
<hr>
<p><a name="idempotency-and-retries"></a></p>
<h2 id="5-Idempotency-and-Retries"><a href="#5-Idempotency-and-Retries" class="headerlink" title="5. Idempotency and Retries"></a>5. Idempotency and Retries</h2><p>In microservice architectures, <strong>idempotency</strong> and <strong>retries</strong> play a critical role in handling rollbacks and retries, ensuring that repeated operations do not result in unwanted side effects.</p>
<h3 id="Idempotency"><a href="#Idempotency" class="headerlink" title="Idempotency:"></a>Idempotency:</h3><p>An operation is <strong>idempotent</strong> if performing it multiple times has the same result as performing it once. For example, if a <strong>Payment Service</strong> is asked to process a payment twice, it should charge the customer only once.</p>
<p><strong>Why It Matters</strong>:</p>
<ul>
<li>When rolling back a transaction, services may need to retry operations (e.g., issuing a refund). These retries must be idempotent to prevent issues like charging a customer multiple times or reserving inventory repeatedly.</li>
<li><strong>Retry policies</strong> are often implemented in communication mechanisms (e.g., message brokers) to ensure reliability.</li>
</ul>
<h3 id="Best-Practices-for-Idempotency"><a href="#Best-Practices-for-Idempotency" class="headerlink" title="Best Practices for Idempotency:"></a>Best Practices for Idempotency:</h3><ul>
<li>Use unique transaction IDs for requests so that services can detect duplicate requests.</li>
<li>Design APIs and actions to ensure they are safe for retries.</li>
</ul>
<hr>
<p><a name="conclusion"></a></p>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a>6. Conclusion</h2><p>Rolling back or canceling transactions in a <strong>Microservice Architecture</strong> requires careful design to handle distributed data, asynchronous operations, and eventual consistency. The <strong>Saga Pattern</strong> (both choreography and orchestration) is the most widely used approach, allowing each service to independently handle parts of the transaction and apply compensating actions in case of failure. Other techniques like <strong>compensation mechanisms</strong>, <strong>eventual consistency</strong>, and <strong>idempotency</strong> ensure that microservices can maintain integrity, even across complex, distributed environments.</p>
<p>When choosing a rollback strategy, it’s essential to balance the need for consistency with the performance and scalability requirements of the system.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
