<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="WhereQ">
<meta property="og:url" content="https://www.whereq.com/page/4/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Dazhi Zhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">WhereQ</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIII/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIII/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XIII</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 14:07:14" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:14-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-10-25 00:10:08" itemprop="dateModified" datetime="2024-10-25T00:10:08-04:00">2024-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#integration-with-microservices-architecture">Integration with Microservices Architecture</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#microservices-architecture-overview">Microservices Architecture Overview</a></li>
<li><a href="#integrating-spring-webflux-with-microservices">Integrating Spring WebFlux with Microservices</a></li>
<li><a href="#using-spring-cloud">Using Spring Cloud</a></li>
<li><a href="#service-registration-and-discovery">Service Registration and Discovery</a><ul>
<li><a href="#adding-dependencies">Adding Dependencies</a></li>
<li><a href="#configuring-the-eureka-client">Configuring the Eureka Client</a></li>
<li><a href="#annotating-the-main-class">Annotating the Main Class</a></li>
</ul>
</li>
<li><a href="#api-gateway">API Gateway</a><ul>
<li><a href="#adding-dependencies-1">Adding Dependencies</a></li>
<li><a href="#configuring-gateway-routes">Configuring Gateway Routes</a></li>
</ul>
</li>
<li><a href="#client-side-load-balancing">Client-Side Load Balancing</a><ul>
<li><a href="#adding-dependencies-2">Adding Dependencies</a></li>
<li><a href="#configuring-ribbon">Configuring Ribbon</a></li>
</ul>
</li>
<li><a href="#circuit-breaker">Circuit Breaker</a><ul>
<li><a href="#adding-dependencies-3">Adding Dependencies</a></li>
<li><a href="#annotating-the-main-class-1">Annotating the Main Class</a></li>
<li><a href="#using-hystrix-commands">Using Hystrix Commands</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Integration-with-Microservices-Architecture"><a href="#Integration-with-Microservices-Architecture" class="headerlink" title="Integration with Microservices Architecture"></a>Integration with Microservices Architecture</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the previous twelve articles, we have delved into the foundational concepts of Spring WebFlux, Reactor, error handling, data stream transformations, reactive database access, performance optimization, security, testing, deployment and operations, as well as best practices and common pitfalls. This article will focus on integrating Spring WebFlux with microservices architecture to build high-performance, scalable distributed systems.</p>
<p><a name="microservices-architecture-overview"></a></p>
<h2 id="Microservices-Architecture-Overview"><a href="#Microservices-Architecture-Overview" class="headerlink" title="Microservices Architecture Overview"></a>Microservices Architecture Overview</h2><p>Microservices architecture is an approach that breaks down an application into a set of small, independently deployable services, each running in its own process and communicating through lightweight mechanisms, typically HTTP or message queues. The benefits of microservices architecture include:</p>
<ul>
<li><strong>Independent Deployment</strong>: Each service can be deployed and updated independently, reducing system downtime.</li>
<li><strong>Scalability</strong>: Services can be scaled independently, improving resource utilization.</li>
<li><strong>Technological Diversity</strong>: Different services can use the most suitable technology stacks, increasing flexibility in technology choices.</li>
</ul>
<p><a name="integrating-spring-webflux-with-microservices"></a></p>
<h2 id="Integrating-Spring-WebFlux-with-Microservices"><a href="#Integrating-Spring-WebFlux-with-Microservices" class="headerlink" title="Integrating Spring WebFlux with Microservices"></a>Integrating Spring WebFlux with Microservices</h2><p>Spring WebFlux, as a reactive web framework within the Spring ecosystem, is well-suited for building high-concurrency, low-latency microservices. Here are some key points for integrating Spring WebFlux with microservices.</p>
<p><a name="using-spring-cloud"></a></p>
<h2 id="Using-Spring-Cloud"><a href="#Using-Spring-Cloud" class="headerlink" title="Using Spring Cloud"></a>Using Spring Cloud</h2><p>Spring Cloud provides a set of tools to simplify development and management in distributed systems, particularly in microservices architectures based on Spring Boot. Key components include:</p>
<ul>
<li><strong>Spring Cloud Netflix</strong>: Integrates Netflix OSS components such as Eureka (service registration and discovery), Ribbon (client-side load balancing), and Hystrix (circuit breaker).</li>
<li><strong>Spring Cloud Gateway</strong>: An API gateway built on Spring WebFlux, offering dynamic routing, monitoring, and rate limiting.</li>
<li><strong>Spring Cloud Config</strong>: Provides centralized configuration management for distributed systems.</li>
</ul>
<p><a name="service-registration-and-discovery"></a></p>
<h2 id="Service-Registration-and-Discovery"><a href="#Service-Registration-and-Discovery" class="headerlink" title="Service Registration and Discovery"></a>Service Registration and Discovery</h2><p>Service registration and discovery are crucial components in microservices architecture, allowing services to dynamically register themselves and discover other services. Spring Cloud Netflix Eureka is a commonly used service registration and discovery component.</p>
<h3 id="Adding-Dependencies"><a href="#Adding-Dependencies" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Eureka client dependency to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-the-Eureka-Client"><a href="#Configuring-the-Eureka-Client" class="headerlink" title="Configuring the Eureka Client"></a>Configuring the Eureka Client</h3><p>Configure the Eureka client in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">eureka.client.service-url.defaultZone</span>=<span class="string">http://localhost:8761/eureka/</span></span><br></pre></td></tr></table></figure>

<h3 id="Annotating-the-Main-Class"><a href="#Annotating-the-Main-Class" class="headerlink" title="Annotating the Main Class"></a>Annotating the Main Class</h3><p>Annotate your Spring Boot main class with <code>@EnableEurekaClient</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="api-gateway"></a></p>
<h2 id="API-Gateway"><a href="#API-Gateway" class="headerlink" title="API Gateway"></a>API Gateway</h2><p>An API gateway is another critical component in microservices architecture, handling all external requests and routing them to the appropriate services. Spring Cloud Gateway is an API gateway built on Spring WebFlux.</p>
<h3 id="Adding-Dependencies-1"><a href="#Adding-Dependencies-1" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud Gateway dependency to your gateway service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Gateway-Routes"><a href="#Configuring-Gateway-Routes" class="headerlink" title="Configuring Gateway Routes"></a>Configuring Gateway Routes</h3><p>Configure routes in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.gateway.routes[0].id</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].uri</span>=<span class="string">lb://book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].predicates[0]</span>=<span class="string">Path=/books/**</span></span><br></pre></td></tr></table></figure>

<p><a name="client-side-load-balancing"></a></p>
<h2 id="Client-Side-Load-Balancing"><a href="#Client-Side-Load-Balancing" class="headerlink" title="Client-Side Load Balancing"></a>Client-Side Load Balancing</h2><p>Spring Cloud Netflix Ribbon provides client-side load balancing, allowing services to distribute requests across multiple instances.</p>
<h3 id="Adding-Dependencies-2"><a href="#Adding-Dependencies-2" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Ribbon dependency to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Ribbon"><a href="#Configuring-Ribbon" class="headerlink" title="Configuring Ribbon"></a>Configuring Ribbon</h3><p>Configure Ribbon in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">book-service.ribbon.listOfServers</span>=<span class="string">localhost:8081,localhost:8082</span></span><br></pre></td></tr></table></figure>

<p><a name="circuit-breaker"></a></p>
<h2 id="Circuit-Breaker"><a href="#Circuit-Breaker" class="headerlink" title="Circuit Breaker"></a>Circuit Breaker</h2><p>Circuit breakers are an essential pattern in microservices architecture, handling service call failures to prevent fault propagation. Spring Cloud Netflix Hystrix provides circuit breaker functionality.</p>
<h3 id="Adding-Dependencies-3"><a href="#Adding-Dependencies-3" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Hystrix dependency to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Annotating-the-Main-Class-1"><a href="#Annotating-the-Main-Class-1" class="headerlink" title="Annotating the Main Class"></a>Annotating the Main Class</h3><p>Annotate your Spring Boot main class with <code>@EnableHystrix</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.EnableHystrix;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Hystrix-Commands"><a href="#Using-Hystrix-Commands" class="headerlink" title="Using Hystrix Commands"></a>Using Hystrix Commands</h3><p>Use Hystrix commands in your service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;defaultBook&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// Call external service or database query</span></span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">defaultBook</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="keyword">new</span> <span class="title class_">Book</span>(id, <span class="string">&quot;Default Book&quot;</span>, <span class="string">&quot;Unknown&quot;</span>, <span class="number">0.0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to integrate Spring WebFlux with microservices architecture. By leveraging Spring Cloud components, we can easily build high-performance, scalable distributed systems.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XII/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XII/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XII</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:07:10 / Modified: 23:36:21" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:10-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In the previous 11 articles, we explored Spring WebFlux fundamentals, Reactor, error handling, data transformation, reactive database access, performance optimization, security, testing, deployment, operations, and best practices. This article will demonstrate how to build a practical Spring WebFlux application through a comprehensive case study.</p>
<ul>
<li><a href="#case-study">Case Study</a><ul>
<li><a href="#1-case-background">1. Case Background</a></li>
<li><a href="#2-project-setup">2. Project Setup</a></li>
<li><a href="#3-data-model">3. Data Model</a></li>
<li><a href="#4-repository-layer">4. Repository Layer</a></li>
<li><a href="#5-service-layer">5. Service Layer</a></li>
<li><a href="#6-handler-and-routing-configuration">6. Handler and Routing Configuration</a></li>
<li><a href="#7-testing">7. Testing</a><ul>
<li><a href="#unit-testing">Unit Testing</a></li>
<li><a href="#integration-testing">Integration Testing</a></li>
</ul>
</li>
<li><a href="#8-deployment-and-monitoring">8. Deployment and Monitoring</a></li>
<li><a href="#9-conclusion">9. Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Case-Study"><a href="#Case-Study" class="headerlink" title="Case Study"></a>Case Study</h1><hr>
<p><a name="case-background"></a></p>
<h2 id="1-Case-Background"><a href="#1-Case-Background" class="headerlink" title="1. Case Background"></a>1. Case Background</h2><p>We will build a simple book management system with the following features:</p>
<ul>
<li>Add a book</li>
<li>Retrieve all books</li>
<li>Retrieve a book by ID</li>
<li>Update book details</li>
<li>Delete a book</li>
</ul>
<p><a name="project-setup"></a></p>
<h2 id="2-Project-Setup"><a href="#2-Project-Setup" class="headerlink" title="2. Project Setup"></a>2. Project Setup</h2><p>First, create a Spring Boot project and include the required dependencies:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.r2dbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>r2dbc-h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="data-model"></a></p>
<h2 id="3-Data-Model"><a href="#3-Data-Model" class="headerlink" title="3. Data Model"></a>3. Data Model</h2><p>Define a <code>Book</code> entity:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.relational.core.mapping.Table;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Table(&quot;books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="repository-layer"></a></p>
<h2 id="4-Repository-Layer"><a href="#4-Repository-Layer" class="headerlink" title="4. Repository Layer"></a>4. Repository Layer</h2><p>Create a reactive <code>BookRepository</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.repository.reactive.ReactiveCrudRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookRepository</span> <span class="keyword">extends</span> <span class="title class_">ReactiveCrudRepository</span>&lt;Book, Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="service-layer"></a></p>
<h2 id="5-Service-Layer"><a href="#5-Service-Layer" class="headerlink" title="5. Service Layer"></a>5. Service Layer</h2><p>Create a service class for business logic handling:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(BookRepository bookRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookRepository = bookRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">addBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.save(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Book&gt; <span class="title function_">getAllBooks</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">updateBook</span><span class="params">(Long id, Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">            .flatMap(existingBook -&gt; &#123;</span><br><span class="line">                existingBook.setTitle(book.getTitle());</span><br><span class="line">                existingBook.setAuthor(book.getAuthor());</span><br><span class="line">                existingBook.setPrice(book.getPrice());</span><br><span class="line">                <span class="keyword">return</span> bookRepository.save(existingBook);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">deleteBook</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="handler-and-routing-configuration"></a></p>
<h2 id="6-Handler-and-Routing-Configuration"><a href="#6-Handler-and-Routing-Configuration" class="headerlink" title="6. Handler and Routing Configuration"></a>6. Handler and Routing Configuration</h2><p>Define handler functions and routing configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.RouterFunction;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.RouterFunctions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookHandler</span><span class="params">(BookService bookService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookService = bookService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">addBook</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.bodyToMono(Book.class)</span><br><span class="line">            .flatMap(bookService::addBook)</span><br><span class="line">            .flatMap(book -&gt; ServerResponse.ok().body(Mono.just(book), Book.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getAllBooks</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().body(bookService.getAllBooks(), Book.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getBookById</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Long.valueOf(request.pathVariable(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> bookService.getBookById(id)</span><br><span class="line">            .flatMap(book -&gt; ServerResponse.ok().body(Mono.just(book), Book.class))</span><br><span class="line">            .switchIfEmpty(ServerResponse.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">updateBook</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Long.valueOf(request.pathVariable(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> request.bodyToMono(Book.class)</span><br><span class="line">            .flatMap(book -&gt; bookService.updateBook(id, book))</span><br><span class="line">            .flatMap(updatedBook -&gt; ServerResponse.ok().body(Mono.just(updatedBook), Book.class))</span><br><span class="line">            .switchIfEmpty(ServerResponse.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">deleteBook</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Long.valueOf(request.pathVariable(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> bookService.deleteBook(id)</span><br><span class="line">            .then(ServerResponse.ok().build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">route</span><span class="params">(BookHandler handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">            .POST(<span class="string">&quot;/books&quot;</span>, handler::addBook)</span><br><span class="line">            .GET(<span class="string">&quot;/books&quot;</span>, handler::getAllBooks)</span><br><span class="line">            .GET(<span class="string">&quot;/books/&#123;id&#125;&quot;</span>, handler::getBookById)</span><br><span class="line">            .PUT(<span class="string">&quot;/books/&#123;id&#125;&quot;</span>, handler::updateBook)</span><br><span class="line">            .DELETE(<span class="string">&quot;/books/&#123;id&#125;&quot;</span>, handler::deleteBook)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="testing"></a></p>
<h2 id="7-Testing"><a href="#7-Testing" class="headerlink" title="7. Testing"></a>7. Testing</h2><p><a name="unit-testing"></a></p>
<h3 id="Unit-Testing"><a href="#Unit-Testing" class="headerlink" title="Unit Testing"></a>Unit Testing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFluxTest(BookHandler.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookHandlerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webTestClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAddBook</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="literal">null</span>, <span class="string">&quot;Spring WebFlux&quot;</span>, <span class="string">&quot;Author&quot;</span>, <span class="number">39.99</span>);</span><br><span class="line">        webTestClient.post().uri(<span class="string">&quot;/books&quot;</span>)</span><br><span class="line">            .bodyValue(book)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.title&quot;</span>).isEqualTo(<span class="string">&quot;Spring WebFlux&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAllBooks</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/books&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBodyList(Book.class).hasSize(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetBookById</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/books/1&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.title&quot;</span>).isEqualTo(<span class="string">&quot;Spring WebFlux&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="integration-testing"></a></p>
<h3 id="Integration-Testing"><a href="#Integration-Testing" class="headerlink" title="Integration Testing"></a>Integration Testing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationIntegrationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webTestClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testBookFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Add book</span></span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="literal">null</span>, <span class="string">&quot;Spring WebFlux&quot;</span>, <span class="string">&quot;Author&quot;</span>, <span class="number">39.99</span>);</span><br><span class="line">        webTestClient.post().uri(<span class="string">&quot;/books&quot;</span>)</span><br><span class="line">            .bodyValue(book)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.title&quot;</span>).isEqualTo(<span class="string">&quot;Spring WebFlux&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Retrieve all books</span></span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/books&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBodyList(Book.class).hasSize(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Retrieve book by ID</span></span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/books/1&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.title&quot;</span>).isEqualTo(<span class="string">&quot;Spring WebFlux&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update book</span></span><br><span class="line">        <span class="type">Book</span> <span class="variable">updatedBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="literal">null</span>, <span class="string">&quot;Spring WebFlux Updated&quot;</span>, <span class="string">&quot;Author&quot;</span>, <span class="number">49.99</span>);</span><br><span class="line">        webTestClient.put().uri(<span class="string">&quot;/books/1&quot;</span>)</span><br><span class="line">            .bodyValue(updatedBook)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.title&quot;</span>).isEqualTo(<span class="string">&quot;Spring WebFlux Updated&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Delete book</span></span><br><span class="line">        webTestClient.delete().uri(<span class="string">&quot;/books/1&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            .expectStatus().isOk();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Verify deletion</span></span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/books/1&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isNotFound();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="deployment-and-monitoring"></a></p>
<h2 id="8-Deployment-and-Monitoring"><a href="#8-Deployment-and-Monitoring" class="headerlink" title="8. Deployment and Monitoring"></a>8. Deployment and Monitoring</h2><p>Ensure the application is deployed to production and properly monitored. Use <strong>Spring Boot Actuator</strong> with <strong>Prometheus</strong> and <strong>Grafana</strong> for monitoring:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">health,info,metrics,prometheus</span></span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="9-Conclusion"><a href="#9-Conclusion" class="headerlink" title="9. Conclusion"></a>9. Conclusion</h2><p>In this article, we demonstrated how to build a real-world reactive application using Spring WebFlux by integrating the concepts from earlier articles and applying best practices.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XI/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:07:07 / Modified: 17:08:31" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:07-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#best-practices-and-common-pitfalls">Best Practices and Common Pitfalls</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#best-practices">Best Practices</a><ul>
<li><a href="#1-proper-use-of-mono-and-flux">1. Proper Use of Mono and Flux</a></li>
<li><a href="#2-error-handling">2. Error Handling</a></li>
<li><a href="#3-backpressure-management">3. Backpressure Management</a></li>
<li><a href="#4-non-blocking-io-operations">4. Non-blocking I&#x2F;O Operations</a></li>
<li><a href="#5-proper-thread-model-configuration">5. Proper Thread Model Configuration</a></li>
</ul>
</li>
<li><a href="#common-pitfalls">Common Pitfalls</a><ul>
<li><a href="#1-blocking-operations">1. Blocking Operations</a></li>
<li><a href="#2-ignoring-error-handling">2. Ignoring Error Handling</a></li>
<li><a href="#3-resource-leaks">3. Resource Leaks</a></li>
<li><a href="#4-over-reliance-on-default-configurations">4. Over-reliance on Default Configurations</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<hr>
<h1 id="Best-Practices-and-Common-Pitfalls"><a href="#Best-Practices-and-Common-Pitfalls" class="headerlink" title="Best Practices and Common Pitfalls"></a>Best Practices and Common Pitfalls</h1><hr>
<p><a name="introduction"></a></p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>In the first ten articles of this series, we discussed the foundational concepts of Spring WebFlux, including Reactor, error handling, data flow transformation, reactive database access, performance optimization, security, testing, and deployment. In this article, we will summarize the best practices for developing Spring WebFlux applications and highlight common pitfalls to help developers build more robust and efficient reactive systems.</p>
<p><a name="best-practices"></a></p>
<h1 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h1><p><a name="proper-use-of-mono-and-flux"></a></p>
<h2 id="1-Proper-Use-of-Mono-and-Flux"><a href="#1-Proper-Use-of-Mono-and-Flux" class="headerlink" title="1. Proper Use of Mono and Flux"></a>1. Proper Use of Mono and Flux</h2><ul>
<li><strong>Mono</strong>: Used for handling asynchronous sequences containing a single element or none. For example, when querying a database for a single user object.</li>
<li><strong>Flux</strong>: Used for handling asynchronous sequences containing multiple elements. For example, retrieving multiple user objects from a database.</li>
</ul>
<p>Ensure that <strong>Mono</strong> and <strong>Flux</strong> are used in appropriate contexts to keep the code simple and readable.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">findUserById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">findAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="error-handling"></a></p>
<h2 id="2-Error-Handling"><a href="#2-Error-Handling" class="headerlink" title="2. Error Handling"></a>2. Error Handling</h2><ul>
<li><strong>onErrorReturn</strong>: Returns a default value when an error occurs.</li>
<li><strong>onErrorResume</strong>: Switches to another <code>Publisher</code> upon encountering an error.</li>
<li><strong>onErrorMap</strong>: Transforms one type of error into another.</li>
</ul>
<p>These operators can be used to handle errors gracefully and ensure the application recovers from failures efficiently.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">findUserById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findById(id)</span><br><span class="line">            .onErrorReturn(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;Default User&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="backpressure-management"></a></p>
<h2 id="3-Backpressure-Management"><a href="#3-Backpressure-Management" class="headerlink" title="3. Backpressure Management"></a>3. Backpressure Management</h2><p>In high-concurrency environments, managing <strong>backpressure</strong> is critical to maintaining system stability. Operators like <code>limitRate</code>, <code>onBackpressureBuffer</code>, and <code>onBackpressureDrop</code> help control the flow of data to prevent overloading.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findAll()</span><br><span class="line">            .limitRate(<span class="number">100</span>)</span><br><span class="line">            .onBackpressureBuffer(<span class="number">50</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="non-blocking-io-operations"></a></p>
<h2 id="4-Non-blocking-I-O-Operations"><a href="#4-Non-blocking-I-O-Operations" class="headerlink" title="4. Non-blocking I&#x2F;O Operations"></a>4. Non-blocking I&#x2F;O Operations</h2><p>Ensure that all I&#x2F;O operations are non-blocking. Avoid using blocking APIs such as <code>RestTemplate</code>, and instead use <strong>WebClient</strong> for HTTP requests.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(<span class="string">&quot;http://example.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUser</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.get()</span><br><span class="line">                .uri(<span class="string">&quot;/users/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">                .retrieve()</span><br><span class="line">                .bodyToMono(User.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WebClient provides an efficient and reactive way to make HTTP calls without blocking the thread.</p>
<p><a name="proper-thread-model-configuration"></a></p>
<h2 id="5-Proper-Thread-Model-Configuration"><a href="#5-Proper-Thread-Model-Configuration" class="headerlink" title="5. Proper Thread Model Configuration"></a>5. Proper Thread Model Configuration</h2><p>Adjust Reactor and Netty thread configurations based on application requirements to optimize performance in high-concurrency environments.</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reactor.netty.ioWorkerCount</span>=<span class="string">16</span></span><br></pre></td></tr></table></figure>

<p>Fine-tuning the thread pool ensures the application can handle more requests efficiently under high loads.</p>
<p><a name="common-pitfalls"></a></p>
<h1 id="Common-Pitfalls"><a href="#Common-Pitfalls" class="headerlink" title="Common Pitfalls"></a>Common Pitfalls</h1><p><a name="blocking-operations"></a></p>
<h2 id="1-Blocking-Operations"><a href="#1-Blocking-Operations" class="headerlink" title="1. Blocking Operations"></a>1. Blocking Operations</h2><p>Avoid using <strong>blocking operations</strong> in reactive programming, such as thread sleeps or blocking database queries. Blocking calls reduce system performance by causing threads to wait unnecessarily.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">findUserById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">// Avoid using blocking calls</span></span><br><span class="line">    <span class="keyword">return</span> Mono.fromCallable(() -&gt; &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>); <span class="comment">// This is a blocking call</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Blocking operations can be detrimental in a reactive context, where non-blocking operations are essential for throughput.</p>
<p><a name="ignoring-error-handling"></a></p>
<h2 id="2-Ignoring-Error-Handling"><a href="#2-Ignoring-Error-Handling" class="headerlink" title="2. Ignoring Error Handling"></a>2. Ignoring Error Handling</h2><p>Ignoring error handling in reactive streams can lead to application crashes when exceptions occur. Ensure that potential errors are handled at every stage of the stream.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">findUserById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findById(id)</span><br><span class="line">            .onErrorResume(e -&gt; &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Error occurred&quot;</span>, e);</span><br><span class="line">                <span class="keyword">return</span> Mono.empty();</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Proper error handling ensures the system remains resilient under failure conditions.</p>
<p><a name="resource-leaks"></a></p>
<h2 id="3-Resource-Leaks"><a href="#3-Resource-Leaks" class="headerlink" title="3. Resource Leaks"></a>3. Resource Leaks</h2><p>Ensure that resources such as files, database connections, or network sockets are properly closed after usage to avoid <strong>resource leaks</strong>. For instance, when handling file streams, ensure the file is closed after processing.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">readFile</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.using(</span><br><span class="line">            () -&gt; Files.lines(Paths.get(path)),</span><br><span class="line">            Flux::fromStream,</span><br><span class="line">            Stream::close</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using the <code>Flux.using</code> construct ensures that resources are cleaned up when no longer needed.</p>
<p><a name="over-reliance-on-default-configurations"></a></p>
<h2 id="4-Over-reliance-on-Default-Configurations"><a href="#4-Over-reliance-on-Default-Configurations" class="headerlink" title="4. Over-reliance on Default Configurations"></a>4. Over-reliance on Default Configurations</h2><p>While Spring Boot provides many default configurations, relying on them in a production environment can be risky. Adjust configurations such as <strong>Netty thread count</strong> and <strong>database connection pool size</strong> based on the specific needs of your application.</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.r2dbc.pool.initialSize</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">spring.r2dbc.pool.maxSize</span>=<span class="string">50</span></span><br></pre></td></tr></table></figure>

<p>By customizing these settings, you can optimize resource usage and ensure smooth scaling under different load conditions.</p>
<p><a name="conclusion"></a></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>In this article, we summarized the best practices for developing Spring WebFlux applications and highlighted common pitfalls to avoid during development. By following these practices and avoiding common mistakes, developers can build more robust, scalable, and efficient reactive applications.</p>
<p>Staying mindful of performance, error handling, and resource management while leveraging reactive programming concepts will lead to high-performing, non-blocking systems capable of handling large volumes of traffic efficiently.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-X/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-X/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - X</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:07:01 / Modified: 17:00:34" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:01-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#deployment-and-operations">Deployment and Operations</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#pre-deployment-preparation">Pre-deployment Preparation</a><ul>
<li><a href="#1-configuration-optimization">1. Configuration Optimization</a></li>
<li><a href="#2-security-configuration">2. Security Configuration</a></li>
</ul>
</li>
<li><a href="#deploying-spring-webflux-applications">Deploying Spring WebFlux Applications</a><ul>
<li><a href="#1-deploying-with-docker">1. Deploying with Docker</a><ul>
<li><a href="#creating-a-dockerfile">Creating a Dockerfile</a></li>
<li><a href="#building-and-running-the-docker-image">Building and Running the Docker Image</a></li>
</ul>
</li>
<li><a href="#2-deploying-with-kubernetes">2. Deploying with Kubernetes</a><ul>
<li><a href="#creating-a-kubernetes-deployment-file">Creating a Kubernetes Deployment File</a></li>
<li><a href="#deploying-to-a-kubernetes-cluster">Deploying to a Kubernetes Cluster</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#operations-and-monitoring">Operations and Monitoring</a><ul>
<li><a href="#1-using-spring-boot-actuator">1. Using Spring Boot Actuator</a></li>
<li><a href="#2-using-prometheus-and-grafana">2. Using Prometheus and Grafana</a><ul>
<li><a href="#configuring-prometheus">Configuring Prometheus</a></li>
<li><a href="#configuring-grafana">Configuring Grafana</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<hr>
<h1 id="Deployment-and-Operations"><a href="#Deployment-and-Operations" class="headerlink" title="Deployment and Operations"></a>Deployment and Operations</h1><hr>
<p><a name="introduction"></a></p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>In previous articles, we explored foundational concepts of Spring WebFlux, including Reactor, error handling, data flow transformation, reactive database access, performance optimization, security, and testing. In this article, we’ll delve into how to deploy and maintain Spring WebFlux applications in a production environment to ensure they run efficiently and reliably.</p>
<p><a name="pre-deployment-preparation"></a></p>
<h1 id="Pre-deployment-Preparation"><a href="#Pre-deployment-Preparation" class="headerlink" title="Pre-deployment Preparation"></a>Pre-deployment Preparation</h1><p>Before deploying a Spring WebFlux application to a production environment, there are several critical preparations to ensure the application’s reliability and performance.</p>
<p><a name="configuration-optimization"></a></p>
<h2 id="1-Configuration-Optimization"><a href="#1-Configuration-Optimization" class="headerlink" title="1. Configuration Optimization"></a>1. Configuration Optimization</h2><p>Tuning the configuration of Spring Boot and Netty is essential for production. This includes adjusting parameters to handle high-concurrency scenarios.</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Increase Netty thread count</span></span><br><span class="line"><span class="attr">reactor.netty.ioWorkerCount</span>=<span class="string">16</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Configure database connection pool</span></span><br><span class="line"><span class="attr">spring.r2dbc.url</span>=<span class="string">r2dbc:pool:postgresql://localhost:5432/mydb</span></span><br><span class="line"><span class="attr">spring.r2dbc.pool.initialSize</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">spring.r2dbc.pool.maxSize</span>=<span class="string">50</span></span><br></pre></td></tr></table></figure>

<p>Optimizing thread pools and connection pools is crucial for handling increased traffic in production environments, especially when working with reactive systems.</p>
<p><a name="security-configuration"></a></p>
<h2 id="2-Security-Configuration"><a href="#2-Security-Configuration" class="headerlink" title="2. Security Configuration"></a>2. Security Configuration</h2><p>Ensure that all necessary security configurations are enabled in the production environment, such as HTTPS, CSRF protection, and XSS protection.</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enable SSL</span></span><br><span class="line"><span class="attr">server.ssl.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">server.ssl.key-store</span>=<span class="string">classpath:keystore.jks</span></span><br><span class="line"><span class="attr">server.ssl.key-store-password</span>=<span class="string">changeit</span></span><br></pre></td></tr></table></figure>

<p>These settings help secure communication between the client and server, protecting sensitive data.</p>
<p><a name="deploying-spring-webflux-applications"></a></p>
<h1 id="Deploying-Spring-WebFlux-Applications"><a href="#Deploying-Spring-WebFlux-Applications" class="headerlink" title="Deploying Spring WebFlux Applications"></a>Deploying Spring WebFlux Applications</h1><p>There are various ways to deploy Spring WebFlux applications, including traditional server deployment, Docker containerization, and Kubernetes orchestration. We will focus on Docker and Kubernetes deployment methods.</p>
<p><a name="deploying-with-docker"></a></p>
<h2 id="1-Deploying-with-Docker"><a href="#1-Deploying-with-Docker" class="headerlink" title="1. Deploying with Docker"></a>1. Deploying with Docker</h2><p>Docker simplifies the deployment process, making it easier to run applications consistently across different environments.</p>
<h3 id="Creating-a-Dockerfile"><a href="#Creating-a-Dockerfile" class="headerlink" title="Creating a Dockerfile"></a>Creating a Dockerfile</h3><p>Create a <code>Dockerfile</code> to build your application’s Docker image:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use the official OpenJDK base image</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the working directory</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy the JAR file into the container</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/myapp.jar /app/myapp.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Expose the application port</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start the application</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;myapp.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Building-and-Running-the-Docker-Image"><a href="#Building-and-Running-the-Docker-Image" class="headerlink" title="Building and Running the Docker Image"></a>Building and Running the Docker Image</h3><p>Use the following commands to build and run the Docker image:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build the Docker image</span></span><br><span class="line">docker build -t myapp:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the Docker container</span></span><br><span class="line">docker run -d -p 8080:8080 myapp:latest</span><br></pre></td></tr></table></figure>

<p><a name="deploying-with-kubernetes"></a></p>
<h2 id="2-Deploying-with-Kubernetes"><a href="#2-Deploying-with-Kubernetes" class="headerlink" title="2. Deploying with Kubernetes"></a>2. Deploying with Kubernetes</h2><p>Kubernetes is a popular container orchestration platform suited for managing large-scale distributed applications.</p>
<h3 id="Creating-a-Kubernetes-Deployment-File"><a href="#Creating-a-Kubernetes-Deployment-File" class="headerlink" title="Creating a Kubernetes Deployment File"></a>Creating a Kubernetes Deployment File</h3><p>Create a <code>deployment.yaml</code> file to define the Kubernetes deployment:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br></pre></td></tr></table></figure>

<h3 id="Deploying-to-a-Kubernetes-Cluster"><a href="#Deploying-to-a-Kubernetes-Cluster" class="headerlink" title="Deploying to a Kubernetes Cluster"></a>Deploying to a Kubernetes Cluster</h3><p>Use the following commands to deploy the application to a Kubernetes cluster:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Apply the deployment and service configurations</span></span><br><span class="line">kubectl apply -f deployment.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the deployment status</span></span><br><span class="line">kubectl get deployments</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the service status</span></span><br><span class="line">kubectl get services</span><br></pre></td></tr></table></figure>

<p><a name="operations-and-monitoring"></a></p>
<h1 id="Operations-and-Monitoring"><a href="#Operations-and-Monitoring" class="headerlink" title="Operations and Monitoring"></a>Operations and Monitoring</h1><p>After deploying to a production environment, ongoing operations and monitoring are key to ensuring the application runs smoothly.</p>
<p><a name="using-spring-boot-actuator"></a></p>
<h2 id="1-Using-Spring-Boot-Actuator"><a href="#1-Using-Spring-Boot-Actuator" class="headerlink" title="1. Using Spring Boot Actuator"></a>1. Using Spring Boot Actuator</h2><p>Spring Boot Actuator provides rich monitoring and management capabilities, allowing real-time health checks and performance tracking.</p>
<p>Add the dependency to your <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Enable Actuator endpoints in the <code>application.properties</code> file:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">health,info,metrics,prometheus</span></span><br></pre></td></tr></table></figure>

<p><a name="using-prometheus-and-grafana"></a></p>
<h2 id="2-Using-Prometheus-and-Grafana"><a href="#2-Using-Prometheus-and-Grafana" class="headerlink" title="2. Using Prometheus and Grafana"></a>2. Using Prometheus and Grafana</h2><p>Prometheus and Grafana are popular open-source monitoring tools suitable for tracking the performance and health of Spring WebFlux applications.</p>
<h3 id="Configuring-Prometheus"><a href="#Configuring-Prometheus" class="headerlink" title="Configuring Prometheus"></a>Configuring Prometheus</h3><p>In the <code>prometheus.yml</code> file, add the Spring Boot Actuator’s Prometheus endpoint:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring-webflux&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:8080&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Grafana"><a href="#Configuring-Grafana" class="headerlink" title="Configuring Grafana"></a>Configuring Grafana</h3><p>Add Prometheus as a data source in Grafana and create dashboards to monitor key application metrics such as memory usage, response times, and request rates.</p>
<p>This setup provides a full observability stack to keep your Spring WebFlux application under constant monitoring for proactive performance tuning and anomaly detection.</p>
<p><a name="conclusion"></a></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>In this article, we discussed how to deploy and operate Spring WebFlux applications in a production environment. With proper configuration optimization, Docker and Kubernetes deployment methods, and continuous monitoring and operations, we can ensure that our applications run efficiently and reliably in production.</p>
<p>By integrating monitoring tools like Prometheus and Grafana, and leveraging Spring Boot Actuator, you can maintain high visibility into your application’s performance and quickly address any issues that arise.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-IX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-IX/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - IX</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:06:56 / Modified: 16:59:12" itemprop="dateCreated datePublished" datetime="2024-10-24T14:06:56-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<ul>
<li><a href="#test">Test</a></li>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#why-testing-is-necessary">Why Testing is Necessary</a></li>
<li><a href="#types-of-testing-in-spring-webflux">Types of Testing in Spring WebFlux</a><ul>
<li><a href="#1-unit-testing">1. Unit Testing</a><ul>
<li><a href="#11-testing-controllers-with-webtestclient">1.1 Testing Controllers with WebTestClient</a></li>
<li><a href="#12-testing-services-with-mockito">1.2 Testing Services with Mockito</a></li>
</ul>
</li>
<li><a href="#2-integration-testing">2. Integration Testing</a></li>
<li><a href="#3-end-to-end-testing">3. End-to-End Testing</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><hr>
<p><a name="introduction"></a></p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>In previous articles, we explored the foundational concepts of Spring WebFlux, Reactor, error handling, data flow transformation, reactive database access, performance optimization, complex scenarios, and security. This article delves into how to conduct testing in Spring WebFlux to ensure that our reactive applications run reliably in both development and production environments.</p>
<p><a name="why-testing-is-necessary"></a></p>
<h2 id="Why-Testing-is-Necessary"><a href="#Why-Testing-is-Necessary" class="headerlink" title="Why Testing is Necessary"></a>Why Testing is Necessary</h2><p>Testing is an indispensable part of the software development process. Through testing, we can validate code correctness, ensure individual modules function as expected, and promptly identify and resolve potential issues. For reactive applications like those built with Spring WebFlux, testing is particularly important because reactive programming introduces asynchronous and non-blocking operations, which increase the complexity of debugging and validation.</p>
<p><a name="types-of-testing-in-spring-webflux"></a></p>
<h2 id="Types-of-Testing-in-Spring-WebFlux"><a href="#Types-of-Testing-in-Spring-WebFlux" class="headerlink" title="Types of Testing in Spring WebFlux"></a>Types of Testing in Spring WebFlux</h2><p>In Spring WebFlux, there are typically three main types of tests:</p>
<ul>
<li>Unit Testing: Testing individual modules or components to ensure their behavior matches expectations.</li>
<li>Integration Testing: Testing the interactions between multiple modules to ensure they work together correctly.</li>
<li>End-to-End Testing: Simulating real user actions and verifying the behavior of the entire system.</li>
</ul>
<p><a name="unit-testing"></a></p>
<h3 id="1-Unit-Testing"><a href="#1-Unit-Testing" class="headerlink" title="1. Unit Testing"></a>1. Unit Testing</h3><p>Unit testing is the smallest test scope, focusing on individual functionality or components. In Spring WebFlux, we commonly test controllers, services, and data access layers.</p>
<p><a name="testing-controllers-with-webtestclient"></a></p>
<h4 id="1-1-Testing-Controllers-with-WebTestClient"><a href="#1-1-Testing-Controllers-with-WebTestClient" class="headerlink" title="1.1 Testing Controllers with WebTestClient"></a>1.1 Testing Controllers with WebTestClient</h4><p><code>WebTestClient</code> is a powerful tool for testing the web layer of Spring WebFlux applications.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFluxTest(UserHandler.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHandlerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webTestClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetUser</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/user/1&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.name&quot;</span>).isEqualTo(<span class="string">&quot;John Doe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBodyList(User.class).hasSize(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This example shows how to test a controller using <code>WebTestClient</code>, focusing on the <code>GET /user/1</code> and <code>GET /users</code> endpoints.</p>
<p><a name="testing-services-with-mockito"></a></p>
<h4 id="1-2-Testing-Services-with-Mockito"><a href="#1-2-Testing-Services-with-Mockito" class="headerlink" title="1.2 Testing Services with Mockito"></a>1.2 Testing Services with Mockito</h4><p>Mockito is a popular mocking framework used to create and manage dependencies in tests.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.mockito.InjectMocks;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Mock;</span><br><span class="line"><span class="keyword">import</span> org.mockito.MockitoAnnotations;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InjectMocks</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceTest</span><span class="params">()</span> &#123;</span><br><span class="line">        MockitoAnnotations.openMocks(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;John Doe&quot;</span>);</span><br><span class="line">        when(userRepository.findById(<span class="string">&quot;1&quot;</span>)).thenReturn(Mono.just(user));</span><br><span class="line"></span><br><span class="line">        Mono&lt;User&gt; result = userService.getUser(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        assertEquals(<span class="string">&quot;John Doe&quot;</span>, result.block().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, we use Mockito to mock the <code>UserRepository</code> and verify that the <code>UserService</code> correctly retrieves the user.</p>
<p><a name="integration-testing"></a></p>
<h3 id="2-Integration-Testing"><a href="#2-Integration-Testing" class="headerlink" title="2. Integration Testing"></a>2. Integration Testing</h3><p>Integration tests validate the interactions between multiple modules. In Spring WebFlux, we usually use the <code>@SpringBootTest</code> annotation to load the entire application context and use <code>WebTestClient</code> to perform tests.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationIntegrationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webTestClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetUser</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/user/1&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.name&quot;</span>).isEqualTo(<span class="string">&quot;John Doe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBodyList(User.class).hasSize(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, the entire application is loaded and tested for correctness across modules using <code>WebTestClient</code>.</p>
<p><a name="end-to-end-testing"></a></p>
<h3 id="3-End-to-End-Testing"><a href="#3-End-to-End-Testing" class="headerlink" title="3. End-to-End Testing"></a>3. End-to-End Testing</h3><p>End-to-end testing simulates real user actions and verifies the behavior of the entire system. These tests are generally more complex as they involve starting the whole application and mimicking various user interaction scenarios.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EndToEndTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webTestClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUserFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Create a new user</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        webTestClient.post().uri(<span class="string">&quot;/user&quot;</span>)</span><br><span class="line">            .bodyValue(newUser)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.name&quot;</span>).isEqualTo(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get all users</span></span><br><span class="line">        webTestClient.get().uri(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBodyList(User.class).hasSize(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This example tests the flow of creating a new user and then retrieving all users to ensure the system works end-to-end.</p>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we discussed how to perform testing in Spring WebFlux. By conducting unit tests, integration tests, and end-to-end tests, you can ensure that every part of your application functions as expected. Additionally, understanding common vulnerabilities like CSRF and XSS is crucial for building secure applications.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-VIII/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-VIII/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - VIII</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:06:50 / Modified: 16:42:39" itemprop="dateCreated datePublished" datetime="2024-10-24T14:06:50-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#security">Security</a></li>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#why-security-is-necessary">Why Security is Necessary</a></li>
<li><a href="#integrating-spring-security-with-webflux">Integrating Spring Security with WebFlux</a><ul>
<li><a href="#1-adding-dependencies">1. Adding Dependencies</a></li>
<li><a href="#2-configuring-security-policies">2. Configuring Security Policies</a></li>
<li><a href="#3-customizing-user-details-service">3. Customizing User Details Service</a></li>
</ul>
</li>
<li><a href="#preventing-common-security-threats">Preventing Common Security Threats</a><ul>
<li><a href="#1-csrf-cross-site-request-forgery">1. CSRF (Cross-Site Request Forgery)</a></li>
<li><a href="#2-xss-cross-site-scripting">2. XSS (Cross-Site Scripting)</a></li>
</ul>
</li>
<li><a href="#security-best-practices">Security Best Practices</a></li>
<li><a href="#csrf-and-xss-attacks">CSRF and XSS Attacks</a><ul>
<li><a href="#what-is-csrf">What is CSRF?</a><ul>
<li><a href="#mitigating-csrf">Mitigating CSRF</a></li>
</ul>
</li>
<li><a href="#what-is-xss">What is XSS?</a><ul>
<li><a href="#mitigating-xss">Mitigating XSS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h1><hr>
<p><a name="introduction"></a></p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>In previous articles, we discussed the foundational concepts of Spring WebFlux, Reactor, error handling, data flow transformation, reactive database access, performance optimization, and applying these concepts in complex scenarios. This article will dive into how to implement security in Spring WebFlux to ensure that our applications run safely in high-concurrency environments.</p>
<p><a name="why-security-is-necessary"></a></p>
<h2 id="Why-Security-is-Necessary"><a href="#Why-Security-is-Necessary" class="headerlink" title="Why Security is Necessary"></a>Why Security is Necessary</h2><p>In any web application, security is crucial. It protects user data from unauthorized access and modifications while preventing common security threats such as Cross-Site Scripting (XSS), SQL Injection, and Cross-Site Request Forgery (CSRF). In Spring WebFlux, security must be carefully considered and implemented to ensure a secure reactive environment.</p>
<p><a name="integrating-spring-security-with-webflux"></a></p>
<h2 id="Integrating-Spring-Security-with-WebFlux"><a href="#Integrating-Spring-Security-with-WebFlux" class="headerlink" title="Integrating Spring Security with WebFlux"></a>Integrating Spring Security with WebFlux</h2><p>Spring Security is a powerful framework within the Spring ecosystem, designed to secure Spring applications. It supports integration with Spring WebFlux, providing comprehensive security for reactive applications.</p>
<p><a name="adding-dependencies"></a></p>
<h3 id="1-Adding-Dependencies"><a href="#1-Adding-Dependencies" class="headerlink" title="1. Adding Dependencies"></a>1. Adding Dependencies</h3><p>First, add the necessary Spring Security dependencies to your project:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="configuring-security-policies"></a></p>
<h3 id="2-Configuring-Security-Policies"><a href="#2-Configuring-Security-Policies" class="headerlink" title="2. Configuring Security Policies"></a>2. Configuring Security Policies</h3><p>Next, create a configuration class to define your security policies:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.web.server.ServerHttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.server.SecurityWebFilterChain;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebFluxSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityWebFilterChain <span class="title function_">securityWebFilterChain</span><span class="params">(ServerHttpSecurity http)</span> &#123;</span><br><span class="line">        http</span><br><span class="line">            .authorizeExchange(exchanges -&gt; exchanges</span><br><span class="line">                .pathMatchers(<span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/public/**&quot;</span>).permitAll()</span><br><span class="line">                .anyExchange().authenticated()</span><br><span class="line">            )</span><br><span class="line">            .httpBasic().and()</span><br><span class="line">            .formLogin().and()</span><br><span class="line">            .csrf().disable();  <span class="comment">// CSRF is disabled for this example but should be enabled in production</span></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this configuration, we define basic security rules: allowing unauthenticated users to access the login page and public resources while requiring authentication for other requests. We’ve enabled basic authentication and form login.</p>
<p><a name="customizing-user-details-service"></a></p>
<h3 id="3-Customizing-User-Details-Service"><a href="#3-Customizing-User-Details-Service" class="headerlink" title="3. Customizing User Details Service"></a>3. Customizing User Details Service</h3><p>To handle user authentication, you can customize the user details service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.MapReactiveUserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapReactiveUserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span> User.withDefaultPasswordEncoder()</span><br><span class="line">            .username(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">admin</span> <span class="operator">=</span> User.withDefaultPasswordEncoder()</span><br><span class="line">            .username(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MapReactiveUserDetailsService</span>(user, admin);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="preventing-common-security-threats"></a></p>
<h2 id="Preventing-Common-Security-Threats"><a href="#Preventing-Common-Security-Threats" class="headerlink" title="Preventing Common Security Threats"></a>Preventing Common Security Threats</h2><p>In this section, we will cover some common security threats and how to prevent them in Spring WebFlux.</p>
<p><a name="csrf-cross-site-request-forgery"></a></p>
<h3 id="1-CSRF-Cross-Site-Request-Forgery"><a href="#1-CSRF-Cross-Site-Request-Forgery" class="headerlink" title="1. CSRF (Cross-Site Request Forgery)"></a>1. CSRF (Cross-Site Request Forgery)</h3><p>In production environments, it is recommended to enable CSRF protection to prevent CSRF attacks:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http</span><br><span class="line">    .csrf().csrfTokenRepository(CookieServerCsrfTokenRepository.withHttpOnlyFalse());</span><br></pre></td></tr></table></figure>

<p><a name="xss-cross-site-scripting"></a></p>
<h3 id="2-XSS-Cross-Site-Scripting"><a href="#2-XSS-Cross-Site-Scripting" class="headerlink" title="2. XSS (Cross-Site Scripting)"></a>2. XSS (Cross-Site Scripting)</h3><p>To prevent XSS attacks, ensure that user input is properly encoded when rendered. Spring Security provides built-in mechanisms to handle encoding in most cases.</p>
<p><a name="security-best-practices"></a></p>
<h2 id="Security-Best-Practices"><a href="#Security-Best-Practices" class="headerlink" title="Security Best Practices"></a>Security Best Practices</h2><ol>
<li><strong>Use Strong Passwords</strong>: Ensure users create strong passwords and update them regularly.</li>
<li><strong>Principle of Least Privilege</strong>: Grant users only the minimum privileges necessary to perform their tasks.</li>
<li><strong>Enable HTTPS</strong>: Use HTTPS to encrypt data transmission, preventing data interception or tampering.</li>
<li><strong>Regularly Update Dependencies</strong>: Keep Spring Security and other dependencies up-to-date to include the latest security patches.</li>
<li><strong>Implement Multi-Factor Authentication (MFA)</strong>: Enhance authentication security by adding an extra layer of verification.</li>
</ol>
<p><a name="csrf-and-xss-attacks"></a></p>
<h2 id="CSRF-and-XSS-Attacks"><a href="#CSRF-and-XSS-Attacks" class="headerlink" title="CSRF and XSS Attacks"></a>CSRF and XSS Attacks</h2><h3 id="What-is-CSRF"><a href="#What-is-CSRF" class="headerlink" title="What is CSRF?"></a>What is CSRF?</h3><p><strong>Cross-Site Request Forgery (CSRF)</strong> is an attack where a malicious website tricks a user into executing actions on another website where they are authenticated. For example, if a user is logged into their banking website, a malicious website could make unauthorized money transfers on behalf of the user.</p>
<h4 id="Mitigating-CSRF"><a href="#Mitigating-CSRF" class="headerlink" title="Mitigating CSRF"></a>Mitigating CSRF</h4><ul>
<li>Use <strong>CSRF tokens</strong>: These tokens ensure that requests made to sensitive endpoints are genuine by embedding a unique token in each form or API request, which the server validates.</li>
<li><strong>SameSite cookies</strong>: Restricting cookies with the <code>SameSite</code> attribute can reduce the risk of CSRF by ensuring cookies are sent only for same-site requests.</li>
</ul>
<h3 id="What-is-XSS"><a href="#What-is-XSS" class="headerlink" title="What is XSS?"></a>What is XSS?</h3><p><strong>Cross-Site Scripting (XSS)</strong> is an attack where malicious scripts are injected into websites and executed in users’ browsers. This can be used to steal sensitive information like cookies, session tokens, or passwords.</p>
<h4 id="Mitigating-XSS"><a href="#Mitigating-XSS" class="headerlink" title="Mitigating XSS"></a>Mitigating XSS</h4><ul>
<li><strong>Input validation and output encoding</strong>: Always validate user inputs and encode any untrusted data before displaying it in a browser. This ensures that malicious scripts cannot be injected into the HTML.</li>
<li><strong>Content Security Policy (CSP)</strong>: Use CSP headers to restrict the types of content that can be executed on your web pages, preventing the browser from executing malicious scripts.</li>
</ul>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to implement security in Spring WebFlux applications. By leveraging Spring Security, we can provide comprehensive security for reactive applications, ensuring protection against common threats like CSRF and XSS. Adopting best practices such as HTTPS, strong passwords, and least privilege can further strengthen your application’s security.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-VII/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-VII/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - VII</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:06:47 / Modified: 16:21:58" itemprop="dateCreated datePublished" datetime="2024-10-24T14:06:47-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#reactive-programming-in-complex-scenarios">Reactive Programming in Complex Scenarios</a></li>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#complex-scenario-1-flow-control-and-backpressure-handling">Complex Scenario 1: Flow Control and Backpressure Handling</a><ul>
<li><a href="#1-using-limitrate">1. Using <code>limitRate</code></a></li>
<li><a href="#2-using-onbackpressurebuffer">2. Using <code>onBackpressureBuffer</code></a></li>
<li><a href="#3-using-onbackpressuredrop">3. Using <code>onBackpressureDrop</code></a></li>
</ul>
</li>
<li><a href="#complex-scenario-2-integrating-external-services">Complex Scenario 2: Integrating External Services</a><ul>
<li><a href="#1-using-webclient-to-call-rest-apis">1. Using <code>WebClient</code> to Call REST APIs</a></li>
<li><a href="#2-using-reactive-kafka-for-message-processing">2. Using Reactive Kafka for Message Processing</a></li>
</ul>
</li>
<li><a href="#complex-scenario-3-handling-large-files">Complex Scenario 3: Handling Large Files</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#furthermore">Furthermore</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Reactive-Programming-in-Complex-Scenarios"><a href="#Reactive-Programming-in-Complex-Scenarios" class="headerlink" title="Reactive Programming in Complex Scenarios"></a>Reactive Programming in Complex Scenarios</h1><p><a name="introduction"></a></p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>In previous articles, we discussed the foundational concepts of Spring WebFlux, Reactor, error handling, data flow transformation, reactive database access, and performance optimization. This article explores how to apply reactive programming in complex scenarios, including flow control, backpressure handling, and integrating external services.</p>
<p><a name="complex-scenario-1-flow-control-and-backpressure-handling"></a></p>
<h2 id="Complex-Scenario-1-Flow-Control-and-Backpressure-Handling"><a href="#Complex-Scenario-1-Flow-Control-and-Backpressure-Handling" class="headerlink" title="Complex Scenario 1: Flow Control and Backpressure Handling"></a>Complex Scenario 1: Flow Control and Backpressure Handling</h2><p>In high-concurrency environments, controlling data flow and managing backpressure are critical for ensuring system stability. Backpressure occurs when downstream consumers cannot keep up with the speed of upstream producers, leading to data accumulation and resource exhaustion. Reactor provides various ways to handle backpressure issues.</p>
<h3 id="1-Using-limitRate"><a href="#1-Using-limitRate" class="headerlink" title="1. Using limitRate"></a>1. Using <code>limitRate</code></h3><p>The <code>limitRate</code> operator limits the amount of data requested at a time, thereby controlling the speed of data flow.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .limitRate(<span class="number">100</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="2-Using-onBackpressureBuffer"><a href="#2-Using-onBackpressureBuffer" class="headerlink" title="2. Using onBackpressureBuffer"></a>2. Using <code>onBackpressureBuffer</code></h3><p>The <code>onBackpressureBuffer</code> operator buffers data during backpressure until the downstream can process it.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureBuffer(<span class="number">50</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="3-Using-onBackpressureDrop"><a href="#3-Using-onBackpressureDrop" class="headerlink" title="3. Using onBackpressureDrop"></a>3. Using <code>onBackpressureDrop</code></h3><p>The <code>onBackpressureDrop</code> operator drops data during backpressure to prevent downstream overload.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureDrop()</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<p><a name="complex-scenario-2-integrating-external-services"></a></p>
<h2 id="Complex-Scenario-2-Integrating-External-Services"><a href="#Complex-Scenario-2-Integrating-External-Services" class="headerlink" title="Complex Scenario 2: Integrating External Services"></a>Complex Scenario 2: Integrating External Services</h2><p>In real projects, interactions with external services are common, such as calling REST APIs or using message queues. Spring WebFlux provides powerful integration capabilities.</p>
<h3 id="1-Using-WebClient-to-Call-REST-APIs"><a href="#1-Using-WebClient-to-Call-REST-APIs" class="headerlink" title="1. Using WebClient to Call REST APIs"></a>1. Using <code>WebClient</code> to Call REST APIs</h3><p><code>WebClient</code> is a non-blocking HTTP client provided by Spring WebFlux, suitable for interacting with external REST services.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebClientExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(<span class="string">&quot;http://example.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">fetchData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.get()</span><br><span class="line">                .uri(<span class="string">&quot;/data&quot;</span>)</span><br><span class="line">                .retrieve()</span><br><span class="line">                .bodyToMono(String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Using-Reactive-Kafka-for-Message-Processing"><a href="#2-Using-Reactive-Kafka-for-Message-Processing" class="headerlink" title="2. Using Reactive Kafka for Message Processing"></a>2. Using Reactive Kafka for Message Processing</h3><p>Spring WebFlux integrates seamlessly with Reactive Kafka to achieve non-blocking message processing.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.kafka.annotation.KafkaListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.FluxSink;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FluxSink&lt;String&gt; sink;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KafkaConsumer</span><span class="params">(FluxSink&lt;String&gt; sink)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sink = sink;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;example-topic&quot;, groupId = &quot;group_id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listen</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        sink.next(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="complex-scenario-3-handling-large-files"></a></p>
<h2 id="Complex-Scenario-3-Handling-Large-Files"><a href="#Complex-Scenario-3-Handling-Large-Files" class="headerlink" title="Complex Scenario 3: Handling Large Files"></a>Complex Scenario 3: Handling Large Files</h2><p>When processing large files, traditional reading methods can lead to excessive memory consumption. Using Spring WebFlux allows for non-blocking, streaming file processing.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DataBuffer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.codec.multipart.FilePart;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerResponse;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">uploadFile</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.multipartData()</span><br><span class="line">                .flatMap(parts -&gt; &#123;</span><br><span class="line">                    <span class="type">FilePart</span> <span class="variable">filePart</span> <span class="operator">=</span> (FilePart) parts.toSingleValueMap().get(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">                    Flux&lt;DataBuffer&gt; content = filePart.content();</span><br><span class="line">                    <span class="keyword">return</span> ServerResponse.ok().body(content, DataBuffer.class);</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored several strategies and methods for applying Spring WebFlux in complex scenarios. By effectively managing backpressure, integrating external services, and processing large files in a streaming fashion, we can build more robust and efficient reactive applications. </p>
<p><a name="furthermore"></a></p>
<h2 id="Furthermore"><a href="#Furthermore" class="headerlink" title="Furthermore"></a>Furthermore</h2><ol>
<li><strong>Kubernetes for Deployment</strong>: Consider deploying your reactive applications using Kubernetes for better scalability and management.</li>
<li><strong>Reactive Programming Patterns</strong>: Implement design patterns such as Circuit Breaker and Rate Limiter to enhance application resilience.</li>
<li><strong>Monitoring with Micrometer</strong>: Use Micrometer to instrument your reactive applications for better observability and performance metrics.</li>
<li><strong>Serverless Architecture</strong>: Explore serverless solutions to handle unpredictable workloads efficiently, integrating with AWS Lambda or Azure Functions.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-VI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-VI/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - VI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:06:43 / Modified: 14:44:16" itemprop="dateCreated datePublished" datetime="2024-10-24T14:06:43-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#reactive-programming-in-complex-scenarios">Reactive Programming in Complex Scenarios</a><ul>
<li><a href="#complex-scenario-1-flow-control-and-backpressure-handling">Complex Scenario 1: Flow Control and Backpressure Handling</a><ul>
<li><a href="#1-using-limitrate">1. Using <code>limitRate</code></a></li>
<li><a href="#2-using-onbackpressurebuffer">2. Using <code>onBackpressureBuffer</code></a></li>
<li><a href="#3-using-onbackpressuredrop">3. Using <code>onBackpressureDrop</code></a></li>
</ul>
</li>
<li><a href="#complex-scenario-2-integrating-external-services">Complex Scenario 2: Integrating External Services</a><ul>
<li><a href="#1-using-webclient-to-call-rest-apis">1. Using <code>WebClient</code> to Call REST APIs</a></li>
<li><a href="#2-using-reactive-kafka-for-message-processing">2. Using Reactive Kafka for Message Processing</a></li>
</ul>
</li>
<li><a href="#complex-scenario-3-handling-large-files">Complex Scenario 3: Handling Large Files</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#furthermore">Furthermore</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Reactive-Programming-in-Complex-Scenarios"><a href="#Reactive-Programming-in-Complex-Scenarios" class="headerlink" title="Reactive Programming in Complex Scenarios"></a>Reactive Programming in Complex Scenarios</h1><p>In previous articles, we discussed the foundational concepts of Spring WebFlux, Reactor, error handling, data flow transformation, reactive database access, and performance optimization. This article explores how to apply reactive programming in complex scenarios, including flow control, backpressure handling, and integrating external services.</p>
<p><a name="complex-scenario-1-flow-control-and-backpressure-handling"></a></p>
<h2 id="Complex-Scenario-1-Flow-Control-and-Backpressure-Handling"><a href="#Complex-Scenario-1-Flow-Control-and-Backpressure-Handling" class="headerlink" title="Complex Scenario 1: Flow Control and Backpressure Handling"></a>Complex Scenario 1: Flow Control and Backpressure Handling</h2><p>In high-concurrency environments, controlling data flow and managing backpressure are critical for ensuring system stability. Backpressure occurs when downstream consumers cannot keep up with the speed of upstream producers, leading to data accumulation and resource exhaustion. Reactor provides various ways to handle backpressure issues.</p>
<h3 id="1-Using-limitRate"><a href="#1-Using-limitRate" class="headerlink" title="1. Using limitRate"></a>1. Using <code>limitRate</code></h3><p>The <code>limitRate</code> operator limits the amount of data requested at a time, thereby controlling the speed of data flow.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .limitRate(<span class="number">100</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="2-Using-onBackpressureBuffer"><a href="#2-Using-onBackpressureBuffer" class="headerlink" title="2. Using onBackpressureBuffer"></a>2. Using <code>onBackpressureBuffer</code></h3><p>The <code>onBackpressureBuffer</code> operator buffers data during backpressure until the downstream can process it.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureBuffer(<span class="number">50</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="3-Using-onBackpressureDrop"><a href="#3-Using-onBackpressureDrop" class="headerlink" title="3. Using onBackpressureDrop"></a>3. Using <code>onBackpressureDrop</code></h3><p>The <code>onBackpressureDrop</code> operator drops data during backpressure to prevent downstream overload.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureDrop()</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<p><a name="complex-scenario-2-integrating-external-services"></a></p>
<h2 id="Complex-Scenario-2-Integrating-External-Services"><a href="#Complex-Scenario-2-Integrating-External-Services" class="headerlink" title="Complex Scenario 2: Integrating External Services"></a>Complex Scenario 2: Integrating External Services</h2><p>In real projects, interactions with external services are common, such as calling REST APIs or using message queues. Spring WebFlux provides powerful integration capabilities.</p>
<h3 id="1-Using-WebClient-to-Call-REST-APIs"><a href="#1-Using-WebClient-to-Call-REST-APIs" class="headerlink" title="1. Using WebClient to Call REST APIs"></a>1. Using <code>WebClient</code> to Call REST APIs</h3><p><code>WebClient</code> is a non-blocking HTTP client provided by Spring WebFlux, suitable for interacting with external REST services.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebClientExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(<span class="string">&quot;http://example.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">fetchData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.get()</span><br><span class="line">                .uri(<span class="string">&quot;/data&quot;</span>)</span><br><span class="line">                .retrieve()</span><br><span class="line">                .bodyToMono(String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Using-Reactive-Kafka-for-Message-Processing"><a href="#2-Using-Reactive-Kafka-for-Message-Processing" class="headerlink" title="2. Using Reactive Kafka for Message Processing"></a>2. Using Reactive Kafka for Message Processing</h3><p>Spring WebFlux integrates seamlessly with Reactive Kafka to achieve non-blocking message processing.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.kafka.annotation.KafkaListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.FluxSink;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FluxSink&lt;String&gt; sink;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KafkaConsumer</span><span class="params">(FluxSink&lt;String&gt; sink)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sink = sink;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;example-topic&quot;, groupId = &quot;group_id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listen</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        sink.next(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="complex-scenario-3-handling-large-files"></a></p>
<h2 id="Complex-Scenario-3-Handling-Large-Files"><a href="#Complex-Scenario-3-Handling-Large-Files" class="headerlink" title="Complex Scenario 3: Handling Large Files"></a>Complex Scenario 3: Handling Large Files</h2><p>When processing large files, traditional reading methods can lead to excessive memory consumption. Using Spring WebFlux allows for non-blocking, streaming file processing.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DataBuffer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.codec.multipart.FilePart;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerResponse;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">uploadFile</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.multipartData()</span><br><span class="line">                .flatMap(parts -&gt; &#123;</span><br><span class="line">                    <span class="type">FilePart</span> <span class="variable">filePart</span> <span class="operator">=</span> (FilePart) parts.toSingleValueMap().get(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">                    Flux&lt;DataBuffer&gt; content = filePart.content();</span><br><span class="line">                    <span class="keyword">return</span> ServerResponse.ok().body(content, DataBuffer.class);</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored several strategies and methods for applying Spring WebFlux in complex scenarios. By effectively managing backpressure, integrating external services, and processing large files in a streaming fashion, we can build more robust and efficient reactive applications. </p>
<p><a name="furthermore"></a></p>
<h2 id="Furthermore"><a href="#Furthermore" class="headerlink" title="Furthermore"></a>Furthermore</h2><ol>
<li><strong>Kubernetes for Deployment</strong>: Consider deploying your reactive applications using Kubernetes for better scalability and management.</li>
<li><strong>Reactive Programming Patterns</strong>: Implement design patterns such as Circuit Breaker and Rate Limiter to enhance application resilience.</li>
<li><strong>Monitoring with Micrometer</strong>: Use Micrometer to instrument your reactive applications for better observability and performance metrics.</li>
<li><strong>Serverless Architecture</strong>: Explore serverless solutions to handle unpredictable workloads efficiently, integrating with AWS Lambda or Azure Functions.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-V/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-V/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - V</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:06:39 / Modified: 14:17:31" itemprop="dateCreated datePublished" datetime="2024-10-24T14:06:39-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#reactive-database-access">Reactive Database Access</a><ul>
<li><a href="#why-choose-reactive-database-access">Why Choose Reactive Database Access?</a></li>
<li><a href="#spring-data-r2dbc">Spring Data R2DBC</a><ul>
<li><a href="#1-project-setup">1. Project Setup</a></li>
<li><a href="#2-database-connection-configuration">2. Database Connection Configuration</a></li>
<li><a href="#-3-data-model"> 3. Data Model</a></li>
<li><a href="#4-creating-a-repository">4. Creating a Repository</a></li>
<li><a href="#5-data-initialization">5. Data Initialization</a></li>
<li><a href="#6-handler-functions-and-route-configuration">6. Handler Functions and Route Configuration</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Reactive-Database-Access"><a href="#Reactive-Database-Access" class="headerlink" title="Reactive Database Access"></a>Reactive Database Access</h1><hr>
<p><a name="why-choose-reactive-database-access"></a></p>
<h2 id="Why-Choose-Reactive-Database-Access"><a href="#Why-Choose-Reactive-Database-Access" class="headerlink" title="Why Choose Reactive Database Access?"></a>Why Choose Reactive Database Access?</h2><p>Traditional database access methods are usually blocking, meaning that when a query is executing, the thread is blocked until the query is completed. This can lead to performance bottlenecks in highly concurrent environments. Reactive database access uses non-blocking I&#x2F;O operations, allowing applications to handle more concurrent requests, improving system throughput and response times.</p>
<hr>
<p><a name="spring-data-r2dbc"></a></p>
<h2 id="Spring-Data-R2DBC"><a href="#Spring-Data-R2DBC" class="headerlink" title="Spring Data R2DBC"></a>Spring Data R2DBC</h2><p>Spring Data R2DBC (Reactive Relational Database Connectivity) is a project in the Spring ecosystem that provides reactive programming support for relational databases. R2DBC is a new database connection specification designed to support reactive programming models.</p>
<p><a name="project-setup"></a></p>
<h3 id="1-Project-Setup"><a href="#1-Project-Setup" class="headerlink" title="1. Project Setup"></a>1. Project Setup</h3><p>First, create a Spring Boot project and include the necessary dependencies:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.r2dbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>r2dbc-h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="database-connection-configuration"></a></p>
<h3 id="2-Database-Connection-Configuration"><a href="#2-Database-Connection-Configuration" class="headerlink" title="2. Database Connection Configuration"></a>2. Database Connection Configuration</h3><p>Configure the H2 database in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.r2dbc.url</span>=<span class="string">r2dbc:h2:mem:///testdb</span></span><br><span class="line"><span class="attr">spring.r2dbc.username</span>=<span class="string">sa</span></span><br><span class="line"><span class="attr">spring.r2dbc.password</span>=<span class="string"></span></span><br><span class="line"><span class="attr">spring.r2dbc.generate-unique-name</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.h2.console.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.h2.console.settings.web-allow-others</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="3-Data-Model"><a href="#3-Data-Model" class="headerlink" title=" 3. Data Model"></a><a name="data-model"></a> 3. Data Model</h3><p>Define a simple <code>User</code> entity:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.relational.core.mapping.Table;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Table(&quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="creating-a-repository"></a></p>
<h3 id="4-Creating-a-Repository"><a href="#4-Creating-a-Repository" class="headerlink" title="4. Creating a Repository"></a>4. Creating a Repository</h3><p>Create a reactive <code>UserRepository</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.repository.reactive.ReactiveCrudRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="data-initialization"></a></p>
<h3 id="5-Data-Initialization"><a href="#5-Data-Initialization" class="headerlink" title="5. Data Initialization"></a>5. Data Initialization</h3><p>Use an initializer class to preload some data:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    CommandLineRunner <span class="title function_">init</span><span class="params">(UserRepository repository)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> args -&gt; &#123;</span><br><span class="line">            Flux&lt;User&gt; userFlux = Flux.just(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;John Doe&quot;</span>),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;Jane Doe&quot;</span>),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;Sam Smith&quot;</span>))</span><br><span class="line">                .flatMap(repository::save);</span><br><span class="line"></span><br><span class="line">            userFlux</span><br><span class="line">                .thenMany(repository.findAll())</span><br><span class="line">                .subscribe(user -&gt; System.out.println(<span class="string">&quot;Saving &quot;</span> + user.toString()));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="handler-functions-and-route-configuration"></a></p>
<h3 id="6-Handler-Functions-and-Route-Configuration"><a href="#6-Handler-Functions-and-Route-Configuration" class="headerlink" title="6. Handler Functions and Route Configuration"></a>6. Handler Functions and Route Configuration</h3><p>Create handler functions and route configurations to handle HTTP requests and return responses:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.RouterFunction;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.RouterFunctions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserHandler</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> Long.valueOf(request.pathVariable(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(userId)</span><br><span class="line">            .flatMap(user -&gt; ServerResponse.ok().body(Mono.just(user), User.class))</span><br><span class="line">            .switchIfEmpty(ServerResponse.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getAllUsers</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().body(userRepository.findAll(), User.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">createUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        Mono&lt;User&gt; userMono = request.bodyToMono(User.class);</span><br><span class="line">        <span class="keyword">return</span> userMono.flatMap(userRepository::save)</span><br><span class="line">            .flatMap(user -&gt; ServerResponse.ok().body(Mono.just(user), User.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouterConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">route</span><span class="params">(UserHandler handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">            .GET(<span class="string">&quot;/user/&#123;id&#125;&quot;</span>, handler::getUser)</span><br><span class="line">            .GET(<span class="string">&quot;/users&quot;</span>, handler::getAllUsers)</span><br><span class="line">            .POST(<span class="string">&quot;/user&quot;</span>, handler::createUser)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to perform reactive database access in Spring WebFlux. With Spring Data R2DBC, we can easily achieve non-blocking access to relational databases, greatly improving the performance and concurrency handling of applications.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-IV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-IV/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - IV</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-24 14:06:07 / Modified: 14:10:07" itemprop="dateCreated datePublished" datetime="2024-10-24T14:06:07-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#data-stream-transformation-and-operations">Data Stream Transformation and Operations</a><ul>
<li><a href="#data-stream-transformation">Data Stream Transformation</a><ul>
<li><a href="#1-map-operator">1. map Operator</a></li>
<li><a href="#2-flatmap-operator">2. flatMap Operator</a></li>
<li><a href="#3-filter-operator">3. filter Operator</a></li>
<li><a href="#4-reduce-operator">4. reduce Operator</a></li>
</ul>
</li>
<li><a href="#practical-example-building-a-complex-data-stream-processing-application">Practical Example: Building a Complex Data Stream Processing Application</a><ul>
<li><a href="#1-project-setup">1. Project Setup</a></li>
<li><a href="#2-data-model">2. Data Model</a></li>
<li><a href="#3-mock-data-source">3. Mock Data Source</a></li>
<li><a href="#4-handler-functions-and-route-configuration">4. Handler Functions and Route Configuration</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Data-Stream-Transformation-and-Operations"><a href="#Data-Stream-Transformation-and-Operations" class="headerlink" title="Data Stream Transformation and Operations"></a>Data Stream Transformation and Operations</h1><hr>
<p><a name="data-stream-transformation"></a> </p>
<h2 id="Data-Stream-Transformation"><a href="#Data-Stream-Transformation" class="headerlink" title="Data Stream Transformation"></a>Data Stream Transformation</h2><p>In reactive programming, transforming and operating on data streams is a core aspect. Using different operators, we can handle data streams flexibly, applying transformations, filtering, aggregating, and more. Below are some common data stream operations and examples.</p>
<p><a name="map-operator"></a></p>
<h3 id="1-map-Operator"><a href="#1-map-Operator" class="headerlink" title="1. map Operator"></a>1. map Operator</h3><p>The <code>map</code> operator transforms each element in a data stream. It takes a function as an argument and applies it to each element.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Integer&gt; numbers = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    .map(n -&gt; n * n);</span><br><span class="line"></span><br><span class="line">numbers.subscribe(System.out::println); <span class="comment">// Output: 1, 4, 9, 16, 25</span></span><br></pre></td></tr></table></figure>

<p><a name="flatmap-operator"></a></p>
<h3 id="2-flatMap-Operator"><a href="#2-flatMap-Operator" class="headerlink" title="2. flatMap Operator"></a>2. flatMap Operator</h3><p>The <code>flatMap</code> operator maps each element to a new <code>Publisher</code> and merges them into a single <code>Flux</code>. It is often used for asynchronous processing.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;String&gt; ids = Flux.just(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">Flux&lt;User&gt; users = ids.flatMap(id -&gt; userRepository.findById(id));</span><br><span class="line"></span><br><span class="line">users.subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<p><a name="filter-operator"></a></p>
<h3 id="3-filter-Operator"><a href="#3-filter-Operator" class="headerlink" title="3. filter Operator"></a>3. filter Operator</h3><p>The <code>filter</code> operator filters data streams, keeping only elements that meet a certain condition.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Integer&gt; numbers = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">numbers.subscribe(System.out::println); <span class="comment">// Output: 2, 4</span></span><br></pre></td></tr></table></figure>

<p><a name="reduce-operator"></a></p>
<h3 id="4-reduce-Operator"><a href="#4-reduce-Operator" class="headerlink" title="4. reduce Operator"></a>4. reduce Operator</h3><p>The <code>reduce</code> operator aggregates all elements in a data stream into a single value. It takes an accumulator function, combining the previous result with the current element.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Integer&gt; numbers = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">Mono&lt;Integer&gt; sum = numbers.reduce((a, b) -&gt; a + b);</span><br><span class="line"></span><br><span class="line">sum.subscribe(System.out::println); <span class="comment">// Output: 15</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="practical-example-building-a-complex-data-stream-processing-application"></a></p>
<h2 id="Practical-Example-Building-a-Complex-Data-Stream-Processing-Application"><a href="#Practical-Example-Building-a-Complex-Data-Stream-Processing-Application" class="headerlink" title="Practical Example: Building a Complex Data Stream Processing Application"></a>Practical Example: Building a Complex Data Stream Processing Application</h2><p>Below is an example showing how to use these operators to build a complex reactive application in Spring WebFlux.</p>
<p><a name="project-setup"></a></p>
<h3 id="1-Project-Setup"><a href="#1-Project-Setup" class="headerlink" title="1. Project Setup"></a>1. Project Setup</h3><p>Ensure that the following dependencies are included in your project:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="data-model"></a></p>
<h3 id="2-Data-Model"><a href="#2-Data-Model" class="headerlink" title="2. Data Model"></a>2. Data Model</h3><p>Define a simple user data model:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Constructors, Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="mock-data-source"></a></p>
<h3 id="3-Mock-Data-Source"><a href="#3-Mock-Data-Source" class="headerlink" title="3. Mock Data Source"></a>3. Mock Data Source</h3><p>Create a mock data source:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;John Doe&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;Jane Doe&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;Sam Smith&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">findById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.justOrEmpty(users.stream()</span><br><span class="line">            .filter(user -&gt; user.getId().equals(id))</span><br><span class="line">            .findFirst());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.fromIterable(users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="handler-functions-and-route-configuration"></a></p>
<h3 id="4-Handler-Functions-and-Route-Configuration"><a href="#4-Handler-Functions-and-Route-Configuration" class="headerlink" title="4. Handler Functions and Route Configuration"></a>4. Handler Functions and Route Configuration</h3><p>Set up handler functions and route configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.RouterFunction;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.RouterFunctions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserHandler</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.pathVariable(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(userId)</span><br><span class="line">            .flatMap(user -&gt; ServerResponse.ok().body(Mono.just(user), User.class))</span><br><span class="line">            .switchIfEmpty(ServerResponse.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getAllUsers</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().body(userRepository.findAll(), User.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouterConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">route</span><span class="params">(UserHandler handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">            .GET(<span class="string">&quot;/user/&#123;id&#125;&quot;</span>, handler::getUser)</span><br><span class="line">            .GET(<span class="string">&quot;/users&quot;</span>, handler::getAllUsers)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to transform and operate on data streams in Spring WebFlux. Using different operators, we can flexibly handle data streams, building complex reactive applications.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
