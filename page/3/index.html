<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="WhereQ">
<meta property="og:url" content="https://www.whereq.com/page/3/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Dazhi Zhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">WhereQ</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">150</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">134</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">89</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/04/21/Merkle-Tree-in-Chinese/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/21/Merkle-Tree-in-Chinese/" class="post-title-link" itemprop="url">Merkle Tree in Chinese</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-21 18:54:45" itemprop="dateCreated datePublished" datetime="2025-04-21T18:54:45-04:00">2025-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/" itemprop="url" rel="index"><span itemprop="name">Cypto Currency</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/Ethereum/" itemprop="url" rel="index"><span itemprop="name">Ethereum</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/Ethereum/Data-Structure/" itemprop="url" rel="index"><span itemprop="name">Data Structure</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Merkle Treeï¼ˆé»˜å…‹å°”æ ‘ï¼‰åœ¨åŒºå—é“¾ã€å¯†ç å­¦å’Œæ•°æ®å®Œæ•´æ€§éªŒè¯ä¸­æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µã€‚å®ƒæ˜¯ä¸€ç§<strong>æ ‘çŠ¶æ•°æ®ç»“æ„</strong>ï¼Œç”¨æ¥é«˜æ•ˆè€Œå®‰å…¨åœ°éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p>
<hr>
<h2 id="ğŸŒ³-ä¸€ã€Merkle-Tree-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸŒ³-ä¸€ã€Merkle-Tree-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸŒ³ ä¸€ã€Merkle Tree æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸŒ³ ä¸€ã€Merkle Tree æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Merkle Tree æ˜¯ä¸€ç§<strong>äºŒå‰æ ‘ç»“æ„</strong>ï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹æ˜¯æŸä¸€ç¬”æ•°æ®çš„å“ˆå¸Œå€¼ï¼Œæ¯ä¸ªéå¶å­èŠ‚ç‚¹æ˜¯å…¶å­èŠ‚ç‚¹å“ˆå¸Œå€¼çš„ç»„åˆå†å“ˆå¸Œåçš„ç»“æœï¼Œç›´åˆ°æ ¹èŠ‚ç‚¹ â€”â€” Merkle Rootã€‚</p>
<h3 id="ğŸ“Œ-ç‰¹ç‚¹ï¼š"><a href="#ğŸ“Œ-ç‰¹ç‚¹ï¼š" class="headerlink" title="ğŸ“Œ ç‰¹ç‚¹ï¼š"></a>ğŸ“Œ ç‰¹ç‚¹ï¼š</h3><ul>
<li>å¿«é€ŸéªŒè¯æŸæ¡æ•°æ®æ˜¯å¦å±äºæŸæ‰¹æ•°æ®ï¼ˆO(log n)ï¼‰</li>
<li>æ•°æ®å®Œæ•´æ€§æ ¡éªŒéå¸¸é«˜æ•ˆ</li>
<li>å¹¿æ³›ç”¨äºåŒºå—é“¾ä¸­ï¼ˆæ¯”ç‰¹å¸ã€ä»¥å¤ªåŠï¼‰ä»¥éªŒè¯äº¤æ˜“</li>
</ul>
<hr>
<h2 id="ğŸ§©-äºŒã€å›¾ç¤ºè¯´æ˜"><a href="#ğŸ§©-äºŒã€å›¾ç¤ºè¯´æ˜" class="headerlink" title="ğŸ§© äºŒã€å›¾ç¤ºè¯´æ˜"></a>ğŸ§© äºŒã€å›¾ç¤ºè¯´æ˜</h2><p>å‡è®¾æˆ‘ä»¬æœ‰ 4 ä¸ªäº¤æ˜“ <code>Tx0, Tx1, Tx2, Tx3</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             Merkle Root</span><br><span class="line">                 â”‚</span><br><span class="line">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">         â”‚                â”‚</span><br><span class="line">      Hash01           Hash23</span><br><span class="line">     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”</span><br><span class="line">  Hash0      Hash1  Hash2     Hash3</span><br><span class="line">  â”‚            â”‚     â”‚          â”‚</span><br><span class="line">Tx0          Tx1   Tx2        Tx3</span><br></pre></td></tr></table></figure>

<h3 id="å“ˆå¸Œè¿‡ç¨‹ï¼š"><a href="#å“ˆå¸Œè¿‡ç¨‹ï¼š" class="headerlink" title="å“ˆå¸Œè¿‡ç¨‹ï¼š"></a>å“ˆå¸Œè¿‡ç¨‹ï¼š</h3><ul>
<li><code>Hash0 = hash(Tx0)</code>ï¼Œ<code>Hash1 = hash(Tx1)</code></li>
<li><code>Hash01 = hash(Hash0 + Hash1)</code></li>
<li><code>Merkle Root = hash(Hash01 + Hash23)</code></li>
</ul>
<hr>
<h2 id="ğŸ’¡-ä¸‰ã€Merkle-Tree-çš„ä½œç”¨"><a href="#ğŸ’¡-ä¸‰ã€Merkle-Tree-çš„ä½œç”¨" class="headerlink" title="ğŸ’¡ ä¸‰ã€Merkle Tree çš„ä½œç”¨"></a>ğŸ’¡ ä¸‰ã€Merkle Tree çš„ä½œç”¨</h2><h3 id="âœ…-åœ¨åŒºå—é“¾ä¸­ä¸»è¦ç”¨æ¥ï¼š"><a href="#âœ…-åœ¨åŒºå—é“¾ä¸­ä¸»è¦ç”¨æ¥ï¼š" class="headerlink" title="âœ… åœ¨åŒºå—é“¾ä¸­ä¸»è¦ç”¨æ¥ï¼š"></a>âœ… åœ¨åŒºå—é“¾ä¸­ä¸»è¦ç”¨æ¥ï¼š</h3><table>
<thead>
<tr>
<th>ç”¨é€”</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>éªŒè¯äº¤æ˜“æ˜¯å¦åœ¨åŒºå—ä¸­</td>
<td>æ¯”å¦‚æ¯”ç‰¹å¸ SPVï¼ˆè½»èŠ‚ç‚¹ï¼‰ç”¨æ¥éªŒè¯ä¸€ç¬”äº¤æ˜“æ˜¯å¦åœ¨åŒºå—ä¸­ï¼Œæ— éœ€ä¸‹è½½æ•´ä¸ªåŒºå—</td>
</tr>
<tr>
<td>ä¿è¯æ•°æ®ä¸å¯ç¯¡æ”¹</td>
<td>å³ä½¿æ›´æ”¹ä¸€ç¬”äº¤æ˜“ï¼ŒMerkle Root ä¹Ÿä¼šå®Œå…¨ä¸åŒ</td>
</tr>
<tr>
<td>æ‰¹é‡å¤„ç†å¤§é‡æ•°æ®çš„å®Œæ•´æ€§éªŒè¯</td>
<td>ç”¨äº IPFSã€æ–‡ä»¶æ ¡éªŒã€åŒºå—å¿«ç…§</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ§ª-å››ã€ä¸€ä¸ªç®€å•çš„-Merkle-Tree-å®ç°ï¼ˆç”¨-JavaScriptï¼‰"><a href="#ğŸ§ª-å››ã€ä¸€ä¸ªç®€å•çš„-Merkle-Tree-å®ç°ï¼ˆç”¨-JavaScriptï¼‰" class="headerlink" title="ğŸ§ª å››ã€ä¸€ä¸ªç®€å•çš„ Merkle Tree å®ç°ï¼ˆç”¨ JavaScriptï¼‰"></a>ğŸ§ª å››ã€ä¸€ä¸ªç®€å•çš„ Merkle Tree å®ç°ï¼ˆç”¨ JavaScriptï¼‰</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createHash &#125; <span class="keyword">from</span> <span class="string">&#x27;crypto&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sha256</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createHash</span>(<span class="string">&#x27;sha256&#x27;</span>).<span class="title function_">update</span>(data).<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»º Merkle Tree å¹¶è¿”å›æ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildMerkleTree</span>(<span class="params"><span class="attr">leaves</span>: <span class="built_in">string</span>[]</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (leaves.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> level = leaves.<span class="title function_">map</span>(sha256);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (level.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">nextLevel</span>: <span class="built_in">string</span>[] = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; level.<span class="property">length</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> left = level[i];</span><br><span class="line">      <span class="keyword">const</span> right = level[i + <span class="number">1</span>] ?? left; <span class="comment">// å¦‚æœæ˜¯å¥‡æ•°ï¼Œå¤åˆ¶æœ€åä¸€ä¸ª</span></span><br><span class="line">      nextLevel.<span class="title function_">push</span>(<span class="title function_">sha256</span>(left + right));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    level = nextLevel;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> level[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> txs = [<span class="string">&#x27;tx0&#x27;</span>, <span class="string">&#x27;tx1&#x27;</span>, <span class="string">&#x27;tx2&#x27;</span>, <span class="string">&#x27;tx3&#x27;</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Merkle Root:&#x27;</span>, <span class="title function_">buildMerkleTree</span>(txs));</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”-äº”ã€å¦‚ä½•éªŒè¯æŸç¬”äº¤æ˜“åœ¨-Merkle-Tree-ä¸­ï¼Ÿ"><a href="#ğŸ”-äº”ã€å¦‚ä½•éªŒè¯æŸç¬”äº¤æ˜“åœ¨-Merkle-Tree-ä¸­ï¼Ÿ" class="headerlink" title="ğŸ” äº”ã€å¦‚ä½•éªŒè¯æŸç¬”äº¤æ˜“åœ¨ Merkle Tree ä¸­ï¼Ÿ"></a>ğŸ” äº”ã€å¦‚ä½•éªŒè¯æŸç¬”äº¤æ˜“åœ¨ Merkle Tree ä¸­ï¼Ÿ</h2><p>éªŒè¯æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>è·å–ä½ é‚£ç¬”äº¤æ˜“çš„å“ˆå¸Œï¼ˆæ¯”å¦‚ <code>tx1 â†’ h1</code>ï¼‰</li>
<li>è·å–ä½ éœ€è¦éªŒè¯è·¯å¾„çš„å…„å¼ŸèŠ‚ç‚¹å“ˆå¸Œï¼ˆç§°ä¸ºâ€œMerkle Proofâ€ï¼‰</li>
<li>é€å±‚æ‹¼æ¥å¹¶è®¡ç®—ï¼Œç›´åˆ°å¾—å‡º Merkle Root</li>
<li>çœ‹æ˜¯å¦å’ŒçœŸæ­£çš„ Merkle Root åŒ¹é…</li>
</ol>
<p>è¿™æ ·ä½ å°±å¯ä»¥<strong>ä»…å‡­éƒ¨åˆ†æ•°æ®éªŒè¯æ•´æ‰¹æ•°æ®å®Œæ•´æ€§</strong>ï¼Œè¿™åœ¨åŒºå—é“¾è½»èŠ‚ç‚¹ä¸­å°¤ä¸ºé‡è¦ã€‚</p>
<hr>
<h2 id="ğŸ“¦-å…­ã€çœŸå®åŒºå—é“¾åœºæ™¯"><a href="#ğŸ“¦-å…­ã€çœŸå®åŒºå—é“¾åœºæ™¯" class="headerlink" title="ğŸ“¦ å…­ã€çœŸå®åŒºå—é“¾åœºæ™¯"></a>ğŸ“¦ å…­ã€çœŸå®åŒºå—é“¾åœºæ™¯</h2><h3 id="ä»¥å¤ªåŠä¸­ï¼š"><a href="#ä»¥å¤ªåŠä¸­ï¼š" class="headerlink" title="ä»¥å¤ªåŠä¸­ï¼š"></a>ä»¥å¤ªåŠä¸­ï¼š</h3><ul>
<li>å¹¶ä¸ç›´æ¥ä½¿ç”¨äºŒå‰ Merkle Treeï¼Œè€Œæ˜¯ä½¿ç”¨æ”¹è¿›ç‰ˆï¼š<strong>Merkle Patricia Trie</strong> æ¥å¤„ç†çŠ¶æ€ï¼ˆè´¦æˆ·ã€ä½™é¢ç­‰ï¼‰</li>
<li>åŒºå—å¤´ä¸­çš„ <code>transactionsRoot</code>ã€<code>stateRoot</code> ç­‰å­—æ®µå°±æ˜¯ Merkle æ ¹</li>
</ul>
<h3 id="æ¯”ç‰¹å¸ä¸­ï¼š"><a href="#æ¯”ç‰¹å¸ä¸­ï¼š" class="headerlink" title="æ¯”ç‰¹å¸ä¸­ï¼š"></a>æ¯”ç‰¹å¸ä¸­ï¼š</h3><ul>
<li>åŒºå—ä¸­çš„ <code>merkle_root</code> å­—æ®µæ˜¯æ‰€æœ‰äº¤æ˜“çš„ Merkle æ ¹</li>
<li>æ”¯æŒè½»èŠ‚ç‚¹ï¼ˆSPVï¼‰é€šè¿‡ Merkle Proof éªŒè¯äº¤æ˜“</li>
</ul>
<hr>
<h2 id="ğŸ§¾-ä¸ƒã€æ€»ç»“é‡ç‚¹"><a href="#ğŸ§¾-ä¸ƒã€æ€»ç»“é‡ç‚¹" class="headerlink" title="ğŸ§¾ ä¸ƒã€æ€»ç»“é‡ç‚¹"></a>ğŸ§¾ ä¸ƒã€æ€»ç»“é‡ç‚¹</h2><table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯ä»€ä¹ˆ</td>
<td>äºŒå‰å“ˆå¸Œæ ‘ï¼Œç”¨äºéªŒè¯å¤§æ‰¹æ•°æ®ä¸­æŸä¸€æ¡æ•°æ®æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>ä¸ºä»€ä¹ˆé‡è¦</td>
<td>é«˜æ•ˆéªŒè¯ã€é˜²ç¯¡æ”¹ã€è½»èŠ‚ç‚¹æ”¯æŒ</td>
</tr>
<tr>
<td>åŒºå—é“¾ç”¨é€”</td>
<td>äº¤æ˜“éªŒè¯ã€çŠ¶æ€éªŒè¯ã€æ•°æ®å®Œæ•´æ€§è¯æ˜</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>ç©ºé—´å ç”¨å°ï¼ŒéªŒè¯æ—¶é—´å¿«ï¼ˆå¯¹æ•°çº§åˆ«ï¼‰ï¼Œå¯ç»„åˆè¯æ˜</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/04/21/Merkle-Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/21/Merkle-Tree/" class="post-title-link" itemprop="url">Merkle Tree</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-21 18:43:23" itemprop="dateCreated datePublished" datetime="2025-04-21T18:43:23-04:00">2025-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/" itemprop="url" rel="index"><span itemprop="name">Cypto Currency</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/Ethereum/" itemprop="url" rel="index"><span itemprop="name">Ethereum</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/Ethereum/Data-Structure/" itemprop="url" rel="index"><span itemprop="name">Data Structure</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ğŸ”-What-is-a-Merkle-Tree"><a href="#ğŸ”-What-is-a-Merkle-Tree" class="headerlink" title="ğŸ” What is a Merkle Tree?"></a>ğŸ” What is a Merkle Tree?</h2><p>A <strong>Merkle Tree</strong> (also called a binary hash tree) is a tree structure where:</p>
<ul>
<li>Every <strong>leaf node</strong> contains the cryptographic hash of a data block.</li>
<li>Every <strong>non-leaf node</strong> contains the hash of the concatenation of its child hashes.</li>
</ul>
<p>Itâ€™s used in blockchain systems (e.g., Bitcoin, Ethereum) to efficiently and securely verify the integrity of large sets of data, such as transactions.</p>
<hr>
<h2 id="ğŸŒ³-Merkle-Tree-Structure"><a href="#ğŸŒ³-Merkle-Tree-Structure" class="headerlink" title="ğŸŒ³ Merkle Tree Structure"></a>ğŸŒ³ Merkle Tree Structure</h2><p>Example with 4 transactions (T1, T2, T3, T4):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">        Root</span><br><span class="line">       /    \</span><br><span class="line">    H12      H34</span><br><span class="line">   /  \     /   \</span><br><span class="line">H1   H2   H3   H4</span><br></pre></td></tr></table></figure>

<ul>
<li><code>H1 = hash(T1)</code>, <code>H2 = hash(T2)</code>, etc.</li>
<li><code>H12 = hash(H1 + H2)</code>, <code>H34 = hash(H3 + H4)</code></li>
<li><code>Root = hash(H12 + H34)</code></li>
</ul>
<p>This root hash is called the <strong>Merkle Root</strong>.</p>
<hr>
<h2 id="ğŸ§ -Benefits-of-Merkle-Tree"><a href="#ğŸ§ -Benefits-of-Merkle-Tree" class="headerlink" title="ğŸ§  Benefits of Merkle Tree"></a>ğŸ§  Benefits of Merkle Tree</h2><ul>
<li>Efficient and secure verification of data integrity.</li>
<li>Only need a small part of the tree (a Merkle proof) to verify a data block.</li>
<li>Used in <strong>SPV (Simplified Payment Verification)</strong> in Bitcoin.</li>
</ul>
<hr>
<h2 id="ğŸ’»-JavaScript-Sample-Code-Using-crypto"><a href="#ğŸ’»-JavaScript-Sample-Code-Using-crypto" class="headerlink" title="ğŸ’» JavaScript Sample Code Using crypto"></a>ğŸ’» JavaScript Sample Code Using <code>crypto</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hashing function</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sha256</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;sha256&#x27;</span>).<span class="title function_">update</span>(data).<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build Merkle Tree from an array of transactions</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildMerkleTree</span>(<span class="params">transactions</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (transactions.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> [<span class="string">&#x27;&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step 1: Hash each transaction</span></span><br><span class="line">  <span class="keyword">let</span> level = transactions.<span class="title function_">map</span>(<span class="function"><span class="params">tx</span> =&gt;</span> <span class="title function_">sha256</span>(tx));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step 2: Build tree up to the root</span></span><br><span class="line">  <span class="keyword">while</span> (level.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> nextLevel = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; level.<span class="property">length</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> left = level[i];</span><br><span class="line">      <span class="keyword">const</span> right = i + <span class="number">1</span> &lt; level.<span class="property">length</span> ? level[i + <span class="number">1</span>] : left; <span class="comment">// duplicate last if odd</span></span><br><span class="line">      <span class="keyword">const</span> combined = left + right;</span><br><span class="line">      nextLevel.<span class="title function_">push</span>(<span class="title function_">sha256</span>(combined));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    level = nextLevel;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> level[<span class="number">0</span>]; <span class="comment">// Merkle root</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example usage</span></span><br><span class="line"><span class="keyword">const</span> txs = [<span class="string">&#x27;tx1-data&#x27;</span>, <span class="string">&#x27;tx2-data&#x27;</span>, <span class="string">&#x27;tx3-data&#x27;</span>, <span class="string">&#x27;tx4-data&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> merkleRoot = <span class="title function_">buildMerkleTree</span>(txs);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Merkle Root:&#x27;</span>, merkleRoot);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“-Notes"><a href="#ğŸ“-Notes" class="headerlink" title="ğŸ“ Notes:"></a>ğŸ“ Notes:</h2><ul>
<li>This sample assumes a binary Merkle tree.</li>
<li>If thereâ€™s an odd number of leaves, the last hash is duplicated to make a pair.</li>
<li>You can also implement <strong>Merkle Proof</strong> logic to verify a leafâ€™s inclusion using hashes up to the root.</li>
</ul>
<h2 id="Another-drawn"><a href="#Another-drawn" class="headerlink" title="Another drawn"></a>Another drawn</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             Merkle Root</span><br><span class="line">                 â”‚</span><br><span class="line">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">         â”‚                â”‚</span><br><span class="line">      Hash01           Hash23</span><br><span class="line">     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”</span><br><span class="line">  Hash0      Hash1  Hash2     Hash3</span><br><span class="line">  â”‚            â”‚     â”‚          â”‚</span><br><span class="line">Tx0          Tx1   Tx2        Tx3</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/04/20/Deep-Dive-Ethers-js-calldata/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/20/Deep-Dive-Ethers-js-calldata/" class="post-title-link" itemprop="url">Deep Dive --- Ethers.js calldata</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-20 18:42:59" itemprop="dateCreated datePublished" datetime="2025-04-20T18:42:59-04:00">2025-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/" itemprop="url" rel="index"><span itemprop="name">Cypto Currency</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cypto-Currency/Ethereum/" itemprop="url" rel="index"><span itemprop="name">Ethereum</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Ethers-js-ä¸­çš„-Calldata-è¯¦è§£åŠä½¿ç”¨åœºæ™¯"><a href="#Ethers-js-ä¸­çš„-Calldata-è¯¦è§£åŠä½¿ç”¨åœºæ™¯" class="headerlink" title="Ethers.js ä¸­çš„ Calldata è¯¦è§£åŠä½¿ç”¨åœºæ™¯"></a>Ethers.js ä¸­çš„ Calldata è¯¦è§£åŠä½¿ç”¨åœºæ™¯</h1><p><code>calldata</code> æ˜¯ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦äº¤äº’ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒåŒ…å«äº†è°ƒç”¨åˆçº¦å‡½æ•°æ—¶å‘é€çš„æ‰€æœ‰æ•°æ®ã€‚åœ¨ ethers.js ä¸­ï¼Œç†è§£å’Œä½¿ç”¨ calldata å¯¹äºé«˜çº§åˆçº¦äº¤äº’è‡³å…³é‡è¦ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-Calldataï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Calldataï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Calldataï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Calldataï¼Ÿ</h2><p>Calldata æ˜¯å‘é€åˆ°ä»¥å¤ªåŠåˆçº¦çš„ç‰¹æ®Šæ•°æ®æ ¼å¼ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>å‡½æ•°é€‰æ‹©å™¨ï¼ˆ4å­—èŠ‚çš„å‡½æ•°ç­¾åå“ˆå¸Œï¼‰</li>
<li>ç¼–ç åçš„å‚æ•°æ•°æ®</li>
</ul>
<h3 id="Calldata-çš„ç‰¹ç‚¹"><a href="#Calldata-çš„ç‰¹ç‚¹" class="headerlink" title="Calldata çš„ç‰¹ç‚¹"></a>Calldata çš„ç‰¹ç‚¹</h3><ol>
<li>åªè¯» - åˆçº¦ä¸èƒ½ä¿®æ”¹ calldata</li>
<li>ä¸´æ—¶å­˜å‚¨ - æ‰§è¡Œç»“æŸåä¸ä¿å­˜åœ¨åŒºå—é“¾ä¸Š</li>
<li>å¤–éƒ¨è°ƒç”¨ä¸“ç”¨ - ç”¨äºåˆçº¦é—´é€šä¿¡</li>
<li>æ¯” memory æ›´ä¾¿å®œ - ä½¿ç”¨ calldata å¯ä»¥èŠ‚çœ gas</li>
</ol>
<h2 id="åŸºç¡€-Calldata-æ“ä½œ"><a href="#åŸºç¡€-Calldata-æ“ä½œ" class="headerlink" title="åŸºç¡€ Calldata æ“ä½œ"></a>åŸºç¡€ Calldata æ“ä½œ</h2><h3 id="1-ç”Ÿæˆ-Calldata"><a href="#1-ç”Ÿæˆ-Calldata" class="headerlink" title="1. ç”Ÿæˆ Calldata"></a>1. ç”Ÿæˆ Calldata</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ethers &#125; = <span class="built_in">require</span>(<span class="string">&quot;ethers&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆçº¦ABI</span></span><br><span class="line"><span class="keyword">const</span> erc20Abi = [</span><br><span class="line">  <span class="string">&quot;function transfer(address to, uint amount)&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæ¥å£</span></span><br><span class="line"><span class="keyword">const</span> iface = <span class="keyword">new</span> ethers.<span class="property">utils</span>.<span class="title class_">Interface</span>(erc20Abi);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–ç calldata</span></span><br><span class="line"><span class="keyword">const</span> calldata = iface.<span class="title function_">encodeFunctionData</span>(<span class="string">&quot;transfer&quot;</span>, [</span><br><span class="line">  <span class="string">&quot;0xRecipientAddressHere&quot;</span>,</span><br><span class="line">  ethers.<span class="property">utils</span>.<span class="title function_">parseEther</span>(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Calldata:&quot;</span>, calldata);</span><br><span class="line"><span class="comment">// è¾“å‡ºç¤ºä¾‹: 0xa9059cbb000000000000000000000000recipientaddress0000000000000000000000000000000000000000000000000de0b6b3a7640000</span></span><br></pre></td></tr></table></figure>

<h3 id="2-è§£æ-Calldata"><a href="#2-è§£æ-Calldata" class="headerlink" title="2. è§£æ Calldata"></a>2. è§£æ Calldata</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ç›¸åŒçš„æ¥å£è§£æcalldata</span></span><br><span class="line"><span class="keyword">const</span> parsed = iface.<span class="title function_">parseTransaction</span>(&#123; <span class="attr">data</span>: calldata &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Parsed:&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: parsed.<span class="property">name</span>,</span><br><span class="line">  <span class="attr">args</span>: parsed.<span class="property">args</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="æ ¸å¿ƒä½¿ç”¨åœºæ™¯"><a href="#æ ¸å¿ƒä½¿ç”¨åœºæ™¯" class="headerlink" title="æ ¸å¿ƒä½¿ç”¨åœºæ™¯"></a>æ ¸å¿ƒä½¿ç”¨åœºæ™¯</h2><h3 id="åœºæ™¯1-æ‰¹é‡äº¤æ˜“-Multicall"><a href="#åœºæ™¯1-æ‰¹é‡äº¤æ˜“-Multicall" class="headerlink" title="åœºæ™¯1: æ‰¹é‡äº¤æ˜“ (Multicall)"></a>åœºæ™¯1: æ‰¹é‡äº¤æ˜“ (Multicall)</h3><p><strong>éœ€æ±‚</strong>ï¼šåœ¨ä¸€æ¬¡äº¤æ˜“ä¸­æ‰§è¡Œå¤šä¸ªåˆçº¦è°ƒç”¨ï¼ŒèŠ‚çœgasè´¹ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multiCallAbi = [</span><br><span class="line">  <span class="string">&quot;function multicall(bytes[] calldata data) external returns (bytes[] memory results)&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">batchTransfer</span>(<span class="params">token, recipients, amounts</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> iface = <span class="keyword">new</span> ethers.<span class="property">utils</span>.<span class="title class_">Interface</span>([</span><br><span class="line">    <span class="string">&quot;function transfer(address to, uint amount)&quot;</span></span><br><span class="line">  ]);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¸ºæ¯ä¸ªè½¬è´¦ç”Ÿæˆcalldata</span></span><br><span class="line">  <span class="keyword">const</span> calls = recipients.<span class="title function_">map</span>(<span class="function">(<span class="params">to, i</span>) =&gt;</span> </span><br><span class="line">    token.<span class="property">interface</span>.<span class="title function_">encodeFunctionData</span>(<span class="string">&quot;transfer&quot;</span>, [to, amounts[i]])</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºMulticallåˆçº¦å®ä¾‹</span></span><br><span class="line">  <span class="keyword">const</span> multicall = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(</span><br><span class="line">    <span class="string">&quot;0x5ba1e12693dc8f9c48aad8770482f4739beed696&quot;</span>, <span class="comment">// Ethereumä¸»ç½‘Multicallåœ°å€</span></span><br><span class="line">    multiCallAbi,</span><br><span class="line">    signer</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ‰§è¡Œæ‰¹é‡è°ƒç”¨</span></span><br><span class="line">  <span class="keyword">const</span> tx = <span class="keyword">await</span> multicall.<span class="title function_">multicall</span>(calls);</span><br><span class="line">  <span class="keyword">await</span> tx.<span class="title function_">wait</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‰¹é‡è½¬è´¦å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯2-ç¦»çº¿ç­¾åäº¤æ˜“"><a href="#åœºæ™¯2-ç¦»çº¿ç­¾åäº¤æ˜“" class="headerlink" title="åœºæ™¯2: ç¦»çº¿ç­¾åäº¤æ˜“"></a>åœºæ™¯2: ç¦»çº¿ç­¾åäº¤æ˜“</h3><p><strong>éœ€æ±‚</strong>ï¼šåœ¨ä¸æš´éœ²ç§é’¥çš„æƒ…å†µä¸‹ç”Ÿæˆå¯å¹¿æ’­çš„äº¤æ˜“æ•°æ®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createSignedTransfer</span>(<span class="params">tokenAddress, to, amount, signer</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(tokenAddress, erc20Abi, signer);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 1. ç”Ÿæˆcalldata</span></span><br><span class="line">  <span class="keyword">const</span> data = token.<span class="property">interface</span>.<span class="title function_">encodeFunctionData</span>(<span class="string">&quot;transfer&quot;</span>, [</span><br><span class="line">    to,</span><br><span class="line">    amount</span><br><span class="line">  ]);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. æ„å»ºåŸå§‹äº¤æ˜“</span></span><br><span class="line">  <span class="keyword">const</span> tx = &#123;</span><br><span class="line">    <span class="attr">to</span>: tokenAddress,</span><br><span class="line">    <span class="attr">data</span>: data,</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">gasLimit</span>: <span class="number">100000</span>,</span><br><span class="line">    <span class="attr">nonce</span>: <span class="keyword">await</span> signer.<span class="title function_">getTransactionCount</span>(),</span><br><span class="line">    <span class="attr">chainId</span>: <span class="number">1</span> <span class="comment">// Ethereumä¸»ç½‘</span></span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. ç­¾åäº¤æ˜“ï¼ˆä¸å¹¿æ’­ï¼‰</span></span><br><span class="line">  <span class="keyword">const</span> signedTx = <span class="keyword">await</span> signer.<span class="title function_">signTransaction</span>(tx);</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ç­¾ååçš„äº¤æ˜“:&quot;</span>, signedTx);</span><br><span class="line">  <span class="comment">// å¯ä»¥å°†å…¶ä¿å­˜æˆ–å‘é€ç»™å…¶ä»–èŠ‚ç‚¹å¹¿æ’­</span></span><br><span class="line">  <span class="keyword">return</span> signedTx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯3-ä¼°ç®—Gasè´¹ç”¨"><a href="#åœºæ™¯3-ä¼°ç®—Gasè´¹ç”¨" class="headerlink" title="åœºæ™¯3: ä¼°ç®—Gasè´¹ç”¨"></a>åœºæ™¯3: ä¼°ç®—Gasè´¹ç”¨</h3><p><strong>éœ€æ±‚</strong>ï¼šåœ¨æ‰§è¡Œäº¤æ˜“å‰å‡†ç¡®ä¼°ç®—æ‰€éœ€çš„gasã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">estimateTransferGas</span>(<span class="params">tokenAddress, <span class="keyword">from</span>, to, amount, provider</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(tokenAddress, erc20Abi, provider);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”Ÿæˆcalldata</span></span><br><span class="line">  <span class="keyword">const</span> data = token.<span class="property">interface</span>.<span class="title function_">encodeFunctionData</span>(<span class="string">&quot;transfer&quot;</span>, [to, amount]);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¼°ç®—gas</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> gasEstimate = <span class="keyword">await</span> provider.<span class="title function_">estimateGas</span>(&#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="keyword">from</span>,</span><br><span class="line">      <span class="attr">to</span>: tokenAddress,</span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`è½¬è´¦é¢„ä¼°Gas: <span class="subst">$&#123;gasEstimate.toString()&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> gasEstimate;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Gasä¼°ç®—å¤±è´¥:&quot;</span>, error.<span class="property">reason</span>);</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯4-ä»£ç†åˆçº¦è°ƒç”¨"><a href="#åœºæ™¯4-ä»£ç†åˆçº¦è°ƒç”¨" class="headerlink" title="åœºæ™¯4: ä»£ç†åˆçº¦è°ƒç”¨"></a>åœºæ™¯4: ä»£ç†åˆçº¦è°ƒç”¨</h3><p><strong>éœ€æ±‚</strong>ï¼šé€šè¿‡ä»£ç†åˆçº¦è°ƒç”¨é€»è¾‘åˆçº¦çš„å‡½æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxyAbi = [</span><br><span class="line">  <span class="string">&quot;function delegatecall(address target, bytes memory data) public payable&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">proxyTransfer</span>(<span class="params">proxyAddress, tokenAddress, to, amount, signer</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(tokenAddress, erc20Abi, signer);</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> ethers.<span class="title class_">Contract</span>(proxyAddress, proxyAbi, signer);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 1. ç”Ÿæˆtoken transferçš„calldata</span></span><br><span class="line">  <span class="keyword">const</span> data = token.<span class="property">interface</span>.<span class="title function_">encodeFunctionData</span>(<span class="string">&quot;transfer&quot;</span>, [to, amount]);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. é€šè¿‡ä»£ç†åˆçº¦çš„delegatecallæ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">const</span> tx = <span class="keyword">await</span> proxy.<span class="title function_">delegatecall</span>(tokenAddress, data);</span><br><span class="line">  <span class="keyword">await</span> tx.<span class="title function_">wait</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;é€šè¿‡ä»£ç†åˆçº¦è½¬è´¦å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯5-äº‹ä»¶æ—¥å¿—è§£æ"><a href="#åœºæ™¯5-äº‹ä»¶æ—¥å¿—è§£æ" class="headerlink" title="åœºæ™¯5: äº‹ä»¶æ—¥å¿—è§£æ"></a>åœºæ™¯5: äº‹ä»¶æ—¥å¿—è§£æ</h3><p><strong>éœ€æ±‚</strong>ï¼šä»äº¤æ˜“æ”¶æ®ä¸­è§£æåŸå§‹äº‹ä»¶æ—¥å¿—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">parseTransferEvents</span>(<span class="params">txHash, provider</span>) &#123;</span><br><span class="line">  <span class="comment">// è·å–äº¤æ˜“æ”¶æ®</span></span><br><span class="line">  <span class="keyword">const</span> receipt = <span class="keyword">await</span> provider.<span class="title function_">getTransactionReceipt</span>(txHash);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºERC20æ¥å£ç”¨äºè§£ææ—¥å¿—</span></span><br><span class="line">  <span class="keyword">const</span> iface = <span class="keyword">new</span> ethers.<span class="property">utils</span>.<span class="title class_">Interface</span>(erc20Abi);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è§£ææ‰€æœ‰æ—¥å¿—</span></span><br><span class="line">  <span class="keyword">const</span> events = receipt.<span class="property">logs</span></span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">log</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> iface.<span class="title function_">parseLog</span>(log);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// å¿½ç•¥éERC20äº‹ä»¶</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">filter</span>(<span class="function"><span class="params">event</span> =&gt;</span> event !== <span class="literal">null</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç­›é€‰Transferäº‹ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> transfers = events.<span class="title function_">filter</span>(<span class="function"><span class="params">e</span> =&gt;</span> e.<span class="property">name</span> === <span class="string">&quot;Transfer&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;äº¤æ˜“ä¸­çš„è½¬è´¦äº‹ä»¶:&quot;</span>, transfers);</span><br><span class="line">  <span class="keyword">return</span> transfers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é«˜çº§ä½¿ç”¨æŠ€å·§"><a href="#é«˜çº§ä½¿ç”¨æŠ€å·§" class="headerlink" title="é«˜çº§ä½¿ç”¨æŠ€å·§"></a>é«˜çº§ä½¿ç”¨æŠ€å·§</h2><h3 id="1-åŠ¨æ€å‚æ•°ç¼–ç "><a href="#1-åŠ¨æ€å‚æ•°ç¼–ç " class="headerlink" title="1. åŠ¨æ€å‚æ•°ç¼–ç "></a>1. åŠ¨æ€å‚æ•°ç¼–ç </h3><p>å½“å‚æ•°ç±»å‹ä¸ç¡®å®šæ—¶ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">encodeDynamicParams</span>(<span class="params">types, values</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> ethers.<span class="property">utils</span>.<span class="property">defaultAbiCoder</span>.<span class="title function_">encode</span>(types, values);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šç¼–ç åŠ¨æ€æ•°ç»„</span></span><br><span class="line"><span class="keyword">const</span> dynamicData = <span class="title function_">encodeDynamicParams</span>(</span><br><span class="line">  [<span class="string">&quot;address[]&quot;</span>, <span class="string">&quot;uint256[]&quot;</span>],</span><br><span class="line">  [</span><br><span class="line">    [<span class="string">&quot;0x123...&quot;</span>, <span class="string">&quot;0x456...&quot;</span>],</span><br><span class="line">    [ethers.<span class="property">utils</span>.<span class="title function_">parseEther</span>(<span class="string">&quot;1&quot;</span>), ethers.<span class="property">utils</span>.<span class="title function_">parseEther</span>(<span class="string">&quot;2&quot;</span>)]</span><br><span class="line">  ]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-è‡ªå®šä¹‰é”™è¯¯å¤„ç†"><a href="#2-è‡ªå®šä¹‰é”™è¯¯å¤„ç†" class="headerlink" title="2. è‡ªå®šä¹‰é”™è¯¯å¤„ç†"></a>2. è‡ªå®šä¹‰é”™è¯¯å¤„ç†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">safeCall</span>(<span class="params">contract, method, args</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> calldata = contract.<span class="property">interface</span>.<span class="title function_">encodeFunctionData</span>(method, args);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨callStaticæ¨¡æ‹Ÿè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> contract.<span class="property">callStatic</span>[method](...args);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">success</span>: <span class="literal">true</span>, <span class="attr">data</span>: result &#125;;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// è§£ærevertåŸå› </span></span><br><span class="line">    <span class="keyword">let</span> reason = <span class="string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">data</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        reason = contract.<span class="property">interface</span>.<span class="title function_">parseError</span>(error.<span class="property">data</span>).<span class="property">name</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        reason = error.<span class="property">data</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">error</span>: reason &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Gasä¼˜åŒ–æŠ€å·§"><a href="#3-Gasä¼˜åŒ–æŠ€å·§" class="headerlink" title="3. Gasä¼˜åŒ–æŠ€å·§"></a>3. Gasä¼˜åŒ–æŠ€å·§</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">optimizedTransfer</span>(<span class="params">token, to, amount</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. ç”Ÿæˆcalldata</span></span><br><span class="line">  <span class="keyword">const</span> data = token.<span class="property">interface</span>.<span class="title function_">encodeFunctionData</span>(<span class="string">&quot;transfer&quot;</span>, [to, amount]);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. è·å–å½“å‰gasä»·æ ¼</span></span><br><span class="line">  <span class="keyword">const</span> gasPrice = <span class="keyword">await</span> token.<span class="property">provider</span>.<span class="title function_">getGasPrice</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. ä¼°ç®—gas</span></span><br><span class="line">  <span class="keyword">const</span> gasLimit = <span class="keyword">await</span> token.<span class="property">estimateGas</span>.<span class="title function_">transfer</span>(to, amount)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">est</span> =&gt;</span> est.<span class="title function_">mul</span>(<span class="number">12</span>).<span class="title function_">div</span>(<span class="number">10</span>)) <span class="comment">// å¢åŠ 20%ç¼“å†²</span></span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> ethers.<span class="property">BigNumber</span>.<span class="title function_">from</span>(<span class="number">100000</span>)); <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 4. æ„å»ºåŸå§‹äº¤æ˜“</span></span><br><span class="line">  <span class="keyword">const</span> tx = &#123;</span><br><span class="line">    <span class="attr">to</span>: token.<span class="property">address</span>,</span><br><span class="line">    <span class="attr">data</span>: data,</span><br><span class="line">    <span class="attr">gasPrice</span>: gasPrice,</span><br><span class="line">    <span class="attr">gasLimit</span>: gasLimit</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 5. å‘é€äº¤æ˜“</span></span><br><span class="line">  <span class="keyword">return</span> token.<span class="property">signer</span>.<span class="title function_">sendTransaction</span>(tx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®‰å…¨æ³¨æ„äº‹é¡¹"><a href="#å®‰å…¨æ³¨æ„äº‹é¡¹" class="headerlink" title="å®‰å…¨æ³¨æ„äº‹é¡¹"></a>å®‰å…¨æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>CalldataéªŒè¯</strong>ï¼šå§‹ç»ˆéªŒè¯å¤–éƒ¨ä¼ å…¥çš„calldataï¼Œé˜²æ­¢æ¶æ„è°ƒç”¨</li>
<li><strong>Gasé™åˆ¶</strong>ï¼šä¸ºæœªçŸ¥calldataè®¾ç½®åˆç†çš„gasé™åˆ¶</li>
<li><strong>é‡æ”¾æ”»å‡»</strong>ï¼šç­¾ååçš„calldataå¯ä»¥è¢«é‡æ”¾ï¼ŒåŒ…å«chainIdå’Œnonce</li>
<li><strong>å‚æ•°æ¸…æ´—</strong>ï¼šåœ¨è§£ç å‰æ£€æŸ¥calldataé•¿åº¦å’Œæ ¼å¼</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Calldata åœ¨ä»¥å¤ªåŠå¼€å‘ä¸­æ‰®æ¼”ç€æ ¸å¿ƒè§’è‰²ï¼Œé€šè¿‡ ethers.js æä¾›çš„å·¥å…·å¯ä»¥ï¼š</p>
<ol>
<li>é«˜æ•ˆç¼–ç å’Œè§£ç å‡½æ•°è°ƒç”¨</li>
<li>å®ç°å¤æ‚çš„æ‰¹é‡äº¤æ˜“æ¨¡å¼</li>
<li>æ„å»ºå®‰å…¨çš„ç¦»çº¿ç­¾åç³»ç»Ÿ</li>
<li>ä¼˜åŒ–gasä½¿ç”¨æˆæœ¬</li>
<li>ä¸ä»£ç†åˆçº¦å’Œé«˜çº§æ¨¡å¼äº¤äº’</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/04/11/Build-a-wechat-app-from-scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/11/Build-a-wechat-app-from-scratch/" class="post-title-link" itemprop="url">Build a wechat app from scratch</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-11 17:33:52" itemprop="dateCreated datePublished" datetime="2025-04-11T17:33:52-04:00">2025-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WeChat/" itemprop="url" rel="index"><span itemprop="name">WeChat</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-é¡¹ç›®ç»“æ„"><a href="#1-é¡¹ç›®ç»“æ„" class="headerlink" title="1. é¡¹ç›®ç»“æ„"></a>1. é¡¹ç›®ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">miniprogram/</span><br><span class="line">â”œâ”€â”€ pages/</span><br><span class="line">â”‚   â””â”€â”€ index/</span><br><span class="line">â”‚       â”œâ”€â”€ index.js</span><br><span class="line">â”‚       â”œâ”€â”€ index.json</span><br><span class="line">â”‚       â”œâ”€â”€ index.wxml</span><br><span class="line">â”‚       â””â”€â”€ index.wxss</span><br><span class="line">â”œâ”€â”€ app.js</span><br><span class="line">â”œâ”€â”€ app.json</span><br><span class="line">â”œâ”€â”€ app.wxss</span><br><span class="line">â””â”€â”€ utils/</span><br><span class="line">    â””â”€â”€ api.js</span><br></pre></td></tr></table></figure>

<h2 id="2-ä»£ç å®ç°"><a href="#2-ä»£ç å®ç°" class="headerlink" title="2. ä»£ç å®ç°"></a>2. ä»£ç å®ç°</h2><h3 id="2-1-app-json-é…ç½®"><a href="#2-1-app-json-é…ç½®" class="headerlink" title="2.1 app.json é…ç½®"></a>2.1 app.json é…ç½®</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;pages/index/index&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;window&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å›¾ç‰‡é£æ ¼è½¬æ¢&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigationBarBackgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sitemapLocation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitemap.json&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-é¡µé¢å¸ƒå±€-index-wxml"><a href="#2-2-é¡µé¢å¸ƒå±€-index-wxml" class="headerlink" title="2.2 é¡µé¢å¸ƒå±€ (index.wxml)"></a>2.2 é¡µé¢å¸ƒå±€ (index.wxml)</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä¸Šéƒ¨ï¼šå›¾ç‰‡è¾“å…¥åŒºåŸŸ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;top-section&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-preview&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;originalImage&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;originalImage&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;chooseImage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>é€‰æ‹©å›¾ç‰‡<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;transformImage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn transform-btn&quot;</span> <span class="attr">disabled</span>=<span class="string">&quot;&#123;&#123;!canTransform&#125;&#125;&quot;</span>&gt;</span>è½¬æ¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- ä¸­éƒ¨ï¼šé£æ ¼é€‰æ‹©åŒºåŸŸ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;middle-section&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>é€‰æ‹©è½¬æ¢é£æ ¼<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;style-buttons&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;styles&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;style-btn &#123;&#123;selectedStyle === item.id ? &#x27;active&#x27; : &#x27;&#x27;&#125;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">bindtap</span>=<span class="string">&quot;selectStyle&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          &#123;&#123;item.name&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- ä¸‹éƒ¨ï¼šç»“æœå±•ç¤ºåŒºåŸŸ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;bottom-section&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;isLoading&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;loading&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/images/loading.gif&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;aspectFit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span>&gt;</span>æ­£åœ¨è½¬æ¢ä¸­ï¼Œè¯·ç¨å€™...<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;transformedImage &amp;&amp; !isLoading&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;result-image&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;transformedImage&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-é¡µé¢æ ·å¼-index-wxss"><a href="#2-3-é¡µé¢æ ·å¼-index-wxss" class="headerlink" title="2.3 é¡µé¢æ ·å¼ (index.wxss)"></a>2.3 é¡µé¢æ ·å¼ (index.wxss)</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.top-section</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.image-preview</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.image-preview</span> <span class="selector-tag">image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.button-group</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">48%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.transform-btn</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#07c160</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.transform-btn</span><span class="selector-attr">[disabled]</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#cccccc</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666666</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.middle-section</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.style-buttons</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.style-btn</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">45%</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.style-btn</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#07c160</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bottom-section</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading</span> <span class="selector-tag">image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.result-image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.result-image</span> <span class="selector-tag">image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-é¡µé¢é€»è¾‘-index-js"><a href="#2-4-é¡µé¢é€»è¾‘-index-js" class="headerlink" title="2.4 é¡µé¢é€»è¾‘ (index.js)"></a>2.4 é¡µé¢é€»è¾‘ (index.js)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> api = <span class="built_in">require</span>(<span class="string">&#x27;../../utils/api.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">originalImage</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">transformedImage</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">selectedStyle</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">canTransform</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">styles</span>: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="string">&#x27;anime&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;åŠ¨æ¼«&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="string">&#x27;vintage&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;æ€€æ—§&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="string">&#x27;cool&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;é…·å¸…&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="string">&#x27;fresh&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;æ¸…æ–°&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€‰æ‹©å›¾ç‰‡</span></span><br><span class="line">  <span class="title function_">chooseImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    wx.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">sizeType</span>: [<span class="string">&#x27;compressed&#x27;</span>],</span><br><span class="line">      <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>],</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">originalImage</span>: res.<span class="property">tempFilePaths</span>[<span class="number">0</span>],</span><br><span class="line">          <span class="attr">transformedImage</span>: <span class="literal">null</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkTransformStatus</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€‰æ‹©é£æ ¼</span></span><br><span class="line">  <span class="title function_">selectStyle</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> styleId = e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">id</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">selectedStyle</span>: styleId</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">checkTransformStatus</span>()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ˜¯å¦å¯ä»¥è½¬æ¢</span></span><br><span class="line">  <span class="title function_">checkTransformStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">canTransform</span>: !!<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">originalImage</span> &amp;&amp; !!<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">selectedStyle</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è½¬æ¢å›¾ç‰‡</span></span><br><span class="line">  <span class="title function_">transformImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">originalImage</span> || !<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">selectedStyle</span>) &#123;</span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;è¯·é€‰æ‹©å›¾ç‰‡å’Œé£æ ¼&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">isLoading</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">transformedImage</span>: <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šä¼ å›¾ç‰‡å¹¶è½¬æ¢</span></span><br><span class="line">    wx.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;https://www.catobigato.com/api/v1/imageTransform&#x27;</span>,</span><br><span class="line">      <span class="attr">filePath</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">originalImage</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">      <span class="attr">formData</span>: &#123;</span><br><span class="line">        <span class="attr">style</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">selectedStyle</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">statusCode</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)</span><br><span class="line">          <span class="keyword">if</span> (data.<span class="property">success</span> &amp;&amp; data.<span class="property">resultUrl</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">              <span class="attr">transformedImage</span>: data.<span class="property">resultUrl</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">              <span class="attr">title</span>: data.<span class="property">message</span> || <span class="string">&#x27;è½¬æ¢å¤±è´¥&#x27;</span>,</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;æœåŠ¡å™¨é”™è¯¯&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">        wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;ç½‘ç»œé”™è¯¯&#x27;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">complete</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">isLoading</span>: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2-5-APIå·¥å…·ç±»-utils-api-js"><a href="#2-5-APIå·¥å…·ç±»-utils-api-js" class="headerlink" title="2.5 APIå·¥å…·ç±» (utils&#x2F;api.js)"></a>2.5 APIå·¥å…·ç±» (utils&#x2F;api.js)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">BASE_URL</span> = <span class="string">&#x27;https://www.catobigato.com/api/v1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">request</span> = (<span class="params">url, method, data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="variable constant_">BASE_URL</span> + url,</span><br><span class="line">      <span class="attr">method</span>: method,</span><br><span class="line">      <span class="attr">data</span>: data,</span><br><span class="line">      <span class="attr">header</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">statusCode</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">data</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(res.<span class="property">data</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  request</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-åŠŸèƒ½è¯´æ˜"><a href="#3-åŠŸèƒ½è¯´æ˜" class="headerlink" title="3. åŠŸèƒ½è¯´æ˜"></a>3. åŠŸèƒ½è¯´æ˜</h2><ol>
<li><p><strong>å›¾ç‰‡é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·ç‚¹å‡»â€é€‰æ‹©å›¾ç‰‡â€æŒ‰é’®ï¼Œå¯ä»¥ä»ç›¸å†Œæˆ–ç›¸æœºè·å–å›¾ç‰‡</li>
<li>é€‰æ‹©çš„å›¾ç‰‡ä¼šæ˜¾ç¤ºåœ¨ä¸Šéƒ¨åŒºåŸŸ</li>
</ul>
</li>
<li><p><strong>é£æ ¼é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>ä¸­éƒ¨åŒºåŸŸæä¾›4ç§é£æ ¼é€‰é¡¹ï¼ˆåŠ¨æ¼«ã€æ€€æ—§ã€é…·å¸…ã€æ¸…æ–°ï¼‰</li>
<li>ç”¨æˆ·ç‚¹å‡»é£æ ¼æŒ‰é’®åï¼ŒæŒ‰é’®ä¼šé«˜äº®æ˜¾ç¤º</li>
</ul>
</li>
<li><p><strong>è½¬æ¢åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>åªæœ‰å½“ç”¨æˆ·é€‰æ‹©äº†å›¾ç‰‡å’Œé£æ ¼åï¼Œâ€è½¬æ¢â€æŒ‰é’®æ‰ä¼šå¯ç”¨</li>
<li>ç‚¹å‡»â€è½¬æ¢â€æŒ‰é’®åï¼Œå°ç¨‹åºå°†å›¾ç‰‡å’Œé£æ ¼å‚æ•°ä¸Šä¼ åˆ°åç«¯API</li>
<li>è½¬æ¢è¿‡ç¨‹ä¸­æ˜¾ç¤ºåŠ è½½åŠ¨ç”»</li>
</ul>
</li>
<li><p><strong>ç»“æœå±•ç¤º</strong>ï¼š</p>
<ul>
<li>è½¬æ¢å®Œæˆåï¼Œç»“æœå›¾ç‰‡æ˜¾ç¤ºåœ¨ä¸‹éƒ¨åŒºåŸŸ</li>
<li>å¦‚æœè½¬æ¢å¤±è´¥ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯æç¤º</li>
</ul>
</li>
</ol>
<h2 id="4-æ³¨æ„äº‹é¡¹"><a href="#4-æ³¨æ„äº‹é¡¹" class="headerlink" title="4. æ³¨æ„äº‹é¡¹"></a>4. æ³¨æ„äº‹é¡¹</h2><ol>
<li><p><strong>åŸŸåé…ç½®</strong>ï¼š</p>
<ul>
<li>åœ¨å¾®ä¿¡å°ç¨‹åºåå°é…ç½®<code>https://www.catobigato.com</code>ä¸ºåˆæ³•åŸŸå</li>
<li>ç¡®ä¿æœåŠ¡å™¨æ”¯æŒHTTPS</li>
</ul>
</li>
<li><p><strong>å›¾ç‰‡å¤§å°é™åˆ¶</strong>ï¼š</p>
<ul>
<li>å¾®ä¿¡å°ç¨‹åºå¯¹ä¸Šä¼ æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼ˆé€šå¸¸ä¸º10MBï¼‰</li>
<li>å»ºè®®åœ¨ä¸Šä¼ å‰å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©å¤„ç†</li>
</ul>
</li>
<li><p><strong>åŠ è½½åŠ¨ç”»</strong>ï¼š</p>
<ul>
<li>å‡†å¤‡ä¸€ä¸ªloading.gifåŠ¨ç”»æ–‡ä»¶æ”¾åœ¨<code>/images/</code>ç›®å½•ä¸‹</li>
<li>ä¹Ÿå¯ä»¥ä½¿ç”¨å¾®ä¿¡è‡ªå¸¦çš„loadingç»„ä»¶</li>
</ul>
</li>
<li><p><strong>é”™è¯¯å¤„ç†</strong>ï¼š</p>
<ul>
<li>æ·»åŠ äº†ç½‘ç»œé”™è¯¯å’ŒæœåŠ¡å™¨é”™è¯¯çš„å¤„ç†é€»è¾‘</li>
<li>æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º</li>
</ul>
</li>
<li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>å¯¹äºå¤§å›¾ç‰‡ï¼Œå¯ä»¥è€ƒè™‘å…ˆå‹ç¼©å†ä¸Šä¼ </li>
<li>å¯ä»¥æ·»åŠ å–æ¶ˆä¸Šä¼ çš„åŠŸèƒ½</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/03/23/PostgreSQL-commands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/23/PostgreSQL-commands/" class="post-title-link" itemprop="url">PostgreSQL commands</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-23 10:12:56" itemprop="dateCreated datePublished" datetime="2025-03-23T10:12:56-04:00">2025-03-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Postgres/" itemprop="url" rel="index"><span itemprop="name">Postgres</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Database-Management"><a href="#Database-Management" class="headerlink" title="Database Management"></a>Database Management</h2><h3 id="List-All-Databases"><a href="#List-All-Databases" class="headerlink" title="List All Databases"></a>List All Databases</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\l</span><br></pre></td></tr></table></figure>

<h3 id="Connect-to-a-Database"><a href="#Connect-to-a-Database" class="headerlink" title="Connect to a Database"></a>Connect to a Database</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\c database_name</span><br></pre></td></tr></table></figure>

<h3 id="Create-a-New-Database"><a href="#Create-a-New-Database" class="headerlink" title="Create a New Database"></a>Create a New Database</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE database_name;</span><br></pre></td></tr></table></figure>

<h3 id="Drop-a-Database"><a href="#Drop-a-Database" class="headerlink" title="Drop a Database"></a>Drop a Database</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE database_name;</span><br></pre></td></tr></table></figure>

<h3 id="Check-Database-Size"><a href="#Check-Database-Size" class="headerlink" title="Check Database Size"></a>Check Database Size</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pg_size_pretty(pg_database_size(<span class="string">&#x27;database_name&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="List-All-Users-Roles"><a href="#List-All-Users-Roles" class="headerlink" title="List All Users&#x2F;Roles"></a>List All Users&#x2F;Roles</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\du</span><br></pre></td></tr></table></figure>

<h3 id="Check-Current-Database"><a href="#Check-Current-Database" class="headerlink" title="Check Current Database"></a>Check Current Database</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> current_database();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Table-Management"><a href="#Table-Management" class="headerlink" title="Table Management"></a>Table Management</h2><h3 id="List-All-Tables-in-the-Current-Database"><a href="#List-All-Tables-in-the-Current-Database" class="headerlink" title="List All Tables in the Current Database"></a>List All Tables in the Current Database</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\dt</span><br></pre></td></tr></table></figure>

<h3 id="List-All-Tables-with-Additional-Details"><a href="#List-All-Tables-with-Additional-Details" class="headerlink" title="List All Tables with Additional Details"></a>List All Tables with Additional Details</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\dt<span class="operator">+</span></span><br></pre></td></tr></table></figure>

<h3 id="Describe-a-Table-Columns-Types-etc"><a href="#Describe-a-Table-Columns-Types-etc" class="headerlink" title="Describe a Table (Columns, Types, etc.)"></a>Describe a Table (Columns, Types, etc.)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\d table_name</span><br></pre></td></tr></table></figure>

<h3 id="Show-Table-Schema"><a href="#Show-Table-Schema" class="headerlink" title="Show Table Schema"></a>Show Table Schema</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\d<span class="operator">+</span> table_name</span><br></pre></td></tr></table></figure>

<h3 id="Check-Table-Size-Including-Indexes"><a href="#Check-Table-Size-Including-Indexes" class="headerlink" title="Check Table Size (Including Indexes)"></a>Check Table Size (Including Indexes)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pg_size_pretty(pg_total_relation_size(<span class="string">&#x27;table_name&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="Check-Table-Row-Count"><a href="#Check-Table-Row-Count" class="headerlink" title="Check Table Row Count"></a>Check Table Row Count</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<h3 id="Show-Indexes-of-a-Table"><a href="#Show-Indexes-of-a-Table" class="headerlink" title="Show Indexes of a Table"></a>Show Indexes of a Table</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\di table_name</span><br></pre></td></tr></table></figure>

<h3 id="Show-Table-Constraints"><a href="#Show-Table-Constraints" class="headerlink" title="Show Table Constraints"></a>Show Table Constraints</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\d table_name</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Query-Execution-and-Statistics"><a href="#Query-Execution-and-Statistics" class="headerlink" title="Query Execution and Statistics"></a>Query Execution and Statistics</h2><h3 id="Explain-a-Query-Execution-Plan"><a href="#Explain-a-Query-Execution-Plan" class="headerlink" title="Explain a Query (Execution Plan)"></a>Explain a Query (Execution Plan)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<h3 id="Explain-with-Detailed-Statistics"><a href="#Explain-with-Detailed-Statistics" class="headerlink" title="Explain with Detailed Statistics"></a>Explain with Detailed Statistics</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN ANALYZE <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<h3 id="Show-Query-Execution-Time"><a href="#Show-Query-Execution-Time" class="headerlink" title="Show Query Execution Time"></a>Show Query Execution Time</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\timing</span><br></pre></td></tr></table></figure>

<h3 id="Show-Active-Queries"><a href="#Show-Active-Queries" class="headerlink" title="Show Active Queries"></a>Show Active Queries</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> pg_stat_activity;</span><br></pre></td></tr></table></figure>

<h3 id="Cancel-a-Running-Query"><a href="#Cancel-a-Running-Query" class="headerlink" title="Cancel a Running Query"></a>Cancel a Running Query</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pg_cancel_backend(pid);</span><br></pre></td></tr></table></figure>

<h3 id="Terminate-a-Running-Query"><a href="#Terminate-a-Running-Query" class="headerlink" title="Terminate a Running Query"></a>Terminate a Running Query</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pg_terminate_backend(pid);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="User-and-Role-Management"><a href="#User-and-Role-Management" class="headerlink" title="User and Role Management"></a>User and Role Management</h2><h3 id="Create-a-New-User-Role"><a href="#Create-a-New-User-Role" class="headerlink" title="Create a New User&#x2F;Role"></a>Create a New User&#x2F;Role</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ROLE role_name <span class="keyword">WITH</span> LOGIN PASSWORD <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Grant-Privileges-to-a-User"><a href="#Grant-Privileges-to-a-User" class="headerlink" title="Grant Privileges to a User"></a>Grant Privileges to a User</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> DATABASE database_name <span class="keyword">TO</span> role_name;</span><br></pre></td></tr></table></figure>

<h3 id="Revoke-Privileges-from-a-User"><a href="#Revoke-Privileges-from-a-User" class="headerlink" title="Revoke Privileges from a User"></a>Revoke Privileges from a User</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> DATABASE database_name <span class="keyword">FROM</span> role_name;</span><br></pre></td></tr></table></figure>

<h3 id="Alter-User-Password"><a href="#Alter-User-Password" class="headerlink" title="Alter User Password"></a>Alter User Password</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> role_name <span class="keyword">WITH</span> PASSWORD <span class="string">&#x27;new_password&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Delete-a-User-Role"><a href="#Delete-a-User-Role" class="headerlink" title="Delete a User&#x2F;Role"></a>Delete a User&#x2F;Role</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> ROLE role_name;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Backup-and-Restore"><a href="#Backup-and-Restore" class="headerlink" title="Backup and Restore"></a>Backup and Restore</h2><h3 id="Backup-a-Database"><a href="#Backup-a-Database" class="headerlink" title="Backup a Database"></a>Backup a Database</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dump -U username -d database_name -f backup_file.sql</span><br></pre></td></tr></table></figure>

<h3 id="Restore-a-Database"><a href="#Restore-a-Database" class="headerlink" title="Restore a Database"></a>Restore a Database</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U username -d database_name -f backup_file.sql</span><br></pre></td></tr></table></figure>

<h3 id="Backup-All-Databases"><a href="#Backup-All-Databases" class="headerlink" title="Backup All Databases"></a>Backup All Databases</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dumpall -U username -f backup_file.sql</span><br></pre></td></tr></table></figure>

<h3 id="Restore-All-Databases"><a href="#Restore-All-Databases" class="headerlink" title="Restore All Databases"></a>Restore All Databases</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U username -f backup_file.sql</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h2><h3 id="Show-PostgreSQL-Version"><a href="#Show-PostgreSQL-Version" class="headerlink" title="Show PostgreSQL Version"></a>Show PostgreSQL Version</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> version();</span><br></pre></td></tr></table></figure>

<h3 id="Show-Current-User"><a href="#Show-Current-User" class="headerlink" title="Show Current User"></a>Show Current User</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">current_user</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Show-All-Settings"><a href="#Show-All-Settings" class="headerlink" title="Show All Settings"></a>Show All Settings</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">ALL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Quit-psql"><a href="#Quit-psql" class="headerlink" title="Quit psql"></a>Quit psql</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\q</span><br></pre></td></tr></table></figure>

<h3 id="Help-for-SQL-Commands"><a href="#Help-for-SQL-Commands" class="headerlink" title="Help for SQL Commands"></a>Help for SQL Commands</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\h</span><br></pre></td></tr></table></figure>

<h3 id="Help-for-psql-Commands"><a href="#Help-for-psql-Commands" class="headerlink" title="Help for psql Commands"></a>Help for psql Commands</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\?</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/03/22/Beat-Practices-of-Keycloak-Production-Configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/22/Beat-Practices-of-Keycloak-Production-Configuration/" class="post-title-link" itemprop="url">Beat Practices of Keycloak Production Configuration</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-22 18:26:05" itemprop="dateCreated datePublished" datetime="2025-03-22T18:26:05-04:00">2025-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1-Hostname-Configuration-in-keycloak-conf"><a href="#1-Hostname-Configuration-in-keycloak-conf" class="headerlink" title="1. Hostname Configuration in keycloak.conf"></a><strong>1. Hostname Configuration in <code>keycloak.conf</code></strong></h3><p>The <code>hostname</code> setting in <code>keycloak.conf</code> is <strong>mandatory for production deployments</strong> if Keycloak needs to generate URLs (e.g., for redirects, emails, or tokens). This ensures that Keycloak uses the correct public-facing URL (e.g., <code>www.keytomarvel.com</code>) instead of the internal server address.</p>
<ul>
<li><p><strong>Why is it important?</strong></p>
<ul>
<li>Keycloak uses the <code>hostname</code> to construct URLs for redirects, emails, and tokens.</li>
<li>If not set, Keycloak might generate URLs using the internal server IP or hostname, which wonâ€™t work for external clients.</li>
</ul>
</li>
<li><p><strong>Example Configuration</strong>:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hostname</span>=www.keytomarvel.com</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="2-Proxy-Configuration-in-keycloak-conf"><a href="#2-Proxy-Configuration-in-keycloak-conf" class="headerlink" title="2. Proxy Configuration in keycloak.conf"></a><strong>2. Proxy Configuration in <code>keycloak.conf</code></strong></h3><p>Since NGINX is handling HTTPS termination, you need to configure Keycloak to trust the proxy. This is done using the <code>proxy</code> setting.</p>
<ul>
<li><p><strong>proxy&#x3D;edge Configuration</strong>:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">proxy</span>=edge</span><br></pre></td></tr></table></figure>

<ul>
<li><code>proxy=edge</code>: Use this when NGINX terminates HTTPS and forwards requests to Keycloak over HTTP.</li>
<li>If NGINX forwards requests over HTTPS to Keycloak, use <code>proxy=reencrypt</code>.</li>
</ul>
</li>
<li><p><strong>Why is it important?</strong></p>
<ul>
<li>Keycloak needs to know itâ€™s behind a proxy to correctly handle headers like <code>X-Forwarded-For</code> and <code>X-Forwarded-Proto</code>.</li>
</ul>
</li>
<li><p><strong>Trust the X-Forwarded-* headers from the reverse proxy</strong>:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">proxy-headers</span>=xforwarded</span><br></pre></td></tr></table></figure>
<ul>
<li><code>proxy=edge</code>: Tells Keycloak it is behind a reverse proxy.</li>
<li><code>proxy-headers=xforwarded</code>: Trusts the <code>X-Forwarded-*</code> headers from Nginx.</li>
</ul>
</li>
<li><p><strong>Update the CSP</strong>:</p>
<p>Update the CSP in your <code>keycloak.conf</code> file to allow framing over HTTPS:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Content Security Policy configuration</span></span><br><span class="line"><span class="attr">spi-events-listener</span>=csp</span><br><span class="line"><span class="attr">spi-events-listener-csp-policy-directives</span>=frame-src <span class="string">&#x27;self&#x27;</span> https://www.keytomarvel.com</span><br></pre></td></tr></table></figure>
<ul>
<li><code>frame-src &#39;self&#39; https://www.keytomarvel.com</code>: Allows framing for the Keycloak admin console over HTTPS.</li>
</ul>
</li>
</ul>
<h3 id="The-complete-keycloak-conf"><a href="#The-complete-keycloak-conf" class="headerlink" title="The complete keycloak.conf"></a>The complete <code>keycloak.conf</code></h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db</span>=postgres</span><br><span class="line"><span class="attr">db-username</span>=username</span><br><span class="line"><span class="attr">db-password</span>=password</span><br><span class="line"><span class="attr">db-url</span>=jdbc:postgresql://<span class="number">192.168</span>.<span class="number">2.128</span>:<span class="number">5432</span>/k2m</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hostname for the Keycloak server. IS MANDATORY FOR PROD!!!</span></span><br><span class="line"><span class="attr">hostname</span>=www.keytomarvel.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># The proxy address forwarding mode if the server is behind a reverse proxy.</span></span><br><span class="line"><span class="attr">proxy</span>=edge</span><br><span class="line"></span><br><span class="line"><span class="comment"># Content Security Policy configuration</span></span><br><span class="line"><span class="attr">spi-events-listener</span>=csp</span><br><span class="line"><span class="attr">spi-events-listener-csp-policy-directives</span>=frame-src <span class="string">&#x27;self&#x27;</span> https://www.keytomarvel.com</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Trust the X-Forwarded-* headers from the reverse proxy</span></span><br><span class="line"><span class="attr">proxy-headers</span>=xforwarded</span><br><span class="line"></span><br><span class="line"><span class="attr">quarkus.hibernate-orm.persistence-xml.ignore</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="3-docker-compose-for-PROD"><a href="#3-docker-compose-for-PROD" class="headerlink" title="3. docker-compose for PROD"></a><strong>3. docker-compose for PROD</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">database:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">keycloak:</span></span><br><span class="line">      <span class="attr">build:</span></span><br><span class="line">        <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">        <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">      <span class="attr">environment:</span></span><br><span class="line">        <span class="attr">KEYCLOAK_ADMIN:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">KEYCLOAK_ADMIN_PASSWORD:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">KC_HTTP_ENABLED:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">        <span class="attr">KC_HTTP_PORT:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">KC_LOG:</span> <span class="string">console,file</span></span><br><span class="line">        <span class="attr">KC_LOG_LEVEL:</span> <span class="string">DEBUG</span></span><br><span class="line">        <span class="attr">KC_LOG_FILE:</span> <span class="string">/opt/keycloak/data/log/keycloak.log</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./volumes/keycloak/conf:/opt/keycloak/conf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./volumes/keycloak/log:/opt/keycloak/data/log</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./volumes/keycloak/providers:/opt/keycloak/providers</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./volumes/keycloak/themes:/opt/keycloak/themes</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">database</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">8888</span><span class="string">:8080</span></span><br><span class="line">      <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">start</span></span><br></pre></td></tr></table></figure>

<h3 id="4-NGINX-Configuration"><a href="#4-NGINX-Configuration" class="headerlink" title="4. NGINX Configuration"></a><strong>4. NGINX Configuration</strong></h3><p>Hereâ€™s an example NGINX configuration for routing traffic to Keycloak:</p>
<h4 id="NGINX-Configuration-Example"><a href="#NGINX-Configuration-Example" class="headerlink" title="NGINX Configuration Example"></a><strong>NGINX Configuration Example</strong></h4><p>â€” &#x2F;etc&#x2F;nginx&#x2F;site-available&#x2F;keytomarvel.com</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> keytomarvel.com www.keytomarvel.com;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># Proxy requests to the Keycloak application running on port 8888</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8888;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Port <span class="variable">$server_port</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl ipv6only=<span class="literal">on</span>; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/keytomarvel.com/fullchain.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/keytomarvel.com/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$host</span> = www.keytomarvel.com) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$host</span> = keytomarvel.com) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> keytomarvel.com www.keytomarvel.com;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">404</span>; <span class="comment"># managed by Certbot</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Key Points</strong>:<ul>
<li>NGINX terminates HTTPS and forwards requests to Keycloak over HTTP.</li>
<li>The <code>proxy_set_header</code> directives ensure Keycloak receives the correct client IP and protocol information.</li>
<li>Ensure Nginx Passes Correct Headers<ul>
<li><code>proxy_set_header X-Forwarded-Proto $scheme;</code>: Tells Keycloak that the original request was HTTPS.</li>
<li><code>proxy_set_header X-Forwarded-Host $host;</code>: Passes the original hostname to Keycloak.</li>
<li><code>proxy_set_header X-Forwarded-Port $server_port;</code>: Passes the original port to Keycloak.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="5-Additional-Production-Considerations"><a href="#5-Additional-Production-Considerations" class="headerlink" title="5. Additional Production Considerations"></a><strong>5. Additional Production Considerations</strong></h3><p>Here are some additional settings and best practices for a production deployment:</p>
<h4 id="a-Database-Connection-Pooling"><a href="#a-Database-Connection-Pooling" class="headerlink" title="a. Database Connection Pooling"></a><strong>a. Database Connection Pooling</strong></h4><p>Ensure the database connection pool is configured for production workloads:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db-pool-initial-size</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">db-pool-max-size</span>=<span class="number">100</span></span><br></pre></td></tr></table></figure>

<h4 id="b-Caching"><a href="#b-Caching" class="headerlink" title="b. Caching"></a><strong>b. Caching</strong></h4><p>Enable distributed caching for high availability:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache</span>=ispn</span><br><span class="line"><span class="attr">cache-stack</span>=kubernetes <span class="comment"># or &#x27;tcp&#x27; for non-Kubernetes environments</span></span><br></pre></td></tr></table></figure>

<h4 id="c-Health-Checks-and-Metrics"><a href="#c-Health-Checks-and-Metrics" class="headerlink" title="c. Health Checks and Metrics"></a><strong>c. Health Checks and Metrics</strong></h4><p>Enable health checks and metrics for monitoring:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">health-enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">metrics-enabled</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="d-Token-and-Session-Timeouts"><a href="#d-Token-and-Session-Timeouts" class="headerlink" title="d. Token and Session Timeouts"></a><strong>d. Token and Session Timeouts</strong></h4><p>Adjust token and session timeouts for security and usability:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">token-lifespan</span>=<span class="number">3600</span> <span class="comment"># Access token lifespan (1 hour)</span></span><br><span class="line"><span class="attr">refresh-token-lifespan</span>=<span class="number">86400</span> <span class="comment"># Refresh token lifespan (24 hours)</span></span><br><span class="line"><span class="attr">session-max-lifespan</span>=<span class="number">86400</span> <span class="comment"># Maximum session lifespan (24 hours)</span></span><br><span class="line"><span class="attr">session-idle-timeout</span>=<span class="number">1800</span> <span class="comment"># Session idle timeout (30 minutes)</span></span><br></pre></td></tr></table></figure>

<h4 id="e-Logging"><a href="#e-Logging" class="headerlink" title="e. Logging"></a><strong>e. Logging</strong></h4><p>Configure logging for production:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log-level</span>=INFO</span><br><span class="line"><span class="attr">log-console-output</span>=json</span><br><span class="line"><span class="attr">log-file</span>=/var/log/keycloak/keycloak.log</span><br></pre></td></tr></table></figure>

<h4 id="f-Email-Configuration"><a href="#f-Email-Configuration" class="headerlink" title="f. Email Configuration"></a><strong>f. Email Configuration</strong></h4><p>Set up email for password resets and notifications:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">smtp-host</span>=smtp.example.com</span><br><span class="line"><span class="attr">smtp-port</span>=<span class="number">587</span></span><br><span class="line"><span class="attr">smtp-username</span>=user@example.com</span><br><span class="line"><span class="attr">smtp-password</span>=changeit</span><br><span class="line"><span class="attr">smtp-from</span>=keycloak@example.com</span><br><span class="line"><span class="attr">smtp-ssl</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">smtp-starttls</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="g-Security-Headers"><a href="#g-Security-Headers" class="headerlink" title="g. Security Headers"></a><strong>g. Security Headers</strong></h4><p>Ensure NGINX adds security headers:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span> always;</span><br><span class="line"><span class="attribute">add_header</span> X-Content-Type-Options <span class="string">&quot;nosniff&quot;</span> always;</span><br><span class="line"><span class="attribute">add_header</span> X-Frame-Options <span class="string">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class="line"><span class="attribute">add_header</span> X-XSS-Protection <span class="string">&quot;1; mode=block&quot;</span> always;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-Full-keycloak-conf-for-Production"><a href="#6-Full-keycloak-conf-for-Production" class="headerlink" title="6. Full keycloak.conf for Production"></a><strong>6. Full <code>keycloak.conf</code> for Production</strong></h3><p>Hereâ€™s a complete <code>keycloak.conf</code> tailored for your setup:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Keycloak Production Configuration</span></span><br><span class="line"><span class="comment"># Database Configuration</span></span><br><span class="line"><span class="attr">db</span>=postgres</span><br><span class="line"><span class="attr">db-url</span>=jdbc:postgresql://localhost:<span class="number">5432</span>/keycloak</span><br><span class="line"><span class="attr">db-username</span>=username</span><br><span class="line"><span class="attr">db-password</span>=password</span><br><span class="line"><span class="attr">db-pool-initial-size</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">db-pool-max-size</span>=<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTP and HTTPS Configuration</span></span><br><span class="line"><span class="attr">http-enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">http-port</span>=<span class="number">8080</span></span><br><span class="line"><span class="attr">hostname</span>=www.keytomarvel.com</span><br><span class="line"><span class="attr">proxy</span>=edge</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cache Configuration</span></span><br><span class="line"><span class="attr">cache</span>=ispn</span><br><span class="line"><span class="attr">cache-stack</span>=kubernetes <span class="comment"># or &#x27;tcp&#x27; for non-Kubernetes environments</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logging Configuration</span></span><br><span class="line"><span class="attr">log-level</span>=INFO</span><br><span class="line"><span class="attr">log-console-output</span>=json</span><br><span class="line"><span class="attr">log-file</span>=/var/log/keycloak/keycloak.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># Health and Metrics</span></span><br><span class="line"><span class="attr">health-enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">metrics-enabled</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Token and Session Configuration</span></span><br><span class="line"><span class="attr">token-lifespan</span>=<span class="number">3600</span></span><br><span class="line"><span class="attr">refresh-token-lifespan</span>=<span class="number">86400</span></span><br><span class="line"><span class="attr">session-max-lifespan</span>=<span class="number">86400</span></span><br><span class="line"><span class="attr">session-idle-timeout</span>=<span class="number">1800</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Email Configuration</span></span><br><span class="line"><span class="attr">smtp-host</span>=smtp.example.com</span><br><span class="line"><span class="attr">smtp-port</span>=<span class="number">587</span></span><br><span class="line"><span class="attr">smtp-username</span>=user@example.com</span><br><span class="line"><span class="attr">smtp-password</span>=changeit</span><br><span class="line"><span class="attr">smtp-from</span>=keycloak@example.com</span><br><span class="line"><span class="attr">smtp-ssl</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">smtp-starttls</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-Deployment-Checklist"><a href="#7-Deployment-Checklist" class="headerlink" title="7. Deployment Checklist"></a><strong>7. Deployment Checklist</strong></h3><ol>
<li><strong>Set <code>hostname</code></strong>: Ensure <code>hostname</code> is set to the public-facing URL (<code>www.keytomarvel.com</code>).</li>
<li><strong>Configure NGINX</strong>: Terminate HTTPS at NGINX and forward requests to Keycloak over HTTP.</li>
<li><strong>Enable Proxy Mode</strong>: Set <code>proxy=edge</code> in <code>keycloak.conf</code>.</li>
<li><strong>Database Tuning</strong>: Configure connection pooling and ensure the database is optimized.</li>
<li><strong>Caching</strong>: Enable distributed caching for high availability.</li>
<li><strong>Monitoring</strong>: Enable health checks and metrics.</li>
<li><strong>Security</strong>: Add security headers in NGINX and ensure tokens&#x2F;sessions are securely configured.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/03/18/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/18/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/" class="post-title-link" itemprop="url">Customizing Keycloak Themes with Keycloakify: A Modern Approach</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-18 13:45:33" itemprop="dateCreated datePublished" datetime="2025-03-18T13:45:33-04:00">2025-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/Keycloakify/" itemprop="url" rel="index"><span itemprop="name">Keycloakify</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach"><a href="#Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach" class="headerlink" title="Customizing Keycloak Themes with Keycloakify: A Modern Approach"></a>Customizing Keycloak Themes with Keycloakify: A Modern Approach</h1><p>Keycloak is a powerful Open Source Identity and Access Management (IAM) solution widely adopted by organizations and companies. However, customizing its theme can be challenging due to limited documentation and the use of FreeMarker, an older templating technology that lacks modern developer-friendly features. Enter <strong>Keycloakify</strong>, a one-stop solution for customizing Keycloak themes using modern web technologies like React, TypeScript, Tailwind CSS, and Vite. This article explores how Keycloakify simplifies Keycloak theme customization and why itâ€™s the best choice for developers looking to modernize their Keycloak UI.</p>
<hr>
<h2 id="Why-Customize-Keycloak-Themes"><a href="#Why-Customize-Keycloak-Themes" class="headerlink" title="Why Customize Keycloak Themes?"></a>Why Customize Keycloak Themes?</h2><p>Keycloak is highly customizable, but its default UI may not align with your organizationâ€™s branding or design requirements. Customizing the theme allows you to:</p>
<ul>
<li>Add your logo and branding elements.</li>
<li>Align the UI with your applicationâ€™s design system.</li>
<li>Improve user experience with modern, responsive designs.</li>
<li>Add custom functionality or workflows.</li>
</ul>
<p>However, Keycloakâ€™s reliance on FreeMarker for theming makes customization cumbersome. FreeMarker lacks the flexibility and developer experience offered by modern front-end frameworks like React.</p>
<hr>
<h2 id="What-is-Keycloakify"><a href="#What-is-Keycloakify" class="headerlink" title="What is Keycloakify?"></a>What is Keycloakify?</h2><p><a target="_blank" rel="noopener" href="https://www.keycloakify.dev/">Keycloakify</a> is a toolchain designed to simplify Keycloak theme customization. It abstracts the complexities of FreeMarker and provides a modern development workflow using:</p>
<ul>
<li><strong>React</strong>: For building dynamic, component-based UIs.</li>
<li><strong>TypeScript</strong>: For type safety and better developer experience.</li>
<li><strong>Tailwind CSS</strong>: For utility-first, responsive styling.</li>
<li><strong>Vite</strong>: For fast development and bundling.</li>
</ul>
<p>Keycloakify acts as a lightweight middleware layer, allowing you to customize Keycloakâ€™s UI while maintaining compatibility with its backend services. It supports all Keycloak theme types (Login, Registration, Account, etc.) and ensures seamless integration with the latest Keycloak versions.</p>
<hr>
<h2 id="Why-Keycloakify-is-the-Best-Solution"><a href="#Why-Keycloakify-is-the-Best-Solution" class="headerlink" title="Why Keycloakify is the Best Solution"></a>Why Keycloakify is the Best Solution</h2><h3 id="1-Modern-Tech-Stack"><a href="#1-Modern-Tech-Stack" class="headerlink" title="1. Modern Tech Stack"></a>1. <strong>Modern Tech Stack</strong></h3><p>Keycloakify replaces FreeMarker with React, enabling developers to use modern tools like Vite, Tailwind CSS, and TypeScript. This makes the development process faster, more efficient, and enjoyable.</p>
<h3 id="2-Active-Maintenance"><a href="#2-Active-Maintenance" class="headerlink" title="2. Active Maintenance"></a>2. <strong>Active Maintenance</strong></h3><p>Keycloakify is actively maintained and keeps up with the latest Keycloak releases. This ensures compatibility and access to new features.</p>
<h3 id="3-End-to-End-Toolchain"><a href="#3-End-to-End-Toolchain" class="headerlink" title="3. End-to-End Toolchain"></a>3. <strong>End-to-End Toolchain</strong></h3><p>Keycloakify provides a complete development workflow, from local development to integration testing with Keycloak running in Docker. This eliminates the need for manual setup and reduces friction.</p>
<h3 id="4-Abstraction-Layer"><a href="#4-Abstraction-Layer" class="headerlink" title="4. Abstraction Layer"></a>4. <strong>Abstraction Layer</strong></h3><p>Keycloakify abstracts the communication between the front-end and Keycloakâ€™s backend, ensuring that your customizations donâ€™t break when Keycloakâ€™s backend changes.</p>
<hr>
<h2 id="My-Experience-with-Keycloakify"><a href="#My-Experience-with-Keycloakify" class="headerlink" title="My Experience with Keycloakify"></a>My Experience with Keycloakify</h2><p>I wanted to customize Keycloak to align with my organizationâ€™s branding and add new Service Providers. My tech stack included <strong>Keycloakify</strong>, <strong>Tailwind CSS</strong>, and <strong>React</strong>. Hereâ€™s how I approached the customization:</p>
<h3 id="Challenges-Faced"><a href="#Challenges-Faced" class="headerlink" title="Challenges Faced"></a>Challenges Faced</h3><ul>
<li><strong>PatternFly Dependency</strong>: Keycloakâ€™s default UI components are built on PatternFly, which is not very customization-friendly.</li>
<li><strong>Component Rewriting</strong>: I decided to rewrite Keycloakâ€™s UI components using plain React and Tailwind CSS, modularizing them for reusability.</li>
</ul>
<h3 id="Work-Done"><a href="#Work-Done" class="headerlink" title="Work Done"></a>Work Done</h3><p>Hereâ€™s a glimpse of the before-and-after results:</p>
<h4 id="Login-Page"><a href="#Login-Page" class="headerlink" title="Login Page"></a><strong>Login Page</strong></h4><ul>
<li><p><strong>Before</strong>: Default Keycloak login form with PatternFly styling.<br><img src="/images/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/login-before.png" alt="Login-before"></p>
</li>
<li><p><strong>After</strong>: Custom login form with Tailwind CSS, aligned with our branding.<br><img src="/images/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/login-after.png" alt="Login-after"></p>
</li>
</ul>
<h4 id="Registration-Page"><a href="#Registration-Page" class="headerlink" title="Registration Page"></a><strong>Registration Page</strong></h4><ul>
<li><strong>Before</strong>: Standard Keycloak registration form.<br><img src="/images/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/register-before.png" alt="Register-before"></li>
<li><strong>After</strong>: Modern, responsive registration form with custom fields and styling.<br><img src="/images/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/register-after.png" alt="Register-before"></li>
</ul>
<h4 id="Account-User-Profile-Page"><a href="#Account-User-Profile-Page" class="headerlink" title="Account (User Profile) Page"></a><strong>Account (User Profile) Page</strong></h4><ul>
<li><strong>Before</strong>: Basic user profile interface.<br><img src="/images/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/user-profile-before.png" alt="Account User Profile-before"></li>
<li><strong>After</strong>: Enhanced profile page with improved UX and branding.<br><img src="/images/Customizing-Keycloak-Themes-with-Keycloakify-A-Modern-Approach/user-profile-after.png" alt="Account User Profile-after"></li>
</ul>
<hr>
<h2 id="Why-Not-Build-a-Custom-Front-End-from-Scratch"><a href="#Why-Not-Build-a-Custom-Front-End-from-Scratch" class="headerlink" title="Why Not Build a Custom Front-End from Scratch?"></a>Why Not Build a Custom Front-End from Scratch?</h2><p>While itâ€™s technically possible to build a custom front-end and communicate with Keycloak via its RESTful API, this approach has significant drawbacks:</p>
<ol>
<li><strong>Lack of Documentation</strong>: Keycloakâ€™s front-end fields and requirements are not well-documented. Youâ€™d need to reverse-engineer the UI or inspect the runtime to understand the required fields.</li>
<li><strong>Dynamic Requirements</strong>: Keycloakâ€™s backend can dynamically change the required fields (e.g., switching between username and email for login). A hardcoded front-end would break if these requirements change.</li>
<li><strong>Maintenance Overhead</strong>: Keeping a custom front-end in sync with Keycloakâ€™s backend updates would require significant effort.</li>
</ol>
<p>Keycloakify solves these problems by encapsulating the communication logic and providing a stable interface for customization.</p>
<hr>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.keycloak.org/">Keycloak Official Website</a></li>
<li><a target="_blank" rel="noopener" href="https://www.keycloakify.dev/">Keycloakify Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://whereq.github.io/2025/03/02/Developing-a-Customized-Keycloak-Theme-with-Keycloakify-Storybook-Tailwind-CSS-and-more/">Developing a Customized Keycloak Theme with Keycloakify, Storybook, Tailwind CSS, and More</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/03/17/How-the-PersonalInfo-Form-Rendered-KeyCloakify/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/17/How-the-PersonalInfo-Form-Rendered-KeyCloakify/" class="post-title-link" itemprop="url">How the PersonalInfo Form Rendered --- KeyCloakify</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-17 09:52:55" itemprop="dateCreated datePublished" datetime="2025-03-17T09:52:55-04:00">2025-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/Keycloakify/" itemprop="url" rel="index"><span itemprop="name">Keycloakify</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="How-the-Form-is-Rendered"><a href="#How-the-Form-is-Rendered" class="headerlink" title="How the Form is Rendered"></a>How the Form is Rendered</h3><ol>
<li><strong>Component Structure</strong>:<ul>
<li>The <code>UserProfileFields</code> component is the main entry point, receiving props like <code>t</code> (translation function), <code>form</code> (React Hook Form instance), <code>userProfileMetadata</code> (attribute metadata), and others.</li>
<li>It renders a <code>ScrollForm</code> component, which takes a <code>sections</code> prop to display grouped form fields.</li>
</ul>
</li>
</ol>
<hr>
<ol start="2">
<li><strong>Grouping Attributes</strong>:<ul>
<li><strong>Logic</strong>: Inside <code>UserProfileFields</code>, <code>groupsWithAttributes</code> is computed using <code>useMemo</code>:<ul>
<li>If <code>userProfileMetadata.attributes</code> is empty, it returns an empty array.</li>
<li>Filters attributes based on <code>hideReadOnly</code> (excludes read-only fields if <code>true</code>).</li>
<li>Groups attributes by their <code>group</code> property, including an â€œungroupedâ€ category (<code>&#123; name: undefined &#125;</code>) for attributes without a group.</li>
<li>Result: An array of <code>GroupWithAttributes</code> objects, each containing a <code>group</code> and its <code>attributes</code>.</li>
</ul>
</li>
<li><strong>Outcome</strong>: Only groups with attributes are rendered (filtered by <code>.filter((group) =&gt; group.attributes.length &gt; 0)</code>).</li>
</ul>
</li>
</ol>
<hr>
<ol start="3">
<li><strong>Rendering Sections</strong>:<ul>
<li><strong>ScrollForm</strong>: The <code>ScrollForm</code> component receives <code>sections</code>, where each section is an object with:<ul>
<li><code>title</code>: Derived from <code>group.displayHeader</code> or <code>group.name</code>, falling back to <code>t(&quot;general&quot;)</code>.</li>
<li><code>panel</code>: A <code>&lt;div className=&quot;space-y-4&quot;&gt;</code> containing:<ul>
<li>Optional group description (<code>&lt;p&gt;</code> with <code>pb-6 text-gray-700</code>) if <code>group.displayDescription</code> exists.</li>
<li>A list of <code>FormField</code> components, one per attribute in the group.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Rendering</strong>: <code>ScrollForm</code> likely renders these sections as collapsible or navigable panels (exact behavior depends on <code>ScrollForm</code> implementation, not shown here).</li>
</ul>
</li>
</ol>
<hr>
<ol start="4">
<li><strong>FormField Rendering</strong>:<ul>
<li><strong>Logic</strong>: The <code>FormField</code> component determines how each attribute is rendered:<ul>
<li><strong>Special Case</strong>: If <code>attribute.name === &quot;locale&quot;</code>, it renders a <code>LocaleSelector</code>.</li>
<li><strong>General Case</strong>: Otherwise, it selects a component from <code>FIELDS</code> based on <code>inputType</code>:<ul>
<li><code>inputType</code> is computed by <code>determineInputType</code> (see below).</li>
<li>If <code>attribute.multivalued</code> or the value is multi-valued (<code>isMultiValue</code>), it defaults to <code>MultiInputComponent</code>.</li>
<li>Otherwise, it uses the mapped component from <code>FIELDS</code> (e.g., <code>TextComponent</code> for <code>&quot;text&quot;</code>, <code>SelectComponent</code> for <code>&quot;select&quot;</code>).</li>
</ul>
</li>
</ul>
</li>
<li><strong>Component Props</strong>: Each <code>FIELDS</code> component receives <code>t</code>, <code>form</code>, <code>inputType</code>, <code>attribute</code>, and <code>renderer</code>.</li>
<li><strong>Outcome</strong>: Each attribute is rendered as a form field (e.g., text input, select dropdown) based on its metadata.</li>
</ul>
</li>
</ol>
<hr>
<ol start="5">
<li><strong>Field Types</strong>:<ul>
<li><strong>Mapping</strong>: The <code>FIELDS</code> object maps <code>InputType</code> to components:<ul>
<li><code>&quot;text&quot;</code>, <code>&quot;html5-*&quot;</code> â†’ <code>TextComponent</code>.</li>
<li><code>&quot;textarea&quot;</code> â†’ <code>TextAreaComponent</code>.</li>
<li><code>&quot;select&quot;</code>, <code>&quot;multiselect&quot;</code> â†’ <code>SelectComponent</code>.</li>
<li><code>&quot;select-radiobuttons&quot;</code>, <code>&quot;multiselect-checkboxes&quot;</code> â†’ <code>OptionComponent</code>.</li>
<li><code>&quot;multi-input&quot;</code> â†’ <code>MultiInputComponent</code>.</li>
</ul>
</li>
<li><strong>Dynamic Selection</strong>: <code>determineInputType</code> checks:<ul>
<li>Root attributes (<code>username</code>, <code>firstName</code>, etc.) â†’ <code>&quot;text&quot;</code>.</li>
<li><code>attribute.annotations?.inputType</code> if valid (e.g., <code>&quot;select&quot;</code>, <code>&quot;textarea&quot;</code>).</li>
<li>Default: <code>&quot;text&quot;</code>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<ol start="6">
<li><strong>Visual Layout</strong>:<ul>
<li><strong>TailwindCSS</strong>: <code>&lt;div className=&quot;space-y-4&quot;&gt;</code> adds vertical spacing between fields; <code>&lt;p className=&quot;pb-6 text-gray-700&quot;&gt;</code> styles group descriptions.</li>
<li><strong>Result</strong>: A scrollable form with sections, each containing a group title, optional description, and a list of input fields.</li>
</ul>
</li>
</ol>
<h3 id="1-Form-Rendering"><a href="#1-Form-Rendering" class="headerlink" title="1. Form Rendering"></a>1. <strong>Form Rendering</strong></h3><p>The <code>UserProfileFields</code> component is responsible for rendering the form. Hereâ€™s how it works:</p>
<h4 id="Step-1-Group-Attributes"><a href="#Step-1-Group-Attributes" class="headerlink" title="Step 1: Group Attributes"></a><strong>Step 1: Group Attributes</strong></h4><ul>
<li>The <code>userProfileMetadata</code> object contains metadata about the user profile, including attributes and groups.</li>
<li>The <code>groupsWithAttributes</code> array is created by grouping attributes based on their <code>group</code> property. If an attribute doesnâ€™t belong to any group, itâ€™s placed in a default group.</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> groupsWithAttributes = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!userProfileMetadata.<span class="property">attributes</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> attributes = hideReadOnly</span><br><span class="line">    ? userProfileMetadata.<span class="property">attributes</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">&#123; readOnly &#125;</span>) =&gt;</span> !readOnly)</span><br><span class="line">    : userProfileMetadata.<span class="property">attributes</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="literal">undefined</span> &#125;, <span class="comment">// Default group for attributes without a group</span></span><br><span class="line">    ...(userProfileMetadata.<span class="property">groups</span> ?? []),</span><br><span class="line">  ].<span class="property">map</span>&lt;<span class="title class_">GroupWithAttributes</span>&gt;(<span class="function">(<span class="params">group</span>) =&gt;</span> (&#123;</span><br><span class="line">    group,</span><br><span class="line">    <span class="attr">attributes</span>: attributes.<span class="title function_">filter</span>(</span><br><span class="line">      <span class="function">(<span class="params">attribute</span>) =&gt;</span> attribute.<span class="property">group</span> === group.<span class="property">name</span>,</span><br><span class="line">    ),</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;, [hideReadOnly, userProfileMetadata.<span class="property">groups</span>, userProfileMetadata.<span class="property">attributes</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="Step-2-Render-the-Form"><a href="#Step-2-Render-the-Form" class="headerlink" title="Step 2: Render the Form"></a><strong>Step 2: Render the Form</strong></h4><ul>
<li>The <code>ScrollForm</code> component is used to render the form sections. Each section corresponds to a group of attributes.</li>
<li>For each group, the <code>title</code> is derived from the groupâ€™s <code>displayHeader</code> or a fallback (e.g., â€œgeneralâ€).</li>
<li>The <code>panel</code> contains the form fields for the groupâ€™s attributes.</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ScrollForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">label</span>=<span class="string">&#123;t(</span>&quot;<span class="attr">jumpToSection</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">sections</span>=<span class="string">&#123;groupsWithAttributes</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">.filter</span>((<span class="attr">group</span>) =&gt;</span> group.attributes.length &gt; 0)</span></span><br><span class="line"><span class="language-xml">      .map((&#123; group, attributes &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="language-xml">        title: label(t, group.displayHeader, group.name) || t(&quot;general&quot;),</span></span><br><span class="line"><span class="language-xml">        panel: (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;space-y-4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;group.displayDescription &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;pb-6 text-gray-700&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;label(t, group.displayDescription, &quot;&quot;)&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            )&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;attributes.map((attribute) =&gt; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">FormField</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">key</span>=<span class="string">&#123;attribute.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">t</span>=<span class="string">&#123;t&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">form</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">supportedLocales</span>=<span class="string">&#123;supportedLocales&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">currentLocale</span>=<span class="string">&#123;currentLocale&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">renderer</span>=<span class="string">&#123;renderer&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">attribute</span>=<span class="string">&#123;attribute&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              /&gt;</span></span></span><br><span class="line"><span class="language-xml">            ))&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ),</span></span><br><span class="line"><span class="language-xml">      &#125;))&#125;</span></span><br><span class="line"><span class="language-xml">  /&gt;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="How-Field-Values-are-Populated"><a href="#How-Field-Values-are-Populated" class="headerlink" title="How Field Values are Populated"></a>How Field Values are Populated</h3><ol>
<li><strong>Form State</strong>:<ul>
<li><strong>Source</strong>: The <code>form</code> prop is a <code>UseFormReturn&lt;UserFormFields&gt;</code> from React Hook Form, managing the form state.</li>
<li><strong>Type</strong>: <code>UserFormFields</code> (from <code>utils.ts</code>) includes user properties (e.g., <code>username</code>, <code>email</code>) and an <code>attributes</code> object or array for custom fields.</li>
</ul>
</li>
</ol>
<hr>
<ol start="2">
<li><strong>Value Retrieval</strong>:<ul>
<li><strong>Logic</strong>: In <code>FormField</code>, <code>form.watch(fieldName(attribute.name))</code> retrieves the current value of each field:<ul>
<li><code>fieldName</code> (from <code>utils.ts</code>) transforms the attribute name:<ul>
<li>Root attributes (<code>username</code>, <code>firstName</code>, etc.) â†’ direct property (e.g., <code>&quot;username&quot;</code>).</li>
<li>Custom attributes â†’ prefixed with <code>&quot;attributes.&quot;</code> and dots replaced with <code>&quot;ğŸº&quot;</code> (e.g., <code>&quot;attributes.my.field&quot;</code> â†’ <code>&quot;attributes.myğŸºfield&quot;</code>).</li>
</ul>
</li>
<li><strong>Result</strong>: <code>value</code> reflects the current form state for that attribute (e.g., <code>&quot;john.doe&quot;</code> for <code>username</code>, <code>[&quot;option1&quot;]</code> for a multivalued field).</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<ol start="3">
<li><strong>Initial Population</strong>:<ul>
<li><strong>Not Shown</strong>: The initial values arenâ€™t set in this file. Theyâ€™re likely passed to <code>form</code> via <code>useForm(&#123; defaultValues &#125;)</code> in a parent component (e.g., a user profile editor).</li>
<li><strong>Assumption</strong>: <code>defaultValues</code> would match <code>UserFormFields</code>, populated from a <code>UserRepresentation</code> object (e.g., <code>&#123; username: &quot;john.doe&quot;, attributes: &#123; &quot;custom.field&quot;: &quot;value&quot; &#125; &#125;</code>).</li>
</ul>
</li>
</ol>
<hr>
<ol start="4">
<li><strong>Dynamic Behavior</strong>:<ul>
<li><strong>Watching Values</strong>: <code>form.watch</code> ensures the rendered component reflects real-time updates (e.g., user typing in a <code>TextComponent</code>).</li>
<li><strong>Multi-Valued Check</strong>: <code>isMultiValue(value)</code> determines if the value is an array with multiple items, influencing the choice of <code>MultiInputComponent</code>.</li>
</ul>
</li>
</ol>
<hr>
<ol start="5">
<li><strong>Component Role</strong>:<ul>
<li><strong>Field Components</strong>: Each <code>FIELDS</code> component (e.g., <code>TextComponent</code>) uses <code>form</code> to register its input (via <code>register</code>, <code>control</code>, etc., not shown here) and display the <code>value</code>.</li>
<li><strong>Example</strong>: For <code>TextComponent</code>, it might render <code>&lt;input &#123;...form.register(fieldName(attribute.name))&#125; value=&#123;value&#125; /&gt;</code>.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-Field-Rendering-and-Value-Population"><a href="#2-Field-Rendering-and-Value-Population" class="headerlink" title="2. Field Rendering and Value Population"></a>2. <strong>Field Rendering and Value Population</strong></h3><p>The <code>FormField</code> component is responsible for rendering individual form fields and populating their values. Hereâ€™s how it works:</p>
<h4 id="Step-1-Determine-the-Input-Type"><a href="#Step-1-Determine-the-Input-Type" class="headerlink" title="Step 1: Determine the Input Type"></a><strong>Step 1: Determine the Input Type</strong></h4><ul>
<li>The <code>inputType</code> is determined based on the attributeâ€™s metadata. For example, if the attribute is multivalued, the <code>multi-input</code> type is used.</li>
<li>The <code>determineInputType</code> function checks the attributeâ€™s <code>annotations.inputType</code> or falls back to a default type (<code>text</code>).</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inputType = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">determineInputType</span>(attribute), [attribute]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> determineInputType = (<span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span>): <span class="function"><span class="params">InputType</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRootAttribute</span>(attribute.<span class="property">name</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;text&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> inputType = attribute.<span class="property">annotations</span>?.<span class="property">inputType</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isValidInputType</span>(inputType)) &#123;</span><br><span class="line">    <span class="keyword">return</span> inputType;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable constant_">DEFAULT_INPUT_TYPE</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Step-2-Render-the-Field"><a href="#Step-2-Render-the-Field" class="headerlink" title="Step 2: Render the Field"></a><strong>Step 2: Render the Field</strong></h4><ul>
<li>The <code>Component</code> variable holds the appropriate component for the field based on the <code>inputType</code>. For example, if the <code>inputType</code> is <code>text</code>, the <code>TextComponent</code> is used.</li>
<li>If the attribute is <code>locale</code>, the <code>LocaleSelector</code> component is used instead.</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> =</span><br><span class="line">  attribute.<span class="property">multivalued</span> ||</span><br><span class="line">  (<span class="title function_">isMultiValue</span>(value) &amp;&amp; attribute.<span class="property">annotations</span>?.<span class="property">inputType</span> === <span class="literal">undefined</span>)</span><br><span class="line">    ? <span class="variable constant_">FIELDS</span>[<span class="string">&quot;multi-input&quot;</span>]</span><br><span class="line">    : <span class="variable constant_">FIELDS</span>[inputType];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (attribute.<span class="property">name</span> === <span class="string">&quot;locale&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">LocaleSelector</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">form</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">supportedLocales</span>=<span class="string">&#123;supportedLocales&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">currentLocale</span>=<span class="string">&#123;currentLocale&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">t</span>=<span class="string">&#123;t&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">attribute</span>=<span class="string">&#123;attribute&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">t</span>=<span class="string">&#123;t&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">form</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">inputType</span>=<span class="string">&#123;inputType&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">attribute</span>=<span class="string">&#123;attribute&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">renderer</span>=<span class="string">&#123;renderer&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="Step-3-Populate-Field-Values"><a href="#Step-3-Populate-Field-Values" class="headerlink" title="Step 3: Populate Field Values"></a><strong>Step 3: Populate Field Values</strong></h4><ul>
<li>The <code>form.watch</code> method from <code>react-hook-form</code> is used to watch the value of the field. This ensures that the fieldâ€™s value is always in sync with the form state.</li>
<li>The <code>fieldName</code> function generates the field name based on the attributeâ€™s name. For example, if the attribute is <code>username</code>, the field name is <code>username</code>. If the attribute is <code>customAttribute</code>, the field name is <code>attributes.customAttribute</code>.</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = form.<span class="title function_">watch</span>(</span><br><span class="line">  <span class="title function_">fieldName</span>(attribute.<span class="property">name</span>) <span class="keyword">as</span> <span class="title class_">FieldPath</span>&lt;<span class="title class_">UserFormFields</span>&gt;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-Form-State-Management"><a href="#3-Form-State-Management" class="headerlink" title="3. Form State Management"></a>3. <strong>Form State Management</strong></h3><p>The <code>react-hook-form</code> library manages the form state. Hereâ€™s how it works:</p>
<h4 id="Step-1-Form-Initialization"><a href="#Step-1-Form-Initialization" class="headerlink" title="Step 1: Form Initialization"></a><strong>Step 1: Form Initialization</strong></h4><ul>
<li>The <code>form</code> object is passed down from the parent component. It contains methods like <code>watch</code>, <code>setValue</code>, and <code>register</code> for managing form state.</li>
</ul>
<h4 id="Step-2-Field-Registration"><a href="#Step-2-Field-Registration" class="headerlink" title="Step 2: Field Registration"></a><strong>Step 2: Field Registration</strong></h4><ul>
<li>Each field component (e.g., <code>TextComponent</code>, <code>SelectComponent</code>) registers itself with the form using the <code>register</code> method. This allows <code>react-hook-form</code> to track the fieldâ€™s value and validation state.</li>
</ul>
<h4 id="Step-3-Value-Updates"><a href="#Step-3-Value-Updates" class="headerlink" title="Step 3: Value Updates"></a><strong>Step 3: Value Updates</strong></h4><ul>
<li>When a user interacts with a field (e.g., types in a text input), the <code>onChange</code> event updates the form state via <code>react-hook-form</code>.</li>
</ul>
<hr>
<h3 id="4-Utility-Functions"><a href="#4-Utility-Functions" class="headerlink" title="4. Utility Functions"></a>4. <strong>Utility Functions</strong></h3><p>The <code>utils.ts</code> file contains utility functions that support form rendering and value population:</p>
<h4 id="fieldName"><a href="#fieldName" class="headerlink" title="fieldName"></a><strong><code>fieldName</code></strong></h4><ul>
<li>Generates the field name based on the attributeâ€™s name. For root attributes (e.g., <code>username</code>), the field name is the attribute name. For custom attributes, the field name is prefixed with <code>attributes.</code>.</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">fieldName</span> = (<span class="params">name?: <span class="built_in">string</span></span>) =&gt;</span><br><span class="line">  <span class="string">`<span class="subst">$&#123;isRootAttribute(name) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;attributes.&quot;</span>&#125;</span><span class="subst">$&#123;name?.replaceAll(</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="string">&quot;.&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="string">&quot;ğŸº&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">  )&#125;</span>`</span> <span class="keyword">as</span> <span class="title class_">FieldPath</span>&lt;<span class="title class_">UserFormFields</span>&gt;;</span><br></pre></td></tr></table></figure>

<h4 id="label"><a href="#label" class="headerlink" title="label"></a><strong><code>label</code></strong></h4><ul>
<li>Generates the label for a field based on the attributeâ€™s <code>displayName</code> or a fallback.</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">label</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">t</span>: <span class="title class_">TFunction</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">text</span>: <span class="built_in">string</span> | <span class="literal">undefined</span>,</span></span><br><span class="line"><span class="params">  fallback?: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  prefix?: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> value = text || fallback;</span><br><span class="line">  <span class="keyword">const</span> bundleKey = <span class="title function_">isBundleKey</span>(value) ? <span class="title function_">unWrap</span>(value!) : value;</span><br><span class="line">  <span class="keyword">const</span> key = prefix ? <span class="string">`<span class="subst">$&#123;prefix&#125;</span>.<span class="subst">$&#123;bundleKey&#125;</span>`</span> : bundleKey;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">t</span>(key || <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ol>
<li><p><strong>Form Rendering</strong>:</p>
<ul>
<li>The <code>UserProfileFields</code> component groups attributes and renders them in sections using the <code>ScrollForm</code> component.</li>
<li>Each section contains fields rendered by the <code>FormField</code> component.</li>
</ul>
</li>
<li><p><strong>Field Rendering</strong>:</p>
<ul>
<li>The <code>FormField</code> component determines the input type and renders the appropriate field component (e.g., <code>TextComponent</code>, <code>SelectComponent</code>).</li>
<li>The <code>LocaleSelector</code> component is used for the <code>locale</code> attribute.</li>
</ul>
</li>
<li><p><strong>Value Population</strong>:</p>
<ul>
<li>The <code>form.watch</code> method from <code>react-hook-form</code> ensures that field values are always in sync with the form state.</li>
<li>The <code>fieldName</code> function generates the correct field name for each attribute.</li>
</ul>
</li>
<li><p><strong>Form State Management</strong>:</p>
<ul>
<li>The <code>react-hook-form</code> library manages the form state, including field registration, value updates, and validation.</li>
</ul>
</li>
<li><p><strong>Utility Functions</strong>:</p>
<ul>
<li>Functions like <code>fieldName</code> and <code>label</code> support form rendering and value population.</li>
</ul>
</li>
</ol>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/keycloak-theme/shared/keycloak-ui-shared/user-profile/UserProfileFields.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">UserProfileAttributeGroupMetadata</span>,</span><br><span class="line">  <span class="title class_">UserProfileAttributeMetadata</span>,</span><br><span class="line">  <span class="title class_">UserProfileMetadata</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;@keycloak/keycloak-admin-client/lib/defs/userProfileMetadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TFunction</span> &#125; <span class="keyword">from</span> <span class="string">&quot;i18next&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ReactNode</span>, useMemo, <span class="keyword">type</span> <span class="variable constant_">JSX</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FieldPath</span>, <span class="title class_">UseFormReturn</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-hook-form&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ScrollForm</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../scroll-form/ScrollForm&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LocaleSelector</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./LocaleSelector&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MultiInputComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./MultiInputComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OptionComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./OptionsComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SelectComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./SelectComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TextAreaComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./TextAreaComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TextComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./TextComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserFormFields</span>, fieldName, isRootAttribute, label &#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">UserProfileError</span> = &#123;</span><br><span class="line">  <span class="attr">responseData</span>: &#123; errors?: &#123; <span class="attr">errorMessage</span>: <span class="built_in">string</span> &#125;[] &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">Options</span> = &#123;</span><br><span class="line">  options?: <span class="built_in">string</span>[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">InputType</span> =</span><br><span class="line">  | <span class="string">&quot;text&quot;</span></span><br><span class="line">  | <span class="string">&quot;textarea&quot;</span></span><br><span class="line">  | <span class="string">&quot;select&quot;</span></span><br><span class="line">  | <span class="string">&quot;select-radiobuttons&quot;</span></span><br><span class="line">  | <span class="string">&quot;multiselect&quot;</span></span><br><span class="line">  | <span class="string">&quot;multiselect-checkboxes&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-email&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-tel&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-url&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-number&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-range&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-datetime-local&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-date&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-month&quot;</span></span><br><span class="line">  | <span class="string">&quot;html5-time&quot;</span></span><br><span class="line">  | <span class="string">&quot;multi-input&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">UserProfileFieldProps</span> = &#123;</span><br><span class="line">  <span class="attr">t</span>: <span class="title class_">TFunction</span>;</span><br><span class="line">  <span class="attr">form</span>: <span class="title class_">UseFormReturn</span>&lt;<span class="title class_">UserFormFields</span>&gt;;</span><br><span class="line">  <span class="attr">inputType</span>: <span class="title class_">InputType</span>;</span><br><span class="line">  <span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span>;</span><br><span class="line">  renderer?: <span class="function">(<span class="params"><span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span></span>) =&gt;</span> <span class="title class_">ReactNode</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">OptionLabel</span> = <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; | <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">FIELDS</span>: &#123;</span><br><span class="line">  [<span class="keyword">type</span> <span class="keyword">in</span> <span class="title class_">InputType</span>]: <span class="function">(<span class="params"><span class="attr">props</span>: <span class="title class_">UserProfileFieldProps</span></span>) =&gt;</span> <span class="variable constant_">JSX</span>.<span class="property">Element</span>;</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="attr">textarea</span>: <span class="title class_">TextAreaComponent</span>,</span><br><span class="line">  <span class="attr">select</span>: <span class="title class_">SelectComponent</span>,</span><br><span class="line">  <span class="string">&quot;select-radiobuttons&quot;</span>: <span class="title class_">OptionComponent</span>,</span><br><span class="line">  <span class="attr">multiselect</span>: <span class="title class_">SelectComponent</span>,</span><br><span class="line">  <span class="string">&quot;multiselect-checkboxes&quot;</span>: <span class="title class_">OptionComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-email&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-tel&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-url&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-number&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-range&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-datetime-local&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-date&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-month&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;html5-time&quot;</span>: <span class="title class_">TextComponent</span>,</span><br><span class="line">  <span class="string">&quot;multi-input&quot;</span>: <span class="title class_">MultiInputComponent</span>,</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">UserProfileFieldsProps</span> = &#123;</span><br><span class="line">  <span class="attr">t</span>: <span class="title class_">TFunction</span>;</span><br><span class="line">  <span class="attr">form</span>: <span class="title class_">UseFormReturn</span>&lt;<span class="title class_">UserFormFields</span>&gt;;</span><br><span class="line">  <span class="attr">userProfileMetadata</span>: <span class="title class_">UserProfileMetadata</span>;</span><br><span class="line">  <span class="attr">supportedLocales</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">currentLocale</span>: <span class="built_in">string</span>;</span><br><span class="line">  hideReadOnly?: <span class="built_in">boolean</span>;</span><br><span class="line">  renderer?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="variable constant_">JSX</span>.<span class="property">Element</span> | <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">GroupWithAttributes</span> = &#123;</span><br><span class="line">  <span class="attr">group</span>: <span class="title class_">UserProfileAttributeGroupMetadata</span>;</span><br><span class="line">  <span class="attr">attributes</span>: <span class="title class_">UserProfileAttributeMetadata</span>[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">UserProfileFields</span> = (<span class="params">&#123;</span></span><br><span class="line"><span class="params">  t,</span></span><br><span class="line"><span class="params">  form,</span></span><br><span class="line"><span class="params">  userProfileMetadata,</span></span><br><span class="line"><span class="params">  supportedLocales,</span></span><br><span class="line"><span class="params">  currentLocale,</span></span><br><span class="line"><span class="params">  hideReadOnly = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params">  renderer,</span></span><br><span class="line"><span class="params">&#125;: <span class="title class_">UserProfileFieldsProps</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// Group attributes by group, for easier rendering.</span></span><br><span class="line">  <span class="keyword">const</span> groupsWithAttributes = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// If there are no attributes, there is no need to group them.</span></span><br><span class="line">    <span class="keyword">if</span> (!userProfileMetadata.<span class="property">attributes</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hide read-only attributes if &#x27;hideReadOnly&#x27; is enabled.</span></span><br><span class="line">    <span class="keyword">const</span> attributes = hideReadOnly</span><br><span class="line">      ? userProfileMetadata.<span class="property">attributes</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">&#123; readOnly &#125;</span>) =&gt;</span> !readOnly)</span><br><span class="line">      : userProfileMetadata.<span class="property">attributes</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      <span class="comment">// Insert an empty group for attributes without a group.</span></span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="literal">undefined</span> &#125;,</span><br><span class="line">      ...(userProfileMetadata.<span class="property">groups</span> ?? []),</span><br><span class="line">    ].<span class="property">map</span>&lt;<span class="title class_">GroupWithAttributes</span>&gt;(<span class="function">(<span class="params">group</span>) =&gt;</span> (&#123;</span><br><span class="line">      group,</span><br><span class="line">      <span class="attr">attributes</span>: attributes.<span class="title function_">filter</span>(</span><br><span class="line">        <span class="function">(<span class="params">attribute</span>) =&gt;</span> attribute.<span class="property">group</span> === group.<span class="property">name</span>,</span><br><span class="line">      ),</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;, [</span><br><span class="line">    hideReadOnly,</span><br><span class="line">    userProfileMetadata.<span class="property">groups</span>,</span><br><span class="line">    userProfileMetadata.<span class="property">attributes</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (groupsWithAttributes.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ScrollForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">label</span>=<span class="string">&#123;t(</span>&quot;<span class="attr">jumpToSection</span>&quot;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">sections</span>=<span class="string">&#123;groupsWithAttributes</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">.filter</span>((<span class="attr">group</span>) =&gt;</span> group.attributes.length &gt; 0)</span></span><br><span class="line"><span class="language-xml">        .map((&#123; group, attributes &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="language-xml">          title: label(t, group.displayHeader, group.name) || t(&quot;general&quot;),</span></span><br><span class="line"><span class="language-xml">          panel: (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;space-y-4&quot;</span>&gt;</span> &#123;/* Replaced pf-v5-c-form with Tailwind CSS */&#125;</span></span><br><span class="line"><span class="language-xml">              &#123;group.displayDescription &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;pb-6 text-gray-700&quot;</span>&gt;</span> &#123;/* Replaced pf-v5-u-pb-lg with Tailwind CSS */&#125;</span></span><br><span class="line"><span class="language-xml">                  &#123;label(t, group.displayDescription, &quot;&quot;)&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              )&#125;</span></span><br><span class="line"><span class="language-xml">              &#123;attributes.map((attribute) =&gt; (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormField</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">key</span>=<span class="string">&#123;attribute.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">t</span>=<span class="string">&#123;t&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">form</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">supportedLocales</span>=<span class="string">&#123;supportedLocales&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">currentLocale</span>=<span class="string">&#123;currentLocale&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">renderer</span>=<span class="string">&#123;renderer&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                  <span class="attr">attribute</span>=<span class="string">&#123;attribute&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">              ))&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ),</span></span><br><span class="line"><span class="language-xml">        &#125;))&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FormFieldProps</span> = &#123;</span><br><span class="line">  <span class="attr">t</span>: <span class="title class_">TFunction</span>;</span><br><span class="line">  <span class="attr">form</span>: <span class="title class_">UseFormReturn</span>&lt;<span class="title class_">UserFormFields</span>&gt;;</span><br><span class="line">  <span class="attr">supportedLocales</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">currentLocale</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span>;</span><br><span class="line">  renderer?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="variable constant_">JSX</span>.<span class="property">Element</span> | <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">FormField</span> = (<span class="params">&#123;</span></span><br><span class="line"><span class="params">  t,</span></span><br><span class="line"><span class="params">  form,</span></span><br><span class="line"><span class="params">  renderer,</span></span><br><span class="line"><span class="params">  supportedLocales,</span></span><br><span class="line"><span class="params">  currentLocale,</span></span><br><span class="line"><span class="params">  attribute,</span></span><br><span class="line"><span class="params">&#125;: <span class="title class_">FormFieldProps</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> value = form.<span class="title function_">watch</span>(</span><br><span class="line">    <span class="title function_">fieldName</span>(attribute.<span class="property">name</span>) <span class="keyword">as</span> <span class="title class_">FieldPath</span>&lt;<span class="title class_">UserFormFields</span>&gt;,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> inputType = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">determineInputType</span>(attribute), [attribute]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Component</span> =</span><br><span class="line">    attribute.<span class="property">multivalued</span> ||</span><br><span class="line">    (<span class="title function_">isMultiValue</span>(value) &amp;&amp; attribute.<span class="property">annotations</span>?.<span class="property">inputType</span> === <span class="literal">undefined</span>)</span><br><span class="line">      ? <span class="variable constant_">FIELDS</span>[<span class="string">&quot;multi-input&quot;</span>]</span><br><span class="line">      : <span class="variable constant_">FIELDS</span>[inputType];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (attribute.<span class="property">name</span> === <span class="string">&quot;locale&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">LocaleSelector</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">form</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">supportedLocales</span>=<span class="string">&#123;supportedLocales&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">currentLocale</span>=<span class="string">&#123;currentLocale&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">t</span>=<span class="string">&#123;t&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">attribute</span>=<span class="string">&#123;attribute&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">t</span>=<span class="string">&#123;t&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">form</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">inputType</span>=<span class="string">&#123;inputType&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">attribute</span>=<span class="string">&#123;attribute&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">renderer</span>=<span class="string">&#123;renderer&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DEFAULT_INPUT_TYPE</span> = <span class="string">&quot;text&quot;</span> <span class="keyword">satisfies</span> <span class="title class_">InputType</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">determineInputType</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span>,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">InputType</span> &#123;</span><br><span class="line">  <span class="comment">// Always treat the root attributes as a text field.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRootAttribute</span>(attribute.<span class="property">name</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;text&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> inputType = attribute.<span class="property">annotations</span>?.<span class="property">inputType</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if we have an valid input type use that to render</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isValidInputType</span>(inputType)) &#123;</span><br><span class="line">    <span class="keyword">return</span> inputType;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// In all other cases use the default</span></span><br><span class="line">  <span class="keyword">return</span> <span class="variable constant_">DEFAULT_INPUT_TYPE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isValidInputType = (<span class="attr">value</span>: <span class="built_in">unknown</span>): value is <span class="title class_">InputType</span> =&gt;</span><br><span class="line">  <span class="keyword">typeof</span> value === <span class="string">&quot;string&quot;</span> &amp;&amp; value <span class="keyword">in</span> <span class="variable constant_">FIELDS</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isMultiValue = (<span class="attr">value</span>: <span class="built_in">unknown</span>): <span class="function"><span class="params">boolean</span> =&gt;</span></span><br><span class="line">  <span class="title class_">Array</span>.<span class="title function_">isArray</span>(value) &amp;&amp; value.<span class="property">length</span> &gt; <span class="number">1</span>;</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">###  src/keycloak-theme/shared/keycloak-ui-shared/user-profile/utils.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserProfileAttributeMetadata</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@keycloak/keycloak-admin-client/lib/defs/userProfileMetadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserRepresentation</span> <span class="keyword">from</span> <span class="string">&quot;@keycloak/keycloak-admin-client/lib/defs/userRepresentation&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TFunction</span> &#125; <span class="keyword">from</span> <span class="string">&quot;i18next&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FieldPath</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-hook-form&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">KeyValueType</span> = &#123; <span class="attr">key</span>: <span class="built_in">string</span>; <span class="attr">value</span>: <span class="built_in">string</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">UserFormFields</span> = <span class="title class_">Omit</span>&lt;</span><br><span class="line">  <span class="title class_">UserRepresentation</span>,</span><br><span class="line">  <span class="string">&quot;attributes&quot;</span> | <span class="string">&quot;userProfileMetadata&quot;</span></span><br><span class="line">&gt; &amp; &#123;</span><br><span class="line">  attributes?: <span class="title class_">KeyValueType</span>[] | <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span> | <span class="built_in">string</span>[]&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FieldError</span> = &#123;</span><br><span class="line">  <span class="attr">field</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">errorMessage</span>: <span class="built_in">string</span>;</span><br><span class="line">  params?: <span class="built_in">string</span>[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ErrorArray</span> = &#123; errors?: <span class="title class_">FieldError</span>[] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">UserProfileError</span> = &#123;</span><br><span class="line">  <span class="attr">responseData</span>: <span class="title class_">ErrorArray</span> | <span class="title class_">FieldError</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isBundleKey</span> = (<span class="params">displayName?: <span class="built_in">string</span></span>) =&gt; displayName?.<span class="title function_">includes</span>(<span class="string">&quot;$&#123;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">unWrap</span> = (<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>) =&gt; key.<span class="title function_">substring</span>(<span class="number">2</span>, key.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">label</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">t</span>: <span class="title class_">TFunction</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">text</span>: <span class="built_in">string</span> | <span class="literal">undefined</span>,</span></span><br><span class="line"><span class="params">  fallback?: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  prefix?: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> value = text || fallback;</span><br><span class="line">  <span class="keyword">const</span> bundleKey = <span class="title function_">isBundleKey</span>(value) ? <span class="title function_">unWrap</span>(value!) : value;</span><br><span class="line">  <span class="keyword">const</span> key = prefix ? <span class="string">`<span class="subst">$&#123;prefix&#125;</span>.<span class="subst">$&#123;bundleKey&#125;</span>`</span> : bundleKey;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">t</span>(key || <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">labelAttribute</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">t</span>: <span class="title class_">TFunction</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">attribute</span>: <span class="title class_">UserProfileAttributeMetadata</span>,</span></span><br><span class="line"><span class="params"></span>) =&gt; <span class="title function_">label</span>(t, attribute.<span class="property">displayName</span>, attribute.<span class="property">name</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ROOT_ATTRIBUTES</span> = [<span class="string">&quot;username&quot;</span>, <span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;email&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isRootAttribute</span> = (<span class="params">attr?: <span class="built_in">string</span></span>) =&gt;</span><br><span class="line">  attr &amp;&amp; <span class="variable constant_">ROOT_ATTRIBUTES</span>.<span class="title function_">includes</span>(attr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">fieldName</span> = (<span class="params">name?: <span class="built_in">string</span></span>) =&gt;</span><br><span class="line">  <span class="string">`<span class="subst">$&#123;isRootAttribute(name) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;attributes.&quot;</span>&#125;</span><span class="subst">$&#123;name?.replaceAll(</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="string">&quot;.&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="string">&quot;ğŸº&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">  )&#125;</span>`</span> <span class="keyword">as</span> <span class="title class_">FieldPath</span>&lt;<span class="title class_">UserFormFields</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> beerify = &lt;T <span class="keyword">extends</span> <span class="built_in">string</span>&gt;<span class="function">(<span class="params"><span class="attr">name</span>: T</span>) =&gt;</span></span><br><span class="line">  name.<span class="title function_">replaceAll</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;ğŸº&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> debeerify = &lt;T <span class="keyword">extends</span> <span class="built_in">string</span>&gt;<span class="function">(<span class="params"><span class="attr">name</span>: T</span>) =&gt;</span></span><br><span class="line">  name.<span class="title function_">replaceAll</span>(<span class="string">&quot;ğŸº&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> setUserProfileServerError&lt;T&gt;(</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">UserProfileError</span>,</span><br><span class="line">  <span class="attr">setError</span>: <span class="function">(<span class="params"><span class="attr">field</span>: keyof T, <span class="attr">params</span>: <span class="built_in">object</span></span>) =&gt;</span> <span class="built_in">void</span>,</span><br><span class="line">  <span class="attr">t</span>: <span class="title class_">TFunction</span>,</span><br><span class="line">) &#123;</span><br><span class="line">  (</span><br><span class="line">    ((error.<span class="property">responseData</span> <span class="keyword">as</span> <span class="title class_">ErrorArray</span>).<span class="property">errors</span> !== <span class="literal">undefined</span></span><br><span class="line">      ? (error.<span class="property">responseData</span> <span class="keyword">as</span> <span class="title class_">ErrorArray</span>).<span class="property">errors</span></span><br><span class="line">      : [error.<span class="property">responseData</span>]) <span class="keyword">as</span> <span class="title class_">FieldError</span>[]</span><br><span class="line">  ).<span class="title function_">forEach</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> params = <span class="title class_">Object</span>.<span class="title function_">assign</span>(</span><br><span class="line">      &#123;&#125;,</span><br><span class="line">      e.<span class="property">params</span>?.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> (<span class="title function_">isBundleKey</span>(p.<span class="title function_">toString</span>()) ? <span class="title function_">t</span>(<span class="title function_">unWrap</span>(p)) : p)),</span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">setError</span>(<span class="title function_">fieldName</span>(e.<span class="property">field</span>) <span class="keyword">as</span> keyof T, &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="title function_">t</span>(</span><br><span class="line">        <span class="title function_">isBundleKey</span>(e.<span class="property">errorMessage</span>) ? <span class="title function_">unWrap</span>(e.<span class="property">errorMessage</span>) : e.<span class="property">errorMessage</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          ...params,</span><br><span class="line">          <span class="attr">defaultValue</span>: e.<span class="property">errorMessage</span> || e.<span class="property">field</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;server&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isRequiredAttribute</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  required,</span></span><br><span class="line"><span class="params">  validators,</span></span><br><span class="line"><span class="params">&#125;: <span class="title class_">UserProfileAttributeMetadata</span></span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">  <span class="comment">// Check if required is true or if the validators include a validation that would make the attribute implicitly required.</span></span><br><span class="line">  <span class="keyword">return</span> required || <span class="title function_">hasRequiredValidators</span>(validators);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Checks whether the given validators include a validation that would make the attribute implicitly required.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hasRequiredValidators</span>(<span class="params"></span></span><br><span class="line"><span class="params">  validators?: <span class="title class_">UserProfileAttributeMetadata</span>[<span class="string">&quot;validators&quot;</span>],</span></span><br><span class="line"><span class="params"></span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">  <span class="comment">// If we don&#x27;t have any validators, the attribute is not required.</span></span><br><span class="line">  <span class="keyword">if</span> (!validators) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the &#x27;length&#x27; validator is defined and has a minimal length greater than zero the attribute is implicitly required.</span></span><br><span class="line">  <span class="comment">// We have to do a lot of defensive coding here, because we don&#x27;t have type information for the validators.</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="string">&quot;length&quot;</span> <span class="keyword">in</span> validators &amp;&amp;</span><br><span class="line">    <span class="string">&quot;min&quot;</span> <span class="keyword">in</span> validators.<span class="property">length</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> validators.<span class="property">length</span>.<span class="property">min</span> === <span class="string">&quot;number&quot;</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> validators.<span class="property">length</span>.<span class="property">min</span> &gt; <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isUserProfileError</span>(<span class="params"><span class="attr">error</span>: <span class="built_in">unknown</span></span>): error is <span class="title class_">UserProfileError</span> &#123;</span><br><span class="line">  <span class="comment">// Check if the error is an object with a &#x27;responseData&#x27; property.</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> error !== <span class="string">&quot;object&quot;</span> ||</span><br><span class="line">    error === <span class="literal">null</span> ||</span><br><span class="line">    !(<span class="string">&quot;responseData&quot;</span> <span class="keyword">in</span> error)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; responseData &#125; = error;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isFieldError</span>(responseData)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check if &#x27;responseData&#x27; is an object with an &#x27;errors&#x27; property that is an array.</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> responseData !== <span class="string">&quot;object&quot;</span> ||</span><br><span class="line">    responseData === <span class="literal">null</span> ||</span><br><span class="line">    !(<span class="string">&quot;errors&quot;</span> <span class="keyword">in</span> responseData) ||</span><br><span class="line">    !<span class="title class_">Array</span>.<span class="title function_">isArray</span>(responseData.<span class="property">errors</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check if all errors are field errors.</span></span><br><span class="line">  <span class="keyword">return</span> responseData.<span class="property">errors</span>.<span class="title function_">every</span>(isFieldError);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isFieldError</span>(<span class="params"><span class="attr">error</span>: <span class="built_in">unknown</span></span>): error is <span class="title class_">FieldError</span> &#123;</span><br><span class="line">  <span class="comment">// Check if the error is an object.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> error !== <span class="string">&quot;object&quot;</span> || error === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check if the error object has a &#x27;field&#x27; property that is a string.</span></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="string">&quot;field&quot;</span> <span class="keyword">in</span> error) || <span class="keyword">typeof</span> error.<span class="property">field</span> !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check if the error object has an &#x27;errorMessage&#x27; property that is a string.</span></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="string">&quot;errorMessage&quot;</span> <span class="keyword">in</span> error) || <span class="keyword">typeof</span> error.<span class="property">errorMessage</span> !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/03/09/Customizing-Keycloak-Themes-with-Keycloakify-and-Tailwind-CSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/09/Customizing-Keycloak-Themes-with-Keycloakify-and-Tailwind-CSS/" class="post-title-link" itemprop="url">Customizing Keycloak Themes with Keycloakify and Tailwind CSS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-09 21:09:42" itemprop="dateCreated datePublished" datetime="2025-03-09T21:09:42-04:00">2025-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/Keycloakify/" itemprop="url" rel="index"><span itemprop="name">Keycloakify</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="What-is-Keycloakify"><a href="#What-is-Keycloakify" class="headerlink" title="What is Keycloakify?"></a>What is Keycloakify?</h2><p>Keycloakify is a library that simplifies the process of creating custom Keycloak themes using modern frontend tools like React and Tailwind CSS. It provides:</p>
<ul>
<li>A set of utility functions (e.g., <code>clsx</code>, <code>kcClsx</code>) to combine Keycloakâ€™s default classes with custom styles.</li>
<li>Predefined classes (e.g., <code>kcLoginClass</code>, <code>kcHeaderClass</code>) to ensure compatibility with Keycloakâ€™s theming system.</li>
<li>Tools to integrate custom themes with Keycloakâ€™s login, registration, and account management pages.</li>
</ul>
<p>Keycloakify is particularly useful for developers who want to use React and Tailwind CSS to create custom Keycloak themes without dealing with Keycloakâ€™s legacy theming system.</p>
<hr>
<h2 id="Keycloakifyâ€™s-kc-Classes"><a href="#Keycloakifyâ€™s-kc-Classes" class="headerlink" title="Keycloakifyâ€™s kc* Classes"></a>Keycloakifyâ€™s <code>kc*</code> Classes</h2><h3 id="Structure-of-kc-Classes"><a href="#Structure-of-kc-Classes" class="headerlink" title="Structure of kc* Classes"></a>Structure of <code>kc*</code> Classes</h3><p>Keycloakify provides a set of predefined classes prefixed with <code>kc*</code> (e.g., <code>kcLoginClass</code>, <code>kcHeaderClass</code>). These classes are designed to:</p>
<ul>
<li>Ensure compatibility with Keycloakâ€™s default theming system.</li>
<li>Provide a base set of styles for common components (e.g., headers, forms, buttons).</li>
<li>Allow developers to extend or override styles using custom CSS or Tailwind CSS.</li>
</ul>
<h3 id="Common-kc-Classes"><a href="#Common-kc-Classes" class="headerlink" title="Common kc* Classes"></a>Common <code>kc*</code> Classes</h3><p>Here are some of the most common <code>kc*</code> classes provided by Keycloakify:</p>
<table>
<thead>
<tr>
<th>Class Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>kcLoginClass</code></td>
<td>Applied to the root container of the login page.</td>
</tr>
<tr>
<td><code>kcHeaderClass</code></td>
<td>Applied to the header section of the login page.</td>
</tr>
<tr>
<td><code>kcFormCardClass</code></td>
<td>Applied to the form container (e.g., login form, registration form).</td>
</tr>
<tr>
<td><code>kcFormHeaderClass</code></td>
<td>Applied to the header of forms (e.g., â€œLogin to Your Accountâ€).</td>
</tr>
<tr>
<td><code>kcFormGroupClass</code></td>
<td>Applied to form groups (e.g., username&#x2F;password fields).</td>
</tr>
<tr>
<td><code>kcAlertClass</code></td>
<td>Applied to alert messages (e.g., error messages, success messages).</td>
</tr>
<tr>
<td><code>kcSignUpClass</code></td>
<td>Applied to the footer section of the login page.</td>
</tr>
</tbody></table>
<hr>
<h2 id="Pros-and-Cons-of-Using-Keycloakify-Classes"><a href="#Pros-and-Cons-of-Using-Keycloakify-Classes" class="headerlink" title="Pros and Cons of Using Keycloakify Classes"></a>Pros and Cons of Using Keycloakify Classes</h2><h3 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h3><ol>
<li><p><strong>Compatibility</strong>:</p>
<ul>
<li>Keycloakifyâ€™s <code>kc*</code> classes ensure compatibility with Keycloakâ€™s default theming system, reducing the risk of layout issues.</li>
</ul>
</li>
<li><p><strong>Quick Start</strong>:</p>
<ul>
<li>Using Keycloakifyâ€™s default classes allows developers to quickly create custom themes without starting from scratch.</li>
</ul>
</li>
<li><p><strong>Consistency</strong>:</p>
<ul>
<li>The predefined classes provide a consistent structure for common components (e.g., headers, forms, buttons).</li>
</ul>
</li>
<li><p><strong>Integration with Keycloak</strong>:</p>
<ul>
<li>Keycloakify handles the integration between custom themes and Keycloakâ€™s theming system, simplifying the deployment process.</li>
</ul>
</li>
</ol>
<h3 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h3><ol>
<li><p><strong>Styling Conflicts</strong>:</p>
<ul>
<li>Keycloakifyâ€™s default classes often come with predefined styles (e.g., padding, margins) that can conflict with custom Tailwind CSS styles.</li>
</ul>
</li>
<li><p><strong>Complexity</strong>:</p>
<ul>
<li>Combining Keycloakifyâ€™s default classes with custom styles can introduce unnecessary complexity, especially when using utility-first frameworks like Tailwind CSS.</li>
</ul>
</li>
<li><p><strong>Limited Flexibility</strong>:</p>
<ul>
<li>Relying on Keycloakifyâ€™s default classes can limit your ability to fully customize the theme, as you may need to override or work around the predefined styles.</li>
</ul>
</li>
<li><p><strong>Performance Overhead</strong>:</p>
<ul>
<li>Including unnecessary default styles can increase the size of your CSS bundle, impacting performance.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="Cleaning-Up-Keycloakify-Classes"><a href="#Cleaning-Up-Keycloakify-Classes" class="headerlink" title="Cleaning Up Keycloakify Classes"></a>Cleaning Up Keycloakify Classes</h2><h3 id="Why-Clean-Up-Keycloakify-Classes"><a href="#Why-Clean-Up-Keycloakify-Classes" class="headerlink" title="Why Clean Up Keycloakify Classes?"></a>Why Clean Up Keycloakify Classes?</h3><p>Keycloakifyâ€™s default classes (e.g., <code>kcLoginClass</code>, <code>kcHeaderClass</code>) are designed to ensure compatibility with Keycloakâ€™s theming system. However, they come with several drawbacks:</p>
<ol>
<li><p><strong>Avoid Styling Conflicts</strong>:</p>
<ul>
<li>Removing Keycloakifyâ€™s default classes eliminates the risk of conflicts with custom Tailwind CSS styles.</li>
</ul>
</li>
<li><p><strong>Simplify the Codebase</strong>:</p>
<ul>
<li>Relying solely on Tailwind CSS makes the codebase cleaner and easier to maintain.</li>
</ul>
</li>
<li><p><strong>Full Control Over Styling</strong>:</p>
<ul>
<li>Using only Tailwind CSS gives you complete control over the themeâ€™s appearance and behavior.</li>
</ul>
</li>
<li><p><strong>Reduce Complexity</strong>:</p>
<ul>
<li>Removing unnecessary classes and functions simplifies the development process.</li>
</ul>
</li>
<li><p><strong>Limited Flexibility</strong>:</p>
<ul>
<li>Relying on Keycloakifyâ€™s default classes limits your ability to fully customize the theme, as you may need to override or work around the predefined styles.</li>
</ul>
</li>
<li><p><strong>Performance Overhead</strong>:</p>
<ul>
<li>Including unnecessary default styles increases the size of your CSS bundle, impacting performance.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="Steps-to-Clean-Up-Keycloakify-Classes"><a href="#Steps-to-Clean-Up-Keycloakify-Classes" class="headerlink" title="Steps to Clean Up Keycloakify Classes"></a>Steps to Clean Up Keycloakify Classes</h3><ol>
<li><strong>Remove <code>clsx</code> and <code>kcClsx</code></strong>:<ul>
<li>Keycloakify provides <code>clsx</code> and <code>kcClsx</code> functions to combine its default classes with custom styles. Since weâ€™re removing the default classes, these functions are no longer needed.</li>
</ul>
</li>
</ol>
<h4 id="Before"><a href="#Before" class="headerlink" title="Before:"></a>Before:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;template-full&quot;</span> className=&#123;<span class="title function_">clsx</span>(<span class="title function_">kcClsx</span>(<span class="string">&quot;kcLoginClass&quot;</span>), <span class="string">&quot;h-screen flex flex-col overflow-hidden&quot;</span>)&#125;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="After"><a href="#After" class="headerlink" title="After:"></a>After:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;template-full&quot;</span> className=<span class="string">&quot;h-screen flex flex-col overflow-hidden bg-gray-700&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>Replace <code>kc*</code> Classes with Tailwind CSS</strong>:<ul>
<li>Replace all instances of <code>clsx(kcClsx(...))</code> with plain Tailwind CSS classes. For example:</li>
</ul>
</li>
</ol>
<h4 id="Before-1"><a href="#Before-1" class="headerlink" title="Before:"></a>Before:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;kc-header&quot;</span> className=&#123;<span class="title function_">clsx</span>(<span class="title function_">kcClsx</span>(<span class="string">&quot;kcHeaderClass&quot;</span>), <span class="string">&quot;bg-blue-700 border-b border-orange-700 h-[3.125rem] flex items-center px-4 fixed top-0 left-0 right-0 z-50 w-full&quot;</span>)&#125;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="After-1"><a href="#After-1" class="headerlink" title="After:"></a>After:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;kc-header&quot;</span> className=<span class="string">&quot;bg-blue-700 border-b border-orange-700 h-[3.125rem] flex items-center px-4 fixed top-0 left-0 right-0 z-50 w-full&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Remove Unnecessary Imports</strong>:<ul>
<li>Remove imports like <code>clsx</code>, <code>getKcClsx</code>, and <code>useSetClassName</code> since they are no longer needed.</li>
</ul>
</li>
</ol>
<h4 id="Before-2"><a href="#Before-2" class="headerlink" title="Before:"></a>Before:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; clsx &#125; <span class="keyword">from</span> <span class="string">&quot;keycloakify/tools/clsx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getKcClsx &#125; <span class="keyword">from</span> <span class="string">&quot;keycloakify/login/lib/kcClsx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSetClassName &#125; <span class="keyword">from</span> <span class="string">&quot;keycloakify/tools/useSetClassName&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="After-2"><a href="#After-2" class="headerlink" title="After:"></a>After:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// These imports are no longer needed</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>Ensure Consistent Styling</strong>:<ul>
<li>Use Tailwind CSS utility classes to define all styles, ensuring consistency and avoiding conflicts. For example:</li>
</ul>
</li>
</ol>
<h4 id="Before-3"><a href="#Before-3" class="headerlink" title="Before:"></a>Before:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;kc-header-wrapper&quot;</span> className=&#123;<span class="title function_">clsx</span>(<span class="title function_">kcClsx</span>(<span class="string">&quot;kcHeaderWrapperClass&quot;</span>), <span class="string">&quot;flex items-center h-full&quot;</span>)&#125;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="After-3"><a href="#After-3" class="headerlink" title="After:"></a>After:</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;kc-header-wrapper&quot;</span> className=<span class="string">&quot;flex items-center h-full&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Example-Fully-Customized-Keycloak-Theme-with-Tailwind-CSS"><a href="#Example-Fully-Customized-Keycloak-Theme-with-Tailwind-CSS" class="headerlink" title="Example: Fully Customized Keycloak Theme with Tailwind CSS"></a>Example: Fully Customized Keycloak Theme with Tailwind CSS</h3><p>Hereâ€™s an example of a fully customized Keycloak theme using only Tailwind CSS:</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; kcSanitize &#125; <span class="keyword">from</span> <span class="string">&quot;keycloakify/lib/kcSanitize&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">TemplateProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;keycloakify/login/TemplateProps&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useInitialize &#125; <span class="keyword">from</span> <span class="string">&quot;keycloakify/login/Template.useInitialize&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; I18n &#125; <span class="keyword">from</span> <span class="string">&quot;./i18n&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">KcContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./KcContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./template.css&quot;</span>; <span class="comment">// Import the CSS file</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logoPngUrl <span class="keyword">from</span> <span class="string">&quot;../../assets/img/logo-s.png&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Template</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">TemplateProps</span>&lt;<span class="title class_">KcContext</span>, I18n&gt;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        displayMessage = <span class="literal">true</span>,</span><br><span class="line">        displayRequiredFields = <span class="literal">false</span>,</span><br><span class="line">        headerNode,</span><br><span class="line">        socialProvidersNode = <span class="literal">null</span>,</span><br><span class="line">        documentTitle,</span><br><span class="line">        kcContext,</span><br><span class="line">        i18n,</span><br><span class="line">        children</span><br><span class="line">    &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; msg, msgStr, currentLanguage, enabledLanguages &#125; = i18n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; realm, auth, url, message, isAppInitiatedAction &#125; = kcContext;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">title</span> = documentTitle ?? <span class="title function_">msgStr</span>(<span class="string">&quot;loginTitle&quot;</span>, kcContext.<span class="property">realm</span>.<span class="property">displayName</span>);</span><br><span class="line">    &#125;, [documentTitle, kcContext.<span class="property">realm</span>.<span class="property">displayName</span>, msgStr]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; isReadyToRender &#125; = <span class="title function_">useInitialize</span>(&#123; kcContext, <span class="attr">doUseDefaultCss</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isReadyToRender) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;template-full&quot;</span> <span class="attr">className</span>=<span class="string">&quot;h-screen flex flex-col overflow-hidden bg-gray-700&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* Header */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-header&quot;</span> <span class="attr">className</span>=<span class="string">&quot;bg-blue-700 border-b border-orange-700 h-[3.125rem] flex items-center px-4 fixed top-0 left-0 right-0 z-50 w-full&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-header-wrapper&quot;</span> <span class="attr">className</span>=<span class="string">&quot;flex items-center h-full&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;logoPngUrl&#125;</span> <span class="attr">width</span>=<span class="string">&#123;40&#125;</span> <span class="attr">height</span>=<span class="string">&#123;40&#125;</span> <span class="attr">className</span>=<span class="string">&quot;mr-2&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;text-white&quot;</span>&gt;</span>&#123;msg(&quot;loginTitleHtml&quot;, realm.displayNameHtml)&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            &#123;/* Main Content */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;template-main-content&quot;</span> <span class="attr">className</span>=<span class="string">&quot;flex-grow mt-[3.125rem] mb-[3.125rem] bg-gray-700&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">header</span> <span class="attr">className</span>=<span class="string">&quot;border-b border-orange-700&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;enabledLanguages.length &gt; 1 &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-locale&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-locale-wrapper&quot;</span> <span class="attr">className</span>=<span class="string">&quot;flex gap-2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                &#123;enabledLanguages</span></span><br><span class="line"><span class="language-xml">                                    .filter((&#123; languageTag &#125;) =&gt; languageTag === &quot;en&quot; || languageTag === &quot;zh-CN&quot;)</span></span><br><span class="line"><span class="language-xml">                                    .map((&#123; languageTag, label, href &#125;) =&gt; (</span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                            <span class="attr">key</span>=<span class="string">&#123;languageTag&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                            <span class="attr">className</span>=<span class="string">&quot;px-3 py-1 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> (window.location.href = href)&#125;</span></span><br><span class="line"><span class="language-xml">                                            aria-label=&#123;label&#125;</span></span><br><span class="line"><span class="language-xml">                                        &gt;</span></span><br><span class="line"><span class="language-xml">                                            &#123;languageTag === &quot;en&quot; ? &quot;ğŸ‡ºğŸ‡¸&quot; : &quot;ğŸ‡¨ğŸ‡³&quot;&#125;</span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    ))&#125;</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    )&#125;</span></span><br><span class="line"><span class="language-xml">                    &#123;(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                        const node = !(auth !== undefined &amp;&amp; auth.showUsername &amp;&amp; !auth.showResetCredentials) ? (</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;kc-page-title&quot;</span>&gt;</span>&#123;headerNode&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        ) : (</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-username&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">id</span>=<span class="string">&quot;kc-attempted-username&quot;</span>&gt;</span>&#123;auth.attemptedUsername&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;reset-login&quot;</span> <span class="attr">href</span>=<span class="string">&#123;url.loginRestartFlowUrl&#125;</span> <span class="attr">aria-label</span>=<span class="string">&#123;msgStr(</span>&quot;<span class="attr">restartLoginTooltip</span>&quot;)&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;kc-login-tooltip&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">className</span>=<span class="string">&quot;kcResetFlowIcon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;kc-tooltip-text&quot;</span>&gt;</span>&#123;msg(&quot;restartLoginTooltip&quot;)&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        );</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                        if (displayRequiredFields) &#123;</span></span><br><span class="line"><span class="language-xml">                            return (</span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;subtitle&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;required&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        &#123;msg(&quot;requiredFields&quot;)&#125;</span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;node&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            );</span></span><br><span class="line"><span class="language-xml">                        &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                        return node;</span></span><br><span class="line"><span class="language-xml">                    &#125;)()&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                &#123;/* Content */&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-content&quot;</span> <span class="attr">className</span>=<span class="string">&quot;border-b border-orange-700&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-content-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        &#123;displayMessage &amp;&amp; message !== undefined &amp;&amp; (message.type !== &quot;warning&quot; || !isAppInitiatedAction) &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>`<span class="attr">alert-</span>$&#123;<span class="attr">message.type</span>&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;pf-c-alert__icon&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    &#123;message.type === &quot;success&quot; &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;kcFeedbackSuccessIcon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">                                    &#123;message.type === &quot;warning&quot; &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;kcFeedbackWarningIcon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">                                    &#123;message.type === &quot;error&quot; &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;kcFeedbackErrorIcon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">                                    &#123;message.type === &quot;info&quot; &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;kcFeedbackInfoIcon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                    <span class="attr">className</span>=<span class="string">&quot;kcAlertTitleClass&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                    <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                        <span class="attr">__html:</span> <span class="attr">kcSanitize</span>(<span class="attr">message.summary</span>)</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                /&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        )&#125;</span></span><br><span class="line"><span class="language-xml">                        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">                        &#123;auth !== undefined &amp;&amp; auth.showTryAnotherWayLink &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;kc-select-try-another-way-form&quot;</span> <span class="attr">action</span>=<span class="string">&#123;url.loginAction&#125;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;tryAnotherWay&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">a</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                        <span class="attr">href</span>=<span class="string">&quot;#&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                        <span class="attr">id</span>=<span class="string">&quot;try-another-way&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                                        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                                            document.forms[&quot;kc-select-try-another-way-form&quot; as never].submit();</span></span><br><span class="line"><span class="language-xml">                                            return false;</span></span><br><span class="line"><span class="language-xml">                                        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">                                    &gt;</span></span><br><span class="line"><span class="language-xml">                                        &#123;msg(&quot;doTryAnotherWay&quot;)&#125;</span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        )&#125;</span></span><br><span class="line"><span class="language-xml">                        &#123;socialProvidersNode&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            &#123;/* Footer */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-footer&quot;</span> <span class="attr">className</span>=<span class="string">&quot;bg-blue-700 border-t border-orange-700 h-[3.125rem] flex items-center justify-center fixed bottom-0 left-0 right-0 z-50&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;text-white&quot;</span>&gt;</span>Â© 2025 WhereQ Inc. All rights reserved.<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Again-benefits-of-Using-Tailwind-CSS-Exclusively"><a href="#Again-benefits-of-Using-Tailwind-CSS-Exclusively" class="headerlink" title="Again, benefits of Using Tailwind CSS Exclusively"></a>Again, benefits of Using Tailwind CSS Exclusively</h2><ol>
<li><p><strong>No Styling Conflicts</strong>:</p>
<ul>
<li>By removing Keycloakifyâ€™s default classes, you eliminate the risk of conflicts with custom Tailwind CSS styles.</li>
</ul>
</li>
<li><p><strong>Full Control Over Styling</strong>:</p>
<ul>
<li>Using only Tailwind CSS gives you complete control over the themeâ€™s appearance and behavior.</li>
</ul>
</li>
<li><p><strong>Simplified Codebase</strong>:</p>
<ul>
<li>The code is cleaner and easier to maintain, with no reliance on Keycloakifyâ€™s default theming system.</li>
</ul>
</li>
<li><p><strong>Improved Performance</strong>:</p>
<ul>
<li>Removing unnecessary default styles reduces the size of your CSS bundle, improving performance.</li>
</ul>
</li>
</ol>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/03/09/Customize-kc-css-classes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/09/Customize-kc-css-classes/" class="post-title-link" itemprop="url">Customize kc-* css classes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-09 13:39:10" itemprop="dateCreated datePublished" datetime="2025-03-09T13:39:10-04:00">2025-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Keycloak/Keycloakify/" itemprop="url" rel="index"><span itemprop="name">Keycloakify</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Summary-of-the-Debugging-Process-and-Solutions-about-Customzing-Template-tsx"><a href="#Summary-of-the-Debugging-Process-and-Solutions-about-Customzing-Template-tsx" class="headerlink" title="Summary of the Debugging Process, and Solutions about Customzing Template.tsx"></a>Summary of the Debugging Process, and Solutions about Customzing Template.tsx</h3><p><img src="/images/Customize-kc-css-classes/kc-header-wrapper-customization.png" alt="Customize kc-header-wrapper clss"></p>
<p>In this case, the issue stemmed from the <code>kc-header-wrapper</code> class, which is part of Keycloakâ€™s original default theme (<code>login.css</code>). This class had predefined styles (e.g., <code>padding</code>, <code>line-height</code>, <code>font-size</code>, etc.) that were overriding the Tailwind CSS styles applied via inline classes in the React component. The <code>kc-</code> prefixed classes are part of Keycloakâ€™s default theme, and customizing them with Tailwind CSS can be challenging because Tailwindâ€™s utility classes are often overridden by these predefined styles.</p>
<h4 id="Debugging-Process"><a href="#Debugging-Process" class="headerlink" title="Debugging Process:"></a>Debugging Process:</h4><ol>
<li><p><strong>Initial Observation</strong>:</p>
<ul>
<li>The <code>kc-header-wrapper</code> was exceeding the height of its parent (<code>kc-header</code>), causing layout issues.</li>
<li>The <code>h-full</code> Tailwind class was not working as expected.</li>
</ul>
</li>
<li><p><strong>Root Cause Identification</strong>:</p>
<ul>
<li>The <code>kc-header-wrapper</code> class from Keycloakâ€™s <code>login.css</code> was overriding the Tailwind styles with its own <code>padding</code>, <code>line-height</code>, and other properties.</li>
</ul>
</li>
<li><p><strong>Attempted Fixes</strong>:</p>
<ul>
<li>Initially, Tailwind CSS classes like <code>p-0</code>, <code>m-0</code>, and <code>h-full</code> were used inline, but they were ineffective due to the higher specificity of the <code>login.css</code> styles.</li>
<li>The <code>!important</code> rule was considered to force override the styles.</li>
</ul>
</li>
<li><p><strong>Final Solution</strong>:</p>
<ul>
<li>A separate CSS file (<code>template.css</code>) was created to reset the problematic properties of <code>#kc-header-wrapper</code> using <code>!important</code>. This ensured that the styles from <code>login.css</code> were overridden.</li>
<li>The <code>template.css</code> file was imported into the <code>Template.tsx</code> component to apply the reset styles.</li>
</ul>
</li>
</ol>
<h4 id="Final-Solution-Code"><a href="#Final-Solution-Code" class="headerlink" title="Final Solution Code:"></a>Final Solution Code:</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* template.css */</span></span><br><span class="line"><span class="selector-id">#kc-header-wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: normal <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: inherit <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">text-transform</span>: none <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">letter-spacing</span>: normal <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">white-space</span>: normal <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">/* Header */</span>&#125;</span><br><span class="line">&lt;div id=<span class="string">&quot;kc-header&quot;</span> className=&#123;<span class="title function_">clsx</span>(<span class="title function_">kcClsx</span>(<span class="string">&quot;kcHeaderClass&quot;</span>), <span class="string">&quot;bg-blue-700 border-b border-orange-700 h-[3.125rem] flex items-center px-4 fixed top-0 left-0 right-0 z-50 w-full&quot;</span>)&#125;&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;kc-header-wrapper&quot;</span> <span class="attr">className</span>=<span class="string">&#123;clsx(kcClsx(</span>&quot;<span class="attr">kcHeaderWrapperClass</span>&quot;), &quot;<span class="attr">flex</span> <span class="attr">items-center</span> <span class="attr">h-full</span>&quot;)&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;logoPngUrl&#125;</span> <span class="attr">width</span>=<span class="string">&#123;40&#125;</span> <span class="attr">height</span>=<span class="string">&#123;40&#125;</span> <span class="attr">className</span>=<span class="string">&quot;mr-2&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;msg(&quot;loginTitleHtml&quot;, realm.displayNameHtml)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Alternatives"><a href="#Alternatives" class="headerlink" title="Alternatives:"></a>Alternatives:</h4><ol>
<li><p><strong>Inline Styles</strong>:</p>
<ul>
<li>As a temporary debugging measure, inline styles can be used to override the <code>login.css</code> styles:<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;kc-header-wrapper&quot;</span> style=&#123;&#123; <span class="attr">padding</span>: <span class="number">0</span>, <span class="attr">margin</span>: <span class="number">0</span>, <span class="attr">lineHeight</span>: <span class="string">&quot;normal&quot;</span>, <span class="attr">fontSize</span>: <span class="string">&quot;inherit&quot;</span>, <span class="attr">textTransform</span>: <span class="string">&quot;none&quot;</span>, <span class="attr">letterSpacing</span>: <span class="string">&quot;normal&quot;</span>, <span class="attr">whiteSpace</span>: <span class="string">&quot;normal&quot;</span> &#125;&#125;&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;logoPngUrl&#125;</span> <span class="attr">width</span>=<span class="string">&#123;40&#125;</span> <span class="attr">height</span>=<span class="string">&#123;40&#125;</span> <span class="attr">className</span>=<span class="string">&quot;mr-2&quot;</span> /&gt;</span></span></span><br><span class="line">    &#123;<span class="title function_">msg</span>(<span class="string">&quot;loginTitleHtml&quot;</span>, realm.<span class="property">displayNameHtml</span>)&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Tailwind <code>!important</code> Utility</strong>:</p>
<ul>
<li>Tailwind CSS supports the <code>!important</code> utility (e.g., <code>p-0!</code>), but this may not always work due to specificity issues with Keycloakâ€™s default styles.</li>
</ul>
</li>
<li><p><strong>Custom CSS File</strong>:</p>
<ul>
<li>The most robust solution is to use a separate CSS file to reset or override the <code>kc-</code> prefixed classes, as shown in the final solution.</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
