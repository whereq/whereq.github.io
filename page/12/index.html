<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="WhereQ">
<meta property="og:url" content="https://www.whereq.com/page/12/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Dazhi Zhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/page/12/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/12/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">WhereQ</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">146</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">130</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">85</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/26/Deep-Dive-Comparing-Spring-REST-Clients-with-Spring-Cloud-OpenFeign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/26/Deep-Dive-Comparing-Spring-REST-Clients-with-Spring-Cloud-OpenFeign/" class="post-title-link" itemprop="url">Deep Dive: Comparing Spring REST Clients with Spring Cloud OpenFeign</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-26 19:42:35" itemprop="dateCreated datePublished" datetime="2024-10-26T19:42:35-04:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#overview-of-spring-rest-clients">Overview of Spring REST Clients</a></li>
<li><a href="#overview-of-spring-cloud-openfeign">Overview of Spring Cloud OpenFeign</a></li>
<li><a href="#key-differences">Key Differences</a></li>
<li><a href="#why-spring-rest-clients-are-replacing-openfeign">Why Spring REST Clients are Replacing OpenFeign</a></li>
<li><a href="#sample-code-comparison">Sample Code Comparison</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the realm of microservices and RESTful APIs, efficient and maintainable client-side HTTP communication is crucial. Spring provides two prominent solutions for this: Spring REST Clients and Spring Cloud OpenFeign. This article delves into a detailed comparison of these two approaches, highlighting their key differences and discussing why Spring REST Clients are increasingly replacing OpenFeign in modern applications.</p>
<p><a name="overview-of-spring-rest-clients"></a></p>
<h2 id="Overview-of-Spring-REST-Clients"><a href="#Overview-of-Spring-REST-Clients" class="headerlink" title="Overview of Spring REST Clients"></a>Overview of Spring REST Clients</h2><h3 id="What-is-Spring-REST-Clients"><a href="#What-is-Spring-REST-Clients" class="headerlink" title="What is Spring REST Clients?"></a>What is Spring REST Clients?</h3><p>Spring REST Clients, introduced in Spring 5, is a set of tools and libraries that facilitate HTTP client-side communication. It includes <code>RestTemplate</code> and <code>WebClient</code>, both of which are designed to simplify the process of making HTTP requests and handling responses.</p>
<h3 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features"></a>Key Features</h3><ul>
<li><strong>RestTemplate</strong>: A synchronous client that provides a simple, template method API over underlying HTTP client libraries.</li>
<li><strong>WebClient</strong>: A reactive, non-blocking client introduced in Spring 5, suitable for modern, asynchronous applications.</li>
<li><strong>Integration with Spring WebFlux</strong>: WebClient is part of the Spring WebFlux framework, making it ideal for reactive programming.</li>
<li><strong>Flexibility</strong>: Supports both synchronous and asynchronous operations.</li>
</ul>
<p><a name="overview-of-spring-cloud-openfeign"></a></p>
<h2 id="Overview-of-Spring-Cloud-OpenFeign"><a href="#Overview-of-Spring-Cloud-OpenFeign" class="headerlink" title="Overview of Spring Cloud OpenFeign"></a>Overview of Spring Cloud OpenFeign</h2><h3 id="What-is-Spring-Cloud-OpenFeign"><a href="#What-is-Spring-Cloud-OpenFeign" class="headerlink" title="What is Spring Cloud OpenFeign?"></a>What is Spring Cloud OpenFeign?</h3><p>Spring Cloud OpenFeign is a declarative HTTP client that simplifies the process of consuming RESTful services. It allows you to define interfaces with annotations to describe the REST API you want to consume, handling the HTTP requests and responses automatically.</p>
<h3 id="Key-Features-1"><a href="#Key-Features-1" class="headerlink" title="Key Features"></a>Key Features</h3><ul>
<li><strong>Declarative REST Client</strong>: Define interfaces with annotations to describe the REST API.</li>
<li><strong>Integration with Spring Boot</strong>: Automatically integrates with Spring Boot’s dependency injection and configuration mechanisms.</li>
<li><strong>Load Balancing</strong>: Integrates with Spring Cloud LoadBalancer for client-side load balancing.</li>
<li><strong>Error Handling</strong>: Provides mechanisms to handle errors and exceptions gracefully.</li>
<li><strong>Interceptors</strong>: Allows adding custom interceptors to modify requests and responses.</li>
</ul>
<p><a name="key-differences"></a></p>
<h2 id="Key-Differences"><a href="#Key-Differences" class="headerlink" title="Key Differences"></a>Key Differences</h2><h3 id="1-Programming-Model"><a href="#1-Programming-Model" class="headerlink" title="1. Programming Model"></a>1. <strong>Programming Model</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: Offers both synchronous (<code>RestTemplate</code>) and reactive (<code>WebClient</code>) models, providing flexibility based on the application’s needs.</li>
<li><strong>OpenFeign</strong>: Primarily declarative, focusing on defining interfaces with annotations for HTTP communication.</li>
</ul>
<h3 id="2-Reactive-Support"><a href="#2-Reactive-Support" class="headerlink" title="2. Reactive Support"></a>2. <strong>Reactive Support</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: WebClient provides full support for reactive programming, making it suitable for modern, asynchronous applications.</li>
<li><strong>OpenFeign</strong>: Limited reactive support; primarily designed for synchronous communication.</li>
</ul>
<h3 id="3-Integration-and-Ecosystem"><a href="#3-Integration-and-Ecosystem" class="headerlink" title="3. Integration and Ecosystem"></a>3. <strong>Integration and Ecosystem</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: Deeply integrated with the Spring ecosystem, including Spring WebFlux and Spring Boot.</li>
<li><strong>OpenFeign</strong>: Integrates well with Spring Cloud, providing additional features like load balancing and service discovery.</li>
</ul>
<h3 id="4-Error-Handling-and-Customization"><a href="#4-Error-Handling-and-Customization" class="headerlink" title="4. Error Handling and Customization"></a>4. <strong>Error Handling and Customization</strong></h3><ul>
<li><strong>Spring REST Clients</strong>: Provides robust error handling and customization options through exception handling and interceptors.</li>
<li><strong>OpenFeign</strong>: Offers error handling through custom error decoders and interceptors, but with a more declarative approach.</li>
</ul>
<p><a name="why-spring-rest-clients-are-replacing-openfeign"></a></p>
<h2 id="Why-Spring-REST-Clients-are-Replacing-OpenFeign"><a href="#Why-Spring-REST-Clients-are-Replacing-OpenFeign" class="headerlink" title="Why Spring REST Clients are Replacing OpenFeign"></a>Why Spring REST Clients are Replacing OpenFeign</h2><h3 id="1-Reactive-Programming"><a href="#1-Reactive-Programming" class="headerlink" title="1. Reactive Programming"></a>1. <strong>Reactive Programming</strong></h3><p>With the rise of reactive programming and the need for non-blocking, asynchronous communication, <code>WebClient</code> has become the preferred choice over <code>RestTemplate</code> and OpenFeign. WebClient’s reactive nature aligns well with modern application architectures.</p>
<h3 id="2-Flexibility-and-Control"><a href="#2-Flexibility-and-Control" class="headerlink" title="2. Flexibility and Control"></a>2. <strong>Flexibility and Control</strong></h3><p>Spring REST Clients provide more flexibility and control over HTTP communication. Developers can choose between synchronous and asynchronous models based on their specific requirements, whereas OpenFeign is more opinionated and less flexible.</p>
<h3 id="3-Ecosystem-Integration"><a href="#3-Ecosystem-Integration" class="headerlink" title="3. Ecosystem Integration"></a>3. <strong>Ecosystem Integration</strong></h3><p>Spring REST Clients are deeply integrated with the broader Spring ecosystem, including Spring WebFlux and Spring Boot. This integration provides a seamless development experience and leverages the full capabilities of the Spring framework.</p>
<h3 id="4-Community-and-Support"><a href="#4-Community-and-Support" class="headerlink" title="4. Community and Support"></a>4. <strong>Community and Support</strong></h3><p>As part of the core Spring framework, Spring REST Clients benefit from continuous updates, improvements, and community support. OpenFeign, while powerful, is part of the Spring Cloud ecosystem and may not receive the same level of attention and updates.</p>
<p><a name="sample-code-comparison"></a></p>
<h2 id="Sample-Code-Comparison"><a href="#Sample-Code-Comparison" class="headerlink" title="Sample Code Comparison"></a>Sample Code Comparison</h2><h3 id="Using-Spring-REST-Clients-WebClient"><a href="#Using-Spring-REST-Clients-WebClient" class="headerlink" title="Using Spring REST Clients (WebClient)"></a>Using Spring REST Clients (<code>WebClient</code>)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProductServiceClient</span><span class="params">(WebClient.Builder webClientBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClient = webClientBuilder.baseUrl(<span class="string">&quot;http://localhost:8081&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Product&gt; <span class="title function_">getProduct</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.get()</span><br><span class="line">                        .uri(<span class="string">&quot;/products/&#123;productId&#125;&quot;</span>, productId)</span><br><span class="line">                        .retrieve()</span><br><span class="line">                        .bodyToMono(Product.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Spring-Cloud-OpenFeign"><a href="#Using-Spring-Cloud-OpenFeign" class="headerlink" title="Using Spring Cloud OpenFeign"></a>Using Spring Cloud OpenFeign</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;product-service&quot;, url = &quot;http://localhost:8081&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/products/&#123;productId&#125;&quot;)</span></span><br><span class="line">    Product <span class="title function_">getProduct</span><span class="params">(<span class="meta">@PathVariable(&quot;productId&quot;)</span> Long productId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>While Spring Cloud OpenFeign offers a declarative and simplified approach to HTTP client communication, Spring REST Clients provide more flexibility, reactive support, and deep integration with the Spring ecosystem. As modern applications increasingly adopt reactive programming and require more control over HTTP communication, Spring REST Clients, particularly <code>WebClient</code>, are becoming the preferred choice over OpenFeign. By understanding the key differences and advantages of each approach, developers can make informed decisions to build robust and scalable microservices architectures.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-openfeign">https://spring.io/projects/spring-cloud-openfeign</a><br><strong>Warning:</strong> As announced in <a target="_blank" rel="noopener" href="https://spring.io/blog/2022/12/16/spring-cloud-2022-0-0-codename-kilburn-has-been-released#spring-cloud-openfeign-feature-complete-announcement">Spring Cloud 2022.0.0 release blog entry</a>, Spring Cloud OpenFeign is now considered feature-complete. We will only be focusing on bug fixes and potentially merging small community feature pull requests. We recommend migrating to <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-http-interface">Spring Interface Clients</a> instead.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/26/Deep-Dive-into-Spring-Cloud-OpenFeign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/26/Deep-Dive-into-Spring-Cloud-OpenFeign/" class="post-title-link" itemprop="url">Deep Dive into Spring Cloud OpenFeign --- Deprecated</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-26 19:29:33" itemprop="dateCreated datePublished" datetime="2024-10-26T19:29:33-04:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/Spring-Cloud/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/Spring-Cloud/Deprecated/" itemprop="url" rel="index"><span itemprop="name">Deprecated</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#key-features">Key Features</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#real-production-use-case">Real Production Use Case</a></li>
<li><a href="#sample-code">Sample Code</a></li>
<li><a href="#deployment-and-usage">Deployment and Usage</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr>
<h1 id="Deep-Dive-into-Spring-Cloud-OpenFeign"><a href="#Deep-Dive-into-Spring-Cloud-OpenFeign" class="headerlink" title="Deep Dive into Spring Cloud OpenFeign"></a>Deep Dive into Spring Cloud OpenFeign</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Spring Cloud OpenFeign is a declarative HTTP client that simplifies the process of consuming RESTful services in Spring Boot applications. It integrates seamlessly with Spring’s dependency injection and configuration mechanisms, making it a powerful tool for microservices architectures. This article provides a deep dive into Spring Cloud OpenFeign, including a real production use case, sample code, and deployment strategies.</p>
<p><a name="key-features"></a></p>
<h2 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features"></a>Key Features</h2><ul>
<li><strong>Declarative REST Client</strong>: Define interfaces with annotations to describe the REST API you want to consume.</li>
<li><strong>Integration with Spring Boot</strong>: Automatically integrates with Spring Boot’s dependency injection and configuration mechanisms.</li>
<li><strong>Load Balancing</strong>: Integrates with Spring Cloud LoadBalancer for client-side load balancing.</li>
<li><strong>Error Handling</strong>: Provides mechanisms to handle errors and exceptions gracefully.</li>
<li><strong>Interceptors</strong>: Allows adding custom interceptors to modify requests and responses.</li>
</ul>
<p><a name="getting-started"></a></p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><p>To use Spring Cloud OpenFeign in your Spring Boot project, add the following dependency to your <code>pom.xml</code> (for Maven) or <code>build.gradle</code> (for Gradle):</p>
<p><strong>Maven:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Gradle:</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.springframework.cloud:spring-cloud-starter-openfeign&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Enable Feign in your Spring Boot application by adding the <code>@EnableFeignClients</code> annotation to your main application class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="real-production-use-case"></a></p>
<h2 id="Real-Production-Use-Case"><a href="#Real-Production-Use-Case" class="headerlink" title="Real Production Use Case"></a>Real Production Use Case</h2><h3 id="Scenario-Microservices-Communication-in-an-E-commerce-Platform"><a href="#Scenario-Microservices-Communication-in-an-E-commerce-Platform" class="headerlink" title="Scenario: Microservices Communication in an E-commerce Platform"></a>Scenario: Microservices Communication in an E-commerce Platform</h3><p>In an e-commerce platform, multiple microservices interact to handle various functionalities such as product catalog, user management, and order processing. OpenFeign is used to facilitate communication between these services.</p>
<h4 id="Example-Order-Service-Communicating-with-Product-Service"><a href="#Example-Order-Service-Communicating-with-Product-Service" class="headerlink" title="Example: Order Service Communicating with Product Service"></a>Example: Order Service Communicating with Product Service</h4><p>The Order Service needs to retrieve product details from the Product Service to process orders. OpenFeign simplifies this communication by allowing the Order Service to define a Feign client for the Product Service.</p>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Define-the-Feign-Client"><a href="#Define-the-Feign-Client" class="headerlink" title="Define the Feign Client"></a>Define the Feign Client</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;product-service&quot;, url = &quot;http://localhost:8081&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/products/&#123;productId&#125;&quot;)</span></span><br><span class="line">    Product <span class="title function_">getProduct</span><span class="params">(<span class="meta">@PathVariable(&quot;productId&quot;)</span> Long productId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Product-Class"><a href="#Product-Class" class="headerlink" title="Product Class"></a>Product Class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-the-Feign-Client-in-the-Order-Service"><a href="#Using-the-Feign-Client-in-the-Order-Service" class="headerlink" title="Using the Feign Client in the Order Service"></a>Using the Feign Client in the Order Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductServiceClient productServiceClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productServiceClient.getProduct(productId);</span><br><span class="line">        <span class="comment">// Process the order using the product details</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="deployment-and-usage"></a></p>
<h2 id="Deployment-and-Usage"><a href="#Deployment-and-Usage" class="headerlink" title="Deployment and Usage"></a>Deployment and Usage</h2><h3 id="Deployment-Strategy"><a href="#Deployment-Strategy" class="headerlink" title="Deployment Strategy"></a>Deployment Strategy</h3><ol>
<li><strong>Containerization</strong>: Use Docker to containerize your Spring Boot applications.</li>
<li><strong>Orchestration</strong>: Deploy your containers using Kubernetes for orchestration.</li>
<li><strong>Service Discovery</strong>: Integrate with a service discovery tool like Eureka or Consul.</li>
</ol>
<h3 id="Example-Deployment-with-Kubernetes"><a href="#Example-Deployment-with-Kubernetes" class="headerlink" title="Example Deployment with Kubernetes"></a>Example Deployment with Kubernetes</h3><h4 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/myapp.jar /myapp.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/myapp.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h4 id="Kubernetes-Deployment-YAML"><a href="#Kubernetes-Deployment-YAML" class="headerlink" title="Kubernetes Deployment YAML"></a>Kubernetes Deployment YAML</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">order-service</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h3 id="Usage-in-Production"><a href="#Usage-in-Production" class="headerlink" title="Usage in Production"></a>Usage in Production</h3><ol>
<li><strong>Monitoring</strong>: Use tools like Prometheus and Grafana to monitor your services.</li>
<li><strong>Logging</strong>: Implement centralized logging with ELK (Elasticsearch, Logstash, Kibana) stack.</li>
<li><strong>Security</strong>: Ensure secure communication using HTTPS and OAuth2 for authentication.</li>
</ol>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Spring Cloud OpenFeign is a powerful tool for building declarative HTTP clients in Spring Boot applications. Its integration with the Spring ecosystem, combined with active development and community support, makes it a reliable choice for microservices architectures. By following the steps outlined in this article, you can effectively use OpenFeign in your production environment, facilitating seamless communication between microservices.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIII-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIII-2/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XIII-2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 23:43:33" itemprop="dateCreated datePublished" datetime="2024-10-24T23:43:33-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Spring-Cloud/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Spring-Cloud/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Spring-Cloud/Reactive/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#deep-dive-integrating-spring-webflux-with-microservices-architecture">Deep Dive: Integrating Spring WebFlux with Microservices Architecture</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#microservices-architecture-overview">Microservices Architecture Overview</a></li>
<li><a href="#integrating-spring-webflux-with-microservices">Integrating Spring WebFlux with Microservices</a></li>
<li><a href="#using-spring-cloud">Using Spring Cloud</a></li>
<li><a href="#service-registration-and-discovery">Service Registration and Discovery</a><ul>
<li><a href="#adding-dependencies">Adding Dependencies</a></li>
<li><a href="#configuring-service-registration-and-discovery">Configuring Service Registration and Discovery</a></li>
<li><a href="#annotating-the-main-class">Annotating the Main Class</a></li>
</ul>
</li>
<li><a href="#api-gateway">API Gateway</a><ul>
<li><a href="#adding-dependencies-1">Adding Dependencies</a></li>
<li><a href="#configuring-gateway-routes">Configuring Gateway Routes</a></li>
</ul>
</li>
<li><a href="#client-side-load-balancing">Client-Side Load Balancing</a><ul>
<li><a href="#adding-dependencies-2">Adding Dependencies</a></li>
<li><a href="#configuring-load-balancer">Configuring Load Balancer</a></li>
<li><a href="#using-load-balancer">Using Load Balancer</a></li>
</ul>
</li>
<li><a href="#circuit-breaker">Circuit Breaker</a><ul>
<li><a href="#adding-dependencies-3">Adding Dependencies</a></li>
<li><a href="#configuring-circuit-breaker">Configuring Circuit Breaker</a></li>
<li><a href="#using-circuit-breaker">Using Circuit Breaker</a></li>
<li><a href="#diagram">Diagram</a></li>
<li><a href="#real-life-production-use-cases">Real-Life Production Use Cases</a><ul>
<li><a href="#use-case-1-e-commerce-platform">Use Case 1: E-commerce Platform</a></li>
<li><a href="#example-order-service-communicating-with-product-service">Example: Order Service Communicating with Product Service</a></li>
<li><a href="#use-case-2-financial-services">Use Case 2: Financial Services</a></li>
<li><a href="#example-transaction-service-with-circuit-breaker">Example: Transaction Service with Circuit Breaker</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sample-code">Sample Code</a><ul>
<li><a href="#service-registration-and-discovery-1">Service Registration and Discovery</a></li>
<li><a href="#api-gateway-1">API Gateway</a></li>
<li><a href="#client-side-load-balancing-1">Client-Side Load Balancing</a></li>
<li><a href="#using-webclient-to-call-different-services">Using <code>WebClient</code> to Call Different Services</a></li>
<li><a href="#circuit-breaker-1">Circuit Breaker</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Deep-Dive-Integrating-Spring-WebFlux-with-Microservices-Architecture"><a href="#Deep-Dive-Integrating-Spring-WebFlux-with-Microservices-Architecture" class="headerlink" title="Deep Dive: Integrating Spring WebFlux with Microservices Architecture"></a>Deep Dive: Integrating Spring WebFlux with Microservices Architecture</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the previous articles, we have delved into the foundational concepts of Spring WebFlux, Reactor, error handling, data stream transformations, reactive database access, performance optimization, security, testing, deployment and operations, as well as best practices and common pitfalls. This article will focus on integrating Spring WebFlux with microservices architecture to build high-performance, scalable distributed systems.</p>
<p><a name="microservices-architecture-overview"></a></p>
<h2 id="Microservices-Architecture-Overview"><a href="#Microservices-Architecture-Overview" class="headerlink" title="Microservices Architecture Overview"></a>Microservices Architecture Overview</h2><p>Microservices architecture is an approach that breaks down an application into a set of small, independently deployable services, each running in its own process and communicating through lightweight mechanisms, typically HTTP or message queues. The benefits of microservices architecture include:</p>
<ul>
<li><strong>Independent Deployment</strong>: Each service can be deployed and updated independently, reducing system downtime.</li>
<li><strong>Scalability</strong>: Services can be scaled independently, improving resource utilization.</li>
<li><strong>Technological Diversity</strong>: Different services can use the most suitable technology stacks, increasing flexibility in technology choices.</li>
</ul>
<p><a name="integrating-spring-webflux-with-microservices"></a></p>
<h2 id="Integrating-Spring-WebFlux-with-Microservices"><a href="#Integrating-Spring-WebFlux-with-Microservices" class="headerlink" title="Integrating Spring WebFlux with Microservices"></a>Integrating Spring WebFlux with Microservices</h2><p>Spring WebFlux, as a reactive web framework within the Spring ecosystem, is well-suited for building high-concurrency, low-latency microservices. Here are some key points for integrating Spring WebFlux with microservices.</p>
<p><a name="using-spring-cloud"></a></p>
<h2 id="Using-Spring-Cloud"><a href="#Using-Spring-Cloud" class="headerlink" title="Using Spring Cloud"></a>Using Spring Cloud</h2><p>Spring Cloud provides a set of tools to simplify development and management in distributed systems, particularly in microservices architectures based on Spring Boot. Key components include:</p>
<ul>
<li><strong>Spring Cloud Kubernetes</strong>: Integrates with Kubernetes for service registration and discovery, configuration, and more.</li>
<li><strong>Spring Cloud Gateway</strong>: An API gateway built on Spring WebFlux, offering dynamic routing, monitoring, and rate limiting.</li>
<li><strong>Spring Cloud Config</strong>: Provides centralized configuration management for distributed systems.</li>
</ul>
<p><a name="service-registration-and-discovery"></a></p>
<h2 id="Service-Registration-and-Discovery"><a href="#Service-Registration-and-Discovery" class="headerlink" title="Service Registration and Discovery"></a>Service Registration and Discovery</h2><p>Service registration and discovery are crucial components in microservices architecture, allowing services to dynamically register themselves and discover other services. Spring Cloud Kubernetes integrates with Kubernetes’ native service discovery mechanisms.</p>
<h3 id="Adding-Dependencies"><a href="#Adding-Dependencies" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud Kubernetes dependencies to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Service-Registration-and-Discovery"><a href="#Configuring-Service-Registration-and-Discovery" class="headerlink" title="Configuring Service Registration and Discovery"></a>Configuring Service Registration and Discovery</h3><p>Configure service registration and discovery in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">spring.cloud.kubernetes.discovery.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="Annotating-the-Main-Class"><a href="#Annotating-the-Main-Class" class="headerlink" title="Annotating the Main Class"></a>Annotating the Main Class</h3><p>Annotate your Spring Boot main class with <code>@EnableDiscoveryClient</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="api-gateway"></a></p>
<h2 id="API-Gateway"><a href="#API-Gateway" class="headerlink" title="API Gateway"></a>API Gateway</h2><p>An API gateway is another critical component in microservices architecture, handling all external requests and routing them to the appropriate services. Spring Cloud Gateway is an API gateway built on Spring WebFlux.</p>
<h3 id="Adding-Dependencies-1"><a href="#Adding-Dependencies-1" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud Gateway dependency to your gateway service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Gateway-Routes"><a href="#Configuring-Gateway-Routes" class="headerlink" title="Configuring Gateway Routes"></a>Configuring Gateway Routes</h3><p>Configure routes in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.gateway.routes[0].id</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].uri</span>=<span class="string">lb://book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].predicates[0]</span>=<span class="string">Path=/books/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].id</span>=<span class="string">user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].uri</span>=<span class="string">lb://user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].predicates[0]</span>=<span class="string">Path=/users/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].id</span>=<span class="string">order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].uri</span>=<span class="string">lb://order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].predicates[0]</span>=<span class="string">Path=/orders/**</span></span><br></pre></td></tr></table></figure>

<p><a name="client-side-load-balancing"></a></p>
<h2 id="Client-Side-Load-Balancing"><a href="#Client-Side-Load-Balancing" class="headerlink" title="Client-Side Load Balancing"></a>Client-Side Load Balancing</h2><p>Spring Cloud provides client-side load balancing through Spring Cloud LoadBalancer, which allows services to distribute requests across multiple instances.</p>
<h3 id="Adding-Dependencies-2"><a href="#Adding-Dependencies-2" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud LoadBalancer dependency to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Load-Balancer"><a href="#Configuring-Load-Balancer" class="headerlink" title="Configuring Load Balancer"></a>Configuring Load Balancer</h3><p>Configure the load balancer in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.loadbalancer.ribbon.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Load-Balancer"><a href="#Using-Load-Balancer" class="headerlink" title="Using Load Balancer"></a>Using Load Balancer</h3><p>Use the load balancer in your service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> WebClient.Builder <span class="title function_">loadBalancedWebClientBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> WebClient.builder();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When you make a request using the <code>WebClient.Builder</code>, you typically specify the service name in the URI (e.g., <code>http://book-service/books</code>). The <code>@LoadBalanced</code> annotation tells Spring Cloud LoadBalancer to intercept this request and resolve the service name (<code>book-service</code>) to the actual service instances.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient.Builder webClientBuilder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(WebClient.Builder webClientBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClientBuilder = webClientBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://book-service/books/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(Book.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="circuit-breaker"></a></p>
<h2 id="Circuit-Breaker"><a href="#Circuit-Breaker" class="headerlink" title="Circuit Breaker"></a>Circuit Breaker</h2><p>Circuit breakers are an essential pattern in microservices architecture, handling service call failures to prevent fault propagation. Spring Cloud Circuit Breaker provides circuit breaker functionality with support for multiple implementations like Resilience4J.</p>
<h3 id="Adding-Dependencies-3"><a href="#Adding-Dependencies-3" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>Add the Spring Cloud Circuit Breaker and Resilience4J dependencies to your service:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-circuitbreaker-reactor-resilience4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Circuit-Breaker"><a href="#Configuring-Circuit-Breaker" class="headerlink" title="Configuring Circuit Breaker"></a>Configuring Circuit Breaker</h3><p>Configure the circuit breaker in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.failureRateThreshold</span>=<span class="string">50</span></span><br><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.waitDurationInOpenState</span>=<span class="string">5s</span></span><br><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.ringBufferSizeInHalfOpenState</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">resilience4j.circuitbreaker.instances.bookService.ringBufferSizeInClosedState</span>=<span class="string">100</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Circuit-Breaker"><a href="#Using-Circuit-Breaker" class="headerlink" title="Using Circuit Breaker"></a>Using Circuit Breaker</h3><p>Use the circuit breaker in your service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.ReactiveCircuitBreakerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveCircuitBreakerFactory circuitBreakerFactory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(ReactiveCircuitBreakerFactory circuitBreakerFactory, BookRepository bookRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreakerFactory = circuitBreakerFactory;</span><br><span class="line">        <span class="built_in">this</span>.bookRepository = bookRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">            .transform(it -&gt; circuitBreakerFactory.create(<span class="string">&quot;bookService&quot;</span>).run(it, throwable -&gt; Mono.just(<span class="keyword">new</span> <span class="title class_">Book</span>(id, <span class="string">&quot;Default Book&quot;</span>, <span class="string">&quot;Unknown&quot;</span>, <span class="number">0.0</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Diagram"><a href="#Diagram" class="headerlink" title="Diagram"></a>Diagram</h3><ul>
<li>Client-Side: WebClient - Alternative of Spring-Cloud OpenFeign</li>
<li>API Gateway: Routes</li>
<li>BookService: Integerated CircuitBreaker(Actual Implementation is resilience4j)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Client-Side       |       | API Gateway       |       | Actual BookService|</span><br><span class="line">| MultiServiceCaller|       |                   |       |                   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">| +-------------+   |       | +-------------+   |       | +-------------+   |</span><br><span class="line">| | WebClient   |   |       | | Routes      |   |       | | Circuit    |   |</span><br><span class="line">| |             |   |       | |             |   |       | | Breaker    |   |</span><br><span class="line">| | +---------+ |   |       | | +---------+ |   |       | | +---------+ |   |</span><br><span class="line">| | | Request | |   |       | | | Request | |   |       | | | Request | |   |</span><br><span class="line">| | +---------+ |   |       | | +---------+ |   |       | | +---------+ |   |</span><br><span class="line">| +-------------+   |       | +-------------+   |       | +-------------+   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">|                   |       |                   |       |                   |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br></pre></td></tr></table></figure>

<h3 id="Real-Life-Production-Use-Cases"><a href="#Real-Life-Production-Use-Cases" class="headerlink" title="Real-Life Production Use Cases"></a>Real-Life Production Use Cases</h3><h4 id="Use-Case-1-E-commerce-Platform"><a href="#Use-Case-1-E-commerce-Platform" class="headerlink" title="Use Case 1: E-commerce Platform"></a>Use Case 1: E-commerce Platform</h4><p>In an e-commerce platform, multiple microservices interact to handle various functionalities such as product catalog, user management, and order processing. Spring WebFlux and Spring Cloud components can be used to build a scalable and resilient system.</p>
<h4 id="Example-Order-Service-Communicating-with-Product-Service"><a href="#Example-Order-Service-Communicating-with-Product-Service" class="headerlink" title="Example: Order Service Communicating with Product Service"></a>Example: Order Service Communicating with Product Service</h4><p>The Order Service needs to retrieve product details from the Product Service to process orders. Spring Cloud Gateway can be used as an API gateway to route requests, and Spring Cloud LoadBalancer can be used for client-side load balancing.</p>
<h4 id="Use-Case-2-Financial-Services"><a href="#Use-Case-2-Financial-Services" class="headerlink" title="Use Case 2: Financial Services"></a>Use Case 2: Financial Services</h4><p>In financial services, microservices handle transactions, account management, and reporting. Spring WebFlux can be used to build high-performance services, and Spring Cloud Circuit Breaker can be used to handle failures gracefully.</p>
<h4 id="Example-Transaction-Service-with-Circuit-Breaker"><a href="#Example-Transaction-Service-with-Circuit-Breaker" class="headerlink" title="Example: Transaction Service with Circuit Breaker"></a>Example: Transaction Service with Circuit Breaker</h4><p>The Transaction Service needs to call the Account Service to validate account balances. If the Account Service is down, the circuit breaker can return a default response to prevent system failure.</p>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Service-Registration-and-Discovery-1"><a href="#Service-Registration-and-Discovery-1" class="headerlink" title="Service Registration and Discovery"></a>Service Registration and Discovery</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="API-Gateway-1"><a href="#API-Gateway-1" class="headerlink" title="API Gateway"></a>API Gateway</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.gateway.routes[0].id</span>=<span class="string">book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].uri</span>=<span class="string">lb://book-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[0].predicates[0]</span>=<span class="string">Path=/books/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].id</span>=<span class="string">user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].uri</span>=<span class="string">lb://user-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[1].predicates[0]</span>=<span class="string">Path=/users/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].id</span>=<span class="string">order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].uri</span>=<span class="string">lb://order-service</span></span><br><span class="line"><span class="attr">spring.cloud.gateway.routes[2].predicates[0]</span>=<span class="string">Path=/orders/**</span></span><br></pre></td></tr></table></figure>

<h3 id="Client-Side-Load-Balancing-1"><a href="#Client-Side-Load-Balancing-1" class="headerlink" title="Client-Side Load Balancing"></a>Client-Side Load Balancing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> WebClient.Builder <span class="title function_">loadBalancedWebClientBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> WebClient.builder();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-WebClient-to-Call-Different-Services"><a href="#Using-WebClient-to-Call-Different-Services" class="headerlink" title="Using WebClient to Call Different Services"></a>Using <code>WebClient</code> to Call Different Services</h3><p>Create a service class that uses the <code>WebClient.Builder</code> to interact with different registered services:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiServiceCaller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient.Builder webClientBuilder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiServiceCaller</span><span class="params">(WebClient.Builder webClientBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClientBuilder = webClientBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://book-service/books/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(Book.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://user-service/users/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(User.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">getOrderById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClientBuilder.build()</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://order-service/orders/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(Order.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Circuit-Breaker-1"><a href="#Circuit-Breaker-1" class="headerlink" title="Circuit Breaker"></a>Circuit Breaker</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.ReactiveCircuitBreakerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveCircuitBreakerFactory circuitBreakerFactory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(ReactiveCircuitBreakerFactory circuitBreakerFactory, BookRepository bookRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreakerFactory = circuitBreakerFactory;</span><br><span class="line">        <span class="built_in">this</span>.bookRepository = bookRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">            .transform(it -&gt; circuitBreakerFactory.create(<span class="string">&quot;bookService&quot;</span>).run(it, throwable -&gt; Mono.just(<span class="keyword">new</span> <span class="title class_">Book</span>(id, <span class="string">&quot;Default Book&quot;</span>, <span class="string">&quot;Unknown&quot;</span>, <span class="number">0.0</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to integrate Spring WebFlux with microservices architecture using the latest Spring Cloud components. By leveraging Spring Cloud Kubernetes, Spring Cloud Gateway, Spring Cloud LoadBalancer, and Spring Cloud Circuit Breaker, we can easily build high-performance, scalable distributed systems. Real-life production use cases and sample code demonstrate the practical application of these components in building resilient and scalable microservices.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice/" class="post-title-link" itemprop="url">Approaches to Rolling Back or Canceling Transactions in Microservice</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 23:17:16" itemprop="dateCreated datePublished" datetime="2024-10-24T23:17:16-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Transaction/" itemprop="url" rel="index"><span itemprop="name">Transaction</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Transaction/Microservice/" itemprop="url" rel="index"><span itemprop="name">Microservice</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Handling rollback or cancellation of transactions in a <strong>Microservice Architecture</strong> when multiple writes are involved is a complex process because each microservice typically has its own database, and there is no central point of coordination like in monolithic applications. Traditional database transactions (ACID) are difficult to apply in microservices, especially when services span across multiple databases, message brokers, and external APIs. Therefore, rollback in microservices needs a more sophisticated approach.</p>
<h3 id="Key-Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice-Architecture"><a href="#Key-Approaches-to-Rolling-Back-or-Canceling-Transactions-in-Microservice-Architecture" class="headerlink" title="Key Approaches to Rolling Back or Canceling Transactions in Microservice Architecture"></a>Key Approaches to Rolling Back or Canceling Transactions in Microservice Architecture</h3><p>There are several strategies to handle rollback or cancellation in microservices when multiple services and writes are involved. These include:</p>
<ul>
<li><a href="#1-saga-pattern">1. Saga Pattern</a><ul>
<li><a href="#a-choreography-based-saga">a. Choreography-based Saga</a></li>
<li><a href="#b-orchestration-based-saga">b. Orchestration-based Saga</a></li>
</ul>
</li>
<li><a href="#2-compensation-mechanism">2. Compensation Mechanism</a></li>
<li><a href="#3-two-phase-commit-2pc">3. Two-Phase Commit (2PC)</a><ul>
<li><a href="#how-2pc-works">How 2PC Works:</a></li>
</ul>
</li>
<li><a href="#4-eventual-consistency">4. Eventual Consistency</a><ul>
<li><a href="#how-to-handle-rollbacks-with-eventual-consistency">How to Handle Rollbacks with Eventual Consistency:</a></li>
</ul>
</li>
<li><a href="#5-idempotency-and-retries">5. Idempotency and Retries</a><ul>
<li><a href="#idempotency">Idempotency:</a></li>
<li><a href="#best-practices-for-idempotency">Best Practices for Idempotency:</a></li>
</ul>
</li>
<li><a href="#6-conclusion">6. Conclusion</a></li>
</ul>
<hr>
<p><a name="saga-pattern"></a></p>
<h2 id="1-Saga-Pattern"><a href="#1-Saga-Pattern" class="headerlink" title="1. Saga Pattern"></a>1. Saga Pattern</h2><p>The <strong>Saga Pattern</strong> is the most popular strategy for handling distributed transactions in microservices. It breaks a large transaction into a sequence of smaller, independent transactions, each handled by a microservice. If any part of the sequence fails, compensating actions (i.e., rollbacks) are triggered to undo the work done by previous steps.</p>
<p>There are two common approaches to implementing the Saga Pattern:</p>
<ul>
<li><strong>Choreography-based Saga</strong></li>
<li><strong>Orchestration-based Saga</strong></li>
</ul>
<p><a name="choreography-based-saga"></a></p>
<h3 id="a-Choreography-based-Saga"><a href="#a-Choreography-based-Saga" class="headerlink" title="a. Choreography-based Saga"></a>a. Choreography-based Saga</h3><p>In a <strong>Choreography-based Saga</strong>, each service involved in the transaction emits an event upon completion of its task. Other services listen to these events and take action accordingly. If an error occurs, the service responsible for the failed transaction emits a failure event, and other services listening for that failure event perform compensating actions.</p>
<p><strong>Example</strong>:<br>Imagine an e-commerce system where you place an order that spans multiple microservices:</p>
<ol>
<li><strong>Order Service</strong>: Creates the order.</li>
<li><strong>Inventory Service</strong>: Reserves the product.</li>
<li><strong>Payment Service</strong>: Charges the customer.</li>
<li><strong>Shipping Service</strong>: Ships the product.</li>
</ol>
<p>If the <strong>Payment Service</strong> fails after reserving the inventory, it can emit a failure event, and the <strong>Inventory Service</strong> would listen to this and release the reserved product (compensating action).</p>
<p><strong>Advantages</strong>:</p>
<ul>
<li>Fully decentralized and scalable.</li>
<li>Easy to add new services without affecting others.</li>
</ul>
<p><strong>Challenges</strong>:</p>
<ul>
<li>Harder to track and manage because there is no central coordinator.</li>
<li>More complex error handling logic in each service.</li>
</ul>
<p><a name="orchestration-based-saga"></a></p>
<h3 id="b-Orchestration-based-Saga"><a href="#b-Orchestration-based-Saga" class="headerlink" title="b. Orchestration-based Saga"></a>b. Orchestration-based Saga</h3><p>In an <strong>Orchestration-based Saga</strong>, a central coordinator (Orchestrator) is responsible for managing the workflow of the transaction. The Orchestrator sends commands to each service to execute a step in the transaction and handles failures by issuing compensating commands if any service fails.</p>
<p><strong>Example</strong>:</p>
<ul>
<li>The <strong>Orchestrator</strong> sends a command to the <strong>Order Service</strong> to create an order.</li>
<li>After receiving success, the Orchestrator asks the <strong>Inventory Service</strong> to reserve the product.</li>
<li>If the <strong>Payment Service</strong> fails, the Orchestrator issues a compensating command to the <strong>Inventory Service</strong> to release the product.</li>
</ul>
<p><strong>Advantages</strong>:</p>
<ul>
<li>Easier to implement because the Orchestrator handles the entire workflow.</li>
<li>Centralized error handling and compensations.</li>
</ul>
<p><strong>Challenges</strong>:</p>
<ul>
<li>The Orchestrator can become a single point of failure or bottleneck.</li>
<li>Needs to manage state and retries, making it potentially complex.</li>
</ul>
<hr>
<p><a name="compensation-mechanism"></a></p>
<h2 id="2-Compensation-Mechanism"><a href="#2-Compensation-Mechanism" class="headerlink" title="2. Compensation Mechanism"></a>2. Compensation Mechanism</h2><p>The <strong>Compensation Mechanism</strong> is the core of both the Saga Pattern and other eventual consistency models. A compensation transaction is essentially the “undo” operation that reverses the effects of a previously completed step in case of failure.</p>
<p><strong>How It Works</strong>:<br>Each microservice is responsible for defining and implementing compensating actions for its operations. For example:</p>
<ul>
<li>If the <strong>Inventory Service</strong> reserves stock but the <strong>Payment Service</strong> fails, the Inventory Service must implement logic to release the stock.</li>
<li>If the <strong>Payment Service</strong> successfully charges a customer but the <strong>Shipping Service</strong> fails, the Payment Service must issue a refund.</li>
</ul>
<p><strong>Key Considerations</strong>:</p>
<ul>
<li><strong>Compensation is not always straightforward</strong>: Rolling back a transaction isn’t always as simple as undoing a change. Some operations might be irreversible (e.g., shipping a product), requiring compensating actions that mitigate the issue (e.g., issuing a refund).</li>
<li><strong>State-driven compensation</strong>: Services must maintain state information to understand which transactions require compensation.</li>
</ul>
<hr>
<p><a name="two-phase-commit-2pc"></a></p>
<h2 id="3-Two-Phase-Commit-2PC"><a href="#3-Two-Phase-Commit-2PC" class="headerlink" title="3. Two-Phase Commit (2PC)"></a>3. Two-Phase Commit (2PC)</h2><p><strong>Two-Phase Commit (2PC)</strong> is a protocol used for coordinating distributed transactions across multiple systems. It’s traditionally used in tightly coupled distributed systems but is less popular in microservice architectures due to performance and complexity concerns.</p>
<h3 id="How-2PC-Works"><a href="#How-2PC-Works" class="headerlink" title="How 2PC Works:"></a>How 2PC Works:</h3><ol>
<li><strong>Prepare Phase</strong>: The transaction coordinator asks each microservice if they are ready to commit the transaction. The services reply with “yes” or “no.”</li>
<li><strong>Commit&#x2F;Rollback Phase</strong>: If all services reply with “yes,” the coordinator instructs them to commit. If any service replies with “no,” the coordinator sends a rollback command to all participating services.</li>
</ol>
<p><strong>Pros</strong>:</p>
<ul>
<li>Strong consistency guarantees.</li>
<li>Ensures atomicity across distributed systems.</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li><strong>Performance overhead</strong>: 2PC introduces a blocking wait time for services to prepare and commit, which can hurt performance in a microservices architecture.</li>
<li><strong>Risk of blocking</strong>: If one service crashes, it can leave other services waiting indefinitely, potentially causing system-wide issues.</li>
</ul>
<p>Given these challenges, 2PC is rarely used in modern, large-scale microservice architectures.</p>
<hr>
<p><a name="eventual-consistency"></a></p>
<h2 id="4-Eventual-Consistency"><a href="#4-Eventual-Consistency" class="headerlink" title="4. Eventual Consistency"></a>4. Eventual Consistency</h2><p>In distributed microservice architectures, <strong>eventual consistency</strong> is often the goal rather than strong consistency (ACID). Eventual consistency ensures that after some time, all participants in a distributed transaction will reach a consistent state, even if there are temporary inconsistencies.</p>
<h3 id="How-to-Handle-Rollbacks-with-Eventual-Consistency"><a href="#How-to-Handle-Rollbacks-with-Eventual-Consistency" class="headerlink" title="How to Handle Rollbacks with Eventual Consistency:"></a>How to Handle Rollbacks with Eventual Consistency:</h3><ul>
<li><strong>Delayed reconciliation</strong>: Some systems may use periodic reconciliation processes to detect inconsistencies and trigger compensating actions to ensure data integrity.</li>
<li><strong>State-based updates</strong>: Services track their state, and if a failure is detected, each service is responsible for ensuring consistency through compensation.</li>
</ul>
<p><strong>Example</strong>:<br>If a <strong>Payment Service</strong> charges a customer but the <strong>Shipping Service</strong> fails to ship the item, the system might temporarily be in an inconsistent state (payment made, no shipment). Over time, a reconciliation job or event listener detects the issue and initiates a refund to bring the system back to consistency.</p>
<p><strong>Pros</strong>:</p>
<ul>
<li>High scalability and resilience.</li>
<li>Tolerates temporary inconsistencies while ensuring long-term data integrity.</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>Complex to reason about, as temporary inconsistencies can confuse users and developers.</li>
<li>Some actions (e.g., shipping a product) may be difficult to compensate.</li>
</ul>
<hr>
<p><a name="idempotency-and-retries"></a></p>
<h2 id="5-Idempotency-and-Retries"><a href="#5-Idempotency-and-Retries" class="headerlink" title="5. Idempotency and Retries"></a>5. Idempotency and Retries</h2><p>In microservice architectures, <strong>idempotency</strong> and <strong>retries</strong> play a critical role in handling rollbacks and retries, ensuring that repeated operations do not result in unwanted side effects.</p>
<h3 id="Idempotency"><a href="#Idempotency" class="headerlink" title="Idempotency:"></a>Idempotency:</h3><p>An operation is <strong>idempotent</strong> if performing it multiple times has the same result as performing it once. For example, if a <strong>Payment Service</strong> is asked to process a payment twice, it should charge the customer only once.</p>
<p><strong>Why It Matters</strong>:</p>
<ul>
<li>When rolling back a transaction, services may need to retry operations (e.g., issuing a refund). These retries must be idempotent to prevent issues like charging a customer multiple times or reserving inventory repeatedly.</li>
<li><strong>Retry policies</strong> are often implemented in communication mechanisms (e.g., message brokers) to ensure reliability.</li>
</ul>
<h3 id="Best-Practices-for-Idempotency"><a href="#Best-Practices-for-Idempotency" class="headerlink" title="Best Practices for Idempotency:"></a>Best Practices for Idempotency:</h3><ul>
<li>Use unique transaction IDs for requests so that services can detect duplicate requests.</li>
<li>Design APIs and actions to ensure they are safe for retries.</li>
</ul>
<hr>
<p><a name="conclusion"></a></p>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a>6. Conclusion</h2><p>Rolling back or canceling transactions in a <strong>Microservice Architecture</strong> requires careful design to handle distributed data, asynchronous operations, and eventual consistency. The <strong>Saga Pattern</strong> (both choreography and orchestration) is the most widely used approach, allowing each service to independently handle parts of the transaction and apply compensating actions in case of failure. Other techniques like <strong>compensation mechanisms</strong>, <strong>eventual consistency</strong>, and <strong>idempotency</strong> ensure that microservices can maintain integrity, even across complex, distributed environments.</p>
<p>When choosing a rollback strategy, it’s essential to balance the need for consistency with the performance and scalability requirements of the system.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Considerations-on-Transactions-Across-Distributed-Systems/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Considerations-on-Transactions-Across-Distributed-Systems/" class="post-title-link" itemprop="url">Considerations on Transactions Across Distributed Systems</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 20:43:50" itemprop="dateCreated datePublished" datetime="2024-10-24T20:43:50-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Transaction/" itemprop="url" rel="index"><span itemprop="name">Transaction</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Transaction/Distributed-System/" itemprop="url" rel="index"><span itemprop="name">Distributed System</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Online-Systems-Defining-Transactions-Database-Transaction-Management-and-Lock-Management"><a href="#Online-Systems-Defining-Transactions-Database-Transaction-Management-and-Lock-Management" class="headerlink" title="Online Systems: Defining Transactions, Database Transaction Management, and Lock Management"></a>Online Systems: Defining Transactions, Database Transaction Management, and Lock Management</h3><p>When working with <strong>complex online systems</strong> (e.g., e-commerce platforms, distributed systems, microservices architecture), transactions span beyond a single database. This requires a broader understanding of transaction management, involving <strong>distributed transactions</strong>, <strong>data consistency across systems</strong>, and sophisticated <strong>lock management</strong> techniques. Let’s break this down with a focus on the key topics: defining transactions in online systems, transaction management (beyond the database), and lock management in such environments.</p>
<hr>
<h3 id="1-Defining-Transactions-in-Online-Systems"><a href="#1-Defining-Transactions-in-Online-Systems" class="headerlink" title="1. Defining Transactions in Online Systems"></a>1. Defining Transactions in Online Systems</h3><p>In an <strong>online system</strong>, a <strong>transaction</strong> is a <strong>sequence of operations</strong> performed as a single logical unit, ensuring <strong>consistency, correctness, and isolation</strong> across different subsystems. These operations could involve:</p>
<ul>
<li><strong>Database operations</strong> (e.g., updating inventory, placing an order)</li>
<li><strong>Third-party API calls</strong> (e.g., payment gateways, external services)</li>
<li><strong>Message queue handling</strong> (e.g., Kafka, RabbitMQ for event-driven architecture)</li>
<li><strong>Microservices interaction</strong> (e.g., coordination between an inventory service and an order service)</li>
</ul>
<p>In simple terms, a transaction in an online system is any series of related actions across multiple components that must either <strong>complete successfully together</strong> or <strong>fail together</strong> to maintain a consistent system state.</p>
<h4 id="Key-Transaction-Properties-ACID-vs-BASE"><a href="#Key-Transaction-Properties-ACID-vs-BASE" class="headerlink" title="Key Transaction Properties: ACID vs BASE"></a>Key Transaction Properties: ACID vs BASE</h4><p>In large-scale systems, transactions must be designed for both <strong>strong consistency</strong> (ACID) or <strong>eventual consistency</strong> (BASE), depending on the use case.</p>
<ol>
<li><p><strong>ACID (Atomicity, Consistency, Isolation, Durability)</strong>:</p>
<ul>
<li>Guarantees <strong>strong consistency</strong>.</li>
<li>Used when all subsystems must maintain a single consistent state.</li>
<li>Common in <strong>single database</strong> transactions or within tightly-coupled services.</li>
</ul>
</li>
<li><p><strong>BASE (Basically Available, Soft-state, Eventually consistent)</strong>:</p>
<ul>
<li>Sacrifices immediate consistency for <strong>availability</strong> and <strong>scalability</strong>.</li>
<li>Often used in <strong>distributed systems</strong> where components may not always be in sync (e.g., eventual consistency in NoSQL databases).</li>
</ul>
</li>
</ol>
<p>In online systems, distributed transactions often require a mix of <strong>ACID</strong> and <strong>BASE</strong> properties, depending on the criticality of the operation.</p>
<hr>
<h3 id="2-Transaction-Management-in-Complex-Online-Systems"><a href="#2-Transaction-Management-in-Complex-Online-Systems" class="headerlink" title="2. Transaction Management in Complex Online Systems"></a>2. Transaction Management in Complex Online Systems</h3><p>Transaction management in online systems can no longer rely solely on single-database transaction managers. These systems often require <strong>distributed transaction management</strong>. Some of the most critical techniques include:</p>
<h4 id="a-Distributed-Transactions-Two-Phase-Commit"><a href="#a-Distributed-Transactions-Two-Phase-Commit" class="headerlink" title="a. Distributed Transactions (Two-Phase Commit)"></a>a. <strong>Distributed Transactions (Two-Phase Commit)</strong></h4><p>When a transaction spans across <strong>multiple services</strong> or databases, a <strong>Two-Phase Commit (2PC)</strong> protocol is commonly used to ensure atomicity. </p>
<ul>
<li><strong>Phase 1 - Prepare</strong>: All participating systems are asked to <strong>prepare</strong> (lock resources and confirm they can commit the transaction).</li>
<li><strong>Phase 2 - Commit&#x2F;Rollback</strong>: If all participants agree, the transaction is <strong>committed</strong>. If any participant fails, the entire transaction is <strong>rolled back</strong>.</li>
</ul>
<p>Example:</p>
<ul>
<li>An order is placed in an online store:<ul>
<li>The <strong>Order Service</strong> inserts an order into the database.</li>
<li>The <strong>Payment Service</strong> processes the payment.</li>
<li>The <strong>Inventory Service</strong> updates the stock.</li>
</ul>
</li>
</ul>
<p>All three operations must be successful for the order to be confirmed. The <strong>2PC</strong> ensures that if any step fails, all previous operations are rolled back.</p>
<p>However, <strong>2PC</strong> can be slow and does not scale well in high-throughput environments due to blocking resources during the “prepare” phase.</p>
<h4 id="b-Saga-Pattern"><a href="#b-Saga-Pattern" class="headerlink" title="b. Saga Pattern"></a>b. <strong>Saga Pattern</strong></h4><p>The <strong>Saga Pattern</strong> is an alternative to 2PC, often used in <strong>microservices architectures</strong> where long-lived transactions are undesirable. Instead of blocking resources, the Saga breaks a distributed transaction into a series of smaller transactions.</p>
<ul>
<li>Each service involved in the transaction performs its work independently.</li>
<li>If one step fails, the previous steps are <strong>compensated</strong> by executing defined rollback actions.</li>
</ul>
<p>Example:</p>
<ol>
<li><strong>Order Service</strong> places an order.</li>
<li><strong>Payment Service</strong> charges the customer.</li>
<li><strong>Inventory Service</strong> updates the stock.</li>
<li>If the <strong>Inventory Service</strong> fails, a compensating transaction <strong>refunds</strong> the payment and <strong>cancels</strong> the order.</li>
</ol>
<p><strong>Sagas</strong> offer better <strong>scalability</strong> compared to 2PC and are particularly suited for <strong>event-driven</strong> architectures where each microservice manages its own transaction.</p>
<h4 id="c-Eventual-Consistency-and-Compensation"><a href="#c-Eventual-Consistency-and-Compensation" class="headerlink" title="c. Eventual Consistency and Compensation"></a>c. <strong>Eventual Consistency and Compensation</strong></h4><p>In some distributed systems, strict ACID properties are relaxed for <strong>eventual consistency</strong>, especially in <strong>BASE systems</strong> (e.g., NoSQL databases, cloud-native architectures). Instead of locking resources, systems rely on <strong>compensation</strong> logic:</p>
<ul>
<li>If a downstream service fails or an external API does not respond, the system might retry the operation or initiate compensating actions to restore consistency.</li>
</ul>
<p><strong>Eventual Consistency Example</strong>:</p>
<ul>
<li>In a <strong>global payment system</strong>, payments made across multiple time zones and currencies may not reflect immediately but will eventually be reconciled to ensure data consistency.</li>
</ul>
<h4 id="d-Message-Driven-Transactions"><a href="#d-Message-Driven-Transactions" class="headerlink" title="d. Message-Driven Transactions"></a>d. <strong>Message-Driven Transactions</strong></h4><p>In <strong>event-driven systems</strong>, message queues (e.g., <strong>Kafka</strong>, <strong>RabbitMQ</strong>) help decouple services, allowing them to handle transactions asynchronously. Here, services:</p>
<ul>
<li><strong>Emit events</strong> for actions like “Order Placed” or “Payment Processed”.</li>
<li><strong>Listen</strong> for events from other services to trigger corresponding actions (e.g., update inventory when an order is placed).</li>
</ul>
<p>By designing for <strong>idempotency</strong> (ensuring repeated operations have the same effect as a single operation), these systems can handle eventual consistency and retries gracefully.</p>
<hr>
<h3 id="3-Lock-Management"><a href="#3-Lock-Management" class="headerlink" title="3. Lock Management"></a>3. Lock Management</h3><p>In online systems, <strong>lock management</strong> becomes complex due to multiple participants, different types of data stores, and network latencies. Locking is crucial to prevent data corruption or race conditions during concurrent transactions.</p>
<h4 id="a-Optimistic-vs-Pessimistic-Locking"><a href="#a-Optimistic-vs-Pessimistic-Locking" class="headerlink" title="a. Optimistic vs Pessimistic Locking"></a>a. <strong>Optimistic vs Pessimistic Locking</strong></h4><ul>
<li><p><strong>Pessimistic Locking</strong>: A <strong>resource is locked</strong> for the entire duration of the transaction, preventing any other transaction from accessing it.</p>
<ul>
<li>Used when <strong>contention</strong> for the resource is high or when updates must be serialized (e.g., bank account transfers).</li>
<li>Example: A row in the <code>Inventory</code> table is locked while updating stock.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> product_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Optimistic Locking</strong>: Assumes conflicts are rare and does not lock the resource. Instead, it checks for conflicts only at the end of the transaction.</p>
<ul>
<li><strong>Version columns</strong> or <strong>timestamps</strong> are used to detect if another transaction modified the same data. If so, the transaction fails, and a retry is triggered.</li>
<li>Example: Update an order only if no other transaction has modified it.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Orders</span><br><span class="line"><span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;SHIPPED&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> order_id <span class="operator">=</span> <span class="number">101</span> <span class="keyword">AND</span> version <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="b-Distributed-Locks"><a href="#b-Distributed-Locks" class="headerlink" title="b. Distributed Locks"></a>b. <strong>Distributed Locks</strong></h4><p>In distributed systems, transactions may need to span multiple nodes or databases. To handle this, <strong>distributed locks</strong> ensure that shared resources are not modified concurrently by different parts of the system.</p>
<ol>
<li><p><strong>Redis-Based Locks</strong>: A simple solution is to use <strong>Redis</strong> to acquire distributed locks.</p>
<p>Example:<br>When updating inventory, each microservice tries to acquire a lock for the product:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET product_lock:1 my_unique_id NX PX 10000</span><br></pre></td></tr></table></figure>

<ul>
<li><code>NX</code> ensures the lock is acquired only if it doesn’t exist.</li>
<li><code>PX 10000</code> ensures the lock expires after 10 seconds if not released.</li>
</ul>
</li>
<li><p><strong>Zookeeper or Etcd</strong>: More robust systems like <strong>Zookeeper</strong> or <strong>Etcd</strong> can handle distributed coordination, offering <strong>leader election</strong>, <strong>mutexes</strong>, and <strong>barriers</strong>.</p>
<p>Example: Distributed systems can use Zookeeper to ensure that <strong>only one instance</strong> of a service performs a critical operation (e.g., process payments in a sharded environment).</p>
</li>
</ol>
<h4 id="c-Deadlock-Detection-and-Prevention"><a href="#c-Deadlock-Detection-and-Prevention" class="headerlink" title="c. Deadlock Detection and Prevention"></a>c. <strong>Deadlock Detection and Prevention</strong></h4><p>In systems with complex transactions and lock dependencies, <strong>deadlocks</strong> can occur, where two transactions are waiting for resources locked by each other.</p>
<ul>
<li><p><strong>Deadlock Detection</strong>: The system detects circular dependencies and aborts one of the transactions to resolve the deadlock.</p>
<p>Example:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> innodb_lock_wait_timeout <span class="operator">=</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Deadlock Prevention</strong>: In systems like <strong>databases</strong> or <strong>distributed systems</strong>, adopting strategies like <strong>acquiring locks in a consistent order</strong> can prevent deadlocks.</p>
</li>
</ul>
<hr>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In an <strong>online system</strong>, transaction management and lock management are more complex than in a simple intranet application. The system must account for <strong>distributed transactions</strong> across multiple services and databases, often relying on protocols like <strong>2PC</strong>, <strong>Sagas</strong>, or <strong>message-driven event handling</strong> to ensure consistency and reliability. Locks, whether in-database or distributed, are critical for managing concurrency and ensuring data integrity but must be handled with care to avoid performance bottlenecks or deadlocks.</p>
<p>In essence, designing transactions in a modern online system requires a mix of strategies from <strong>distributed transaction management</strong>, <strong>eventual consistency models</strong>, and <strong>advanced locking mechanisms</strong> to maintain data reliability, availability, and scalability.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Data-Integrity-and-Consistency-in-Databases/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Data-Integrity-and-Consistency-in-Databases/" class="post-title-link" itemprop="url">Data Integrity and Consistency in Databases</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 20:25:06" itemprop="dateCreated datePublished" datetime="2024-10-24T20:25:06-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/RDBMS/" itemprop="url" rel="index"><span itemprop="name">RDBMS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#data-integrity-and-consistency-in-databases">Data Integrity and Consistency in Databases</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#definitions">Definitions</a></li>
<li><a href="#example-scenario-e-commerce-system">Example Scenario: E-commerce System</a><ul>
<li><a href="#products-table">Products Table</a></li>
<li><a href="#orders-table">Orders Table</a></li>
<li><a href="#part-1-data-integrity">Part 1: Data Integrity</a></li>
<li><a href="#part-2-data-consistency-in-a-transaction">Part 2: Data Consistency in a Transaction</a><ul>
<li><a href="#transaction-scenario-placing-an-order">Transaction Scenario: Placing an Order</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#example-of-inconsistent-state-without-transactions">Example of Inconsistent State Without Transactions</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Data-Integrity-and-Consistency-in-Databases"><a href="#Data-Integrity-and-Consistency-in-Databases" class="headerlink" title="Data Integrity and Consistency in Databases"></a>Data Integrity and Consistency in Databases</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>To understand <strong>data integrity</strong> and <strong>consistency</strong>, let’s break them down with an example, illustrating how they work in a transactional database environment.</p>
<hr>
<p><a name="definitions"></a></p>
<h2 id="Definitions"><a href="#Definitions" class="headerlink" title="Definitions"></a>Definitions</h2><ul>
<li><p><strong>Data Integrity</strong>: Refers to the accuracy and reliability of the data. Data integrity ensures that the data is <strong>correct, complete</strong>, and consistent throughout its lifecycle. It is often enforced through rules such as <strong>constraints</strong> (e.g., primary keys, foreign keys, unique constraints).</p>
</li>
<li><p><strong>Consistency</strong>: In the context of transactions, consistency ensures that the database transitions from one <strong>valid state</strong> to another. This means that after every transaction, the database adheres to all rules and constraints that maintain its correctness.</p>
</li>
</ul>
<hr>
<p><a name="example-scenario-ecommerce-system"></a></p>
<h2 id="Example-Scenario-E-commerce-System"><a href="#Example-Scenario-E-commerce-System" class="headerlink" title="Example Scenario: E-commerce System"></a>Example Scenario: E-commerce System</h2><p>Imagine an e-commerce system where users place orders for products. We have two important tables:</p>
<ol>
<li><strong>Products</strong> table: Stores information about products, including <code>product_id</code>, <code>name</code>, <code>price</code>, and <code>quantity_in_stock</code>.</li>
<li><strong>Orders</strong> table: Stores orders placed by customers, including <code>order_id</code>, <code>product_id</code>, <code>quantity_ordered</code>, and <code>status</code>.</li>
</ol>
<h3 id="Products-Table"><a href="#Products-Table" class="headerlink" title="Products Table"></a>Products Table</h3><table>
<thead>
<tr>
<th>product_id</th>
<th>name</th>
<th>price</th>
<th>quantity_in_stock</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Laptop</td>
<td>1000</td>
<td>10</td>
</tr>
<tr>
<td>2</td>
<td>Smartphone</td>
<td>800</td>
<td>20</td>
</tr>
<tr>
<td>3</td>
<td>Headphones</td>
<td>150</td>
<td>30</td>
</tr>
</tbody></table>
<h3 id="Orders-Table"><a href="#Orders-Table" class="headerlink" title="Orders Table"></a>Orders Table</h3><table>
<thead>
<tr>
<th>order_id</th>
<th>product_id</th>
<th>quantity_ordered</th>
<th>status</th>
</tr>
</thead>
<tbody><tr>
<td>101</td>
<td>1</td>
<td>2</td>
<td>PENDING</td>
</tr>
<tr>
<td>102</td>
<td>2</td>
<td>1</td>
<td>SHIPPED</td>
</tr>
</tbody></table>
<hr>
<p><a name="part-1-data-integrity"></a></p>
<h3 id="Part-1-Data-Integrity"><a href="#Part-1-Data-Integrity" class="headerlink" title="Part 1: Data Integrity"></a>Part 1: Data Integrity</h3><p><strong>Data Integrity</strong> ensures that the data adheres to business rules and constraints. Let’s define some <strong>integrity constraints</strong> in this system:</p>
<ol>
<li><p><strong>Foreign Key Constraint</strong>: Ensures that every <code>product_id</code> in the <code>Orders</code> table refers to a valid <code>product_id</code> in the <code>Products</code> table. This prevents orders from being placed for non-existent products.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_product_id</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY (product_id) <span class="keyword">REFERENCES</span> Products(product_id);</span><br></pre></td></tr></table></figure>

<p><strong>Example Violation</strong>:<br>If someone tries to insert an order with <code>product_id = 999</code> (which does not exist in the Products table), the foreign key constraint would <strong>reject</strong> the transaction.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Orders (order_id, product_id, quantity_ordered, status)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">103</span>, <span class="number">999</span>, <span class="number">1</span>, <span class="string">&#x27;PENDING&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Result</strong>: Integrity violation. The order cannot be placed because <code>product_id = 999</code> does not exist in the <code>Products</code> table.</p>
</li>
<li><p><strong>Check Constraint</strong>: Ensures that no negative quantity can be ordered or stored in the inventory.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Products</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> chk_positive_quantity <span class="keyword">CHECK</span> (quantity_in_stock <span class="operator">&gt;=</span> <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Example Violation</strong>:<br>If an update tries to set <code>quantity_in_stock</code> to a negative value, it will be rejected.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Products</span><br><span class="line"><span class="keyword">SET</span> quantity_in_stock <span class="operator">=</span> <span class="number">-5</span></span><br><span class="line"><span class="keyword">WHERE</span> product_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Result</strong>: Integrity violation. Negative stock values are not allowed.</p>
</li>
<li><p><strong>Unique Constraint</strong>: Ensures no duplicate <code>product_id</code> exists in the <code>Products</code> table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Products</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> unique_product_id <span class="keyword">UNIQUE</span> (product_id);</span><br></pre></td></tr></table></figure>

<p><strong>Example Violation</strong>:<br>If we try to insert another product with the same <code>product_id</code>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Products (product_id, name, price, quantity_in_stock)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Tablet&#x27;</span>, <span class="number">500</span>, <span class="number">15</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Result</strong>: Integrity violation. Duplicate product IDs are not allowed.</p>
</li>
</ol>
<p>These constraints enforce <strong>data integrity</strong> by ensuring that only valid data can be inserted or updated in the database.</p>
<hr>
<p><a name="part-2-data-consistency-in-a-transaction"></a></p>
<h3 id="Part-2-Data-Consistency-in-a-Transaction"><a href="#Part-2-Data-Consistency-in-a-Transaction" class="headerlink" title="Part 2: Data Consistency in a Transaction"></a>Part 2: Data Consistency in a Transaction</h3><p><strong>Data Consistency</strong> means that after a transaction, all defined integrity rules are maintained, and the system remains in a valid state. Let’s explore this with a transactional scenario.</p>
<h4 id="Transaction-Scenario-Placing-an-Order"><a href="#Transaction-Scenario-Placing-an-Order" class="headerlink" title="Transaction Scenario: Placing an Order"></a>Transaction Scenario: Placing an Order</h4><p>When a user places an order, several things happen as part of a <strong>single transaction</strong>:</p>
<ol>
<li>The system <strong>decreases</strong> the quantity of the product in the <code>Products</code> table.</li>
<li>A new order is <strong>inserted</strong> into the <code>Orders</code> table.</li>
<li>If the order cannot be completed for some reason (e.g., insufficient stock), the entire transaction is <strong>rolled back</strong>.</li>
</ol>
<p>Let’s simulate this with an example where a customer places an order for 3 laptops (<code>product_id = 1</code>).</p>
<ol>
<li><p><strong>Initial State</strong>:</p>
<ul>
<li><code>Products</code> table shows 10 laptops in stock.</li>
<li>No new order is placed yet.</li>
</ul>
</li>
<li><p><strong>Transaction Start</strong>:</p>
<ul>
<li><p>Begin the transaction:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRANSACTION;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Check Stock</strong>:<br>First, the system checks if there are enough laptops in stock.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantity_in_stock <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> product_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- Result: 10</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Decrease Stock</strong>:<br>If there is enough stock, decrease the stock by the ordered quantity.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Products</span><br><span class="line"><span class="keyword">SET</span> quantity_in_stock <span class="operator">=</span> quantity_in_stock <span class="operator">-</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">WHERE</span> product_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>After the update, the stock of laptops is reduced to 7.</p>
</li>
<li><p><strong>Insert Order</strong>:<br>Insert the new order into the <code>Orders</code> table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Orders (order_id, product_id, quantity_ordered, status)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">103</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&#x27;PENDING&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Commit Transaction</strong>:<br>If everything succeeds (no constraint violations, no failures), commit the transaction.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Final State</strong>:</p>
<ul>
<li>The <code>Products</code> table now shows 7 laptops in stock.</li>
<li>A new order has been added to the <code>Orders</code> table.</li>
</ul>
</li>
</ol>
<p><strong>Data Consistency</strong> is maintained because the system follows the ACID properties. The <strong>database’s state</strong> transitions from a valid state to another valid state (the stock is updated, and the order is recorded correctly).</p>
<hr>
<p><a name="example-of-inconsistent-state-without-transactions"></a></p>
<h2 id="Example-of-Inconsistent-State-Without-Transactions"><a href="#Example-of-Inconsistent-State-Without-Transactions" class="headerlink" title="Example of Inconsistent State Without Transactions"></a>Example of Inconsistent State Without Transactions</h2><p>Now let’s imagine what would happen if transactions were <strong>not used</strong>, leading to <strong>inconsistent data</strong>.</p>
<ol>
<li><p><strong>Decrease Stock</strong>:<br>The system updates the stock to 7 but fails to insert the order due to a system error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Products</span><br><span class="line"><span class="keyword">SET</span> quantity_in_stock <span class="operator">=</span> quantity_in_stock <span class="operator">-</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">WHERE</span> product_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- Success: stock reduced to 7</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Insert Order Fails</strong>:<br>The order insertion fails (due to a network issue or other error).</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Orders (order_id, product_id, quantity_ordered, status)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">103</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&#x27;PENDING&#x27;</span>);</span><br><span class="line"><span class="comment">-- Error: Failure to insert the order</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>Since the database <strong>was not in a transaction</strong>, the stock was reduced but the order was never recorded. This results in an <strong>inconsistent state</strong> where the stock is reduced but no corresponding order exists, violating the system’s expected behavior.</p>
<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><ul>
<li><strong>Data Integrity</strong> ensures that only valid and accurate data can be entered or modified in the database by using constraints like foreign keys, check constraints, and unique constraints.</li>
<li><strong>Data Consistency</strong> ensures that after a transaction, the database remains in a valid state, where all integrity rules are maintained and the system behaves as expected.</li>
</ul>
<p>By using proper transaction management and enforcing data integrity rules, we can prevent inconsistent states and maintain the overall reliability of an online system.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XVII/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XVII/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XVII</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 14:07:44" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:44-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In the previous sixteen articles, we have covered the foundational concepts of Spring WebFlux, Reactor, data stream transformation, reactive database access, performance optimization, security, testing, deployment and operations, best practices, common pitfalls, integration with microservices architecture, and real-time data push. This article will delve into implementing effective error handling strategies in Spring WebFlux applications to ensure system robustness and user experience.</p>
<ul>
<li><a href="#error-handling-strategies">Error Handling Strategies</a><ul>
<li><a href="#importance-of-error-handling">Importance of Error Handling</a></li>
<li><a href="#basic-concepts-of-error-handling">Basic Concepts of Error Handling</a></li>
<li><a href="#global-error-handling">Global Error Handling</a><ul>
<li><a href="#creating-a-global-error-handler">Creating a Global Error Handler</a></li>
<li><a href="#configuration-class-explanation">Configuration Class Explanation</a></li>
</ul>
</li>
<li><a href="#controller-level-error-handling">Controller-Level Error Handling</a></li>
<li><a href="#error-handling-in-reactive-streams">Error Handling in Reactive Streams</a><ul>
<li><a href="#using-onerrorresume">Using <code>onErrorResume</code></a></li>
<li><a href="#using-onerrorreturn">Using <code>onErrorReturn</code></a></li>
<li><a href="#using-onerrormap">Using <code>onErrorMap</code></a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Error-Handling-Strategies"><a href="#Error-Handling-Strategies" class="headerlink" title="Error Handling Strategies"></a>Error Handling Strategies</h1><hr>
<p><a name="importance-of-error-handling"></a></p>
<h2 id="Importance-of-Error-Handling"><a href="#Importance-of-Error-Handling" class="headerlink" title="Importance of Error Handling"></a>Importance of Error Handling</h2><p>In any application, errors are inevitable. How these errors are handled not only affects system stability but also directly impacts user experience. In Spring WebFlux, due to its asynchronous and non-blocking nature, error handling is particularly crucial.</p>
<p><a name="basic-concepts-of-error-handling"></a></p>
<h2 id="Basic-Concepts-of-Error-Handling"><a href="#Basic-Concepts-of-Error-Handling" class="headerlink" title="Basic Concepts of Error Handling"></a>Basic Concepts of Error Handling</h2><p>In Spring WebFlux, error handling typically involves the following levels:</p>
<ul>
<li><strong>Global Error Handling</strong>: Captures unhandled exceptions in the application and provides a unified error response.</li>
<li><strong>Controller-Level Error Handling</strong>: Handles errors specific to requests in controllers.</li>
<li><strong>Error Handling in Reactive Streams</strong>: Manages and recovers from errors within reactive data streams.</li>
</ul>
<p><a name="global-error-handling"></a></p>
<h2 id="Global-Error-Handling"><a href="#Global-Error-Handling" class="headerlink" title="Global Error Handling"></a>Global Error Handling</h2><p>Global error handling can be achieved by implementing the <code>ErrorWebExceptionHandler</code> interface.</p>
<p><a name="creating-a-global-error-handler"></a></p>
<h3 id="Creating-a-Global-Error-Handler"><a href="#Creating-a-Global-Error-Handler" class="headerlink" title="Creating a Global Error Handler"></a>Creating a Global Error Handler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.reactive.error.ErrorWebExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.server.ServerResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalErrorHandlerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Order(-2)</span></span><br><span class="line">    <span class="keyword">public</span> ErrorWebExceptionHandler <span class="title function_">globalErrorHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GlobalErrorHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">GlobalErrorHandler</span> <span class="keyword">implements</span> <span class="title class_">ErrorWebExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange, Throwable ex)</span> &#123;</span><br><span class="line">            <span class="type">ServerRequest</span> <span class="variable">request</span> <span class="operator">=</span> ServerRequest.create(exchange, HandlerStrategies.withDefaults().messageReaders());</span><br><span class="line">            <span class="keyword">return</span> renderErrorResponse(request, ex)</span><br><span class="line">                .flatMap(response -&gt; response.writeTo(exchange, HandlerStrategies.withDefaults()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Mono&lt;ServerResponse&gt; <span class="title function_">renderErrorResponse</span><span class="params">(ServerRequest request, Throwable ex)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ServerResponse.status(HttpStatus.INTERNAL_SERVER_ERROR)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .bodyValue(<span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(ex.getMessage()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ErrorResponse</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ErrorResponse</span><span class="params">(String message)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.message = message;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="configuration-class-explanation"></a></p>
<h3 id="Configuration-Class-Explanation"><a href="#Configuration-Class-Explanation" class="headerlink" title="Configuration Class Explanation"></a>Configuration Class Explanation</h3><p>In the above configuration, we define a global error handler <code>GlobalErrorHandler</code> that captures all unhandled exceptions and returns a unified error response. By implementing the <code>ErrorWebExceptionHandler</code> interface, we can customize the error handling logic.</p>
<p><a name="controller-level-error-handling"></a></p>
<h2 id="Controller-Level-Error-Handling"><a href="#Controller-Level-Error-Handling" class="headerlink" title="Controller-Level Error Handling"></a>Controller-Level Error Handling</h2><p>At the controller level, we can use the <code>@ExceptionHandler</code> annotation to handle specific exceptions.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ControllerExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(BookNotFoundException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleBookNotFound</span><span class="params">(BookNotFoundException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND).body(errorResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle other exceptions</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleException</span><span class="params">(Exception ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="string">&quot;Internal Server Error&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="error-handling-in-reactive-streams"></a></p>
<h2 id="Error-Handling-in-Reactive-Streams"><a href="#Error-Handling-in-Reactive-Streams" class="headerlink" title="Error Handling in Reactive Streams"></a>Error Handling in Reactive Streams</h2><p>In reactive streams, we can use various operators to handle errors.</p>
<p><a name="using-onerrorresume"></a></p>
<h3 id="Using-onErrorResume"><a href="#Using-onErrorResume" class="headerlink" title="Using onErrorResume"></a>Using <code>onErrorResume</code></h3><p>The <code>onErrorResume</code> operator allows switching to another <code>Publisher</code> when an error occurs.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">findBookById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">        .onErrorResume(ex -&gt; &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Error finding book&quot;</span>, ex);</span><br><span class="line">            <span class="keyword">return</span> Mono.empty();</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="using-onerrorreturn"></a></p>
<h3 id="Using-onErrorReturn"><a href="#Using-onErrorReturn" class="headerlink" title="Using onErrorReturn"></a>Using <code>onErrorReturn</code></h3><p>The <code>onErrorReturn</code> operator allows returning a default value when an error occurs.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">findBookById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">        .onErrorReturn(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;Default Book&quot;</span>, <span class="string">&quot;Unknown Author&quot;</span>, <span class="number">0.0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="using-onerrormap"></a></p>
<h3 id="Using-onErrorMap"><a href="#Using-onErrorMap" class="headerlink" title="Using onErrorMap"></a>Using <code>onErrorMap</code></h3><p>The <code>onErrorMap</code> operator allows converting the error to another type of error.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">findBookById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">        .onErrorMap(ex -&gt; <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;Custom error message&quot;</span>, ex));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to implement effective error handling strategies in Spring WebFlux applications. By using global error handling, controller-level error handling, and error handling in reactive streams, we can build more robust and user-friendly applications. Proper error handling is essential for maintaining the reliability and performance of modern reactive applications.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XVI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XVI/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XVI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 14:07:41" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:41-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In the previous fifteen articles, we have covered the foundational concepts of Spring WebFlux, Reactor, error handling, data stream transformation, reactive database access, performance optimization, security, testing, deployment and operations, best practices, common pitfalls, integration with microservices architecture, and real-time data push. This article will delve into implementing effective logging and monitoring in Spring WebFlux applications to ensure system observability and stability.</p>
<ul>
<li><a href="#logging-and-monitoring">Logging and Monitoring</a><ul>
<li><a href="#introduction-to-logging">Introduction to Logging</a><ul>
<li><a href="#adding-dependencies">Adding Dependencies</a></li>
<li><a href="#configuring-logback">Configuring Logback</a></li>
<li><a href="#using-logging-in-code">Using Logging in Code</a></li>
</ul>
</li>
<li><a href="#introduction-to-monitoring">Introduction to Monitoring</a><ul>
<li><a href="#spring-boot-actuator">Spring Boot Actuator</a><ul>
<li><a href="#adding-actuator-dependencies">Adding Actuator Dependencies</a></li>
<li><a href="#configuring-actuator">Configuring Actuator</a></li>
<li><a href="#using-actuator-endpoints">Using Actuator Endpoints</a></li>
</ul>
</li>
<li><a href="#monitoring-with-prometheus-and-grafana">Monitoring with Prometheus and Grafana</a><ul>
<li><a href="#adding-prometheus-dependencies">Adding Prometheus Dependencies</a></li>
<li><a href="#configuring-prometheus">Configuring Prometheus</a></li>
<li><a href="#configuring-prometheus-server">Configuring Prometheus Server</a></li>
<li><a href="#visualizing-with-grafana">Visualizing with Grafana</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Logging-and-Monitoring"><a href="#Logging-and-Monitoring" class="headerlink" title="Logging and Monitoring"></a>Logging and Monitoring</h1><hr>
<p><a name="introduction-to-logging"></a></p>
<h2 id="Introduction-to-Logging"><a href="#Introduction-to-Logging" class="headerlink" title="Introduction to Logging"></a>Introduction to Logging</h2><p>Logging is a critical component of application development. It helps developers understand the system’s operational state, diagnose issues, and perform performance analysis. Spring WebFlux can integrate with various logging frameworks such as SLF4J, Logback, and Log4j2.</p>
<p><a name="adding-dependencies"></a></p>
<h3 id="Adding-Dependencies"><a href="#Adding-Dependencies" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>To begin, add the Logback dependency to your project (Spring Boot uses Logback by default):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="configuring-logback"></a></p>
<h3 id="Configuring-Logback"><a href="#Configuring-Logback" class="headerlink" title="Configuring Logback"></a>Configuring Logback</h3><p>Create or modify the <code>logback-spring.xml</code> file in the <code>src/main/resources</code> directory:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/base.xml&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework.web&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.example&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="using-logging-in-code"></a></p>
<h3 id="Using-Logging-in-Code"><a href="#Using-Logging-in-Code" class="headerlink" title="Using Logging in Code"></a>Using Logging in Code</h3><p>Use SLF4J to log messages in your code:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(BookService.class);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Adding book: &#123;&#125;&quot;</span>, book.getTitle());</span><br><span class="line">        <span class="comment">// Other logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="introduction-to-monitoring"></a></p>
<h2 id="Introduction-to-Monitoring"><a href="#Introduction-to-Monitoring" class="headerlink" title="Introduction to Monitoring"></a>Introduction to Monitoring</h2><p>Monitoring is crucial for ensuring system stability and performance. By monitoring, we can promptly detect and address system issues. Spring Boot Actuator and Prometheus are commonly used monitoring tools.</p>
<p><a name="spring-boot-actuator"></a></p>
<h3 id="Spring-Boot-Actuator"><a href="#Spring-Boot-Actuator" class="headerlink" title="Spring Boot Actuator"></a>Spring Boot Actuator</h3><p>Spring Boot Actuator provides a wealth of monitoring and management endpoints, making it easier for developers to monitor and manage applications.</p>
<p><a name="adding-actuator-dependencies"></a></p>
<h4 id="Adding-Actuator-Dependencies"><a href="#Adding-Actuator-Dependencies" class="headerlink" title="Adding Actuator Dependencies"></a>Adding Actuator Dependencies</h4><p>Add the Actuator dependency to your project:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="configuring-actuator"></a></p>
<h4 id="Configuring-Actuator"><a href="#Configuring-Actuator" class="headerlink" title="Configuring Actuator"></a>Configuring Actuator</h4><p>Enable Actuator endpoints in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">health,info,metrics,loggers,httptrace</span></span><br><span class="line"><span class="attr">management.endpoint.health.show-details</span>=<span class="string">always</span></span><br></pre></td></tr></table></figure>

<p><a name="using-actuator-endpoints"></a></p>
<h4 id="Using-Actuator-Endpoints"><a href="#Using-Actuator-Endpoints" class="headerlink" title="Using Actuator Endpoints"></a>Using Actuator Endpoints</h4><p>Access <code>http://localhost:8080/actuator</code> to view all available Actuator endpoints, such as health checks (<code>health</code>), application information (<code>info</code>), and loggers (<code>loggers</code>).</p>
<p><a name="monitoring-with-prometheus-and-grafana"></a></p>
<h3 id="Monitoring-with-Prometheus-and-Grafana"><a href="#Monitoring-with-Prometheus-and-Grafana" class="headerlink" title="Monitoring with Prometheus and Grafana"></a>Monitoring with Prometheus and Grafana</h3><p>Prometheus and Grafana are popular open-source monitoring and visualization tools suitable for monitoring Spring WebFlux applications.</p>
<p><a name="adding-prometheus-dependencies"></a></p>
<h4 id="Adding-Prometheus-Dependencies"><a href="#Adding-Prometheus-Dependencies" class="headerlink" title="Adding Prometheus Dependencies"></a>Adding Prometheus Dependencies</h4><p>Add the Prometheus dependency to your project:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="configuring-prometheus"></a></p>
<h4 id="Configuring-Prometheus"><a href="#Configuring-Prometheus" class="headerlink" title="Configuring Prometheus"></a>Configuring Prometheus</h4><p>Configure Prometheus in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">prometheus</span></span><br><span class="line"><span class="attr">management.metrics.export.prometheus.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<p><a name="configuring-prometheus-server"></a></p>
<h4 id="Configuring-Prometheus-Server"><a href="#Configuring-Prometheus-Server" class="headerlink" title="Configuring Prometheus Server"></a>Configuring Prometheus Server</h4><p>Add the Spring WebFlux application’s monitoring configuration to Prometheus’s <code>prometheus.yml</code> file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring-webflux-app&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/actuator/prometheus&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:8080&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><a name="visualizing-with-grafana"></a></p>
<h4 id="Visualizing-with-Grafana"><a href="#Visualizing-with-Grafana" class="headerlink" title="Visualizing with Grafana"></a>Visualizing with Grafana</h4><p>Add the Prometheus data source in Grafana and create dashboards to monitor key metrics of the Spring WebFlux application, such as response times, request counts, and error rates.</p>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to implement effective logging and monitoring in Spring WebFlux applications. By using Logback for logging and Spring Boot Actuator, Prometheus, and Grafana for monitoring, we can ensure system observability and stability. These practices are essential for maintaining the health and performance of modern reactive applications.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XV/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XV</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 14:07:35" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:35-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In the previous fourteen articles, we have delved into the foundational concepts of Spring WebFlux, Reactor, error handling, data stream transformation, reactive database access, performance optimization, security, testing, deployment and operations, best practices, common pitfalls, and integration with microservices architecture. This article will explore how to implement real-time data push functionality using Spring WebFlux to build high-performance, real-time responsive applications.</p>
<ul>
<li><a href="#real-time-data-push">Real-Time Data Push</a><ul>
<li><a href="#introduction-to-real-time-data-push">Introduction to Real-Time Data Push</a></li>
<li><a href="#implementing-real-time-data-push-with-websocket">Implementing Real-Time Data Push with WebSocket</a><ul>
<li><a href="#adding-dependencies">Adding Dependencies</a></li>
<li><a href="#configuring-websocket">Configuring WebSocket</a></li>
<li><a href="#creating-a-websocket-handler">Creating a WebSocket Handler</a></li>
<li><a href="#configuring-websocket-routes">Configuring WebSocket Routes</a></li>
</ul>
</li>
<li><a href="#implementing-real-time-data-push-with-server-sent-events-sse">Implementing Real-Time Data Push with Server-Sent Events (SSE)</a><ul>
<li><a href="#creating-an-sse-controller">Creating an SSE Controller</a></li>
</ul>
</li>
<li><a href="#application-scenarios-for-real-time-data-push">Application Scenarios for Real-Time Data Push</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Real-Time-Data-Push"><a href="#Real-Time-Data-Push" class="headerlink" title="Real-Time Data Push"></a>Real-Time Data Push</h1><hr>
<p><a name="introduction-to-real-time-data-push"></a></p>
<h2 id="Introduction-to-Real-Time-Data-Push"><a href="#Introduction-to-Real-Time-Data-Push" class="headerlink" title="Introduction to Real-Time Data Push"></a>Introduction to Real-Time Data Push</h2><p>Real-time data push is a technology that enables servers to actively send updated data to clients without waiting for client requests. This technology is highly suitable for applications that require timely updates, such as stock prices, real-time chat, online games, and more. Common real-time data push technologies include WebSocket, Server-Sent Events (SSE), and Long Polling.</p>
<p><a name="implementing-real-time-data-push-with-websocket"></a></p>
<h2 id="Implementing-Real-Time-Data-Push-with-WebSocket"><a href="#Implementing-Real-Time-Data-Push-with-WebSocket" class="headerlink" title="Implementing Real-Time Data Push with WebSocket"></a>Implementing Real-Time Data Push with WebSocket</h2><p>WebSocket is a full-duplex communication protocol that allows real-time communication between the server and the client over a single TCP connection. Spring WebFlux provides robust support for WebSocket.</p>
<p><a name="adding-dependencies"></a></p>
<h3 id="Adding-Dependencies"><a href="#Adding-Dependencies" class="headerlink" title="Adding Dependencies"></a>Adding Dependencies</h3><p>To start, add the necessary WebSocket dependencies to your project:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="configuring-websocket"></a></p>
<h3 id="Configuring-WebSocket"><a href="#Configuring-WebSocket" class="headerlink" title="Configuring WebSocket"></a>Configuring WebSocket</h3><p>Next, create a WebSocket configuration class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.config.EnableWebFlux;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.config.WebFluxConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.support.WebSocketHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebFlux</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title class_">WebFluxConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebSocketHandlerAdapter <span class="title function_">handlerAdapter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebSocketHandlerAdapter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="creating-a-websocket-handler"></a></p>
<h3 id="Creating-a-WebSocket-Handler"><a href="#Creating-a-WebSocket-Handler" class="headerlink" title="Creating a WebSocket Handler"></a>Creating a WebSocket Handler</h3><p>Create a WebSocket handler to manage client connections:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.WebSocketSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.WebSocketHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RealTimeDataHandler</span> <span class="keyword">implements</span> <span class="title class_">WebSocketHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(WebSocketSession session)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> session.send(</span><br><span class="line">                session.receive()</span><br><span class="line">                        .map(msg -&gt; session.textMessage(<span class="string">&quot;Server received: &quot;</span> + msg.getPayloadAsText()))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="configuring-websocket-routes"></a></p>
<h3 id="Configuring-WebSocket-Routes"><a href="#Configuring-WebSocket-Routes" class="headerlink" title="Configuring WebSocket Routes"></a>Configuring WebSocket Routes</h3><p>Finally, configure the WebSocket routes:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.support.WebSocketHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.support.WebSocketService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.upgrade.ReactorNettyRequestUpgradeStrategy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.support.DefaultHandshakeHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.WebSocketService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.socket.server.support.ReactorNettyRequestUpgradeStrategy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketRouterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebSocketService <span class="title function_">webSocketService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebSocketService</span>(<span class="keyword">new</span> <span class="title class_">ReactorNettyRequestUpgradeStrategy</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebSocketHandlerAdapter <span class="title function_">webSocketHandlerAdapter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebSocketHandlerAdapter</span>(webSocketService());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebSocketHandler <span class="title function_">realTimeDataHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RealTimeDataHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="implementing-real-time-data-push-with-server-sent-events-sse"></a></p>
<h2 id="Implementing-Real-Time-Data-Push-with-Server-Sent-Events-SSE"><a href="#Implementing-Real-Time-Data-Push-with-Server-Sent-Events-SSE" class="headerlink" title="Implementing Real-Time Data Push with Server-Sent Events (SSE)"></a>Implementing Real-Time Data Push with Server-Sent Events (SSE)</h2><p>Server-Sent Events (SSE) is a technology that allows servers to push real-time updates to browsers over HTTP. Spring WebFlux also provides excellent support for SSE.</p>
<p><a name="creating-an-sse-controller"></a></p>
<h3 id="Creating-an-SSE-Controller"><a href="#Creating-an-SSE-Controller" class="headerlink" title="Creating an SSE Controller"></a>Creating an SSE Controller</h3><p>Create an SSE controller to push real-time data:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSEController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/sse&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">streamEvents</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.interval(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">                .map(sequence -&gt; <span class="string">&quot;Server Time: &quot;</span> + LocalTime.now().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="application-scenarios-for-real-time-data-push"></a></p>
<h2 id="Application-Scenarios-for-Real-Time-Data-Push"><a href="#Application-Scenarios-for-Real-Time-Data-Push" class="headerlink" title="Application Scenarios for Real-Time Data Push"></a>Application Scenarios for Real-Time Data Push</h2><p>Real-time data push is beneficial in various applications, including:</p>
<ul>
<li><strong>Financial Applications</strong>: Real-time updates for stock prices, market indices, etc.</li>
<li><strong>Real-Time Chat</strong>: Implementing online chat applications with instant message reception.</li>
<li><strong>Online Games</strong>: Pushing game states and player actions.</li>
<li><strong>Internet of Things (IoT)</strong>: Real-time monitoring and control of IoT devices.</li>
</ul>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to implement real-time data push using Spring WebFlux. By leveraging WebSocket and Server-Sent Events, we can build high-performance, real-time responsive applications. These technologies are essential for modern applications that require instant data updates and real-time interactions.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/Reactive-Programming-in-Spring-WebFlux-Series-XIV/" class="post-title-link" itemprop="url">Reactive Programming in Spring WebFlux Series - XIV</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-24 14:07:24" itemprop="dateCreated datePublished" datetime="2024-10-24T14:07:24-04:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/Spring-Boot/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#event-driven-architecture">Event-Driven Architecture</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-event-driven-architecture">What is Event-Driven Architecture?</a></li>
<li><a href="#why-choose-event-driven-architecture">Why Choose Event-Driven Architecture?</a></li>
<li><a href="#building-event-driven-architecture-with-spring-webflux">Building Event-Driven Architecture with Spring WebFlux</a></li>
<li><a href="#project-setup">Project Setup</a></li>
<li><a href="#configuring-kafka">Configuring Kafka</a></li>
<li><a href="#event-model">Event Model</a></li>
<li><a href="#event-producer">Event Producer</a></li>
<li><a href="#event-consumer">Event Consumer</a></li>
<li><a href="#service-layer-integration-with-event-driven">Service Layer Integration with Event-Driven</a></li>
<li><a href="#connecting-the-pieces">Connecting the Pieces</a><ul>
<li><a href="#bookeventconsumer-listening-to-the-topic">BookEventConsumer Listening to the Topic</a></li>
<li><a href="#bookeventproducer-producing-events-to-the-topic">BookEventProducer Producing Events to the Topic</a></li>
<li><a href="#bookservice-integration">BookService Integration</a></li>
<li><a href="#example-of-event-handling-in-bookeventconsumer">Example of Event Handling in BookEventConsumer</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Event-Driven-Architecture"><a href="#Event-Driven-Architecture" class="headerlink" title="Event-Driven Architecture"></a>Event-Driven Architecture</h1><hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the previous thirteen articles, we have explored the foundational concepts of Spring WebFlux, Reactor, error handling, data stream transformations, reactive database access, performance optimization, security, testing, deployment and operations, best practices and common pitfalls, as well as integration with microservices architecture. This article will delve into how to use Spring WebFlux to build an event-driven architecture, enhancing system scalability and responsiveness.</p>
<p><a name="what-is-event-driven-architecture"></a></p>
<h2 id="What-is-Event-Driven-Architecture"><a href="#What-is-Event-Driven-Architecture" class="headerlink" title="What is Event-Driven Architecture?"></a>What is Event-Driven Architecture?</h2><p>Event-Driven Architecture (EDA) is a software design pattern where the behavior of the system is driven by events. Events can represent user actions, system state changes, or other triggering conditions. EDA typically consists of the following components:</p>
<ul>
<li><strong>Event</strong>: Represents a state change or action within the system.</li>
<li><strong>Event Producer</strong>: Generates and publishes events.</li>
<li><strong>Event Consumer</strong>: Subscribes to and processes events.</li>
<li><strong>Event Bus</strong>: Manages the transmission and routing of events.</li>
</ul>
<p><a name="why-choose-event-driven-architecture"></a></p>
<h2 id="Why-Choose-Event-Driven-Architecture"><a href="#Why-Choose-Event-Driven-Architecture" class="headerlink" title="Why Choose Event-Driven Architecture?"></a>Why Choose Event-Driven Architecture?</h2><p>Event-Driven Architecture offers several advantages:</p>
<ul>
<li><strong>Loose Coupling</strong>: Producers and consumers communicate via events, reducing system coupling.</li>
<li><strong>Scalability</strong>: Producers and consumers can be scaled independently based on load, enhancing system scalability.</li>
<li><strong>Real-Time Responsiveness</strong>: Enables real-time event handling, improving system responsiveness and flexibility.</li>
</ul>
<p><a name="building-event-driven-architecture-with-spring-webflux"></a></p>
<h2 id="Building-Event-Driven-Architecture-with-Spring-WebFlux"><a href="#Building-Event-Driven-Architecture-with-Spring-WebFlux" class="headerlink" title="Building Event-Driven Architecture with Spring WebFlux"></a>Building Event-Driven Architecture with Spring WebFlux</h2><p>Spring WebFlux and Project Reactor provide robust support for building event-driven architectures. Below is an example of using Spring WebFlux and Kafka to construct an event-driven architecture.</p>
<p><a name="project-setup"></a></p>
<h2 id="Project-Setup"><a href="#Project-Setup" class="headerlink" title="Project Setup"></a>Project Setup</h2><p>First, create a Spring Boot project and include the necessary dependencies:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.r2dbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>r2dbc-h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a name="configuring-kafka"></a></p>
<h2 id="Configuring-Kafka"><a href="#Configuring-Kafka" class="headerlink" title="Configuring Kafka"></a>Configuring Kafka</h2><p>Configure Kafka in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.bootstrap-servers</span>=<span class="string">localhost:9092</span></span><br><span class="line"><span class="attr">spring.kafka.consumer.group-id</span>=<span class="string">book-consumers</span></span><br><span class="line"><span class="attr">spring.kafka.consumer.auto-offset-reset</span>=<span class="string">earliest</span></span><br><span class="line"><span class="attr">spring.kafka.producer.key-serializer</span>=<span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line"><span class="attr">spring.kafka.producer.value-serializer</span>=<span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line"><span class="attr">spring.kafka.consumer.key-deserializer</span>=<span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line"><span class="attr">spring.kafka.consumer.value-deserializer</span>=<span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br></pre></td></tr></table></figure>

<p><a name="event-model"></a></p>
<h2 id="Event-Model"><a href="#Event-Model" class="headerlink" title="Event Model"></a>Event Model</h2><p>Define a simple event model:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String eventId;</span><br><span class="line">    <span class="keyword">private</span> String eventType;</span><br><span class="line">    <span class="keyword">private</span> Book book;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Constructors, Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="event-producer"></a></p>
<h2 id="Event-Producer"><a href="#Event-Producer" class="headerlink" title="Event Producer"></a>Event Producer</h2><p>Create an event producer to publish book-related events:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.kafka.core.KafkaTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookEventProducer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> KafkaTemplate&lt;String, BookEvent&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookEventProducer</span><span class="params">(KafkaTemplate&lt;String, BookEvent&gt; kafkaTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.kafkaTemplate = kafkaTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">sendEvent</span><span class="params">(BookEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromRunnable(() -&gt; kafkaTemplate.send(<span class="string">&quot;book-events&quot;</span>, event));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="event-consumer"></a></p>
<h2 id="Event-Consumer"><a href="#Event-Consumer" class="headerlink" title="Event Consumer"></a>Event Consumer</h2><p>Create an event consumer to handle book-related events:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.kafka.annotation.KafkaListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.FluxSink;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookEventConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FluxSink&lt;BookEvent&gt; sink;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookEventConsumer</span><span class="params">(FluxSink&lt;BookEvent&gt; sink)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sink = sink;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;book-events&quot;, groupId = &quot;book-consumers&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">(BookEvent event)</span> &#123;</span><br><span class="line">        sink.next(event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="service-layer-integration-with-event-driven"></a></p>
<h2 id="Service-Layer-Integration-with-Event-Driven"><a href="#Service-Layer-Integration-with-Event-Driven" class="headerlink" title="Service Layer Integration with Event-Driven"></a>Service Layer Integration with Event-Driven</h2><p>Integrate event-driven architecture in the <code>BookService</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookRepository bookRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookEventProducer eventProducer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(BookRepository bookRepository, BookEventProducer eventProducer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookRepository = bookRepository;</span><br><span class="line">        <span class="built_in">this</span>.eventProducer = eventProducer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Book&gt; <span class="title function_">addBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.save(book)</span><br><span class="line">            .flatMap(savedBook -&gt; &#123;</span><br><span class="line">                <span class="type">BookEvent</span> <span class="variable">event</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookEvent</span>(UUID.randomUUID().toString(), <span class="string">&quot;BOOK_CREATED&quot;</span>, savedBook);</span><br><span class="line">                <span class="keyword">return</span> eventProducer.sendEvent(event).thenReturn(savedBook);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">deleteBook</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookRepository.findById(id)</span><br><span class="line">            .flatMap(book -&gt; &#123;</span><br><span class="line">                <span class="type">BookEvent</span> <span class="variable">event</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookEvent</span>(UUID.randomUUID().toString(), <span class="string">&quot;BOOK_DELETED&quot;</span>, book);</span><br><span class="line">                <span class="keyword">return</span> eventProducer.sendEvent(event).then(bookRepository.deleteById(id));</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="connecting-the-pieces"></a></p>
<h2 id="Connecting-the-Pieces"><a href="#Connecting-the-Pieces" class="headerlink" title="Connecting the Pieces"></a>Connecting the Pieces</h2><h3 id="BookEventConsumer-Listening-to-the-Topic"><a href="#BookEventConsumer-Listening-to-the-Topic" class="headerlink" title="BookEventConsumer Listening to the Topic"></a>BookEventConsumer Listening to the Topic</h3><p>The <code>BookEventConsumer</code> listens to the Kafka topic <code>book-events</code> and processes incoming events. When an event is received, it pushes the event to a <code>FluxSink</code>, which can be used to propagate the event to other parts of the application.</p>
<h3 id="BookEventProducer-Producing-Events-to-the-Topic"><a href="#BookEventProducer-Producing-Events-to-the-Topic" class="headerlink" title="BookEventProducer Producing Events to the Topic"></a>BookEventProducer Producing Events to the Topic</h3><p>The <code>BookEventProducer</code> is responsible for producing events to the Kafka topic <code>book-events</code>. When a book is added or deleted, the <code>BookService</code> uses the <code>BookEventProducer</code> to send corresponding events.</p>
<h3 id="BookService-Integration"><a href="#BookService-Integration" class="headerlink" title="BookService Integration"></a>BookService Integration</h3><p>The <code>BookService</code> integrates the event-driven architecture by:</p>
<ol>
<li><strong>Producing Events</strong>: When a book is added or deleted, the <code>BookService</code> creates a <code>BookEvent</code> and sends it to the Kafka topic using the <code>BookEventProducer</code>.</li>
<li><strong>Consuming Events</strong>: The <code>BookEventConsumer</code> listens to the Kafka topic and processes the events. Depending on the event type, it can trigger further actions, such as updating a cache or sending notifications.</li>
</ol>
<h3 id="Example-of-Event-Handling-in-BookEventConsumer"><a href="#Example-of-Event-Handling-in-BookEventConsumer" class="headerlink" title="Example of Event Handling in BookEventConsumer"></a>Example of Event Handling in BookEventConsumer</h3><p>To illustrate how the <code>BookEventConsumer</code> can integrate with the <code>BookService</code>, let’s extend the <code>BookEventConsumer</code> to handle specific events:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.kafka.annotation.KafkaListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.FluxSink;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookEventConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FluxSink&lt;BookEvent&gt; sink;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookEventConsumer</span><span class="params">(FluxSink&lt;BookEvent&gt; sink, BookService bookService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sink = sink;</span><br><span class="line">        <span class="built_in">this</span>.bookService = bookService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;book-events&quot;, groupId = &quot;book-consumers&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">(BookEvent event)</span> &#123;</span><br><span class="line">        sink.next(event);</span><br><span class="line">        handleEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(BookEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getEventType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;BOOK_CREATED&quot;</span>:</span><br><span class="line">                bookService.handleBookCreated(event.getBook()).subscribe();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;BOOK_DELETED&quot;</span>:</span><br><span class="line">                bookService.handleBookDeleted(event.getBook().getId()).subscribe();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// Handle other event types as needed</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, the <code>BookEventConsumer</code> not only pushes events to the <code>FluxSink</code> but also calls methods in the <code>BookService</code> to handle specific events. This ensures that the business logic related to event handling is centralized in the <code>BookService</code>.</p>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this article, we explored how to build an event-driven architecture using Spring WebFlux. By leveraging event-driven architecture, we can enhance system scalability and responsiveness, creating more flexible and efficient distributed systems. The integration of <code>BookEventProducer</code>, <code>BookEventConsumer</code>, and <code>BookService</code> demonstrates how events can be produced, consumed, and handled within a reactive and event-driven context.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
