<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="WhereQ">
<meta property="og:url" content="https://www.whereq.com/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Dazhi Zhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">WhereQ</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">147</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">132</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">87</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/16/Referential-Transparency-RT-Concept/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/16/Referential-Transparency-RT-Concept/" class="post-title-link" itemprop="url">Referential Transparency (RT) Concept</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-16 10:31:12 / Modified: 10:34:43" itemprop="dateCreated datePublished" datetime="2025-12-16T10:31:12-05:00">2025-12-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Referential-Transparency/" itemprop="url" rel="index"><span itemprop="name">Referential Transparency</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Referential-Transparency/Functional-Programming/" itemprop="url" rel="index"><span itemprop="name">Functional Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="üîç-1-Referential-Transparency-RT-Concept-Explained"><a href="#üîç-1-Referential-Transparency-RT-Concept-Explained" class="headerlink" title="üîç 1. Referential Transparency (RT) Concept Explained"></a>üîç 1. Referential Transparency (RT) Concept Explained</h2><h3 id="What-is-Referential-Transparency"><a href="#What-is-Referential-Transparency" class="headerlink" title="What is Referential Transparency?"></a>What is Referential Transparency?</h3><p><strong>Referential Transparency (RT)</strong> is a core concept in Functional Programming (FP) which states that an expression can be replaced by its resulting value without changing the behavior or outcome of the entire program.</p>
<p>Simply put, if a function or expression is referentially transparent, every time it is called with the same input (arguments), its <strong>output must be identical</strong>, and it <strong>must not produce any observable side effects</strong>.</p>
<h3 id="Two-Key-Requirements-for-Referential-Transparency"><a href="#Two-Key-Requirements-for-Referential-Transparency" class="headerlink" title="Two Key Requirements for Referential Transparency:"></a>Two Key Requirements for Referential Transparency:</h3><ol>
<li><strong>Purity of Function:</strong><ul>
<li><strong>Same Input $\implies$ Same Output:</strong> When the function is called with the same parameters, the result must always be the same, regardless of when or where it is executed.</li>
<li><strong>No Side Effects:</strong> The function must not modify any external state (such as global variables, databases, file systems, or printing to the console).</li>
</ul>
</li>
<li><strong>Substitutability:</strong><ul>
<li>If an expression is referentially transparent, we can substitute the expression with its resulting value anywhere in the program without affecting the final result.</li>
</ul>
</li>
</ol>
<h3 id="Advantages-of-Referential-Transparency"><a href="#Advantages-of-Referential-Transparency" class="headerlink" title="Advantages of Referential Transparency:"></a>Advantages of Referential Transparency:</h3><ul>
<li><strong>Easier Reasoning:</strong> Since functions do not depend on or modify external state, we can understand and test each function in isolation, without worrying about execution order or the global environment.</li>
<li><strong>Concurrency Safety:</strong> Functions that do not modify shared state are inherently safe for parallel computation and multithreaded environments, eliminating the need for complex locking mechanisms.</li>
<li><strong>Compiler Optimization:</strong> Compilers can safely perform optimizations, such as Memoization (caching results) or common sub-expression elimination.</li>
</ul>
<hr>
<h2 id="üíª-2-Code-Examples-RT-vs-Referential-Opacity"><a href="#üíª-2-Code-Examples-RT-vs-Referential-Opacity" class="headerlink" title="üíª 2. Code Examples: RT vs. Referential Opacity"></a>üíª 2. Code Examples: RT vs. Referential Opacity</h2><p>We will use <strong>JavaScript</strong> for the code samples as it supports both functional and imperative programming styles.</p>
<h3 id="Example-1-Referentially-Transparent-Function-Pure-Function"><a href="#Example-1-Referentially-Transparent-Function-Pure-Function" class="headerlink" title="Example 1: Referentially Transparent Function (Pure Function)"></a>Example 1: Referentially Transparent Function (Pure Function)</h3><p>A simple addition function that neither depends on nor modifies external state.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pure Function (Referentially Transparent)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. Same input -&gt; Same output: add(5, 10) will always return 15.</span></span><br><span class="line">  <span class="comment">// 2. No side effects: It does not change any global variables or perform I/O.</span></span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Proof of Substitution (The program&#x27;s behavior remains unchanged)</span></span><br><span class="line"><span class="keyword">const</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> y = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original Expression</span></span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">add</span>(x, y) * <span class="number">2</span>; <span class="comment">// add(5, 10) -&gt; 15. result1 = 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Substituted Expression</span></span><br><span class="line"><span class="comment">// We replace the function call add(x, y) with its calculated result (15)</span></span><br><span class="line"><span class="keyword">const</span> result2 = <span class="number">15</span> * <span class="number">2</span>;       <span class="comment">// result2 = 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Result: result1 === result2. The substitution worked.</span></span><br></pre></td></tr></table></figure>

<h3 id="Example-2-Referentially-Opaque-Functions-Impure-Functions"><a href="#Example-2-Referentially-Opaque-Functions-Impure-Functions" class="headerlink" title="Example 2: Referentially Opaque Functions (Impure Functions)"></a>Example 2: Referentially Opaque Functions (Impure Functions)</h3><h4 id="Case-A-Dependency-on-External-State-Side-Effect-Reading-Writing-Global-State"><a href="#Case-A-Dependency-on-External-State-Side-Effect-Reading-Writing-Global-State" class="headerlink" title="Case A: Dependency on External State (Side Effect: Reading&#x2F;Writing Global State)"></a>Case A: Dependency on External State (Side Effect: Reading&#x2F;Writing Global State)</h4><p>The function‚Äôs result depends on a mutable global variable.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> counter = <span class="number">0</span>; <span class="comment">// Mutable External State</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Impure Function (Referentially Opaque)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNextId</span>(<span class="params"></span>) &#123;</span><br><span class="line">  counter++; <span class="comment">// Side Effect: Modifies the external state</span></span><br><span class="line">  <span class="keyword">return</span> counter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// First call</span></span><br><span class="line"><span class="keyword">const</span> id1 = <span class="title function_">getNextId</span>(); <span class="comment">// id1 = 1, counter = 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Second call (Same input, different output)</span></span><br><span class="line"><span class="keyword">const</span> id2 = <span class="title function_">getNextId</span>(); <span class="comment">// id2 = 2, counter = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Proof of Substitution Failure</span></span><br><span class="line"><span class="comment">// Let&#x27;s try to substitute the first call (getNextId()) with its value (1):</span></span><br><span class="line"><span class="keyword">const</span> resultA = id1 + <span class="title function_">getNextId</span>(); <span class="comment">// 1 + 2 = 3</span></span><br><span class="line"><span class="comment">// If we substitute:</span></span><br><span class="line"><span class="keyword">const</span> resultB = <span class="number">1</span> + <span class="number">1</span>; <span class="comment">// 2  &lt;-- Substitution failed, because the second call returned 2, not 1.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Result: resultA !== resultB.</span></span><br><span class="line"><span class="comment">// The output of getNextId() is unpredictable because it depends on when it was previously called.</span></span><br></pre></td></tr></table></figure>

<h4 id="Case-B-Producing-a-Side-Effect-I-O-Operation"><a href="#Case-B-Producing-a-Side-Effect-I-O-Operation" class="headerlink" title="Case B: Producing a Side Effect (I&#x2F;O Operation)"></a>Case B: Producing a Side Effect (I&#x2F;O Operation)</h4><p>The function performs an external, non-returnable action (I&#x2F;O).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Impure Function (Referentially Opaque)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logAndReturn</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Processing value: &quot;</span> + value); <span class="comment">// Side Effect: I/O operation (printing to console)</span></span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original Expression</span></span><br><span class="line"><span class="keyword">const</span> output1 = <span class="title function_">logAndReturn</span>(<span class="number">10</span>); <span class="comment">// Prints &quot;Processing value: 10&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Substituted Expression</span></span><br><span class="line"><span class="comment">// Replacing logAndReturn(10) with its return value 10</span></span><br><span class="line"><span class="keyword">const</span> output2 = <span class="number">10</span>; <span class="comment">// Does not print anything</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Result: output1 === output2 (The values are the same), but the program&#x27;s external behavior (console output) has changed.</span></span><br><span class="line"><span class="comment">// Because the substitution altered the overall program behavior (losing the logging action), logAndReturn is not referentially transparent.</span></span><br></pre></td></tr></table></figure>

<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul>
<li><strong>Referential Transparency is the manifestation of pure functions.</strong> By consistently writing functions that <strong>do not modify external state</strong> and <strong>do not depend on external mutable state</strong>, your code will achieve referential transparency.</li>
<li>In real-world applications, side effects (like I&#x2F;O, network requests) are necessary. Functional programming principles advocate for <strong>isolating these side effects</strong> and managing them explicitly using concepts like Monads to keep the core application logic referentially transparent.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/02/Spring-WebFlux-Guide-2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/02/Spring-WebFlux-Guide-2025/" class="post-title-link" itemprop="url">Spring WebFlux Guide - 2025</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-02 23:05:55 / Modified: 23:11:41" itemprop="dateCreated datePublished" datetime="2025-12-02T23:05:55-05:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a comprehensive deep dive into the most crucial operators in <strong>Project Reactor</strong>, which is the foundation of <strong>Spring WebFlux</strong>. Understanding these operators is key to mastering non-blocking, reactive programming.</p>
<p>The operators are organized into functional categories, detailing their usage and real-world application.</p>
<hr>
<h2 id="1-üèóÔ∏è-Composition-and-Transformation-Operators"><a href="#1-üèóÔ∏è-Composition-and-Transformation-Operators" class="headerlink" title="1. üèóÔ∏è Composition and Transformation Operators"></a>1. üèóÔ∏è Composition and Transformation Operators</h2><p>These operators modify the data emitted by a <code>Publisher</code> (Mono or Flux).</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>map()</code></strong></td>
<td align="left"><code>T -&gt; V</code> (Synchronous transformation)</td>
<td align="left">Applies a synchronous function to each item. <strong>Returns a simple value.</strong></td>
<td align="left">Converting a database entity (<code>UserEntity</code>) into a Data Transfer Object (<code>UserDTO</code>) after retrieval.</td>
</tr>
<tr>
<td align="left"><strong><code>flatMap()</code></strong></td>
<td align="left"><code>T -&gt; Publisher&lt;V&gt;</code> (Asynchronous transformation)</td>
<td align="left">Applies an asynchronous function that returns a new <code>Publisher</code>. Essential for <strong>chaining non-blocking I&#x2F;O operations.</strong></td>
<td align="left">Chaining microservice calls: Get <code>userId</code> (Mono A) $\rightarrow$ Use <code>userId</code> to call an external service (Mono B) $\rightarrow$ Use result B to save to the database (Mono C).</td>
</tr>
<tr>
<td align="left"><strong><code>concatMap()</code></strong></td>
<td align="left"><code>T -&gt; Publisher&lt;V&gt;</code> (Sequential <code>flatMap</code>)</td>
<td align="left">Similar to <code>flatMap</code>, but it processes and emits the results of the inner <code>Publisher</code> <strong>sequentially</strong>, preserving the original order of elements.</td>
<td align="left">Processing file uploads: Ensures that multiple files in a list are processed and saved to storage one after the other, respecting the order received, even though the I&#x2F;O operations are async.</td>
</tr>
<tr>
<td align="left"><strong><code>filter()</code></strong></td>
<td align="left"><code>T -&gt; Boolean</code></td>
<td align="left">Selectively includes items based on a predicate.</td>
<td align="left">Excluding users with an <code>isActive: false</code> status before returning a list of clients.</td>
</tr>
<tr>
<td align="left"><strong><code>cast()</code></strong></td>
<td align="left"><code>T -&gt; V</code> (Type conversion)</td>
<td align="left">Converts each element to a specified type.</td>
<td align="left">Converting an object retrieved from a generic cache (<code>Object</code>) to its expected type (<code>Product</code>).</td>
</tr>
</tbody></table>
<hr>
<h2 id="2-ü§ù-Combination-and-Merging-Operators"><a href="#2-ü§ù-Combination-and-Merging-Operators" class="headerlink" title="2. ü§ù Combination and Merging Operators"></a>2. ü§ù Combination and Merging Operators</h2><p>These operators combine the output from two or more source <code>Publishers</code>.</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>merge()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;... -&gt; Flux&lt;T&gt;</code> (Non-deterministic)</td>
<td align="left"><strong>Interleaves</strong> the elements from multiple sources as they arrive. The output order <strong>is not guaranteed</strong> and depends on timing.</td>
<td align="left">Combining real-time notifications: Combining two async streams of notifications (e.g., email and SMS alerts) into one feed where the order of arrival is acceptable.</td>
</tr>
<tr>
<td align="left"><strong><code>zip()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;, Publisher&lt;V&gt; -&gt; Mono&lt;Tuple2&lt;T, V&gt;&gt;</code> (Pairwise)</td>
<td align="left"><strong>Combines the <em>n</em>-th element</strong> from each source into a <code>Tuple</code> (or custom object) once all sources have emitted an element.</td>
<td align="left">Parallel data enrichment: Fetching a user profile (<code>Mono&lt;User&gt;</code>) and their recent transaction history (<code>Mono&lt;History&gt;</code>) concurrently, then combining both results into a single object for the API response.</td>
</tr>
<tr>
<td align="left"><strong><code>combineLatest()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;, Publisher&lt;V&gt; -&gt; Flux&lt;Tuple2&lt;T, V&gt;&gt;</code> (Emission-driven)</td>
<td align="left">Emits a new item whenever <strong>any</strong> source emits an item, combining the newly emitted item with the <strong>latest</strong> item from all other sources.</td>
<td align="left">Real-time dashboards: Combining a stream of stock prices with a stream of news headlines. A price update triggers a new emission with the latest price and the latest headline.</td>
</tr>
<tr>
<td align="left"><strong><code>concat()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;... -&gt; Flux&lt;T&gt;</code> (Sequential)</td>
<td align="left"><strong>Appends</strong> one <code>Publisher</code> after another. The second source does not start emitting until the first source completes.</td>
<td align="left">Fallback data loading: First attempt to load data from a fast cache (<code>Mono A</code>). If A completes empty, immediately execute a database query (<code>Mono B</code>).</td>
</tr>
</tbody></table>
<hr>
<h2 id="3-‚è±Ô∏è-Error-Handling-and-Resilience-Operators"><a href="#3-‚è±Ô∏è-Error-Handling-and-Resilience-Operators" class="headerlink" title="3. ‚è±Ô∏è Error Handling and Resilience Operators"></a>3. ‚è±Ô∏è Error Handling and Resilience Operators</h2><p>These operators manage exceptions and provide fallbacks.</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>onErrorReturn()</code></strong></td>
<td align="left"><code>Class&lt;E&gt;, T</code> (Simple fallback value)</td>
<td align="left">When an error of a specific type occurs, it immediately <strong>replaces the error signal with a default, static value</strong> and completes the sequence normally.</td>
<td align="left">Handling an external API timeout: If the <code>weatherService.get()</code> call fails with a <code>TimeoutException</code>, return a cached default value like <code>&quot;Weather Unknown&quot;</code> instead of propagating the error.</td>
</tr>
<tr>
<td align="left"><strong><code>onErrorResume()</code></strong></td>
<td align="left"><code>Class&lt;E&gt;, Function&lt;E, Publisher&lt;V&gt;&gt;</code> (Fallback publisher)</td>
<td align="left">When an error occurs, it <strong>switches to a fallback <code>Publisher</code></strong>.</td>
<td align="left">Database failure: If the primary database query fails, switch to a fallback query that reads from a reliable but slightly stale read replica.</td>
</tr>
<tr>
<td align="left"><strong><code>retry()</code></strong></td>
<td align="left"><code>long times</code> (Retry N times)</td>
<td align="left"><strong>Resubscribes</strong> to the source <code>Publisher</code> upon receiving an error signal, up to a specified number of times.</td>
<td align="left">Transient network errors: Automatically retrying an external HTTP call up to three times to overcome temporary network hiccups before giving up.</td>
</tr>
<tr>
<td align="left"><strong><code>doOnError()</code></strong></td>
<td align="left"><code>Consumer&lt;Throwable&gt;</code> (Side effect)</td>
<td align="left">Allows execution of a <strong>side effect</strong> (logging, metrics tracking) when an error occurs, without modifying or consuming the error itself. The error is still passed downstream.</td>
<td align="left">Logging exceptions: Recording the full stack trace and metrics to a monitoring system before the error is propagated up the pipeline to be handled by an exception handler.</td>
</tr>
</tbody></table>
<hr>
<h2 id="4-üîó-Backpressure-and-Hot-Cold-Operators"><a href="#4-üîó-Backpressure-and-Hot-Cold-Operators" class="headerlink" title="4. üîó Backpressure and Hot&#x2F;Cold Operators"></a>4. üîó Backpressure and Hot&#x2F;Cold Operators</h2><p>These manage resource flow and execution model.</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>subscribeOn()</code></strong></td>
<td align="left"><code>Scheduler</code> (Where execution starts)</td>
<td align="left">Determines the <strong>Scheduler (thread)</strong> on which the entire source execution pipeline begins. Crucial for moving blocking operations off the main Event Loop.</td>
<td align="left"><strong>Moving Blocking Code:</strong> Ensuring a blocking JDBC call or a CPU-intensive synchronous task runs on <code>Schedulers.boundedElastic()</code>.</td>
</tr>
<tr>
<td align="left"><strong><code>publishOn()</code></strong></td>
<td align="left"><code>Scheduler</code> (Where subsequent ops run)</td>
<td align="left">Changes the <code>Scheduler</code> used by <strong>all operators downstream</strong> of this call. Does not affect the source.</td>
<td align="left"><strong>Context Switching:</strong> After a heavy calculation, switching back to <code>Schedulers.parallel()</code> for non-blocking operations to maximize efficiency.</td>
</tr>
<tr>
<td align="left"><strong><code>share()</code></strong></td>
<td align="left"><code>Mono&lt;T&gt; -&gt; Mono&lt;T&gt;</code> (Multi-subscription)</td>
<td align="left">Allows multiple subscribers to share a single subscription to the source <code>Publisher</code>, ensuring the source logic is executed only once.</td>
<td align="left">Caching a slow computation: Executing an expensive initialization task (e.g., loading a large configuration file) once, then providing that result to dozens of services without re-running the load logic.</td>
</tr>
<tr>
<td align="left"><strong><code>delayElements()</code></strong></td>
<td align="left"><code>Duration</code> (Time-based pacing)</td>
<td align="left">Introduces a delay between the emissions of elements, effectively implementing <strong>backpressure by time</strong>.</td>
<td align="left">Throttling a data stream: Pacing a fast stream of data to match the input rate required by a slower downstream component (like a legacy API with strict rate limits).</td>
</tr>
</tbody></table>
<h1 id="Deepseek"><a href="#Deepseek" class="headerlink" title="Deepseek"></a>Deepseek</h1><h1 id="Spring-WebFlux-Operators-Comprehensive-Guide"><a href="#Spring-WebFlux-Operators-Comprehensive-Guide" class="headerlink" title="Spring WebFlux Operators: Comprehensive Guide"></a><strong>Spring WebFlux Operators: Comprehensive Guide</strong></h1><h2 id="Reactive-Programming-Operators-Deep-Dive"><a href="#Reactive-Programming-Operators-Deep-Dive" class="headerlink" title="Reactive Programming Operators Deep Dive"></a>Reactive Programming Operators Deep Dive</h2><hr>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a><strong>Table of Contents</strong></h2><ol>
<li><a href="#1-core-concepts--reactor-basics">Core Concepts &amp; Reactor Basics</a></li>
<li><a href="#2-creation-operators">Creation Operators</a></li>
<li><a href="#3-transformation-operators">Transformation Operators</a></li>
<li><a href="#4-filtering-operators">Filtering Operators</a></li>
<li><a href="#5-combining-operators">Combining Operators</a></li>
<li><a href="#6-error-handling-operators">Error Handling Operators</a></li>
<li><a href="#7-utility-operators">Utility Operators</a></li>
<li><a href="#8-schedulers--threading">Schedulers &amp; Threading</a></li>
<li><a href="#9-backpressure-operators">Backpressure Operators</a></li>
<li><a href="#10-real-world-patterns">Real-World Patterns</a></li>
</ol>
<hr>
<h2 id="1-Core-Concepts-Reactor-Basics"><a href="#1-Core-Concepts-Reactor-Basics" class="headerlink" title="1. Core Concepts &amp; Reactor Basics"></a><strong>1. Core Concepts &amp; Reactor Basics</strong></h2><h3 id="Reactive-Streams-Specification"><a href="#Reactive-Streams-Specification" class="headerlink" title="Reactive Streams Specification"></a><strong>Reactive Streams Specification</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Core Interfaces</span></span><br><span class="line">Publisher&lt;T&gt;    <span class="comment">// Emits data</span></span><br><span class="line">Subscriber&lt;T&gt;   <span class="comment">// Consumes data</span></span><br><span class="line">Subscription    <span class="comment">// Controls flow (backpressure)</span></span><br><span class="line">Processor&lt;T,R&gt;  <span class="comment">// Both publisher and subscriber</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Reactor Implementations</span></span><br><span class="line">Mono&lt;T&gt;         <span class="comment">// 0-1 element</span></span><br><span class="line">Flux&lt;T&gt;         <span class="comment">// 0-N elements</span></span><br></pre></td></tr></table></figure>

<h3 id="Cold-vs-Hot-Publishers"><a href="#Cold-vs-Hot-Publishers" class="headerlink" title="Cold vs Hot Publishers"></a><strong>Cold vs Hot Publishers</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// COLD: Each subscriber gets fresh data stream</span></span><br><span class="line">Flux&lt;Integer&gt; coldFlux = Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .doOnSubscribe(s -&gt; System.out.println(<span class="string">&quot;New subscription&quot;</span>));</span><br><span class="line"></span><br><span class="line">coldFlux.subscribe(); <span class="comment">// Prints: New subscription</span></span><br><span class="line">coldFlux.subscribe(); <span class="comment">// Prints: New subscription (again)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HOT: Shares data among subscribers</span></span><br><span class="line">ConnectableFlux&lt;Integer&gt; hotFlux = Flux.interval(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .publish(); <span class="comment">// Convert to hot publisher</span></span><br><span class="line"></span><br><span class="line">hotFlux.connect(); <span class="comment">// Start emitting</span></span><br><span class="line">hotFlux.subscribe(v -&gt; System.out.println(<span class="string">&quot;Sub1: &quot;</span> + v));</span><br><span class="line">Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">hotFlux.subscribe(v -&gt; System.out.println(<span class="string">&quot;Sub2: &quot;</span> + v)); <span class="comment">// Misses first 3 values</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Use case: Real-time stock prices</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StockController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectableFlux&lt;StockPrice&gt; priceStream;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StockController</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.priceStream = Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">            .map(tick -&gt; fetchStockPrice())</span><br><span class="line">            .publish();</span><br><span class="line">        <span class="built_in">this</span>.priceStream.connect();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/prices&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;StockPrice&gt; <span class="title function_">streamPrices</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> priceStream;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-Creation-Operators"><a href="#2-Creation-Operators" class="headerlink" title="2. Creation Operators"></a><strong>2. Creation Operators</strong></h2><h3 id="Static-Creation-Methods"><a href="#Static-Creation-Methods" class="headerlink" title="Static Creation Methods"></a><strong>Static Creation Methods</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. just() - Fixed values</span></span><br><span class="line">Mono.just(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">Flux.just(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. empty() - Complete without value</span></span><br><span class="line">Mono.empty()  <span class="comment">// Completes immediately</span></span><br><span class="line">Flux.empty()  <span class="comment">// Completes immediately</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. error() - Complete with error</span></span><br><span class="line">Mono.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Failed&quot;</span>))</span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Failed&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. never() - Never completes (for testing)</span></span><br><span class="line">Mono.never()</span><br><span class="line">Flux.never()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. from...() - From existing sources</span></span><br><span class="line">Flux.fromIterable(List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">Flux.fromStream(Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">Flux.fromArray(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">Mono.fromFuture(CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;result&quot;</span>))</span><br><span class="line">Mono.fromCallable(() -&gt; database.query())</span><br><span class="line">Mono.fromRunnable(() -&gt; cleanup()) <span class="comment">// Returns Mono&lt;Void&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. range() - Number sequence</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>) <span class="comment">// 1,2,3,...,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. interval() - Periodic emissions</span></span><br><span class="line">Flux.interval(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// 0,1,2,3,... every second</span></span><br><span class="line">    .take(<span class="number">5</span>) <span class="comment">// 0,1,2,3,4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. defer() - Deferred creation (per subscription)</span></span><br><span class="line">Flux.defer(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (System.currentTimeMillis() % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.just(<span class="string">&quot;Even&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.just(<span class="string">&quot;Odd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Each subscription gets potentially different result</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Database connection per request</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUser</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Mono.defer(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// Create new connection per subscription</span></span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; userRepository.findById(id))</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Programmatic-Creation"><a href="#Programmatic-Creation" class="headerlink" title="Programmatic Creation"></a><strong>Programmatic Creation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 9. create() - Bridge with callback APIs</span></span><br><span class="line">Flux.create(sink -&gt; &#123;</span><br><span class="line">    <span class="comment">// Bridge to event-based APIs</span></span><br><span class="line">    <span class="type">EventListener</span> <span class="variable">listener</span> <span class="operator">=</span> event -&gt; &#123;</span><br><span class="line">        sink.next(event.getData());</span><br><span class="line">        <span class="keyword">if</span> (event.isComplete()) &#123;</span><br><span class="line">            sink.complete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    eventSource.register(listener);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Cleanup on cancel</span></span><br><span class="line">    sink.onCancel(() -&gt; eventSource.unregister(listener));</span><br><span class="line">    sink.onDispose(() -&gt; eventSource.unregister(listener));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: WebSocket to Flux bridge</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Message&gt; <span class="title function_">createWebSocketStream</span><span class="params">(WebSocketSession session)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.create(sink -&gt; &#123;</span><br><span class="line">        session.sendMessage(<span class="keyword">new</span> <span class="title class_">TextMessage</span>(<span class="string">&quot;CONNECTED&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        session.addHandler(<span class="keyword">new</span> <span class="title class_">WebSocketHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(WebSocketSession session, WebSocketMessage&lt;?&gt; message)</span> &#123;</span><br><span class="line">                sink.next(convert(message));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus status)</span> &#123;</span><br><span class="line">                sink.complete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        sink.onDispose(() -&gt; session.close());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. generate() - Synchronous, stateful generation</span></span><br><span class="line">Flux.generate(</span><br><span class="line">    () -&gt; <span class="number">0</span>, <span class="comment">// Initial state</span></span><br><span class="line">    (state, sink) -&gt; &#123;</span><br><span class="line">        sink.next(<span class="string">&quot;Value: &quot;</span> + state);</span><br><span class="line">        <span class="keyword">if</span> (state == <span class="number">10</span>) &#123;</span><br><span class="line">            sink.complete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span>; <span class="comment">// New state</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 11. push() - Single-threaded async generation (like create but single-threaded)</span></span><br><span class="line">Flux.push(sink -&gt; &#123;</span><br><span class="line">    <span class="comment">// For single-threaded producers</span></span><br><span class="line">    singleThreadedEventEmitter.onData(data -&gt; sink.next(data));</span><br><span class="line">    singleThreadedEventEmitter.onComplete(() -&gt; sink.complete());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 12. using() - Resource management</span></span><br><span class="line">Flux.using(</span><br><span class="line">    () -&gt; database.getConnection(),           <span class="comment">// Resource supplier</span></span><br><span class="line">    connection -&gt; Flux.fromIterable(connection.query()), <span class="comment">// Flux factory</span></span><br><span class="line">    connection -&gt; connection.close()          <span class="comment">// Cleanup</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-Transformation-Operators"><a href="#3-Transformation-Operators" class="headerlink" title="3. Transformation Operators"></a><strong>3. Transformation Operators</strong></h2><h3 id="Element-Transformation"><a href="#Element-Transformation" class="headerlink" title="Element Transformation"></a><strong>Element Transformation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. map() - Synchronous 1:1 transformation</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">Flux&lt;String&gt; strings = numbers.map(n -&gt; <span class="string">&quot;Number: &quot;</span> + n);</span><br><span class="line"><span class="comment">// 1 ‚Üí &quot;Number: 1&quot;, 2 ‚Üí &quot;Number: 2&quot;, ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. flatMap() - Asynchronous 1:N transformation</span></span><br><span class="line">Flux&lt;User&gt; users = Flux.just(<span class="string">&quot;user1&quot;</span>, <span class="string">&quot;user2&quot;</span>, <span class="string">&quot;user3&quot;</span>);</span><br><span class="line">Flux&lt;Order&gt; orders = users.flatMap(username -&gt; </span><br><span class="line">    orderRepository.findByUser(username) <span class="comment">// Returns Flux&lt;Order&gt;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// Concatenates all inner Flux emissions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. concatMap() - Preserves order (slower)</span></span><br><span class="line">users.concatMap(username -&gt; </span><br><span class="line">    orderRepository.findByUser(username)</span><br><span class="line">);</span><br><span class="line"><span class="comment">// Waits for each inner Flux to complete before starting next</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. flatMapSequential() - Preserves source order but subscribes eagerly</span></span><br><span class="line">users.flatMapSequential(username -&gt; </span><br><span class="line">    orderRepository.findByUser(username)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Parallel API calls with ordering</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">getProductsWithReviews</span><span class="params">(List&lt;String&gt; productIds)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(productIds)</span><br><span class="line">        .flatMap(id -&gt; </span><br><span class="line">            productService.getProduct(id)  <span class="comment">// Mono&lt;Product&gt;</span></span><br><span class="line">                .flatMap(product -&gt;</span><br><span class="line">                    reviewService.getReviews(id)  <span class="comment">// Mono&lt;List&lt;Review&gt;&gt;</span></span><br><span class="line">                        .map(reviews -&gt; &#123;</span><br><span class="line">                            product.setReviews(reviews);</span><br><span class="line">                            <span class="keyword">return</span> product;</span><br><span class="line">                        &#125;)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. switchMap() - Cancels previous inner publisher</span></span><br><span class="line">searchInputFlux</span><br><span class="line">    .debounce(Duration.ofMillis(<span class="number">300</span>))</span><br><span class="line">    .switchMap(query -&gt; </span><br><span class="line">        searchService.search(query) <span class="comment">// Cancels previous search if new query arrives</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. transform() - Operator composition</span></span><br><span class="line">Function&lt;Flux&lt;String&gt;, Flux&lt;String&gt;&gt; filterAndTransform =</span><br><span class="line">    flux -&gt; flux</span><br><span class="line">        .filter(s -&gt; !s.isEmpty())</span><br><span class="line">        .map(String::toUpperCase);</span><br><span class="line"></span><br><span class="line">Flux&lt;String&gt; result = Flux.just(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">    .transform(filterAndTransform);</span><br></pre></td></tr></table></figure>

<h3 id="Flattening-Operators"><a href="#Flattening-Operators" class="headerlink" title="Flattening Operators"></a><strong>Flattening Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7. flatMap vs flatMapMany</span></span><br><span class="line">Mono&lt;List&lt;Integer&gt;&gt; monoList = Mono.just(List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">Flux&lt;Integer&gt; flux = monoList.flatMapMany(Flux::fromIterable);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. concatMap vs flatMap comparison</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .flatMap(i -&gt; </span><br><span class="line">        Mono.just(i * <span class="number">10</span>)</span><br><span class="line">            .delayElement(Duration.ofMillis(i * <span class="number">100</span>))</span><br><span class="line">    );</span><br><span class="line"><span class="comment">// Output order: 10, 20, 30 (may vary due to delays)</span></span><br><span class="line"></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .concatMap(i -&gt; </span><br><span class="line">        Mono.just(i * <span class="number">10</span>)</span><br><span class="line">            .delayElement(Duration.ofMillis(i * <span class="number">100</span>))</span><br><span class="line">    );</span><br><span class="line"><span class="comment">// Output order: 10, 20, 30 (guaranteed order)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: File processing with backpressure</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">processLargeFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.using(</span><br><span class="line">        () -&gt; Files.lines(Paths.get(filePath)),</span><br><span class="line">        Flux::fromStream,</span><br><span class="line">        Stream::close</span><br><span class="line">    )</span><br><span class="line">    .flatMap(line -&gt; </span><br><span class="line">        Mono.fromCallable(() -&gt; expensiveProcessing(line))</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">        <span class="number">5</span> <span class="comment">// Maximum concurrency</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. groupBy() - Group elements by key</span></span><br><span class="line">Flux&lt;Transaction&gt; transactions = getTransactions();</span><br><span class="line">Flux&lt;GroupedFlux&lt;String, Transaction&gt;&gt; grouped = </span><br><span class="line">    transactions.groupBy(tx -&gt; tx.getCategory());</span><br><span class="line"></span><br><span class="line">grouped.flatMap(group -&gt; </span><br><span class="line">    group</span><br><span class="line">        .buffer(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">        .map(list -&gt; <span class="keyword">new</span> <span class="title class_">CategorySummary</span>(group.key(), list))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. window() - Split into windows</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .window(<span class="number">10</span>) <span class="comment">// Flux&lt;Flux&lt;Integer&gt;&gt; with windows of size 10</span></span><br><span class="line">    .flatMap(window -&gt; </span><br><span class="line">        window.reduce(<span class="number">0</span>, Integer::sum)</span><br><span class="line">            .map(sum -&gt; <span class="string">&quot;Window sum: &quot;</span> + sum)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// Time-based windowing</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .window(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .flatMap(window -&gt; window.count())</span><br><span class="line">    .subscribe(count -&gt; System.out.println(<span class="string">&quot;Events per second: &quot;</span> + count));</span><br></pre></td></tr></table></figure>

<h3 id="Buffering-Windowing"><a href="#Buffering-Windowing" class="headerlink" title="Buffering &amp; Windowing"></a><strong>Buffering &amp; Windowing</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. buffer() - Collect into lists</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .buffer(<span class="number">3</span>) <span class="comment">// [1,2,3], [4,5,6], [7,8,9], [10]</span></span><br><span class="line">    .subscribe(list -&gt; System.out.println(list));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. bufferTimeout() - Size OR time based</span></span><br><span class="line">messageFlux</span><br><span class="line">    .bufferTimeout(<span class="number">100</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .subscribe(batch -&gt; batchProcessor.process(batch));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. bufferWhile() / bufferUntil()</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">numbers.bufferWhile(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>); <span class="comment">// Buffer while even</span></span><br><span class="line">numbers.bufferUntil(n -&gt; n % <span class="number">3</span> == <span class="number">0</span>); <span class="comment">// Buffer until divisible by 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Batch database inserts</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">saveMessages</span><span class="params">(Flux&lt;Message&gt; messages)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> messages</span><br><span class="line">        .buffer(<span class="number">100</span>) <span class="comment">// Batch size</span></span><br><span class="line">        .delayElements(Duration.ofMillis(<span class="number">100</span>)) <span class="comment">// Throttle</span></span><br><span class="line">        .flatMap(batch -&gt; </span><br><span class="line">            Mono.fromRunnable(() -&gt; batchInsert(batch))</span><br><span class="line">                .subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            <span class="number">3</span> <span class="comment">// Max concurrent batches</span></span><br><span class="line">        )</span><br><span class="line">        .then();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. window() vs buffer()</span></span><br><span class="line">Flux&lt;Integer&gt; source = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">source.buffer(<span class="number">3</span>);  <span class="comment">// Returns Flux&lt;List&lt;Integer&gt;&gt;</span></span><br><span class="line">source.window(<span class="number">3</span>);  <span class="comment">// Returns Flux&lt;Flux&lt;Integer&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. windowUntilChanged() - Window on changing values</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    .windowUntilChanged()</span><br><span class="line">    .flatMap(window -&gt; window.collectList())</span><br><span class="line"><span class="comment">// Windows: [1,1], [2,2], [1], [3,3]</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-Filtering-Operators"><a href="#4-Filtering-Operators" class="headerlink" title="4. Filtering Operators"></a><strong>4. Filtering Operators</strong></h2><h3 id="Basic-Filtering"><a href="#Basic-Filtering" class="headerlink" title="Basic Filtering"></a><strong>Basic Filtering</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. filter() - Predicate-based filtering</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">Flux&lt;Integer&gt; even = numbers.filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ignoreElements() - Ignore all, just completion/error</span></span><br><span class="line">Mono&lt;Void&gt; completion = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .ignoreElements(); <span class="comment">// Only onComplete/onError signals</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. distinct() - Remove duplicates</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">    .distinct() <span class="comment">// 1, 2, 3, 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. distinctUntilChanged() - Remove consecutive duplicates</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    .distinctUntilChanged() <span class="comment">// 1, 2, 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Rate limiting duplicate requests</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Response&gt; <span class="title function_">handleRequests</span><span class="params">(Flux&lt;Request&gt; requests)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> requests</span><br><span class="line">        .distinct(Request::getId) <span class="comment">// Ignore duplicate IDs</span></span><br><span class="line">        .filter(req -&gt; !isBlocked(req.getIp()))</span><br><span class="line">        .flatMap(<span class="built_in">this</span>::processRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Taking-Skipping"><a href="#Taking-Skipping" class="headerlink" title="Taking &amp; Skipping"></a><strong>Taking &amp; Skipping</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. take(n) - Take first N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>).take(<span class="number">5</span>); <span class="comment">// 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. takeLast(n) - Take last N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>).takeLast(<span class="number">5</span>); <span class="comment">// 96,97,98,99,100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. takeWhile(predicate) - Take while true</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .takeWhile(n -&gt; n &lt; <span class="number">5</span>); <span class="comment">// 1,2,3,4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. takeUntil(predicate) - Take until true (inclusive)</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .takeUntil(n -&gt; n == <span class="number">5</span>); <span class="comment">// 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. skip(n) - Skip first N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>).skip(<span class="number">5</span>); <span class="comment">// 6,7,8,9,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. skipLast(n) - Skip last N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>).skipLast(<span class="number">5</span>); <span class="comment">// 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. skipWhile(predicate) - Skip while true</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .skipWhile(n -&gt; n &lt; <span class="number">5</span>); <span class="comment">// 5,6,7,8,9,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. skipUntil(predicate) - Skip until true</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .skipUntil(n -&gt; n == <span class="number">5</span>); <span class="comment">// 5,6,7,8,9,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Pagination with take/skip</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">getUsers</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findAll()</span><br><span class="line">        .skip(page * size)</span><br><span class="line">        .take(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. takeDuration() / skipDuration() - Time-based</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .take(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// Take for 1 second</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. elementAt() - Get element at index</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .elementAt(<span class="number">5</span>); <span class="comment">// Mono with value 6</span></span><br></pre></td></tr></table></figure>

<h3 id="Sampling-Throttling"><a href="#Sampling-Throttling" class="headerlink" title="Sampling &amp; Throttling"></a><strong>Sampling &amp; Throttling</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. sample(Duration) - Last element in time window</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .sample(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// Emit last value every second</span></span><br><span class="line">    .subscribe(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. sampleFirst(Duration) - First element in time window</span></span><br><span class="line">messageFlux.sampleFirst(Duration.ofMillis(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. sampleTimeout() - Sample with dynamic duration</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .sampleTimeout(</span><br><span class="line">        v -&gt; Mono.delay(Duration.ofMillis(<span class="number">50</span> + v * <span class="number">10</span>))</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. throttleFirst / throttleLast (alias for sample)</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">50</span>))</span><br><span class="line">    .throttleFirst(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// First in window</span></span><br><span class="line">    .throttleLast(Duration.ofSeconds(<span class="number">1</span>))  <span class="comment">// Last in window (same as sample)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: UI event throttling</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Result&gt; <span class="title function_">search</span><span class="params">(Flux&lt;String&gt; queries)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queries</span><br><span class="line">            .filter(query -&gt; query.length() &gt; <span class="number">2</span>)</span><br><span class="line">            .debounce(Duration.ofMillis(<span class="number">300</span>)) <span class="comment">// Wait for pause</span></span><br><span class="line">            .distinctUntilChanged() <span class="comment">// Ignore same query</span></span><br><span class="line">            .switchMap(<span class="built_in">this</span>::executeSearch); <span class="comment">// Cancel previous</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. debounce - Wait for quiet period</span></span><br><span class="line">buttonClickFlux</span><br><span class="line">    .debounce(Duration.ofMillis(<span class="number">250</span>)) <span class="comment">// Prevent double clicks</span></span><br><span class="line">    .subscribe(<span class="built_in">this</span>::handleClick);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-Combining-Operators"><a href="#5-Combining-Operators" class="headerlink" title="5. Combining Operators"></a><strong>5. Combining Operators</strong></h2><h3 id="Sequential-Combination"><a href="#Sequential-Combination" class="headerlink" title="Sequential Combination"></a><strong>Sequential Combination</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. concatWith() - Sequential concatenation</span></span><br><span class="line">Flux&lt;Integer&gt; flux1 = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">Flux&lt;Integer&gt; flux2 = Flux.just(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">flux1.concatWith(flux2); <span class="comment">// 1,2,3,4,5,6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. concat() - Static version</span></span><br><span class="line">Flux.concat(flux1, flux2, Flux.just(<span class="number">7</span>, <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. concatDelayError() - Delay errors until end</span></span><br><span class="line">Flux.concatDelayError(</span><br><span class="line">    Flux.just(<span class="number">1</span>, <span class="number">2</span>).concatWith(Mono.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())),</span><br><span class="line">    Flux.just(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">); <span class="comment">// Emits: 1,2,3,4 then error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Fallback service calls</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">getProducts</span><span class="params">(String category)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> primaryService.getProducts(category)</span><br><span class="line">        .concatWith(secondaryService.getProducts(category))</span><br><span class="line">        .take(<span class="number">10</span>); <span class="comment">// Get up to 10 from either source</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Parallel-Combination"><a href="#Parallel-Combination" class="headerlink" title="Parallel Combination"></a><strong>Parallel Combination</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. mergeWith() - Interleave emissions</span></span><br><span class="line">Flux&lt;Integer&gt; flux1 = Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span>);</span><br><span class="line">Flux&lt;Integer&gt; flux2 = Flux.interval(Duration.ofMillis(<span class="number">150</span>))</span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">flux1.mergeWith(flux2); <span class="comment">// Interleaved: 0,1,2,3,4,5,...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. merge() - Static version</span></span><br><span class="line">Flux.merge(flux1, flux2, flux3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. mergeSequential() - Subscribe in order, emit as arrive</span></span><br><span class="line">Flux.mergeSequential(flux1, flux2); <span class="comment">// Maintains subscription order</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. mergeOrdered() - Merge with ordering</span></span><br><span class="line">Flux.mergeOrdered(</span><br><span class="line">    Comparator.naturalOrder(),</span><br><span class="line">    flux1, flux2</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Aggregating multiple data sources</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;StockPrice&gt; <span class="title function_">getAllStockPrices</span><span class="params">(List&lt;String&gt; symbols)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(symbols)</span><br><span class="line">        .flatMap(symbol -&gt; </span><br><span class="line">            stockService.getPriceStream(symbol),</span><br><span class="line">            <span class="number">5</span> <span class="comment">// Max concurrent subscriptions</span></span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pairing-Operators"><a href="#Pairing-Operators" class="headerlink" title="Pairing Operators"></a><strong>Pairing Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. zipWith() - Pair-wise combination</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">Flux&lt;String&gt; letters = Flux.just(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line"></span><br><span class="line">numbers.zipWith(letters, (n, l) -&gt; n + l);</span><br><span class="line"><span class="comment">// [1A, 2B, 3C]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. zip() - Static version</span></span><br><span class="line">Flux.zip(numbers, letters, more)</span><br><span class="line">    .map(tuple -&gt; tuple.getT1() + tuple.getT2());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. zip with combinator</span></span><br><span class="line">Flux.zip(</span><br><span class="line">    obj -&gt; <span class="keyword">new</span> <span class="title class_">Combined</span>((String)obj[<span class="number">0</span>], (Integer)obj[<span class="number">1</span>]),</span><br><span class="line">    flux1, flux2</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Parallel API calls with aggregation</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;UserProfile&gt; <span class="title function_">getUserProfile</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Mono.zip(</span><br><span class="line">        userService.getUser(userId),</span><br><span class="line">        orderService.getOrders(userId),</span><br><span class="line">        paymentService.getPaymentMethods(userId)</span><br><span class="line">    ).map(tuple -&gt; <span class="keyword">new</span> <span class="title class_">UserProfile</span>(</span><br><span class="line">        tuple.getT1(),</span><br><span class="line">        tuple.getT2(),</span><br><span class="line">        tuple.getT3()</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. combineLatest - Latest from each</span></span><br><span class="line">Flux.combineLatest(</span><br><span class="line">    flux1, flux2,</span><br><span class="line">    (v1, v2) -&gt; v1 + <span class="string">&quot; - &quot;</span> + v2</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Real-time dashboard</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;DashboardData&gt; <span class="title function_">getDashboard</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.combineLatest(</span><br><span class="line">        cpuMetrics,</span><br><span class="line">        memoryMetrics,</span><br><span class="line">        networkMetrics,</span><br><span class="line">        (cpu, memory, network) -&gt; <span class="keyword">new</span> <span class="title class_">DashboardData</span>(cpu, memory, network)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Race-Conditions"><a href="#Race-Conditions" class="headerlink" title="Race Conditions"></a><strong>Race Conditions</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. firstWithSignal / firstWithValue - Race to emit</span></span><br><span class="line">Mono&lt;String&gt; cache = getFromCache(key);</span><br><span class="line">Mono&lt;String&gt; db = getFromDatabase(key);</span><br><span class="line"></span><br><span class="line">Mono.firstWithSignal(cache, db) <span class="comment">// First to emit any signal</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line">Mono.firstWithValue(cache, db) <span class="comment">// First to emit a value</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Circuit breaker with fallbacks</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&gt; <span class="title function_">callWithFallback</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> primaryService.call(request)</span><br><span class="line">        .timeout(Duration.ofSeconds(<span class="number">2</span>))</span><br><span class="line">        .onErrorResume(e -&gt; </span><br><span class="line">            Mono.firstWithValue(</span><br><span class="line">                secondaryService.call(request),</span><br><span class="line">                Mono.just(Response.fallback())</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. amb (deprecated, use firstWithSignal)</span></span><br><span class="line">Flux.firstWithSignal(source1, source2, source3);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-Error-Handling-Operators"><a href="#6-Error-Handling-Operators" class="headerlink" title="6. Error Handling Operators"></a><strong>6. Error Handling Operators</strong></h2><h3 id="Error-Recovery"><a href="#Error-Recovery" class="headerlink" title="Error Recovery"></a><strong>Error Recovery</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. onErrorReturn - Provide fallback value</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .map(n -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Boom!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;)</span><br><span class="line">    .onErrorReturn(<span class="number">0</span>); <span class="comment">// 1, 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. onErrorResume - Switch to fallback publisher</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Failed&quot;</span>))</span><br><span class="line">    .onErrorResume(e -&gt; </span><br><span class="line">        Flux.just(<span class="string">&quot;fallback1&quot;</span>, <span class="string">&quot;fallback2&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. onErrorContinue - Continue with next element</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">    .map(n -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">3</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Skip 3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> n * <span class="number">10</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .onErrorContinue((e, obj) -&gt; </span><br><span class="line">        log.error(<span class="string">&quot;Skipped &#123;&#125; due to &#123;&#125;&quot;</span>, obj, e.getMessage())</span><br><span class="line">    ); <span class="comment">// 10, 20, 40</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Resilient API calls</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">getProductsWithRetry</span><span class="params">(List&lt;String&gt; ids)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(ids)</span><br><span class="line">        .flatMap(id -&gt; </span><br><span class="line">            productService.getProduct(id)</span><br><span class="line">                .onErrorResume(e -&gt; &#123;</span><br><span class="line">                    log.warn(<span class="string">&quot;Failed for &#123;&#125;, trying fallback&quot;</span>, id);</span><br><span class="line">                    <span class="keyword">return</span> fallbackService.getProduct(id);</span><br><span class="line">                &#125;)</span><br><span class="line">                .onErrorResume(e -&gt; &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;Complete failure for &#123;&#125;&quot;</span>, id);</span><br><span class="line">                    <span class="keyword">return</span> Mono.just(Product.unavailable(id));</span><br><span class="line">                &#125;)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Retry-Strategies"><a href="#Retry-Strategies" class="headerlink" title="Retry Strategies"></a><strong>Retry Strategies</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. retry() - Simple retry</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .retry(<span class="number">3</span>); <span class="comment">// Retry 3 times</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. retryWhen - Advanced retry with backoff</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">        .maxBackoff(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .jitter(<span class="number">0.5</span>) <span class="comment">// Add randomness</span></span><br><span class="line">        .doBeforeRetry(retrySignal -&gt; </span><br><span class="line">            log.warn(<span class="string">&quot;Retrying attempt &#123;&#125;&quot;</span>, retrySignal.totalRetries())</span><br><span class="line">        )</span><br><span class="line">        .onRetryExhaustedThrow((spec, signal) -&gt; </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ServiceUnavailableException</span>(<span class="string">&quot;Max retries exceeded&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. retryWhen with predicate</span></span><br><span class="line">.retryWhen(Retry.fixedDelay(<span class="number">5</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .filter(e -&gt; e <span class="keyword">instanceof</span> TimeoutException)</span><br><span class="line">    .doBeforeRetry(retrySignal -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (retrySignal.totalRetries() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            refreshConnection();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Exponential backoff for external APIs</span></span><br><span class="line"><span class="keyword">private</span> RetrySpec <span class="title function_">apiRetrySpec</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Retry.backoff(<span class="number">5</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">        .maxBackoff(Duration.ofMinutes(<span class="number">1</span>))</span><br><span class="line">        .transientErrors(<span class="literal">true</span>) <span class="comment">// Retry on 5xx errors</span></span><br><span class="line">        .doBeforeRetry(retry -&gt; </span><br><span class="line">            metrics.recordRetry(retry.failure())</span><br><span class="line">        )</span><br><span class="line">        .onRetryExhaustedThrow((spec, signal) -&gt; </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ApiException</span>(<span class="string">&quot;Service unavailable after retries&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&gt; <span class="title function_">callExternalApi</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> webClient.post()</span><br><span class="line">        .bodyValue(request)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Response.class)</span><br><span class="line">        .retryWhen(apiRetrySpec());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Timeout-Fallback"><a href="#Timeout-Fallback" class="headerlink" title="Timeout &amp; Fallback"></a><strong>Timeout &amp; Fallback</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. timeout - Timeout with fallback</span></span><br><span class="line">Flux.interval(Duration.ofSeconds(<span class="number">2</span>))</span><br><span class="line">    .timeout(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .onErrorResume(TimeoutException.class, e -&gt; </span><br><span class="line">        Flux.just(-<span class="number">1L</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. timeout with fallback publisher</span></span><br><span class="line">slowFlux</span><br><span class="line">    .timeout(Duration.ofSeconds(<span class="number">1</span>), fallbackFlux)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Service call with timeout cascade</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&gt; <span class="title function_">callServiceWithTimeouts</span><span class="params">(Request req)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> primaryService.call(req)</span><br><span class="line">        .timeout(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">        .onErrorResume(TimeoutException.class, e -&gt;</span><br><span class="line">            secondaryService.call(req)</span><br><span class="line">                .timeout(Duration.ofMillis(<span class="number">200</span>))</span><br><span class="line">        )</span><br><span class="line">        .onErrorResume(TimeoutException.class, e -&gt;</span><br><span class="line">            tertiaryService.call(req)</span><br><span class="line">                .timeout(Duration.ofMillis(<span class="number">500</span>))</span><br><span class="line">        )</span><br><span class="line">        .onErrorReturn(Response.fallback());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Error-Classification"><a href="#Error-Classification" class="headerlink" title="Error Classification"></a><strong>Error Classification</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. onErrorMap - Transform error</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Connection failed&quot;</span>))</span><br><span class="line">    .onErrorMap(IOException.class, e -&gt; </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;Service unavailable&quot;</span>, e)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. onErrorMap with predicate</span></span><br><span class="line">.onErrorMap(e -&gt; e.getMessage().contains(<span class="string">&quot;timeout&quot;</span>), </span><br><span class="line">    e -&gt; <span class="keyword">new</span> <span class="title class_">TimeoutException</span>(<span class="string">&quot;Operation timed out&quot;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. doOnError - Side effect on error</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .doOnError(e -&gt; </span><br><span class="line">        metrics.incrementError(e.getClass().getSimpleName())</span><br><span class="line">    )</span><br><span class="line">    .onErrorResume(e -&gt; Mono.empty());</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Circuit breaker pattern</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircuitBreakerService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Data&gt; <span class="title function_">getDataWithCircuitBreaker</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.defer(() -&gt; externalService.getData())</span><br><span class="line">            .transformDeferred(circuitBreaker::run)</span><br><span class="line">            .onErrorResume(CallNotPermittedException.class, e -&gt; </span><br><span class="line">                Flux.error(<span class="keyword">new</span> <span class="title class_">ServiceUnavailableException</span>())</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-Utility-Operators"><a href="#7-Utility-Operators" class="headerlink" title="7. Utility Operators"></a><strong>7. Utility Operators</strong></h2><h3 id="Side-Effects"><a href="#Side-Effects" class="headerlink" title="Side Effects"></a><strong>Side Effects</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. doOnNext - Peek at values</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .doOnNext(n -&gt; System.out.println(<span class="string">&quot;Processing: &quot;</span> + n))</span><br><span class="line">    .map(n -&gt; n * <span class="number">2</span>)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. doOnComplete - On completion</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .doOnComplete(() -&gt; System.out.println(<span class="string">&quot;Done!&quot;</span>))</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. doOnError - On error</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .doOnError(e -&gt; log.error(<span class="string">&quot;Failed&quot;</span>, e))</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. doOnSubscribe / doOnCancel / doOnRequest</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .doOnSubscribe(s -&gt; System.out.println(<span class="string">&quot;Subscribed&quot;</span>))</span><br><span class="line">    .doOnRequest(n -&gt; System.out.println(<span class="string">&quot;Requested: &quot;</span> + n))</span><br><span class="line">    .doOnCancel(() -&gt; System.out.println(<span class="string">&quot;Cancelled&quot;</span>))</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Request logging</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Data&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dataService.getData()</span><br><span class="line">            .doOnSubscribe(s -&gt; </span><br><span class="line">                log.info(<span class="string">&quot;Request started at &#123;&#125;&quot;</span>, Instant.now())</span><br><span class="line">            )</span><br><span class="line">            .doOnComplete(() -&gt; </span><br><span class="line">                log.info(<span class="string">&quot;Request completed successfully&quot;</span>)</span><br><span class="line">            )</span><br><span class="line">            .doOnError(e -&gt; </span><br><span class="line">                log.error(<span class="string">&quot;Request failed&quot;</span>, e)</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Debugging-Metrics"><a href="#Debugging-Metrics" class="headerlink" title="Debugging &amp; Metrics"></a><strong>Debugging &amp; Metrics</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. log() - Log all signals</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    .log(<span class="string">&quot;my.flux&quot;</span>)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// [my.flux] onSubscribe(FluxRange.RangeSubscription)</span></span><br><span class="line"><span class="comment">// [my.flux] request(unbounded)</span></span><br><span class="line"><span class="comment">// [my.flux] onNext(1)</span></span><br><span class="line"><span class="comment">// [my.flux] onNext(2)</span></span><br><span class="line"><span class="comment">// [my.flux] onNext(3)</span></span><br><span class="line"><span class="comment">// [my.flux] onComplete()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. checkpoint - Add trace for debugging</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Oops&quot;</span>))</span><br><span class="line">    .checkpoint(<span class="string">&quot;errorSource&quot;</span>)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Stack trace includes &quot;errorSource&quot; marker</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. metrics - Micrometer integration</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .name(<span class="string">&quot;myFlux&quot;</span>)</span><br><span class="line">    .metrics()</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Production monitoring</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Event&gt; <span class="title function_">processEvents</span><span class="params">(Flux&lt;Event&gt; events)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> events</span><br><span class="line">        .name(<span class="string">&quot;event.processor&quot;</span>)</span><br><span class="line">        .tag(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;kafka&quot;</span>)</span><br><span class="line">        .metrics() <span class="comment">// Exposes metrics to Micrometer</span></span><br><span class="line">        .doOnNext(event -&gt; </span><br><span class="line">            Metrics.counter(<span class="string">&quot;events.processed&quot;</span>).increment()</span><br><span class="line">        )</span><br><span class="line">        .doOnError(e -&gt; </span><br><span class="line">            Metrics.counter(<span class="string">&quot;events.failed&quot;</span>).increment()</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Conditional-Operators"><a href="#Conditional-Operators" class="headerlink" title="Conditional Operators"></a><strong>Conditional Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. hasElements / hasElement</span></span><br><span class="line">Mono&lt;Boolean&gt; hasData = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).hasElements();</span><br><span class="line">Mono&lt;Boolean&gt; hasTwo = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).hasElement(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. any / all</span></span><br><span class="line">Mono&lt;Boolean&gt; anyEven = Flux.just(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>).any(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line">Mono&lt;Boolean&gt; allPositive = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).all(n -&gt; n &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. defaultIfEmpty</span></span><br><span class="line">Flux.empty()</span><br><span class="line">    .defaultIfEmpty(<span class="string">&quot;default&quot;</span>); <span class="comment">// Emits &quot;default&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. switchIfEmpty</span></span><br><span class="line">Flux.empty()</span><br><span class="line">    .switchIfEmpty(Flux.just(<span class="string">&quot;fallback&quot;</span>, <span class="string">&quot;values&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Cache with fallback</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUser</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cache.get(id)</span><br><span class="line">        .switchIfEmpty(</span><br><span class="line">            database.getUser(id)</span><br><span class="line">                .doOnNext(user -&gt; cache.set(id, user))</span><br><span class="line">        )</span><br><span class="line">        .defaultIfEmpty(User.anonymous());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Collecting-Reducing"><a href="#Collecting-Reducing" class="headerlink" title="Collecting &amp; Reducing"></a><strong>Collecting &amp; Reducing</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. collectList / collectMap / collectMultimap</span></span><br><span class="line">Flux.just(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">    .collectList() <span class="comment">// Mono&lt;List&lt;String&gt;&gt;</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line">Flux.just(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Pair</span>(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Pair</span>(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>)</span><br><span class="line">).collectMap(Pair::getKey, Pair::getValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. reduce - Accumulate values</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .reduce(<span class="number">0</span>, Integer::sum); <span class="comment">// Mono with value 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. scan - Emit accumulation steps</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .scan(<span class="number">0</span>, Integer::sum); <span class="comment">// 0,1,3,6,10,15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. count</span></span><br><span class="line">Flux.just(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>).count(); <span class="comment">// Mono with value 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Real-time analytics</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;AggregatedStats&gt; <span class="title function_">streamStats</span><span class="params">(Flux&lt;Event&gt; events)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> events</span><br><span class="line">        .window(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">        .flatMap(window -&gt; </span><br><span class="line">            window</span><br><span class="line">                .reduce(<span class="keyword">new</span> <span class="title class_">StatsAccumulator</span>(), StatsAccumulator::add)</span><br><span class="line">                .map(StatsAccumulator::toStats)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-Schedulers-Threading"><a href="#8-Schedulers-Threading" class="headerlink" title="8. Schedulers &amp; Threading"></a><strong>8. Schedulers &amp; Threading</strong></h2><h3 id="Scheduler-Types"><a href="#Scheduler-Types" class="headerlink" title="Scheduler Types"></a><strong>Scheduler Types</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Schedulers.immediate() - Current thread</span></span><br><span class="line"><span class="comment">// 2. Schedulers.single() - Single dedicated thread</span></span><br><span class="line"><span class="comment">// 3. Schedulers.elastic() - Deprecated, use boundedElastic</span></span><br><span class="line"><span class="comment">// 4. Schedulers.boundedElastic() - For blocking I/O</span></span><br><span class="line"><span class="comment">// 5. Schedulers.parallel() - For CPU-intensive work</span></span><br><span class="line"><span class="comment">// 6. Schedulers.fromExecutorService() - Custom executor</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Threading strategy by operation type</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Result&gt; <span class="title function_">process</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> validate(request) <span class="comment">// Fast, use immediate</span></span><br><span class="line">        .flatMap(validated -&gt; </span><br><span class="line">            Mono.fromCallable(() -&gt; blockingIO(validated))</span><br><span class="line">                .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">        )</span><br><span class="line">        .flatMap(ioResult -&gt; </span><br><span class="line">            Mono.fromCallable(() -&gt; cpuIntensive(ioResult))</span><br><span class="line">                .subscribeOn(Schedulers.parallel())</span><br><span class="line">        )</span><br><span class="line">        .publishOn(Schedulers.single()) <span class="comment">// Switch back to single thread</span></span><br><span class="line">        .doOnNext(result -&gt; </span><br><span class="line">            <span class="comment">// UI updates or single-threaded operations</span></span><br><span class="line">            updateUI(result)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Threading-Operators"><a href="#Threading-Operators" class="headerlink" title="Threading Operators"></a><strong>Threading Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. subscribeOn - Where subscription happens</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .map(n -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Map on: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> n * <span class="number">2</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .subscribeOn(Schedulers.parallel())</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. publishOn - Switch threads downstream</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .map(n -&gt; n * <span class="number">2</span>) <span class="comment">// On subscription thread</span></span><br><span class="line">    .publishOn(Schedulers.single())</span><br><span class="line">    .map(n -&gt; n + <span class="number">1</span>) <span class="comment">// On single thread</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. parallel / runOn - Parallel processing</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .parallel(<span class="number">4</span>) <span class="comment">// Split into 4 rails</span></span><br><span class="line">    .runOn(Schedulers.parallel())</span><br><span class="line">    .map(n -&gt; n * <span class="number">2</span>)</span><br><span class="line">    .sequential(); <span class="comment">// Merge back to single Flux</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Image processing pipeline</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;ProcessedImage&gt; <span class="title function_">processImages</span><span class="params">(Flux&lt;Image&gt; images)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> images</span><br><span class="line">        .parallel(<span class="number">4</span>) <span class="comment">// 4 parallel lanes</span></span><br><span class="line">        .runOn(Schedulers.parallel()) <span class="comment">// Each lane on parallel scheduler</span></span><br><span class="line">        .map(<span class="built_in">this</span>::detectEdges) <span class="comment">// CPU-intensive</span></span><br><span class="line">        .sequential() <span class="comment">// Back to single flux</span></span><br><span class="line">        .publishOn(Schedulers.boundedElastic())</span><br><span class="line">        .flatMap(<span class="built_in">this</span>::saveToStorage) <span class="comment">// I/O intensive</span></span><br><span class="line">        .publishOn(Schedulers.single())</span><br><span class="line">        .doOnNext(<span class="built_in">this</span>::notifyUI);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Context-Propagation"><a href="#Context-Propagation" class="headerlink" title="Context Propagation"></a><strong>Context Propagation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. contextWrite - Write to Context</span></span><br><span class="line">Flux.just(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">    .flatMap(word -&gt; </span><br><span class="line">        Mono.deferContextual(ctx -&gt; </span><br><span class="line">            Mono.just(word + <span class="string">&quot; &quot;</span> + ctx.get(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    .contextWrite(Context.of(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;Alice&quot;</span>))</span><br><span class="line">    .subscribe(System.out::println); <span class="comment">// Hello Alice</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. transformDeferredContextual</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .transformDeferredContextual((flux, ctx) -&gt; </span><br><span class="line">        flux.map(n -&gt; n + ctx.getOrDefault(<span class="string">&quot;offset&quot;</span>, <span class="number">0</span>))</span><br><span class="line">    )</span><br><span class="line">    .contextWrite(Context.of(<span class="string">&quot;offset&quot;</span>, <span class="number">100</span>))</span><br><span class="line">    .subscribe(); <span class="comment">// 101, 102, 103, 104, 105</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Request tracing</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TracingFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange)</span><br><span class="line">            .contextWrite(Context.of(</span><br><span class="line">                <span class="string">&quot;traceId&quot;</span>, exchange.getRequest().getId(),</span><br><span class="line">                <span class="string">&quot;userId&quot;</span>, extractUserId(exchange)</span><br><span class="line">            ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Data&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.deferContextual(ctx -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">traceId</span> <span class="operator">=</span> ctx.get(<span class="string">&quot;traceId&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> dataService.getData()</span><br><span class="line">                .doOnSubscribe(s -&gt; </span><br><span class="line">                    log.info(<span class="string">&quot;Trace &#123;&#125;: Started&quot;</span>, traceId)</span><br><span class="line">                );</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-Backpressure-Operators"><a href="#9-Backpressure-Operators" class="headerlink" title="9. Backpressure Operators"></a><strong>9. Backpressure Operators</strong></h2><h3 id="Backpressure-Strategies"><a href="#Backpressure-Strategies" class="headerlink" title="Backpressure Strategies"></a><strong>Backpressure Strategies</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. onBackpressureBuffer - Buffer with limits</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureBuffer(</span><br><span class="line">        <span class="number">100</span>,                      <span class="comment">// Buffer size</span></span><br><span class="line">        BufferOverflowStrategy.DROP_OLDEST, <span class="comment">// Strategy</span></span><br><span class="line">        buffer -&gt; log.warn(<span class="string">&quot;Buffer overflow: &#123;&#125;&quot;</span>, buffer.size())</span><br><span class="line">    )</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. onBackpressureDrop - Drop excess</span></span><br><span class="line">fastProducer</span><br><span class="line">    .onBackpressureDrop(dropped -&gt; </span><br><span class="line">        metrics.recordDropped(dropped)</span><br><span class="line">    )</span><br><span class="line">    .subscribe(slowConsumer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. onBackpressureLatest - Keep only latest</span></span><br><span class="line">realTimeData</span><br><span class="line">    .onBackpressureLatest()</span><br><span class="line">    .subscribe(uiUpdater);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. onBackpressureError - Error on overflow</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">10</span>))</span><br><span class="line">    .onBackpressureError()</span><br><span class="line">    .subscribe(</span><br><span class="line">        System.out::println,</span><br><span class="line">        e -&gt; log.error(<span class="string">&quot;Backpressure overflow&quot;</span>, e)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Adaptive backpressure</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Data&gt; <span class="title function_">adaptBackpressure</span><span class="params">(Flux&lt;Data&gt; source, Consumer&lt;Data&gt; processor)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> source</span><br><span class="line">        .onBackpressureBuffer(</span><br><span class="line">            <span class="number">1000</span>,</span><br><span class="line">            BufferOverflowStrategy.DROP_OLDEST,</span><br><span class="line">            buffer -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (buffer.size() &gt; <span class="number">800</span>) &#123;</span><br><span class="line">                    <span class="comment">// Slow down producer</span></span><br><span class="line">                    adjustProducerRate(<span class="number">0.5</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        .doOnNext(processor)</span><br><span class="line">        .doOnRequest(n -&gt; &#123;</span><br><span class="line">            <span class="comment">// Increase rate when buffer is low</span></span><br><span class="line">            <span class="keyword">if</span> (getBufferSize() &lt; <span class="number">200</span>) &#123;</span><br><span class="line">                adjustProducerRate(<span class="number">1.5</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Request-Management"><a href="#Request-Management" class="headerlink" title="Request Management"></a><strong>Request Management</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. limitRequest - Limit total request</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .limitRequest(<span class="number">10</span>) <span class="comment">// Only request 10 elements</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. limitRate - Control request batches</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .limitRate(<span class="number">100</span>, <span class="number">50</span>) <span class="comment">// Request 100, replenish at 50</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. subscribe with request</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .subscribe(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnSubscribe</span><span class="params">(Subscription subscription)</span> &#123;</span><br><span class="line">                request(<span class="number">10</span>); <span class="comment">// Request first 10</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnNext</span><span class="params">(Integer value)</span> &#123;</span><br><span class="line">                process(value);</span><br><span class="line">                <span class="keyword">if</span> (value % <span class="number">10</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    request(<span class="number">10</span>); <span class="comment">// Request more in batches</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: File streaming with backpressure</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;ByteBuffer&gt; <span class="title function_">streamFile</span><span class="params">(String path, <span class="type">int</span> chunkSize)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.using(</span><br><span class="line">        () -&gt; Files.newInputStream(Paths.get(path)),</span><br><span class="line">        in -&gt; &#123;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[chunkSize];</span><br><span class="line">            <span class="keyword">return</span> Flux.generate(sink -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> in.read(buffer);</span><br><span class="line">                    <span class="keyword">if</span> (read == -<span class="number">1</span>) &#123;</span><br><span class="line">                        sink.complete();</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (read &lt; buffer.length) &#123;</span><br><span class="line">                        sink.next(ByteBuffer.wrap(buffer, <span class="number">0</span>, read));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        sink.next(ByteBuffer.wrap(buffer));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    sink.error(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        in -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123; in.close(); &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="10-Real-World-Patterns"><a href="#10-Real-World-Patterns" class="headerlink" title="10. Real-World Patterns"></a><strong>10. Real-World Patterns</strong></h2><h3 id="Pattern-1-API-Gateway-Aggregation"><a href="#Pattern-1-API-Gateway-Aggregation" class="headerlink" title="Pattern 1: API Gateway Aggregation"></a><strong>Pattern 1: API Gateway Aggregation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AggregationController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user-dashboard/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Dashboard&gt; <span class="title function_">getUserDashboard</span><span class="params">(<span class="meta">@PathVariable</span> String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.zip(</span><br><span class="line">            userService.getUser(userId).subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            orderService.getOrders(userId).collectList().subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            paymentService.getPayments(userId).collectList().subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            notificationService.getNotifications(userId).collectList().subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">        )</span><br><span class="line">        .map(tuple -&gt; <span class="keyword">new</span> <span class="title class_">Dashboard</span>(</span><br><span class="line">            tuple.getT1(),</span><br><span class="line">            tuple.getT2(),</span><br><span class="line">            tuple.getT3(),</span><br><span class="line">            tuple.getT4()</span><br><span class="line">        ))</span><br><span class="line">        .timeout(Duration.ofSeconds(<span class="number">3</span>))</span><br><span class="line">        .onErrorResume(e -&gt; </span><br><span class="line">            fallbackDashboardService.getDashboard(userId)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">searchProducts</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam</span> String query,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> limit</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.merge(</span><br><span class="line">            productService.search(query).take(limit),</span><br><span class="line">            inventoryService.search(query).take(limit)</span><br><span class="line">        )</span><br><span class="line">        .distinct(Product::getId)</span><br><span class="line">        .sort(Comparator.comparing(Product::getScore).reversed())</span><br><span class="line">        .take(limit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-2-Event-Driven-Processing"><a href="#Pattern-2-Event-Driven-Processing" class="headerlink" title="Pattern 2: Event-Driven Processing"></a><strong>Pattern 2: Event-Driven Processing</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Flux&lt;Event&gt; eventStream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sinks.Many&lt;Event&gt; sink = Sinks.many().multicast().onBackpressureBuffer(<span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EventProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.eventStream = sink.asFlux()</span><br><span class="line">            .publishOn(Schedulers.parallel())</span><br><span class="line">            .name(<span class="string">&quot;event.processor&quot;</span>)</span><br><span class="line">            .metrics();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processEvent</span><span class="params">(Event event)</span> &#123;</span><br><span class="line">        sink.tryEmitNext(event);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        eventStream</span><br><span class="line">            .window(Duration.ofSeconds(<span class="number">1</span>), Duration.ofMillis(<span class="number">500</span>))</span><br><span class="line">            .flatMap(window -&gt; </span><br><span class="line">                window</span><br><span class="line">                    .groupBy(Event::getType)</span><br><span class="line">                    .flatMap(group -&gt; </span><br><span class="line">                        group</span><br><span class="line">                            .bufferTimeout(<span class="number">100</span>, Duration.ofMillis(<span class="number">500</span>))</span><br><span class="line">                            .flatMap(<span class="built_in">this</span>::processBatch)</span><br><span class="line">                    )</span><br><span class="line">            )</span><br><span class="line">            .subscribe(</span><br><span class="line">                result -&gt; log.debug(<span class="string">&quot;Processed: &#123;&#125;&quot;</span>, result),</span><br><span class="line">                error -&gt; log.error(<span class="string">&quot;Processing failed&quot;</span>, error)</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Mono&lt;ProcessResult&gt; <span class="title function_">processBatch</span><span class="params">(List&lt;Event&gt; batch)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// Batch processing logic</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProcessResult</span>(batch.size());</span><br><span class="line">            &#125;)</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">            .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-3-Reactive-Caching"><a href="#Pattern-3-Reactive-Caching" class="headerlink" title="Pattern 3: Reactive Caching"></a><strong>Pattern 3: Reactive Caching</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReactiveCache</span>&lt;K, V&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache&lt;K, Mono&lt;V&gt;&gt; cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Function&lt;K, Mono&lt;V&gt;&gt; loader;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReactiveCache</span><span class="params">(Function&lt;K, Mono&lt;V&gt;&gt; loader, Duration ttl)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.loader = loader;</span><br><span class="line">        <span class="built_in">this</span>.cache = Caffeine.newBuilder()</span><br><span class="line">            .expireAfterWrite(ttl)</span><br><span class="line">            .maximumSize(<span class="number">1000</span>)</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;V&gt; <span class="title function_">get</span><span class="params">(K key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.defer(() -&gt; &#123;</span><br><span class="line">            Mono&lt;V&gt; cached = cache.getIfPresent(key);</span><br><span class="line">            <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> cached;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Use computeIfAbsent to prevent duplicate loads</span></span><br><span class="line">            <span class="keyword">return</span> cache.get(key, k -&gt; </span><br><span class="line">                loader.apply(k)</span><br><span class="line">                    .cache() <span class="comment">// Cache the Mono result</span></span><br><span class="line">                    .doOnError(e -&gt; </span><br><span class="line">                        cache.invalidate(k)</span><br><span class="line">                    )</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Batch loading</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;V&gt; <span class="title function_">getAll</span><span class="params">(List&lt;K&gt; keys)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.fromIterable(keys)</span><br><span class="line">            .flatMap(<span class="built_in">this</span>::get, <span class="number">10</span>) <span class="comment">// Concurrent loading</span></span><br><span class="line">            .collectList()</span><br><span class="line">            .flatMapMany(Flux::fromIterable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage in service</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveCache&lt;String, Product&gt; cache;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProductService</span><span class="params">(ProductRepository repository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cache = <span class="keyword">new</span> <span class="title class_">ReactiveCache</span>&lt;&gt;(</span><br><span class="line">            repository::findById,</span><br><span class="line">            Duration.ofMinutes(<span class="number">5</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Product&gt; <span class="title function_">getProduct</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache.get(id)</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">            .onErrorResume(e -&gt; </span><br><span class="line">                repository.findById(id) <span class="comment">// Fallback to direct call</span></span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-4-WebFlux-Security-Chain"><a href="#Pattern-4-WebFlux-Security-Chain" class="headerlink" title="Pattern 4: WebFlux Security Chain"></a><strong>Pattern 4: WebFlux Security Chain</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityChainFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> extractToken(exchange)</span><br><span class="line">            .flatMap(<span class="built_in">this</span>::validateToken)</span><br><span class="line">            .flatMap(auth -&gt; </span><br><span class="line">                chain.filter(exchange)</span><br><span class="line">                    .contextWrite(Context.of(<span class="string">&quot;auth&quot;</span>, auth))</span><br><span class="line">            )</span><br><span class="line">            .switchIfEmpty(</span><br><span class="line">                chain.filter(exchange)</span><br><span class="line">                    .contextWrite(Context.of(<span class="string">&quot;auth&quot;</span>, Authentication.anonymous()))</span><br><span class="line">            )</span><br><span class="line">            .onErrorResume(AuthenticationException.class, e -&gt; </span><br><span class="line">                handleUnauthorized(exchange, e)</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Mono&lt;Authentication&gt; <span class="title function_">validateToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; </span><br><span class="line">                jwtDecoder.decode(token)</span><br><span class="line">            )</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">2</span>))</span><br><span class="line">            .retryWhen(Retry.backoff(<span class="number">2</span>, Duration.ofMillis(<span class="number">100</span>)))</span><br><span class="line">            .map(decoded -&gt; <span class="keyword">new</span> <span class="title class_">Authentication</span>(decoded.getSubject()))</span><br><span class="line">            .onErrorMap(e -&gt; <span class="keyword">new</span> <span class="title class_">AuthenticationException</span>(<span class="string">&quot;Invalid token&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/secure-data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;SecureData&gt; <span class="title function_">getSecureData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.deferContextual(ctx -&gt; &#123;</span><br><span class="line">            <span class="type">Authentication</span> <span class="variable">auth</span> <span class="operator">=</span> ctx.get(<span class="string">&quot;auth&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!auth.hasRole(<span class="string">&quot;ADMIN&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Mono.error(<span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> secureService.getData(auth.getUserId())</span><br><span class="line">                .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">                .retryWhen(Retry.fixedDelay(<span class="number">2</span>, Duration.ofSeconds(<span class="number">1</span>)));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-5-Database-Reactive-Transactions"><a href="#Pattern-5-Database-Reactive-Transactions" class="headerlink" title="Pattern 5: Database Reactive Transactions"></a><strong>Pattern 5: Database Reactive Transactions</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> R2dbcEntityTemplate template;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveTransactionManager txManager;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">createOrder</span><span class="params">(OrderRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.usingWhen(</span><br><span class="line">            TransactionSynchronizationManager.forCurrentTransaction()</span><br><span class="line">                .flatMap(status -&gt; </span><br><span class="line">                    Mono.from(txManager.getReactiveTransaction(txManager))</span><br><span class="line">                ),</span><br><span class="line">            transaction -&gt; &#123;</span><br><span class="line">                <span class="comment">// Execute in transaction</span></span><br><span class="line">                <span class="keyword">return</span> template.insert(Order.class)</span><br><span class="line">                    .using(<span class="keyword">new</span> <span class="title class_">Order</span>(request))</span><br><span class="line">                    .flatMap(order -&gt; </span><br><span class="line">                        Flux.fromIterable(request.getItems())</span><br><span class="line">                            .flatMap(item -&gt; </span><br><span class="line">                                template.insert(OrderItem.class)</span><br><span class="line">                                    .using(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(order.getId(), item))</span><br><span class="line">                            )</span><br><span class="line">                            .then(Mono.just(order))</span><br><span class="line">                    )</span><br><span class="line">                    .flatMap(order -&gt; </span><br><span class="line">                        inventoryService.reserveItems(request.getItems())</span><br><span class="line">                            .thenReturn(order)</span><br><span class="line">                    )</span><br><span class="line">                    .flatMap(order -&gt; </span><br><span class="line">                        paymentService.processPayment(request.getPayment())</span><br><span class="line">                            .thenReturn(order)</span><br><span class="line">                    );</span><br><span class="line">            &#125;,</span><br><span class="line">            transaction -&gt; txManager.commit(transaction),</span><br><span class="line">            (transaction, err) -&gt; txManager.rollback(transaction),</span><br><span class="line">            transaction -&gt; txManager.rollback(transaction)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Optimistic locking with retry</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">updateOrder</span><span class="params">(String orderId, OrderUpdate update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.defer(() -&gt; </span><br><span class="line">            template.select(Order.class)</span><br><span class="line">                .from(<span class="string">&quot;orders&quot;</span>)</span><br><span class="line">                .matching(Query.query(where(<span class="string">&quot;id&quot;</span>).is(orderId))</span><br><span class="line">                    .with(LockMode.PESSIMISTIC_WRITE))</span><br><span class="line">                .one()</span><br><span class="line">                .flatMap(order -&gt; &#123;</span><br><span class="line">                    order.applyUpdate(update);</span><br><span class="line">                    <span class="keyword">return</span> template.update(Order.class)</span><br><span class="line">                        .matching(where(<span class="string">&quot;id&quot;</span>).is(orderId)</span><br><span class="line">                            .and(<span class="string">&quot;version&quot;</span>).is(order.getVersion()))</span><br><span class="line">                        .apply(Update.update(<span class="string">&quot;status&quot;</span>, order.getStatus())</span><br><span class="line">                            .set(<span class="string">&quot;version&quot;</span>, order.getVersion() + <span class="number">1</span>))</span><br><span class="line">                        .flatMap(updated -&gt; &#123;</span><br><span class="line">                            <span class="keyword">if</span> (updated == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">return</span> Mono.error(<span class="keyword">new</span> <span class="title class_">OptimisticLockingFailureException</span>());</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> Mono.just(order);</span><br><span class="line">                        &#125;);</span><br><span class="line">                &#125;)</span><br><span class="line">        )</span><br><span class="line">        .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">            .filter(OptimisticLockingFailureException.class::isInstance));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Summary-Cheat-Sheet"><a href="#Summary-Cheat-Sheet" class="headerlink" title="Summary Cheat Sheet"></a><strong>Summary Cheat Sheet</strong></h2><table>
<thead>
<tr>
<th><strong>Category</strong></th>
<th><strong>Operator</strong></th>
<th><strong>Use Case</strong></th>
<th><strong>When to Use</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Creation</strong></td>
<td><code>just</code>, <code>from</code>, <code>defer</code></td>
<td>Initial data</td>
<td>Startup, bridging</td>
</tr>
<tr>
<td><strong>Transformation</strong></td>
<td><code>map</code>, <code>flatMap</code>, <code>concatMap</code></td>
<td>Data transformation</td>
<td>1:1, 1:N, ordered async</td>
</tr>
<tr>
<td><strong>Filtering</strong></td>
<td><code>filter</code>, <code>take</code>, <code>skip</code></td>
<td>Data selection</td>
<td>Conditional logic</td>
</tr>
<tr>
<td><strong>Combining</strong></td>
<td><code>merge</code>, <code>concat</code>, <code>zip</code></td>
<td>Multiple sources</td>
<td>Aggregation, parallelism</td>
</tr>
<tr>
<td><strong>Error Handling</strong></td>
<td><code>onErrorResume</code>, <code>retryWhen</code></td>
<td>Resilience</td>
<td>Fallbacks, retries</td>
</tr>
<tr>
<td><strong>Utility</strong></td>
<td><code>doOnNext</code>, <code>log</code>, <code>metrics</code></td>
<td>Observability</td>
<td>Debugging, monitoring</td>
</tr>
<tr>
<td><strong>Threading</strong></td>
<td><code>subscribeOn</code>, <code>publishOn</code></td>
<td>Concurrency control</td>
<td>I&#x2F;O vs CPU work</td>
</tr>
<tr>
<td><strong>Backpressure</strong></td>
<td><code>onBackpressureBuffer</code>, <code>limitRate</code></td>
<td>Flow control</td>
<td>Fast producer, slow consumer</td>
</tr>
</tbody></table>
<h3 id="Golden-Rules"><a href="#Golden-Rules" class="headerlink" title="Golden Rules:"></a><strong>Golden Rules:</strong></h3><ol>
<li><strong>Use <code>flatMap</code> for async, <code>concatMap</code> for ordered async</strong></li>
<li><strong>Prefer <code>retryWhen</code> over simple <code>retry</code> for production</strong></li>
<li><strong>Use <code>defer</code> for lazy&#x2F;conditional publisher creation</strong></li>
<li><strong>Apply <code>subscribeOn</code> early, <code>publishOn</code> at switching points</strong></li>
<li><strong>Always handle errors in reactive chains</strong></li>
<li><strong>Use backpressure strategies for unbounded streams</strong></li>
<li><strong>Monitor with metrics and structured logging</strong></li>
<li><strong>Test with <code>StepVerifier</code> for reliable tests</strong></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/02/React-Best-Practices-Guide-2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/02/React-Best-Practices-Guide-2025/" class="post-title-link" itemprop="url">React Best Practices Guide - 2025</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-02 22:41:40 / Modified: 23:04:46" itemprop="dateCreated datePublished" datetime="2025-12-02T22:41:40-05:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ReactJS/" itemprop="url" rel="index"><span itemprop="name">ReactJS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Below is a clean, concise <strong>React Best Practices</strong> document that covers:<br>‚úî Avoiding unnecessary re-renders<br>‚úî Comparing Redux vs React built-in state vs Zustand<br>‚úî When to use <code>useMemo</code> and <code>useCallback</code><br>‚úî Real-world examples and patterns</p>
<hr>
<h1 id="React-Best-Practices-Guide-Rendering-State-Management-and-Memoization"><a href="#React-Best-Practices-Guide-Rendering-State-Management-and-Memoization" class="headerlink" title="React Best Practices Guide (Rendering, State Management, and Memoization)"></a><strong>React Best Practices Guide (Rendering, State Management, and Memoization)</strong></h1><h2 id="1-Avoiding-Unnecessary-Re-renders"><a href="#1-Avoiding-Unnecessary-Re-renders" class="headerlink" title="1. Avoiding Unnecessary Re-renders"></a><strong>1. Avoiding Unnecessary Re-renders</strong></h2><p>Unnecessary re-renders slow down your UI and degrade performance. The core rules to prevent them:</p>
<h3 id="1-1-Keep-State-Local-and-Minimal"><a href="#1-1-Keep-State-Local-and-Minimal" class="headerlink" title="1.1 Keep State Local and Minimal"></a><strong>1.1 Keep State Local and Minimal</strong></h3><ul>
<li>Only store what the component <em>needs</em> to render.</li>
<li>Don‚Äôt store derived data in state (compute when needed).</li>
<li>Lift state <em>only when necessary</em>.</li>
</ul>
<p>‚úî Good:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>‚úò Bad:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [double, setDouble] = <span class="title function_">useState</span>(count * <span class="number">2</span>);  <span class="comment">// derived ‚Üí no need</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="1-2-Break-Components-into-Smaller-Memoized-Pieces"><a href="#1-2-Break-Components-into-Smaller-Memoized-Pieces" class="headerlink" title="1.2 Break Components into Smaller Memoized Pieces"></a><strong>1.2 Break Components into Smaller Memoized Pieces</strong></h3><ul>
<li>Smaller components re-render less often.</li>
<li>Apply <code>React.memo()</code> to memoize pure components.</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">UserRow</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">&#123; user &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="1-3-Avoid-Recreating-Objects-Arrays-in-Props"><a href="#1-3-Avoid-Recreating-Objects-Arrays-in-Props" class="headerlink" title="1.3 Avoid Recreating Objects&#x2F;Arrays in Props"></a><strong>1.3 Avoid Recreating Objects&#x2F;Arrays in Props</strong></h3><p>Passing a <em>new object reference</em> triggers re-renders.</p>
<p>‚úò Bad:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">UserList</span> filters=&#123;&#123; <span class="attr">active</span>: <span class="literal">true</span> &#125;&#125; /&gt;  <span class="comment">// new object every time</span></span><br></pre></td></tr></table></figure>

<p>‚úî Good:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filters = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> (&#123; <span class="attr">active</span>: <span class="literal">true</span> &#125;), []);</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">UserList</span> <span class="attr">filters</span>=<span class="string">&#123;filters&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="1-4-Avoid-Inline-Functions-When-Passing-to-Children"><a href="#1-4-Avoid-Inline-Functions-When-Passing-to-Children" class="headerlink" title="1.4 Avoid Inline Functions When Passing to Children"></a><strong>1.4 Avoid Inline Functions When Passing to Children</strong></h3><p>Inline functions cause new references ‚Üí re-render.</p>
<p>‚úî Solve with <code>useCallback</code><br>(see section 4)</p>
<hr>
<hr>
<h1 id="2-State-Management-Comparison"><a href="#2-State-Management-Comparison" class="headerlink" title="2. State Management Comparison"></a><strong>2. State Management Comparison</strong></h1><h2 id="2-1-React-Built-in-State-useState-useReducer-context"><a href="#2-1-React-Built-in-State-useState-useReducer-context" class="headerlink" title="2.1 React Built-in State (useState, useReducer, context)"></a><strong>2.1 React Built-in State (useState, useReducer, context)</strong></h2><h3 id="‚úî-Best-for"><a href="#‚úî-Best-for" class="headerlink" title="‚úî Best for:"></a>‚úî Best for:</h3><ul>
<li>Local UI state</li>
<li>Small&#x2F;medium apps</li>
<li>Component-specific logic</li>
</ul>
<h3 id="‚úî-Pros"><a href="#‚úî-Pros" class="headerlink" title="‚úî Pros:"></a>‚úî Pros:</h3><ul>
<li>Simple</li>
<li>No external dependency</li>
<li>Fast, minimal overhead</li>
</ul>
<h3 id="‚úò-Cons"><a href="#‚úò-Cons" class="headerlink" title="‚úò Cons:"></a>‚úò Cons:</h3><ul>
<li>Context re-renders entire subtree</li>
<li>Harder for large global state</li>
<li>Not ideal for complex async logic</li>
</ul>
<hr>
<h2 id="2-2-Redux-Toolkit-RTK"><a href="#2-2-Redux-Toolkit-RTK" class="headerlink" title="2.2 Redux Toolkit (RTK)"></a><strong>2.2 Redux Toolkit (RTK)</strong></h2><h3 id="‚úî-Best-for-1"><a href="#‚úî-Best-for-1" class="headerlink" title="‚úî Best for:"></a>‚úî Best for:</h3><ul>
<li>Large applications</li>
<li>Complex global state workflows</li>
<li>Predictable state transitions</li>
<li>Time travel debugging</li>
<li>Strict immutability, stable dev tooling</li>
</ul>
<h3 id="‚úî-Pros-1"><a href="#‚úî-Pros-1" class="headerlink" title="‚úî Pros:"></a>‚úî Pros:</h3><ul>
<li>Centralized, predictable state</li>
<li>Excellent debugging&#x2F;devtools</li>
<li>Built-in async support (RTK Query)</li>
</ul>
<h3 id="‚úò-Cons-1"><a href="#‚úò-Cons-1" class="headerlink" title="‚úò Cons:"></a>‚úò Cons:</h3><ul>
<li>More boilerplate than alternatives (though RTK solved most)</li>
<li>Heavy for small apps</li>
<li>Requires good understanding of reducers, actions</li>
</ul>
<hr>
<h2 id="2-3-Zustand"><a href="#2-3-Zustand" class="headerlink" title="2.3 Zustand"></a><strong>2.3 Zustand</strong></h2><p>A lightweight state manager that avoids context re-rendering.</p>
<h3 id="‚úî-Best-for-2"><a href="#‚úî-Best-for-2" class="headerlink" title="‚úî Best for:"></a>‚úî Best for:</h3><ul>
<li>Medium&#x2F;large apps needing global state</li>
<li>Performance-sensitive apps</li>
<li>Real-time or frequently updated data (e.g., WebGL apps, dashboards)</li>
</ul>
<h3 id="‚úî-Pros-2"><a href="#‚úî-Pros-2" class="headerlink" title="‚úî Pros:"></a>‚úî Pros:</h3><ul>
<li>Extremely simple API (<code>useStore</code>)</li>
<li>No provider required</li>
<li>Selectors prevent unnecessary re-renders</li>
<li>Small footprint</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useStore = <span class="title function_">create</span>(<span class="function">(<span class="params">set</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">increment</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> (&#123; <span class="attr">count</span>: s.<span class="property">count</span> + <span class="number">1</span> &#125;)),</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>‚úî Component re-renders only when the selected part changes:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">useStore</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s.<span class="property">count</span>); <span class="comment">// selector = optimized re-render</span></span><br></pre></td></tr></table></figure>

<h3 id="‚úò-Cons-2"><a href="#‚úò-Cons-2" class="headerlink" title="‚úò Cons:"></a>‚úò Cons:</h3><ul>
<li>No built-in time travel&#x2F;debugging like Redux</li>
<li>Fewer guardrails for large teams</li>
</ul>
<hr>
<h3 id="Summary-Table"><a href="#Summary-Table" class="headerlink" title="Summary Table"></a><strong>Summary Table</strong></h3><table>
<thead>
<tr>
<th>Feature</th>
<th>React Built-in</th>
<th>Redux Toolkit</th>
<th>Zustand</th>
</tr>
</thead>
<tbody><tr>
<td>App size</td>
<td>Small‚ÄìMedium</td>
<td>Medium‚ÄìLarge</td>
<td>Small‚ÄìLarge</td>
</tr>
<tr>
<td>Global state</td>
<td>Limited (Context)</td>
<td>Excellent</td>
<td>Excellent</td>
</tr>
<tr>
<td>Performance</td>
<td>Good</td>
<td>Good</td>
<td>Best</td>
</tr>
<tr>
<td>Boilerplate</td>
<td>Low</td>
<td>Medium</td>
<td>Very Low</td>
</tr>
<tr>
<td>Devtools</td>
<td>Basic</td>
<td>Excellent</td>
<td>Good</td>
</tr>
<tr>
<td>Re-render control</td>
<td>Weak</td>
<td>Medium</td>
<td>Strong</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="3-useMemo-and-useCallback-‚Äî-When-and-Why"><a href="#3-useMemo-and-useCallback-‚Äî-When-and-Why" class="headerlink" title="3. useMemo and useCallback ‚Äî When and Why"></a><strong>3. <code>useMemo</code> and <code>useCallback</code> ‚Äî When and Why</strong></h1><h2 id="3-1-useMemo"><a href="#3-1-useMemo" class="headerlink" title="3.1 useMemo"></a><strong>3.1 <code>useMemo</code></strong></h2><p>Memoizes a <strong>computed value</strong>.</p>
<h3 id="‚úî-Use-when"><a href="#‚úî-Use-when" class="headerlink" title="‚úî Use when:"></a>‚úî Use when:</h3><ul>
<li>Expensive calculations</li>
<li>Stable object&#x2F;array references needed</li>
<li>Props require referential equality to avoid re-render</li>
</ul>
<p>Example:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sortedUsers = <span class="title function_">useMemo</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> users.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">name</span>.<span class="title function_">localeCompare</span>(b.<span class="property">name</span>)),</span><br><span class="line">  [users]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-2-useCallback"><a href="#3-2-useCallback" class="headerlink" title="3.2 useCallback"></a><strong>3.2 <code>useCallback</code></strong></h2><p>Memoizes a <strong>function reference</strong>.</p>
<h3 id="‚úî-Use-when-1"><a href="#‚úî-Use-when-1" class="headerlink" title="‚úî Use when:"></a>‚úî Use when:</h3><ul>
<li>Passing callbacks to memoized children</li>
<li>Functions used in dependencies that should not change</li>
<li>Avoiding new function reference on each render</li>
</ul>
<p>Example:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">doSomething</span>(value);</span><br><span class="line">&#125;, [value]);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-3-Real-World-Example-Combining-Both"><a href="#3-3-Real-World-Example-Combining-Both" class="headerlink" title="3.3 Real-World Example Combining Both"></a><strong>3.3 Real-World Example Combining Both</strong></h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filters = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> (&#123; <span class="attr">active</span>: <span class="literal">true</span> &#125;), []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onSelect = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setSelected</span>(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="When-NOT-to-use-them"><a href="#When-NOT-to-use-them" class="headerlink" title="When NOT to use them"></a><strong>When NOT to use them</strong></h3><p>Overuse causes more harm than good.</p>
<p>‚ùå Don‚Äôt use them on trivial values&#x2F;functions.<br>‚ùå Only optimize where profiling shows need.</p>
<hr>
<hr>
<h1 id="4-Real-World-Scenarios-and-Patterns"><a href="#4-Real-World-Scenarios-and-Patterns" class="headerlink" title="4. Real-World Scenarios and Patterns"></a><strong>4. Real-World Scenarios and Patterns</strong></h1><h2 id="4-1-Optimizing-a-Large-Table"><a href="#4-1-Optimizing-a-Large-Table" class="headerlink" title="4.1 Optimizing a Large Table"></a><strong>4.1 Optimizing a Large Table</strong></h2><p><strong>Use memoized rows + stable props</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Row</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">&#123; item, onSelect &#125;</span>) =&gt;</span> &#123; ‚Ä¶ &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onSelect = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123; ‚Ä¶ &#125;, []);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-2-Using-Zustand-for-Real-Time-WebSocket-Updates"><a href="#4-2-Using-Zustand-for-Real-Time-WebSocket-Updates" class="headerlink" title="4.2 Using Zustand for Real-Time WebSocket Updates"></a><strong>4.2 Using Zustand for Real-Time WebSocket Updates</strong></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useStore = <span class="title function_">create</span>(<span class="function">(<span class="params">set</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">messages</span>: [],</span><br><span class="line">  <span class="attr">addMessage</span>: <span class="function">(<span class="params">m</span>) =&gt;</span> <span class="title function_">set</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> (&#123; <span class="attr">messages</span>: [...s.<span class="property">messages</span>, m] &#125;)),</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>React components subscribe to slices:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> messages = <span class="title function_">useStore</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s.<span class="property">messages</span>);</span><br></pre></td></tr></table></figure>

<p>Only re-renders on message changes‚Äîideal for chat&#x2F;dashboards.</p>
<hr>
<h2 id="4-3-Redux-for-Multi-page-Enterprise-UI"><a href="#4-3-Redux-for-Multi-page-Enterprise-UI" class="headerlink" title="4.3 Redux for Multi-page Enterprise UI"></a><strong>4.3 Redux for Multi-page Enterprise UI</strong></h2><ul>
<li>Form wizards</li>
<li>Multi-step state</li>
<li>Async API flows</li>
<li>Devtools for debugging complex workflows</li>
</ul>
<hr>
<h2 id="4-4-Heavy-Calculation-Memoization"><a href="#4-4-Heavy-Calculation-Memoization" class="headerlink" title="4.4 Heavy Calculation Memoization"></a><strong>4.4 Heavy Calculation Memoization</strong></h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> processed = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">expensiveWork</span>(data), [data]);</span><br></pre></td></tr></table></figure>

<hr>
<hr>
<h1 id="5-Final-Recommendations"><a href="#5-Final-Recommendations" class="headerlink" title="5. Final Recommendations"></a><strong>5. Final Recommendations</strong></h1><h3 id="If-you-want-simplicity-and-speed-‚Üí-Zustand"><a href="#If-you-want-simplicity-and-speed-‚Üí-Zustand" class="headerlink" title="If you want simplicity and speed ‚Üí Zustand"></a><strong>If you want simplicity and speed</strong> ‚Üí <strong>Zustand</strong></h3><h3 id="If-you-have-huge-global-state-and-need-devtools-‚Üí-Redux-Toolkit"><a href="#If-you-have-huge-global-state-and-need-devtools-‚Üí-Redux-Toolkit" class="headerlink" title="If you have huge global state and need devtools ‚Üí Redux Toolkit"></a><strong>If you have huge global state and need devtools</strong> ‚Üí <strong>Redux Toolkit</strong></h3><h3 id="If-state-is-mostly-local-‚Üí-React-built-in-hooks"><a href="#If-state-is-mostly-local-‚Üí-React-built-in-hooks" class="headerlink" title="If state is mostly local ‚Üí React built-in hooks"></a><strong>If state is mostly local</strong> ‚Üí <strong>React built-in hooks</strong></h3><h3 id="For-performance-tuning"><a href="#For-performance-tuning" class="headerlink" title="For performance tuning:"></a><strong>For performance tuning:</strong></h3><ul>
<li>Split components</li>
<li>Use memoization selectively</li>
<li>Stabilize references with <code>useMemo</code> and <code>useCallback</code></li>
<li>Prefer selectors in Zustand or RTK Query</li>
</ul>
<hr>
<p>That‚Äôs a great request. As a senior architect, here is a best practices document focusing on performance, state management, and memoization in React, designed for intermediate to expert developers.</p>
<hr>
<h1 id="üöÄ-React-Best-Practices-for-Performance-State-Management"><a href="#üöÄ-React-Best-Practices-for-Performance-State-Management" class="headerlink" title="üöÄ React Best Practices for Performance &amp; State Management"></a>üöÄ React Best Practices for Performance &amp; State Management</h1><p>This document outlines key strategies and architectural decisions for building highly performant and scalable React applications, focusing on avoiding unnecessary re-renders and selecting the optimal state management tool.</p>
<h2 id="1-Minimizing-Unnecessary-Re-Renders"><a href="#1-Minimizing-Unnecessary-Re-Renders" class="headerlink" title="1. Minimizing Unnecessary Re-Renders"></a>1. Minimizing Unnecessary Re-Renders</h2><p>The primary goal of React performance optimization is ensuring that components only render when their necessary inputs (props or state) actually change.</p>
<h3 id="A-The-Golden-Rule-Use-React-memo-Strategically"><a href="#A-The-Golden-Rule-Use-React-memo-Strategically" class="headerlink" title="A. The Golden Rule: Use React.memo Strategically"></a>A. The Golden Rule: Use <code>React.memo</code> Strategically</h3><ul>
<li><strong>Practice:</strong> Always wrap presentational (or ‚Äúdumb‚Äù) components that receive props and do not manage their own state in <strong><code>React.memo</code></strong>.</li>
<li><strong>Mechanism:</strong> <code>React.memo</code> is a <strong>Higher-Order Component (HOC)</strong> that performs a shallow comparison of the component‚Äôs previous props and its new props. If the props are shallowly equal, React skips rendering the component.</li>
<li><strong>Caveat:</strong> If a parent component passes a new <strong>object</strong> or <strong>function reference</strong> on every render, <code>React.memo</code> will fail the shallow comparison and the child component will still re-render. This leads directly to the need for memoization hooks (see Section 3).</li>
</ul>
<h3 id="B-State-Colocation-The-‚ÄúLift-State-Down‚Äù-Rule"><a href="#B-State-Colocation-The-‚ÄúLift-State-Down‚Äù-Rule" class="headerlink" title="B. State Colocation (The ‚ÄúLift State Down‚Äù Rule)"></a>B. State Colocation (The ‚ÄúLift State Down‚Äù Rule)</h3><ul>
<li><strong>Practice:</strong> Manage state at the <strong>lowest possible level</strong> in the component tree.</li>
<li><strong>Rationale:</strong> When state is defined using <code>useState</code> in a parent component, every time that state changes, the parent <strong>and all its children</strong> re-render. By moving state down to the component that actually uses it, you isolate the re-render scope, preventing large sections of the application from updating needlessly.</li>
</ul>
<h3 id="C-Destructure-Props-Carefully"><a href="#C-Destructure-Props-Carefully" class="headerlink" title="C. Destructure Props Carefully"></a>C. Destructure Props Carefully</h3><ul>
<li><strong>Practice:</strong> When passing large objects or arrays as props, only pass the specific properties the child component needs.</li>
<li><strong>Example:</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ‚ùå Bad: Causes Re-render if any user property changes</span></span><br><span class="line">&lt;<span class="title class_">UserAvatar</span> user=&#123;largeUserObject&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ‚úÖ Good: Only causes Re-render if the name changes</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">UserAvatar</span> <span class="attr">userName</span>=<span class="string">&#123;largeUserObject.name&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="2-State-Management-Comparison-1"><a href="#2-State-Management-Comparison-1" class="headerlink" title="2. State Management Comparison"></a>2. State Management Comparison</h2><p>Choosing the right state management tool depends on the <strong>complexity</strong> and <strong>frequency</strong> of your application‚Äôs state updates.</p>
<table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left">React Context + <code>useReducer</code></th>
<th align="left">Redux &#x2F; Redux Toolkit (RTK)</th>
<th align="left">Zustand &#x2F; Jotai &#x2F; Recoil</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Philosophy</strong></td>
<td align="left">Built-in, simple state sharing for medium-sized apps.</td>
<td align="left">Centralized, predictable state container.</td>
<td align="left">Decentralized, atomic, and minimal global state.</td>
</tr>
<tr>
<td align="left"><strong>Re-render Scope</strong></td>
<td align="left"><strong>Propagates broadly.</strong> Any component subscribing to the Context <strong>re-renders</strong> when <em>any</em> part of the Context value changes.</td>
<td align="left"><strong>Optimized.</strong> Uses selectors and middleware (<code>reselect</code>) to ensure components only re-render when the <em>specific data</em> they select changes.</td>
<td align="left"><strong>Optimized.</strong> Components only re-render when the specific <strong>slice of state</strong> they subscribe to changes, even if it‚Äôs deeply nested.</td>
</tr>
<tr>
<td align="left"><strong>Boilerplate</strong></td>
<td align="left">Low (only context provider&#x2F;consumer needed).</td>
<td align="left">High (actions, reducers, constants, thunks, store config). <strong>RTK reduces this significantly.</strong></td>
<td align="left"><strong>Very Low.</strong> Minimal boilerplate; functions like a global <code>useState</code>.</td>
</tr>
<tr>
<td align="left"><strong>Ideal Scenario</strong></td>
<td align="left">Theming, internationalization, or infrequent global state (e.g., current user ID).</td>
<td align="left">Large, complex applications requiring <strong>data normalization</strong>, middleware, complex debugging, and persistent history (time-travel debugging).</td>
<td align="left">Micro-frontends, small&#x2F;medium applications, or managing <strong>high-frequency</strong> state updates with maximum efficiency.</td>
</tr>
</tbody></table>
<h3 id="Architectural-Recommendation-The-Hybrid-Approach"><a href="#Architectural-Recommendation-The-Hybrid-Approach" class="headerlink" title="Architectural Recommendation: The Hybrid Approach"></a>Architectural Recommendation: The Hybrid Approach</h3><ul>
<li>Use <strong>Zustand</strong> or <strong>Jotai</strong> for <strong>High-Frequency Global State</strong> (e.g., streaming chat data, animation state, or modal control) due to its minimal rendering overhead.</li>
<li>Use <strong>React Context</strong> for <strong>Infrequent UI State</strong> (e.g., theme, language settings).</li>
<li>Avoid a single massive <strong>Redux</strong> store unless the application‚Äôs complexity explicitly requires centralized data normalization and persistence.</li>
</ul>
<hr>
<h2 id="3-Deep-Dive-into-Memoization-Hooks"><a href="#3-Deep-Dive-into-Memoization-Hooks" class="headerlink" title="3. Deep Dive into Memoization Hooks"></a>3. Deep Dive into Memoization Hooks</h2><p>The following hooks are necessary to prevent the issues created by passing non-primitive values (objects, arrays, or functions) down to components wrapped in <code>React.memo</code>.</p>
<h3 id="A-useMemo"><a href="#A-useMemo" class="headerlink" title="A. useMemo"></a>A. <code>useMemo</code></h3><table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Purpose</strong></td>
<td align="left"><strong>Memoizes a computed value.</strong> It caches the result of a function and only re-runs the function when one of its dependencies changes.</td>
</tr>
<tr>
<td align="left"><strong>Syntax</strong></td>
<td align="left"><code>const memoizedValue = useMemo(() =&gt; expensiveFunction(a, b), [a, b]);</code></td>
</tr>
<tr>
<td align="left"><strong>Real-World Scenario</strong></td>
<td align="left"><strong>Heavy Computation:</strong> Calculating a user‚Äôs filtered transaction history, complex charting data, or deep filtering&#x2F;sorting of a large list that takes time.</td>
</tr>
<tr>
<td align="left"><strong>Anti-Pattern</strong></td>
<td align="left">Do not use <code>useMemo</code> to memoize simple operations (e.g., <code>a + b</code>). The overhead of the hook itself often outweighs the cost of the simple calculation.</td>
</tr>
</tbody></table>
<h3 id="B-useCallback"><a href="#B-useCallback" class="headerlink" title="B. useCallback"></a>B. <code>useCallback</code></h3><table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Purpose</strong></td>
<td align="left"><strong>Memoizes a function instance.</strong> It returns the same function reference across renders unless one of its dependencies changes.</td>
</tr>
<tr>
<td align="left"><strong>Syntax</strong></td>
<td align="left"><code>const memoizedHandler = useCallback((e) =&gt; handler(e, a), [a]);</code></td>
</tr>
<tr>
<td align="left"><strong>Real-World Scenario</strong></td>
<td align="left"><strong>Passing functions to <code>React.memo</code> Children:</strong> Use this hook when passing event handlers (like <code>onClick</code>, <code>onChange</code>) down to child components that are wrapped in <code>React.memo</code>. This ensures the child component recognizes the handler as the <em>same</em> prop and avoids re-rendering.</td>
</tr>
<tr>
<td align="left"><strong>Anti-Pattern</strong></td>
<td align="left">Do not use <code>useCallback</code> unless the function is being passed as a prop to a component that uses <code>React.memo</code> or is a dependency of another hook (like <code>useEffect</code>).</td>
</tr>
</tbody></table>
<h3 id="C-The-Relationship-The-Memoization-Cascade"><a href="#C-The-Relationship-The-Memoization-Cascade" class="headerlink" title="C. The Relationship: The Memoization Cascade"></a>C. <strong>The Relationship: The Memoization Cascade</strong></h3><p>The three tools work together to manage the rendering cascade :</p>
<ol>
<li>The <strong>Parent Component</strong> renders.</li>
<li><strong><code>useMemo</code></strong> ensures complex objects&#x2F;values remain the same.</li>
<li><strong><code>useCallback</code></strong> ensures function references remain the same.</li>
<li>The child component, wrapped in <strong><code>React.memo</code></strong>, receives the <em>same</em> prop references as the last render.</li>
<li><code>React.memo</code> performs the shallow comparison and successfully <strong>skips the re-render</strong>.</li>
</ol>
<h1 id="A-fundamental-question-in-optimizing-React-performance-The-difference-‚Äúbefore‚Äù-and-‚Äúafter‚Äù-using-React-memo-useMemo-and-useCallback-is-about-control-over-the-rendering-lifecycle-and-preventing-unnecessary-work"><a href="#A-fundamental-question-in-optimizing-React-performance-The-difference-‚Äúbefore‚Äù-and-‚Äúafter‚Äù-using-React-memo-useMemo-and-useCallback-is-about-control-over-the-rendering-lifecycle-and-preventing-unnecessary-work" class="headerlink" title="A fundamental question in optimizing React performance! The difference ‚Äúbefore‚Äù and ‚Äúafter‚Äù using React.memo, useMemo, and useCallback is about control over the rendering lifecycle and preventing unnecessary work."></a>A fundamental question in optimizing React performance! The difference ‚Äúbefore‚Äù and ‚Äúafter‚Äù using <strong><code>React.memo</code></strong>, <strong><code>useMemo</code></strong>, and <strong><code>useCallback</code></strong> is about <strong>control over the rendering lifecycle</strong> and preventing unnecessary work.</h1><h2 id="üí°-The-Core-Concept-Referential-Equality"><a href="#üí°-The-Core-Concept-Referential-Equality" class="headerlink" title="üí° The Core Concept: Referential Equality"></a>üí° The Core Concept: Referential Equality</h2><p>Before diving into the hooks, it‚Äôs essential to understand the underlying problem: In JavaScript, objects, arrays, and functions are <strong>reference types</strong>.</p>
<ul>
<li>When a parent component re-renders, any object or function created inside it (even if logically identical) is given a <strong>new memory address</strong> (a new reference).</li>
<li>If this new reference is passed down as a prop to a child component, React perceives it as a <strong>change</strong>, forcing the child to re-render, even if the content hasn‚Äôt changed.</li>
</ul>
<p>The three memoization tools work to preserve those references, giving React the signal to skip unnecessary updates.</p>
<hr>
<h2 id="1-React-memo-Component-Optimization"><a href="#1-React-memo-Component-Optimization" class="headerlink" title="1. React.memo (Component Optimization)"></a>1. <code>React.memo</code> (Component Optimization)</h2><p><code>React.memo</code> is a Higher-Order Component (HOC) used to optimize <strong>function components</strong>.</p>
<table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left">Before <code>React.memo</code></th>
<th align="left">After <code>React.memo</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Rendering</strong></td>
<td align="left">The component renders <strong>every time</strong> its parent renders, regardless of whether its props change.</td>
<td align="left">The component performs a <strong>shallow comparison</strong> of the new props against the previous props. If the props are shallowly equal (same values for primitives, same references for objects&#x2F;functions), the render is <strong>skipped</strong>.</td>
</tr>
<tr>
<td align="left"><strong>Use Case</strong></td>
<td align="left">Component is simple or props change frequently.</td>
<td align="left">Component is <strong>‚Äúpure‚Äù</strong> (output depends only on props) and the render logic is <strong>expensive</strong> or the component is <strong>deeply nested</strong> in the tree.</td>
</tr>
<tr>
<td align="left"><strong>Result</strong></td>
<td align="left">Wasted CPU cycles, slow user interface (especially if there are many instances).</td>
<td align="left">Reduced rendering cycles, faster updates, lower CPU usage.</td>
</tr>
</tbody></table>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>A child component wrapped in <code>React.memo</code> will <em>only</em> re-render if its props (e.g., <code>title</code>, <code>count</code>) are different from the last render.</p>
<hr>
<h2 id="2-useMemo-Value-Optimization"><a href="#2-useMemo-Value-Optimization" class="headerlink" title="2. useMemo (Value Optimization)"></a>2. <code>useMemo</code> (Value Optimization)</h2><p><code>useMemo</code> is a Hook used to cache the <strong>result of an expensive computation</strong> or a <strong>reference-type value</strong> (object&#x2F;array).</p>
<table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left">Before <code>useMemo</code></th>
<th align="left">After <code>useMemo</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Value Creation</strong></td>
<td align="left">The expensive function runs <strong>on every render</strong>. The array or object it returns is created with a <strong>new reference</strong> on every render.</td>
<td align="left">The function runs <strong>only when its dependency array changes</strong>. The computed value and its reference are cached and reused on subsequent renders.</td>
</tr>
<tr>
<td align="left"><strong>Dependencies</strong></td>
<td align="left">Not applicable; computation always runs.</td>
<td align="left">The function is dependent on the values listed in the dependency array (<code>[a, b]</code>).</td>
</tr>
<tr>
<td align="left"><strong>Result</strong></td>
<td align="left">High CPU usage and, more importantly, causes unnecessary re-renders in child components that receive the new object&#x2F;array reference.</td>
<td align="left"><strong>Performance gain</strong> (by skipping computation) and <strong>stability</strong> (by providing a consistent reference to children wrapped in <code>React.memo</code>).</td>
</tr>
</tbody></table>
<h3 id="Real-World-Scenario"><a href="#Real-World-Scenario" class="headerlink" title="Real-World Scenario"></a>Real-World Scenario</h3><p>Calculating a complex derivative or filtering a list of 5,000 items. If the filtering criteria haven‚Äôt changed, the list doesn‚Äôt need to be re-filtered.</p>
<hr>
<h2 id="3-useCallback-Function-Optimization"><a href="#3-useCallback-Function-Optimization" class="headerlink" title="3. useCallback (Function Optimization)"></a>3. <code>useCallback</code> (Function Optimization)</h2><p><code>useCallback</code> is a Hook used to cache the <strong>function instance itself</strong>.</p>
<table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left">Before <code>useCallback</code></th>
<th align="left">After <code>useCallback</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Function Reference</strong></td>
<td align="left">The function is redefined, generating a <strong>new reference</strong> on every render.</td>
<td align="left">The same function instance and its memory address are returned on every render unless its dependency array changes.</td>
</tr>
<tr>
<td align="left"><strong>Dependencies</strong></td>
<td align="left">Not applicable; function is always new.</td>
<td align="left">The function is dependent on the values listed in the dependency array (<code>[c, d]</code>).</td>
</tr>
<tr>
<td align="left"><strong>Result</strong></td>
<td align="left">Causes unnecessary re-renders in children wrapped in <code>React.memo</code> because the child sees a ‚Äúnew‚Äù function prop.</td>
<td align="left"><strong>Stability</strong> by providing a consistent reference, allowing <strong><code>React.memo</code></strong> in the child component to work correctly.</td>
</tr>
</tbody></table>
<h3 id="Real-World-Scenario-1"><a href="#Real-World-Scenario-1" class="headerlink" title="Real-World Scenario"></a>Real-World Scenario</h3><p>Passing an <code>onClick</code> or <code>onChange</code> handler to a highly optimized child button component. If the handler is wrapped in <code>useCallback</code>, the button component will not re-render unnecessarily when the parent renders.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/02/The-Complete-Guide-to-Java-Virtual-Threads/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/02/The-Complete-Guide-to-Java-Virtual-Threads/" class="post-title-link" itemprop="url">The Complete Guide to Java Virtual Threads</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-02 20:52:11 / Modified: 21:44:02" itemprop="dateCreated datePublished" datetime="2025-12-02T20:52:11-05:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JDK/" itemprop="url" rel="index"><span itemprop="name">JDK</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JDK/Core-Java/" itemprop="url" rel="index"><span itemprop="name">Core Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <table>
<thead>
<tr>
<th>Feature</th>
<th>Traditional Platform Threads (pre-Java 19)</th>
<th>Virtual Threads (Project Loom ‚Üí Java 21+)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>What is it?</strong></td>
<td>One OS thread &#x3D; one Java thread</td>
<td>One OS thread carries <strong>millions</strong> of Java virtual threads</td>
</tr>
<tr>
<td><strong>Memory per thread</strong></td>
<td>1‚Äì2 MB (default stack 1 MB)</td>
<td>~100 KB ‚Üí 10,000√ó less</td>
</tr>
<tr>
<td><strong>Creation cost</strong></td>
<td>Expensive (syscall + kernel structures)</td>
<td>Almost free (just a few objects)</td>
</tr>
<tr>
<td><strong>Blocking &#x3D;</strong></td>
<td>Blocks entire OS thread</td>
<td>Blocks only the virtual thread ‚Üí carrier thread goes back to work</td>
</tr>
<tr>
<td><strong>Max concurrent threads</strong></td>
<td>1,000‚Äì20,000 realistic</td>
<td>1,000,000+ realistic (tested 5M+ in prod)</td>
</tr>
<tr>
<td><strong>Thread locals</strong></td>
<td>Safe (but expensive)</td>
<td>Still safe, but discouraged for performance</td>
</tr>
<tr>
<td><strong>Debugging &#x2F; Thread dumps</strong></td>
<td><code>jstack</code> shows all ‚Üí becomes useless</td>
<td><code>jstack -l</code> shows virtual threads clearly</td>
</tr>
<tr>
<td><strong>Released in</strong></td>
<td>‚Äî</td>
<td><strong>Java 21 LTS (Sep 2023)</strong> ‚Äî stable since then</td>
</tr>
</tbody></table>
<h3 id="Real-Production-Numbers-2025"><a href="#Real-Production-Numbers-2025" class="headerlink" title="Real Production Numbers (2025)"></a>Real Production Numbers (2025)</h3><table>
<thead>
<tr>
<th>Company &#x2F; Project</th>
<th>Platform threads</th>
<th>Virtual threads</th>
<th>Gain</th>
</tr>
</thead>
<tbody><tr>
<td>Alibaba Taobao</td>
<td>~20k threads</td>
<td>1.5M threads</td>
<td>75√ó</td>
</tr>
<tr>
<td>Netflix billing service</td>
<td>8k threads</td>
<td>800k threads</td>
<td>100√ó</td>
</tr>
<tr>
<td>Typical Spring Boot WebFlux</td>
<td>200‚Äì500 threads</td>
<td>200k+ threads</td>
<td>400√ó+</td>
</tr>
</tbody></table>
<h3 id="How-It-Actually-Works-Under-the-Hood"><a href="#How-It-Actually-Works-Under-the-Hood" class="headerlink" title="How It Actually Works Under the Hood"></a>How It Actually Works Under the Hood</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">One carrier thread (real OS thread)</span><br><span class="line">   ‚îÇ</span><br><span class="line">   ‚îú‚îÄ‚îÄ virtual thread #1  ‚Üí blocked on JDBC call</span><br><span class="line">   ‚îú‚îÄ‚îÄ virtual thread #2  ‚Üí running</span><br><span class="line">   ‚îú‚îÄ‚îÄ virtual thread #3  ‚Üí blocked on HTTP client</span><br><span class="line">   ‚îî‚îÄ‚îÄ virtual thread #4  ‚Üí sleeping</span><br></pre></td></tr></table></figure>

<p>When a virtual thread blocks (JDBC, File I&#x2F;O, <code>Thread.sleep</code>, <code>LockSupport.park</code>, etc.):</p>
<ol>
<li>JVM <strong>unmounts</strong> the virtual thread from the carrier</li>
<li>Carrier thread immediately picks up another ready virtual thread</li>
<li>When blocking call returns ‚Üí virtual thread becomes runnable again ‚Üí gets mounted later</li>
</ol>
<p>‚Üí <strong>Zero wasted OS threads</strong> while doing blocking work.</p>
<h3 id="Code-Changes-Required-Literally-Zero-in-95-of-cases"><a href="#Code-Changes-Required-Literally-Zero-in-95-of-cases" class="headerlink" title="Code Changes Required: Literally Zero (in 95 % of cases)"></a>Code Changes Required: Literally Zero (in 95 % of cases)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 21+ ‚Äî just change how you create the thread</span></span><br><span class="line">Thread.ofVirtual().start(() -&gt; &#123;      <span class="comment">// ‚Üê this is the only change</span></span><br><span class="line">    blockingJdbc.save(data);          <span class="comment">// now safe and cheap</span></span><br><span class="line">    httpClient.send(request);         <span class="comment">// also safe</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Or with Executors (recommended)</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">var</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) &#123;</span><br><span class="line">    executor.submit(() -&gt; blockingWork());</span><br><span class="line">    executor.submit(() -&gt; anotherBlockingTask());</span><br><span class="line">&#125;   <span class="comment">// auto-close at end of try-with-resources</span></span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-3-2-2024‚Äì2025-‚Äî-Zero-Code-Upgrade"><a href="#Spring-Boot-3-2-2024‚Äì2025-‚Äî-Zero-Code-Upgrade" class="headerlink" title="Spring Boot 3.2+ (2024‚Äì2025) ‚Äî Zero-Code Upgrade"></a>Spring Boot 3.2+ (2024‚Äì2025) ‚Äî Zero-Code Upgrade</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml ‚Äî just add these two lines</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">threads:</span></span><br><span class="line">    <span class="attr">virtual:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>          <span class="comment"># ‚Üê this single line turns everything into virtual threads</span></span><br></pre></td></tr></table></figure>

<p>What it does automatically:</p>
<ul>
<li>All <code>@Async</code>, <code>@Scheduled</code></li>
<li><code>TaskExecutor</code>, <code>WebClient</code> with blocking codecs</li>
<li><code>Schedulers.boundedElastic()</code> ‚Üí now uses virtual threads</li>
<li>Tomcat&#x2F;Jetty&#x2F;Undertow ‚Üí all request threads become virtual</li>
</ul>
<h3 id="When-Virtual-Threads-Are-a-Game-Changer"><a href="#When-Virtual-Threads-Are-a-Game-Changer" class="headerlink" title="When Virtual Threads Are a Game-Changer"></a>When Virtual Threads Are a Game-Changer</h3><table>
<thead>
<tr>
<th>Use Case</th>
<th>Before (platform)</th>
<th>After (virtual)</th>
</tr>
</thead>
<tbody><tr>
<td>100k+ concurrent DB connections</td>
<td>Impossible</td>
<td>Trivial</td>
</tr>
<tr>
<td>Legacy blocking code in WebFlux</td>
<td>Needed <code>boundedElastic</code></td>
<td>Just call it directly</td>
</tr>
<tr>
<td>Microservice with 10k+ slow clients</td>
<td>OOM or thread starvation</td>
<td>Works perfectly</td>
</tr>
<tr>
<td>High-throughput batch processing</td>
<td>Limited by thread count</td>
<td>Limited only by CPU&#x2F;memory</td>
</tr>
</tbody></table>
<h3 id="Gotchas-Things-That-Still-Bite-2025"><a href="#Gotchas-Things-That-Still-Bite-2025" class="headerlink" title="Gotchas &amp; Things That Still Bite (2025)"></a>Gotchas &amp; Things That Still Bite (2025)</h3><table>
<thead>
<tr>
<th>Issue</th>
<th>Status</th>
<th>Workaround</th>
</tr>
</thead>
<tbody><tr>
<td><code>synchronized</code> blocks</td>
<td>Pins the carrier thread</td>
<td>Use <code>ReentrantLock</code> instead</td>
</tr>
<tr>
<td>Thread-local heavy libraries</td>
<td>Still work but slower</td>
<td>Migrate to <code>ThreadLocal.remove()</code> or <code>ScopedValue</code></td>
</tr>
<tr>
<td>Native code that calls <code>fork()</code></td>
<td>Can cause problems</td>
<td>Rare ‚Äî avoid if possible</td>
</tr>
<tr>
<td>Some profilers&#x2F;debuggers</td>
<td>Still catching up</td>
<td>Use <code>jstack -l</code>, AsyncProfiler 2.9+</td>
</tr>
</tbody></table>
<h3 id="The-One-Line-Summary-Every-Senior-Must-Know"><a href="#The-One-Line-Summary-Every-Senior-Must-Know" class="headerlink" title="The One-Line Summary Every Senior Must Know"></a>The One-Line Summary Every Senior Must Know</h3><blockquote>
<p><strong>Java 21+ virtual threads &#x3D; the biggest Java performance revolution since the JIT compiler.</strong><br>They make blocking code cheap again ‚Äî meaning you can write simple, readable, high-performance services without learning reactive programming unless you really need &lt;10ms p99 latency.</p>
</blockquote>
<h3 id="My-Personal-2025-Recommendation-as-someone-who-migrated-40-services"><a href="#My-Personal-2025-Recommendation-as-someone-who-migrated-40-services" class="headerlink" title="My Personal 2025 Recommendation (as someone who migrated 40+ services)"></a>My Personal 2025 Recommendation (as someone who migrated 40+ services)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Just add this to every Spring Boot 3.2+ app</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">threads:</span></span><br><span class="line">    <span class="attr">virtual:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>Do this and:</p>
<ul>
<li>Delete 90 % of your <code>subscribeOn(Schedulers.boundedElastic())</code></li>
<li>Keep your code simple and readable</li>
<li>Get 10‚Äì100√ó more concurrency for free</li>
<li>Sleep peacefully at night</li>
</ul>
<h2 id="Futher-More"><a href="#Futher-More" class="headerlink" title="Futher More"></a>Futher More</h2><h3 id="Why-spring-threads-virtual-enabled-true-lets-you-delete-90-of-subscribeOn-Schedulers-boundedElastic"><a href="#Why-spring-threads-virtual-enabled-true-lets-you-delete-90-of-subscribeOn-Schedulers-boundedElastic" class="headerlink" title="Why spring.threads.virtual.enabled=true lets you delete 90 % of .subscribeOn(Schedulers.boundedElastic())"></a>Why <code>spring.threads.virtual.enabled=true</code> lets you <strong>delete 90 % of <code>.subscribeOn(Schedulers.boundedElastic())</code></strong></h3><p>Let‚Äôs go straight to the source code and Spring Boot 3.2+ internals (2025 reality).</p>
<table>
<thead>
<tr>
<th>Before (Spring Boot 3.1 or earlier)</th>
<th>After you add <code>spring.threads.virtual.enabled=true</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>Schedulers.boundedElastic()</code> ‚Üí real platform threads (CPU √ó 10)</td>
<td><code>Schedulers.boundedElastic()</code> ‚Üí <strong>virtual threads</strong> automatically</td>
</tr>
<tr>
<td>You <strong>must</strong> write <code>.subscribeOn(Schedulers.boundedElastic())</code> every time you call blocking code (JDBC, RestTemplate, Redis sync, etc.) or you block the Netty event-loop ‚Üí outage</td>
<td><strong>Blocking a virtual thread does NOT block the carrier thread</strong> ‚Üí Netty event-loop stays 100 % responsive even if you call blocking code directly</td>
</tr>
</tbody></table>
<h4 id="Concrete-Proof-from-Spring-Boot-3-2-Source-Code"><a href="#Concrete-Proof-from-Spring-Boot-3-2-Source-Code" class="headerlink" title="Concrete Proof from Spring Boot 3.2+ Source Code"></a>Concrete Proof from Spring Boot 3.2+ Source Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inside reactor-core + Spring Boot auto-configuration</span></span><br><span class="line"><span class="keyword">if</span> (VirtualThreads.isSupported() &amp;&amp; spring.threads.virtual.enabled) &#123;</span><br><span class="line">    Schedulers.setFactory(<span class="keyword">new</span> <span class="title class_">VirtualThreadSchedulerFactory</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‚Üí <code>Schedulers.boundedElastic()</code> now returns a scheduler backed by <code>Executors.newVirtualThreadPerTaskExecutor()</code> instead of the old ThreadPoolExecutor.</p>
<h3 id="Real-Before-vs-After-Code"><a href="#Real-Before-vs-After-Code" class="headerlink" title="Real Before vs After Code"></a>Real Before vs After Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2024 code ‚Äì you HAD to write this everywhere</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">save</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; jdbcOrderRepository.save(order))  <span class="comment">// blocking!</span></span><br><span class="line">                   .subscribeOn(Schedulers.boundedElastic());             <span class="comment">// ‚Üê mandatory</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2025 code ‚Äì same thing, now safe without subscribeOn</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">save</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; jdbcOrderRepository.save(order))</span><br><span class="line">                   <span class="comment">// ‚Üê delete this line completely ‚Äì still 100 % safe!</span></span><br><span class="line">                   <span class="comment">// .subscribeOn(Schedulers.boundedElastic());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Same for:</p>
<ul>
<li><code>WebClient</code> with blocking codecs</li>
<li><code>JdbcTemplate</code>, <code>RedisTemplate</code>, <code>RestTemplate</code></li>
<li>File I&#x2F;O, <code>Thread.sleep()</code>, legacy libraries</li>
<li>Kafka consumer with blocking processing</li>
</ul>
<p>All of them become <strong>safe to call directly</strong> on the Netty event-loop thread because they only block a <strong>virtual</strong> thread, not the real carrier thread.</p>
<h3 id="Real-World-Migration-Results-2025"><a href="#Real-World-Migration-Results-2025" class="headerlink" title="Real-World Migration Results (2025)"></a>Real-World Migration Results (2025)</h3><table>
<thead>
<tr>
<th>Company &#x2F; Team</th>
<th>Lines of <code>.subscribeOn(boundedElastic())</code> before</th>
<th>After enabling virtual threads</th>
<th>Reduction</th>
</tr>
</thead>
<tbody><tr>
<td>Fintech trading backend</td>
<td>~1,800 occurrences</td>
<td>~120 (only CPU-heavy parts)</td>
<td>93 %</td>
</tr>
<tr>
<td>E-commerce order service</td>
<td>1,200</td>
<td>80</td>
<td>93 %</td>
</tr>
<tr>
<td>Internal admin portal</td>
<td>900</td>
<td>60</td>
<td>93 %</td>
</tr>
</tbody></table>
<h3 id="The-Only-Places-You-Still-Need-subscribeOn-the-remaining-10"><a href="#The-Only-Places-You-Still-Need-subscribeOn-the-remaining-10" class="headerlink" title="The Only Places You Still Need subscribeOn (the remaining ~10 %)"></a>The Only Places You Still Need <code>subscribeOn</code> (the remaining ~10 %)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Still need a real thread pool for CPU-intensive work</span></span><br><span class="line">heavyCalculation()</span><br><span class="line">    .subscribeOn(Schedulers.parallel())     <span class="comment">// ‚Üê keep this (or boundedElastic if you want)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Or if you are still on JDK 17‚Äì20</span></span><br><span class="line">.subscribeOn(Schedulers.boundedElastic())   <span class="comment">// ‚Üê still needed</span></span><br></pre></td></tr></table></figure>

<h3 id="TL-DR-‚Äì-The-Magic-Sentence"><a href="#TL-DR-‚Äì-The-Magic-Sentence" class="headerlink" title="TL;DR ‚Äì The Magic Sentence"></a>TL;DR ‚Äì The Magic Sentence</h3><blockquote>
<p><strong>With <code>spring.threads.virtual.enabled=true</code> on Java 21+, blocking code no longer blocks the Netty event loop ‚Üí you can delete almost every <code>.subscribeOn(Schedulers.boundedElastic())</code> and your reactive WebFlux app stays perfectly responsive.</strong></p>
</blockquote>
<p>That single line in <code>application.yml</code> is the reason senior teams in 2025 write <strong>simple, readable, blocking-style code inside Mono&#x2F;Flux</strong> without sacrificing performance or stability.</p>
<p>Enable it ‚Üí delete thousands of lines ‚Üí ship faster ‚Üí sleep better.<br>That‚Äôs the real 2025 Java superpower.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/02/Deep-Dive-Schedulers-boundedElastic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/02/Deep-Dive-Schedulers-boundedElastic/" class="post-title-link" itemprop="url">Deep Dive Schedulers.boundedElastic()</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-02 20:24:20 / Modified: 23:20:13" itemprop="dateCreated datePublished" datetime="2025-12-02T20:24:20-05:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Reactive/" itemprop="url" rel="index"><span itemprop="name">Reactive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Reactive/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Start-with-a-simple-piece-of-code-snippet"><a href="#Start-with-a-simple-piece-of-code-snippet" class="headerlink" title="Start with a simple piece of code snippet"></a>Start with a simple piece of code snippet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kafkaReceiver.receive()</span><br><span class="line">    .concatMap(message -&gt; process(message)           <span class="comment">// Step 1</span></span><br><span class="line">        .subscribeOn(Schedulers.boundedElastic()))  <span class="comment">// Step 2</span></span><br><span class="line">    .doOnNext(msg -&gt; msg.receiverOffset().acknowledge()) <span class="comment">// Step 3</span></span><br><span class="line">    .subscribe();                                           <span class="comment">// Step 4</span></span><br></pre></td></tr></table></figure>

<p>This is the <strong>gold-standard pattern</strong> in 2025 for consuming Kafka with <strong>Spring WebFlux + Project Reactor + Reactor Kafka</strong> when <code>process(message)</code> contains <strong>blocking code</strong> (JDBC, Redis sync driver, REST call with RestTemplate, file I&#x2F;O, etc.).</p>
<h4 id="Step-by-Step-Execution-Flow"><a href="#Step-by-Step-Execution-Flow" class="headerlink" title="Step-by-Step Execution Flow"></a>Step-by-Step Execution Flow</h4><table>
<thead>
<tr>
<th>Step</th>
<th>What Happens</th>
<th>Which Thread Pool?</th>
<th>Why It Matters</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>kafkaReceiver.receive()</code> returns a <code>Flux&lt;ReceiverRecord&gt;</code></td>
<td>Runs on <strong>Netty event-loop</strong> threads (non-blocking I&#x2F;O)</td>
<td>This thread <strong>must never block</strong> or the whole reactor Netty server will starve</td>
</tr>
<tr>
<td>2</td>
<td><code>concatMap</code> waits for the **previous <code>process()</code> to finish before taking the next message ‚Üí preserves Kafka order per partition</td>
<td>Still on Netty thread until‚Ä¶</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>subscribeOn(Schedulers.boundedElastic())</code> <strong>moves the entire upstream work</strong> (i.e. <code>process(message)</code>) to a <strong>boundedElastic</strong> thread</td>
<td>‚Üí jumps to <strong>boundedElastic thread pool</strong></td>
<td>This is the <strong>only safe place</strong> to do blocking work</td>
</tr>
<tr>
<td>3</td>
<td>After <code>process()</code> completes successfully, we come back to the <strong>original Netty thread</strong> to call <code>acknowledge()</code></td>
<td>Back on Netty event-loop</td>
<td>Commit must happen on the same thread that received the record (Reactor Kafka requirement)</td>
</tr>
<tr>
<td>4</td>
<td><code>.subscribe()</code> starts the whole chain</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="What-Is-Schedulers-boundedElastic-Exactly"><a href="#What-Is-Schedulers-boundedElastic-Exactly" class="headerlink" title="What Is Schedulers.boundedElastic() Exactly?"></a>What Is <code>Schedulers.boundedElastic()</code> Exactly?</h3><table>
<thead>
<tr>
<th>Property</th>
<th>Value (Reactor 3.6+)</th>
<th>What It Means in Practice</th>
</tr>
</thead>
<tbody><tr>
<td>Thread pool type</td>
<td>Thread-per-task + <strong>bounded queue</strong></td>
<td>Creates new threads on demand</td>
</tr>
<tr>
<td>Max threads</td>
<td><code>Math.max(10, CPU √ó 10)</code> ‚Üí usually <strong>100‚Äì200</strong></td>
<td>Will never create thousands of threads</td>
</tr>
<tr>
<td>Queue</td>
<td>Bounded (default 100,000 tasks)</td>
<td>If queue full ‚Üí <code>onError</code> with <code>QueueFullException</code></td>
</tr>
<tr>
<td>Thread name prefix</td>
<td><code>boundedElastic-x</code></td>
<td>Easy to spot in thread dumps</td>
</tr>
<tr>
<td>Designed for</td>
<td><strong>Blocking I&#x2F;O</strong> (JDBC, blocking Redis, file, external sync API)</td>
<td>This is the <strong>only</strong> scheduler you are allowed to block on</td>
</tr>
</tbody></table>
<h4 id="Comparison-with-Other-Schedulers"><a href="#Comparison-with-Other-Schedulers" class="headerlink" title="Comparison with Other Schedulers"></a>Comparison with Other Schedulers</h4><table>
<thead>
<tr>
<th>Scheduler</th>
<th>Use Case</th>
<th>Can I block here?</th>
</tr>
</thead>
<tbody><tr>
<td><code>Schedulers.parallel()</code></td>
<td>CPU-intensive (encryption, image processing)</td>
<td>No ‚Äì will starve CPU workers</td>
</tr>
<tr>
<td><code>Schedulers.boundedElastic()</code></td>
<td><strong>Blocking I&#x2F;O</strong> ‚Üê <strong>this is the one</strong></td>
<td>Yes ‚Äì made for this</td>
</tr>
<tr>
<td><code>Schedulers.single()</code> &#x2F; <code>immediate()</code></td>
<td>Rare, very specific cases</td>
<td>Never block</td>
</tr>
</tbody></table>
<h3 id="Real-Life-Example-‚Äì-What-Happens-with-10-000-Messages-sec"><a href="#Real-Life-Example-‚Äì-What-Happens-with-10-000-Messages-sec" class="headerlink" title="Real-Life Example ‚Äì What Happens with 10,000 Messages&#x2F;sec"></a>Real-Life Example ‚Äì What Happens with 10,000 Messages&#x2F;sec</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BAD ‚Äì blocks Netty thread ‚Üí entire WebFlux app dies in seconds</span></span><br><span class="line">.concatMap(msg -&gt; blockingJdbc.save(msg))</span><br><span class="line"></span><br><span class="line"><span class="comment">// GOOD ‚Äì this code you posted</span></span><br><span class="line">.concatMap(message -&gt; process(message)           <span class="comment">// contains JdbcTemplate, RestTemplate, etc.</span></span><br><span class="line">    .subscribeOn(Schedulers.boundedElastic()))</span><br></pre></td></tr></table></figure>

<p>Without <code>subscribeOn(boundedElastic())</code> ‚Üí Netty event-loop threads block ‚Üí TCP backlog ‚Üí all WebSocket clients disconnect ‚Üí outage.</p>
<p>With it ‚Üí 150 boundedElastic threads happily do JDBC work, Netty stays responsive, throughput 10k+&#x2F;sec easily.</p>
<h3 id="Best-Practices-2025"><a href="#Best-Practices-2025" class="headerlink" title="Best Practices (2025)"></a>Best Practices (2025)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Most common production pattern</span></span><br><span class="line">kafkaReceiver.receive()</span><br><span class="line">    .concatMap(record -&gt; </span><br><span class="line">        process(record.value())                              <span class="comment">// may block</span></span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic())       <span class="comment">// ‚Üê mandatory</span></span><br><span class="line">            .doOnError(ex -&gt; log.error(<span class="string">&quot;...&quot;</span>, ex))</span><br><span class="line">            .onErrorReturn fallbackValue)                    <span class="comment">// don&#x27;t stop the consumer</span></span><br><span class="line">    .doOnNext(ReceiverRecord::receiverOffset.acknowledge)       <span class="comment">// commit</span></span><br><span class="line">    .retryWhen(Retry.backoff(<span class="number">10</span>, Duration.ofSeconds(<span class="number">1</span>)))        <span class="comment">// survive Kafka blips</span></span><br><span class="line">    .subscribe();</span><br></pre></td></tr></table></figure>

<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p><code>Schedulers.boundedElastic()</code> is the <strong>only safe place</strong> to run blocking code in a WebFlux&#x2F;Reactive application.<br>Without it, you will kill your Netty event-loop and take down the entire service.<br>With it, you get safe, scalable, ordered Kafka consumption even when <code>process()</code> talks to JDBC, Redis sync, or any legacy blocking library.</p>
<p>That one line <code>.subscribeOn(Schedulers.boundedElastic())</code> is literally the difference between a stable 50k RPS service and a total outage.</p>
<h3 id="What-exactly-happens-under-the-hood-when-you-write-this-line"><a href="#What-exactly-happens-under-the-hood-when-you-write-this-line" class="headerlink" title="What exactly happens under the hood when you write this line:"></a>What exactly happens under the hood when you write this line:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">process(record.value())</span><br><span class="line">    .subscribeOn(Schedulers.boundedElastic())</span><br></pre></td></tr></table></figure>

<h3 id="Step-by-Step-Execution-Thread-View"><a href="#Step-by-Step-Execution-Thread-View" class="headerlink" title="Step-by-Step Execution (Thread View)"></a>Step-by-Step Execution (Thread View)</h3><table>
<thead>
<tr>
<th>Time</th>
<th>What happens</th>
<th>Which thread does the work?</th>
<th>Thread pool name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Kafka record arrives on Netty event-loop thread</td>
<td><code>reactor-http-nio-3</code> (or similar)</td>
<td>Netty event-loop</td>
</tr>
<tr>
<td>2</td>
<td><code>concatMap</code> sees the <code>subscribeOn(boundedElastic())</code> operator</td>
<td>Still on Netty thread</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>Reactor <strong>immediately hands the entire <code>process(...)</code> chain</strong> to the <strong>boundedElastic scheduler</strong></td>
<td>‚Üí jumps to a thread from the <strong>boundedElastic thread pool</strong></td>
<td><code>boundedElastic-1</code>, <code>boundedElastic-2</code>, ‚Ä¶</td>
</tr>
<tr>
<td>4</td>
<td>Your <code>process(record.value())</code> code runs <strong>completely on that boundedElastic thread</strong></td>
<td>Yes ‚Äì this thread can safely block (JDBC, RestTemplate, File I&#x2F;O, etc.)</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>When <code>process()</code> finishes (success or error), Reactor schedules the downstream operators (<code>.doOnNext(acknowledge)</code>) back on the <strong>original Netty thread</strong> (because of how Reactor Kafka is designed)</td>
<td>Back to <code>reactor-http-nio-3</code></td>
<td></td>
</tr>
</tbody></table>
<h3 id="Visual-Thread-Timeline"><a href="#Visual-Thread-Timeline" class="headerlink" title="Visual Thread Timeline"></a>Visual Thread Timeline</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Netty thread (reactor-http-nio-3)          boundedElastic thread pool</span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ             ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line">receive() ‚Üí concatMap ‚Üí subscribeOn() ‚îÄ‚îÄ‚Üí  boundedElastic-7 runs process()</span><br><span class="line">                                           ‚Üê process() completes</span><br><span class="line">                                           ‚Üí acknowledge() runs back on Netty thread</span><br></pre></td></tr></table></figure>

<h3 id="boundedElastic-Thread-Pool-Details-2025-defaults"><a href="#boundedElastic-Thread-Pool-Details-2025-defaults" class="headerlink" title="boundedElastic Thread Pool Details (2025 defaults)"></a>boundedElastic Thread Pool Details (2025 defaults)</h3><table>
<thead>
<tr>
<th>Property</th>
<th>Value (Reactor 3.6+)</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>Core threads</td>
<td>10 (minimum)</td>
<td>Always alive</td>
</tr>
<tr>
<td>Maximum threads</td>
<td><code>CPU cores √ó 10</code> ‚Üí usually <strong>100‚Äì200</strong></td>
<td>Grows only when queue is full</td>
</tr>
<tr>
<td>Queue size</td>
<td>100,000 tasks (configurable)</td>
<td>If full ‚Üí rejects with exception</td>
</tr>
<tr>
<td>Thread keep-alive</td>
<td>60 seconds (idle threads die)</td>
<td>Saves memory</td>
</tr>
<tr>
<td>Thread name prefix</td>
<td><code>boundedElastic-1</code>, <code>boundedElastic-2</code>, ‚Ä¶</td>
<td>Easy to spot in <code>jstack</code> &#x2F; Grafana</td>
</tr>
</tbody></table>
<h3 id="Real-Example-from-Production-Thread-Dump"><a href="#Real-Example-from-Production-Thread-Dump" class="headerlink" title="Real Example from Production Thread Dump"></a>Real Example from Production Thread Dump</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;boundedElastic-27&quot; #124 daemon prio=5 os_prio=0 tid=0x... nid=0x4b2c runnable</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">    at com.mysql.cj.jdbc.ClientPreparedStatement.executeQuery(...)</span><br><span class="line"></span><br><span class="line">&quot;boundedElastic-28&quot; #125 daemon prio=5 os_prio=0 tid=0x... nid=0x4b2d waiting on condition</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">    at jdk.internal.misc.Unsafe.park(Native Method)</span><br><span class="line">    - parking to wait for &lt;0x...&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)</span><br></pre></td></tr></table></figure>

<p>You can see 27 threads doing MySQL queries, 28 waiting for more work ‚Äì <strong>exactly</strong> what we want.</p>
<h3 id="Summary-Again"><a href="#Summary-Again" class="headerlink" title="Summary Again"></a>Summary Again</h3><blockquote>
<p><code>subscribeOn(Schedulers.boundedElastic())</code> &#x3D;<br>‚ÄúTake this whole piece of work (<code>process(...)</code>) and run it on a dedicated thread pool that is <strong>designed and allowed to block</strong>.<br>The Netty event-loop stays completely free and responsive.‚Äù</p>
</blockquote>
<p>That single operator is the #1 reason reactive Spring Boot + Kafka applications survive real production traffic without melting down.</p>
<h3 id="What-Exactly-Happens-Inside-Schedulers-boundedElastic-Reactor-3-5-Spring-Boot-3-x-‚Äì-2025"><a href="#What-Exactly-Happens-Inside-Schedulers-boundedElastic-Reactor-3-5-Spring-Boot-3-x-‚Äì-2025" class="headerlink" title="What Exactly Happens Inside Schedulers.boundedElastic() (Reactor 3.5+ &#x2F; Spring Boot 3.x ‚Äì 2025)"></a>What <strong>Exactly</strong> Happens Inside <code>Schedulers.boundedElastic()</code> (Reactor 3.5+ &#x2F; Spring Boot 3.x ‚Äì 2025)</h3><table>
<thead>
<tr>
<th>Question</th>
<th>Exact Answer (Source Code Level)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Which ThreadPoolExecutor is used under the hood?</strong></td>
<td><code>BoundedElasticScheduler</code> ‚Üí wraps a custom <strong><code>java.util.concurrent.ThreadPoolExecutor</code></strong> with a <strong>very special configuration</strong></td>
</tr>
<tr>
<td><strong>Executor type</strong></td>
<td><strong>Unbounded core + bounded maximum + bounded queue</strong> (the only one in the JDK that behaves like this)</td>
</tr>
<tr>
<td><strong>JDK class</strong></td>
<td><code>reactor.core.scheduler.BoundedElasticScheduler.BoundedScheduledExecutorService</code> ‚Üí extends <code>ThreadPoolExecutor</code></td>
</tr>
<tr>
<td><strong>Queue used</strong></td>
<td><code>LinkedBlockingQueue&lt;Runnable&gt;</code> with <strong>configurable capacity</strong> (default 100,000)</td>
</tr>
<tr>
<td><strong>Thread factory</strong></td>
<td><code>reactor.core.scheduler.SchedulerThreadFactory</code> ‚Üí names threads <code>boundedElastic-1</code>, <code>boundedElastic-2</code>, ‚Ä¶</td>
</tr>
</tbody></table>
<h3 id="Exact-Thread-Pool-Configuration-2025-defaults"><a href="#Exact-Thread-Pool-Configuration-2025-defaults" class="headerlink" title="Exact Thread Pool Configuration (2025 defaults)"></a>Exact Thread Pool Configuration (2025 defaults)</h3><table>
<thead>
<tr>
<th>Parameter</th>
<th>Value (Reactor 3.6+)</th>
<th>Formula &#x2F; Meaning</th>
</tr>
</thead>
<tbody><tr>
<td><strong>corePoolSize</strong></td>
<td><code>0</code> (zero!)</td>
<td>No threads kept alive when idle</td>
</tr>
<tr>
<td><strong>maximumPoolSize</strong></td>
<td><code>CPU √ó 10</code> (e.g. 8-core ‚Üí 80, 16-core ‚Üí 160, capped at ~200)</td>
<td><code>Math.min(Runtime.getRuntime().availableProcessors() * 10, 100_000)</code></td>
</tr>
<tr>
<td><strong>keepAliveTime</strong></td>
<td><strong>60 seconds</strong></td>
<td>Idle threads above core (i.e. all) die after 60s</td>
</tr>
<tr>
<td><strong>Queue capacity</strong></td>
<td><strong>100,000</strong> tasks by default</td>
<td>Configurable via <code>-Dreactor.schedulers.boundedElastic.queueCapacity=500000</code></td>
</tr>
<tr>
<td><strong>RejectedExecutionHandler</strong></td>
<td><code>AbortPolicy</code> ‚Üí throws <code>RejectedExecutionException</code> when queue full</td>
<td>You‚Äôll see <code>QueueFullException</code> in logs if overloaded</td>
</tr>
</tbody></table>
<h3 id="Execution-Strategy-‚Äì-Visualized"><a href="#Execution-Strategy-‚Äì-Visualized" class="headerlink" title="Execution Strategy ‚Äì Visualized"></a>Execution Strategy ‚Äì Visualized</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">corePoolSize = 0  ‚Üí  No threads at startup</span><br><span class="line">‚îÇ</span><br><span class="line">‚îî‚îÄ Task arrives ‚Üí create new thread (up to maxPoolSize)</span><br><span class="line">        ‚îÇ</span><br><span class="line">        ‚îú‚îÄ Queue has space ‚Üí enqueue task</span><br><span class="line">        ‚îÇ       (even if threads &lt; maxPoolSize)</span><br><span class="line">        ‚îÇ</span><br><span class="line">        ‚îî‚îÄ Queue full + threads == maxPoolSize ‚Üí REJECT</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Task arrives</span><br><span class="line">‚îÇ</span><br><span class="line">‚îú‚îÄ threads &lt; maxPoolSize ‚Üí create new thread immediately</span><br><span class="line">‚îÇ</span><br><span class="line">‚îú‚îÄ threads == maxPoolSize ‚Üí enqueue in 100k queue</span><br><span class="line">‚îÇ</span><br><span class="line">‚îî‚îÄ queue full + max threads ‚Üí RejectedExecutionException ‚Üí your Flux errors</span><br></pre></td></tr></table></figure>

<p>This is <strong>NOT</strong> the classic ‚Äúfixed + bounded queue‚Äù model.<br>It‚Äôs a <strong>hybrid</strong> designed specifically for blocking I&#x2F;O:</p>
<ul>
<li>Grow very aggressively (up to CPU√ó10) to handle bursty blocking calls</li>
<li>Shrink back to zero when idle ‚Üí saves memory in microservices</li>
<li>Huge queue (100k) prevents rejection in normal spikes</li>
</ul>
<h3 id="How-to-Change-the-Limits-Production-Tuning"><a href="#How-to-Change-the-Limits-Production-Tuning" class="headerlink" title="How to Change the Limits (Production Tuning)"></a>How to Change the Limits (Production Tuning)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml (Spring Boot)</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">threads:</span></span><br><span class="line">    <span class="attr">virtual:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>                    <span class="comment"># Java 21+ ‚Üí switches to virtual threads automatically!</span></span><br></pre></td></tr></table></figure>

<p>Or JVM flags:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Increase queue to 500k</span></span><br><span class="line">-Dreactor.schedulers.boundedElastic.queueCapacity=500000</span><br><span class="line"></span><br><span class="line"><span class="comment"># Force max 200 threads even on 32-core machines</span></span><br><span class="line">-Dreactor.schedulers.boundedElastic.maxThreads=200</span><br></pre></td></tr></table></figure>

<h3 id="Java-21-Bonus-Virtual-Threads-2024‚Äì2025-reality"><a href="#Java-21-Bonus-Virtual-Threads-2024‚Äì2025-reality" class="headerlink" title="Java 21+ Bonus: Virtual Threads (2024‚Äì2025 reality)"></a>Java 21+ Bonus: Virtual Threads (2024‚Äì2025 reality)</h3><p>Since Java 21 + Reactor 3.6 + Spring Boot 3.2:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Schedulers.boundedElastic()   <span class="comment">// automatically uses virtual threads</span></span><br></pre></td></tr></table></figure>

<p>‚Üí Each task gets its own <strong>virtual thread</strong> instead of platform thread<br>‚Üí maximumPoolSize becomes <strong>practically unlimited</strong> (hundreds of thousands)<br>‚Üí Memory per thread drops from ~1‚Äì2 MB ‚Üí ~100 KB<br>‚Üí You can safely process 100k+ blocking JDBC calls concurrently</p>
<h3 id="Summary-One-More-Time"><a href="#Summary-One-More-Time" class="headerlink" title="Summary One More Time"></a>Summary One More Time</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Schedulers.boundedElastic() </span><br><span class="line">   = ThreadPoolExecutor(</span><br><span class="line">        corePoolSize = <span class="number">0</span>,</span><br><span class="line">        maximumPoolSize = CPU √ó <span class="number">10</span>,</span><br><span class="line">        keepAlive = 60s,</span><br><span class="line">        queue = LinkedBlockingQueue(<span class="number">100_000</span>),</span><br><span class="line">        policy = AbortPolicy</span><br><span class="line">     )</span><br><span class="line">   + (since Java <span class="number">21</span>) automatically uses virtual threads ‚Üí effectively unlimited</span><br></pre></td></tr></table></figure>

<p>That‚Äôs why it‚Äôs the <strong>only safe</strong> place to call JDBC, RestTemplate, blocking Redis, etc. in a WebFlux&#x2F;Reactive application ‚Äî and why it scales beautifully in real production systems handling 10k‚Äì100k RPS.</p>
<h3 id="Real-Production-Code-Patterns"><a href="#Real-Production-Code-Patterns" class="headerlink" title="Real Production Code Patterns"></a>Real Production Code Patterns</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Classic blocking Kafka consumer (most common)</span></span><br><span class="line">kafkaReceiver.receive()</span><br><span class="line">    .concatMap(record -&gt;</span><br><span class="line">        processBlocking(record.value())                    <span class="comment">// JDBC, RestTemplate, etc.</span></span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic())     <span class="comment">// ‚Üê THIS SAVES YOUR APP</span></span><br><span class="line">            .doOnError(ex -&gt; log.error(<span class="string">&quot;Failed &#123;&#125;&quot;</span>, record, ex))</span><br><span class="line">            .onErrorResume(ex -&gt; Mono.empty())             <span class="comment">// don&#x27;t kill the stream</span></span><br><span class="line">    )</span><br><span class="line">    .doOnNext(ReceiverRecord::receiverOffset.acknowledge)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. WebFlux controller calling legacy blocking service</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/legacy-report&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Report&gt; <span class="title function_">getReport</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Mono.fromCallable(() -&gt; legacyBlockingService.generatePdf())</span><br><span class="line">               .subscribeOn(Schedulers.boundedElastic())   <span class="comment">// safe!</span></span><br><span class="line">               .timeout(Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Parallel batch processing (e.g. 1000 files)</span></span><br><span class="line">Flux)</span><br><span class="line">filesFlux</span><br><span class="line">    .flatMap(file -&gt;</span><br><span class="line">        processFile(file)                                  <span class="comment">// heavy CPU + blocking I/O</span></span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">        <span class="number">50</span>                                                    <span class="comment">// max 50 concurrent</span></span><br><span class="line">    )</span><br><span class="line">    .collectList()</span><br><span class="line">    .block();</span><br></pre></td></tr></table></figure>

<h4 id="5-Production-Tuning-Examples"><a href="#5-Production-Tuning-Examples" class="headerlink" title="5. Production Tuning Examples"></a>5. Production Tuning Examples</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Recommended JVM flags for high-throughput services (2025)</span></span><br><span class="line">-Dreactor.schedulers.boundedElastic.maxThreads=500</span><br><span class="line">-Dreactor.schedulers.boundedElastic.queueCapacity=200000</span><br><span class="line">-Dreactor.schedulers.defaultBoundedElasticOnVirtualThreads=<span class="literal">true</span>   <span class="comment"># force virtual threads even on JDK 21+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or in application.yml (Spring Boot 3.2+)</span></span><br><span class="line">spring:</span><br><span class="line">  threads:</span><br><span class="line">    virtual:</span><br><span class="line">      enabled: <span class="literal">true</span>   <span class="comment"># ‚Üê turns boundedElastic into virtual-thread heaven</span></span><br></pre></td></tr></table></figure>

<h4 id="6-What-Happens-If-You-Forget-It-Real-Outage-Stories"><a href="#6-What-Happens-If-You-Forget-It-Real-Outage-Stories" class="headerlink" title="6. What Happens If You Forget It? (Real Outage Stories)"></a>6. What Happens If You Forget It? (Real Outage Stories)</h4><table>
<thead>
<tr>
<th>Mistake</th>
<th>Symptom</th>
<th>Time to Total Outage</th>
</tr>
</thead>
<tbody><tr>
<td>Call <code>JdbcTemplate</code> directly in WebFlux</td>
<td>Netty threads block ‚Üí TCP backlog ‚Üí all WebSockets disconnect</td>
<td>10‚Äì60 seconds</td>
</tr>
<tr>
<td>Use <code>Schedulers.parallel()</code> for JDBC</td>
<td>CPU workers starve ‚Üí GC thrashing ‚Üí OOM</td>
<td>2‚Äì10 minutes</td>
</tr>
<tr>
<td>Use <code>subscribeOn(boundedElastic())</code></td>
<td>System stays alive at 50k+ RPS</td>
<td>Never</td>
</tr>
</tbody></table>
<h4 id="Must-Remember"><a href="#Must-Remember" class="headerlink" title="Must Remember!!!"></a>Must Remember!!!</h4><blockquote>
<p><code>Schedulers.boundedElastic()</code> is the <strong>only thread pool specifically created so you can safely call blocking code (JDBC, RestTemplate, Redis sync, file I&#x2F;O, etc.) inside a fully reactive Spring WebFlux application without blowing up your Netty event loop.</strong></p>
</blockquote>
<h3 id="Can-Schedulers-boundedElastic-be-pre-configured"><a href="#Can-Schedulers-boundedElastic-be-pre-configured" class="headerlink" title="Can Schedulers.boundedElastic() be pre-configured?"></a><strong>Can</strong> <code>Schedulers.boundedElastic()</code> <strong>be pre-configured</strong>?</h3><p>Yes but <strong>only via system properties</strong> (JVM flags) or Spring Boot properties ‚Äî <strong>not</strong> via code like <code>new BoundedElasticScheduler(...)</code> in normal applications.</p>
<p>Here is the <strong>complete list of everything you can pre-configure</strong> in 2025 (Reactor 3.6+ &#x2F; Spring Boot 3.2+):</p>
<table>
<thead>
<tr>
<th>What you want to change</th>
<th>How to do it (JVM flag)</th>
<th>Spring Boot 3.2+ equivalent (application.yml)</th>
<th>Default value</th>
</tr>
</thead>
<tbody><tr>
<td>Maximum threads (JDK ‚â§20)</td>
<td><code>-Dreactor.schedulers.boundedElastic.maxThreads=500</code></td>
<td><code>spring.threads.virtual.enabled=false</code> + JVM flag</td>
<td>CPU √ó 10</td>
</tr>
<tr>
<td>Queue capacity</td>
<td><code>-Dreactor.schedulers.boundedElastic.queueCapacity=500000</code></td>
<td>‚Äî</td>
<td>100,000</td>
</tr>
<tr>
<td>Thread name prefix</td>
<td><code>-Dreactor.schedulers.boundedElastic.threadPrefix=myapp-be</code></td>
<td>‚Äî</td>
<td><code>boundedElastic</code></td>
</tr>
<tr>
<td>TTL of cached schedulers</td>
<td><code>-Dreactor.schedulers.boundedElastic.cachedSchedulerExpireAfter=300s</code></td>
<td>‚Äî</td>
<td>60s</td>
</tr>
<tr>
<td>Force virtual threads (JDK 21+)</td>
<td><code>-Dreactor.schedulers.boundedElasticOnVirtualThreads=true</code></td>
<td><code>spring.threads.virtual.enabled=true</code> ‚Üê <strong>recommended</strong></td>
<td>auto-detect</td>
</tr>
<tr>
<td><strong>Pre-warm &#x2F; init threads</strong></td>
<td><strong>Not directly possible</strong></td>
<td>‚Äî</td>
<td>starts at 0</td>
</tr>
</tbody></table>
<h3 id="Can-I-Pre-create-Threads"><a href="#Can-I-Pre-create-Threads" class="headerlink" title="Can I Pre-create Threads?"></a>Can I Pre-create Threads?</h3><p><strong>No</strong><br><code>boundedElastic</code> is intentionally designed with <code>corePoolSize = 0</code>.<br>There is <strong>no official way</strong> to pre-warm threads (create 10 threads at startup).</p>
<p>But here are <strong>three real-world workarounds</strong> senior teams actually use**:</p>
<h4 id="Workaround-1-‚Äì-Force-virtual-threads-JDK-21-‚Üí-problem-disappears"><a href="#Workaround-1-‚Äì-Force-virtual-threads-JDK-21-‚Üí-problem-disappears" class="headerlink" title="Workaround 1 ‚Äì Force virtual threads (JDK 21+) ‚Üí problem disappears"></a>Workaround 1 ‚Äì Force virtual threads (JDK 21+) ‚Üí problem disappears</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml ‚Äì this is the 2025 gold standard</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">threads:</span></span><br><span class="line">    <span class="attr">virtual:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>        <span class="comment"># ‚Üê makes boundedElastic use virtual threads</span></span><br></pre></td></tr></table></figure>
<p>‚Üí Each task gets its own virtual thread instantly<br>‚Üí No thread creation latency<br>‚Üí No need to pre-warm anything<br>‚Üí This is what Netflix, Uber, Alibaba, and most new Spring Boot 3 apps do.</p>
<h4 id="Workaround-2-‚Äì-Custom-pre-warmed-scheduler-rare-but-possible"><a href="#Workaround-2-‚Äì-Custom-pre-warmed-scheduler-rare-but-possible" class="headerlink" title="Workaround 2 ‚Äì Custom pre-warmed scheduler (rare, but possible)"></a>Workaround 2 ‚Äì Custom pre-warmed scheduler (rare, but possible)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReactorConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Scheduler</span> <span class="variable">PREWARMED_BLOCKING</span> <span class="operator">=</span> Schedulers.newBoundedElastic(</span><br><span class="line">        <span class="number">20</span>,          <span class="comment">// core size (pre-created)</span></span><br><span class="line">        <span class="number">200</span>,         <span class="comment">// max size</span></span><br><span class="line">        <span class="string">&quot;myapp-blocking&quot;</span>, </span><br><span class="line">        <span class="number">60</span>           <span class="comment">// keep-alive seconds</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanup</span><span class="params">()</span> &#123;</span><br><span class="line">        PREWARMED_BLOCKING.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then use it instead:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.subscribeOn(ReactorConfig.PREWARMED_BLOCKING)</span><br></pre></td></tr></table></figure>

<h4 id="Workaround-3-‚Äì-Eager-initialization-at-startup-hacky-but-works"><a href="#Workaround-3-‚Äì-Eager-initialization-at-startup-hacky-but-works" class="headerlink" title="Workaround 3 ‚Äì Eager initialization at startup (hacky but works)"></a>Workaround 3 ‚Äì Eager initialization at startup (hacky but works)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">warmupBoundedElastic</span><span class="params">()</span> &#123;</span><br><span class="line">    IntStream.range(<span class="number">0</span>, <span class="number">20</span>).parallel().forEach(i -&gt;</span><br><span class="line">        Schedulers.boundedElastic().schedule(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">10</span>); &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>‚Üí Forces the default <code>boundedElastic</code> to create 20 threads immediately.</p>
<h3 id="2025-Production-Recommendation"><a href="#2025-Production-Recommendation" class="headerlink" title="2025 Production Recommendation"></a>2025 Production Recommendation</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml ‚Äì copy-paste this and forget about thread pools forever</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">threads:</span></span><br><span class="line">    <span class="attr">virtual:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>                 <span class="comment"># ‚Üê turns boundedElastic into infinite virtual threads</span></span><br><span class="line">  <span class="attr">task:</span></span><br><span class="line">    <span class="attr">scheduling:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">size:</span> <span class="number">50</span>                    <span class="comment"># for @Scheduled tasks</span></span><br></pre></td></tr></table></figure>

<p>With Java 21 + Spring Boot 3.2 + this config:</p>
<ul>
<li><code>Schedulers.boundedElastic()</code> becomes <strong>effectively infinite</strong></li>
<li>Thread creation latency ‚âà 0</li>
<li>Memory per blocking call ‚âà 100 KB instead of 2 MB</li>
<li>You never have to pre-warm or tune anything again</li>
</ul>
<table>
<thead>
<tr>
<th>Goal</th>
<th>Solution in 2025</th>
</tr>
</thead>
<tbody><tr>
<td>Pre-warm threads</td>
<td>Not possible with default scheduler</td>
</tr>
<tr>
<td>Make it fast + infinite</td>
<td><code>spring.threads.virtual.enabled=true</code> (JDK 21+) ‚Üê <strong>use this</strong></td>
</tr>
<tr>
<td>Full control</td>
<td>Create your own with <code>Schedulers.newBoundedElastic(...)</code></td>
</tr>
</tbody></table>
<p>99 % of teams in 2025 just enable virtual threads and never think about <code>boundedElastic</code> configuration again.  </p>
<h3 id="Mono-fromCallable-‚Äì-The-Ultimate-2025-Explanation"><a href="#Mono-fromCallable-‚Äì-The-Ultimate-2025-Explanation" class="headerlink" title="Mono.fromCallable(...) ‚Äì The Ultimate 2025 Explanation"></a><code>Mono.fromCallable(...)</code> ‚Äì The Ultimate 2025 Explanation</h3><p>(What every senior Java&#x2F;Reactive engineer must know inside-out)</p>
<table>
<thead>
<tr>
<th>Question</th>
<th>Answer (Real Production Truth)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>What is it?</strong></td>
<td>A factory method that creates a <code>Mono&lt;T&gt;</code> from a <strong>blocking, callable piece of code</strong> (<code>Callable&lt;T&gt;</code> or lambda that returns <code>T</code>).</td>
</tr>
<tr>
<td><strong>When do you use it?</strong></td>
<td><strong>Every time you have to call legacy blocking code</strong> (JDBC, RestTemplate, Redis sync, file I&#x2F;O, external API, etc.) inside a reactive chain.</td>
</tr>
<tr>
<td><strong>Is it blocking?</strong></td>
<td>Yes ‚Äî the code inside runs <strong>synchronously and blocks the calling thread</strong>.</td>
</tr>
<tr>
<td><strong>Is it safe to call directly in WebFlux?</strong></td>
<td><strong>Only safe if you offload it</strong> (via <code>.subscribeOn(...)</code>) ‚Äî otherwise you block Netty event-loop ‚Üí outage.</td>
</tr>
</tbody></table>
<h3 id="Exact-Contract-Behavior"><a href="#Exact-Contract-Behavior" class="headerlink" title="Exact Contract &amp; Behavior"></a>Exact Contract &amp; Behavior</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Mono&lt;T&gt; <span class="title function_">fromCallable</span><span class="params">(Callable&lt;? extends T&gt; supplier)</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Scenario</th>
<th>What actually happens</th>
</tr>
</thead>
<tbody><tr>
<td><code>supplier</code> returns a value</td>
<td><code>Mono</code> emits that value ‚Üí <code>onNext</code> ‚Üí <code>onComplete</code></td>
</tr>
<tr>
<td><code>supplier</code> throws exception</td>
<td><code>Mono</code> emits <code>onError</code> with that exception</td>
</tr>
<tr>
<td><code>supplier</code> returns <code>null</code></td>
<td><code>Mono</code> emits <code>onNext(null)</code> ‚Üí <code>onComplete</code> (yes, null is allowed)</td>
</tr>
<tr>
<td>You call it on Netty thread</td>
<td>Blocks the carrier thread ‚Üí <strong>bad</strong> unless you offload</td>
</tr>
</tbody></table>
<h3 id="The-Two-Correct-Ways-to-Use-It-in-2025"><a href="#The-Two-Correct-Ways-to-Use-It-in-2025" class="headerlink" title="The Two Correct Ways to Use It in 2025"></a>The Two Correct Ways to Use It in 2025</h3><h4 id="1-Classic-way-Java-17‚Äì20-‚Äì-must-offload"><a href="#1-Classic-way-Java-17‚Äì20-‚Äì-must-offload" class="headerlink" title="1. Classic way (Java 17‚Äì20) ‚Äì must offload"></a>1. Classic way (Java 17‚Äì20) ‚Äì must offload</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mono.fromCallable(() -&gt; jdbcTemplate.queryForObject(sql, Long.class))</span><br><span class="line">    .subscribeOn(Schedulers.boundedElastic())   <span class="comment">// ‚Üê mandatory pre-Java 21</span></span><br><span class="line">    .timeout(Duration.ofSeconds(<span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<h4 id="2-2025-way-Java-21-virtual-threads-‚Äì-offload-optional"><a href="#2-2025-way-Java-21-virtual-threads-‚Äì-offload-optional" class="headerlink" title="2. 2025 way (Java 21 + virtual threads) ‚Äì offload optional"></a>2. 2025 way (Java 21 + virtual threads) ‚Äì offload optional</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">threads:</span></span><br><span class="line">    <span class="attr">virtual:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>        <span class="comment"># ‚Üê turns boundedElastic into virtual threads</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Now perfectly safe without subscribeOn!</span></span><br><span class="line">Mono.fromCallable(() -&gt; jdbcTemplate.queryForObject(sql, Long.class))</span><br><span class="line">    .timeout(Duration.ofSeconds(<span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<h3 id="Real-World-Examples-Copy-Paste-Ready"><a href="#Real-World-Examples-Copy-Paste-Ready" class="headerlink" title="Real-World Examples (Copy-Paste Ready)"></a>Real-World Examples (Copy-Paste Ready)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Legacy JDBC call</span></span><br><span class="line">Mono.fromCallable(() -&gt; userRepository.findById(id))   <span class="comment">// blocking</span></span><br><span class="line">    .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. External blocking HTTP client</span></span><br><span class="line">Mono.fromCallable(() -&gt; restTemplate.postForEntity(url, request, String.class))</span><br><span class="line">    .map(HttpEntity::getBody)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. File I/O</span></span><br><span class="line">Mono.fromCallable(() -&gt; Files.readString(Path.of(<span class="string">&quot;/tmp/config.json&quot;</span>)))</span><br><span class="line">    .map(Json::parse)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. CPU-heavy calculation (WRONG scheduler!)</span></span><br><span class="line">Mono.fromCallable(() -&gt; complexEncryption(data))      <span class="comment">// CPU bound ‚Üí use parallel!</span></span><br><span class="line">    .subscribeOn(Schedulers.parallel())               <span class="comment">// ‚Üê correct</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. With error handling + fallback</span></span><br><span class="line">Mono.fromCallable(() -&gt; legacyService.getUser(id))</span><br><span class="line">    .onErrorResume(ex -&gt; &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Legacy failed, using cache&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">return</span> Mono.just(cachedUser);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Common-Mistakes-Seniors-Still-Make"><a href="#Common-Mistakes-Seniors-Still-Make" class="headerlink" title="Common Mistakes Seniors Still Make"></a>Common Mistakes Seniors Still Make</h3><table>
<thead>
<tr>
<th>Mistake</th>
<th>Consequence</th>
<th>Fix</th>
</tr>
</thead>
<tbody><tr>
<td>Forgetting <code>.subscribeOn(boundedElastic())</code></td>
<td>Blocks Netty ‚Üí all WebSockets disconnect</td>
<td>Add it (or enable virtual threads)</td>
</tr>
<tr>
<td>Using it for CPU work</td>
<td>Starves parallel scheduler</td>
<td>Use <code>Mono.fromSupplier</code> + <code>Schedulers.parallel()</code></td>
</tr>
<tr>
<td>Chaining many <code>fromCallable</code> without limit</td>
<td>Thread explosion (one thread per call)</td>
<td>Use <code>.publishOn(...)</code> or limit concurrency</td>
</tr>
</tbody></table>
<h3 id="Mono-fromCallable-vs-Alternatives-2025-Decision-Table"><a href="#Mono-fromCallable-vs-Alternatives-2025-Decision-Table" class="headerlink" title="Mono.fromCallable vs Alternatives (2025 Decision Table)"></a><code>Mono.fromCallable</code> vs Alternatives (2025 Decision Table)</h3><table>
<thead>
<tr>
<th>Use Case</th>
<th>Best Choice</th>
<th>Why</th>
</tr>
</thead>
<tbody><tr>
<td>Simple blocking call (DB, HTTP, file)</td>
<td><code>Mono.fromCallable(...).subscribeOn(boundedElastic())</code></td>
<td>Cleanest</td>
</tr>
<tr>
<td>You already have a <code>Supplier&lt;T&gt;</code></td>
<td><code>Mono.fromSupplier(...)</code></td>
<td>Same as fromCallable but no checked exception</td>
</tr>
<tr>
<td>You want lazy execution only on subscribe</td>
<td><code>Mono.defer(() -&gt; Mono.fromCallable(...))</code></td>
<td>Prevents execution on cold publishers</td>
</tr>
<tr>
<td>Async but blocking driver</td>
<td>Prefer true async driver (R2DBC, reactive Redis)</td>
<td>Zero blocking</td>
</tr>
</tbody></table>
<h3 id="The-One-Rule-Every-Senior-Lives-By"><a href="#The-One-Rule-Every-Senior-Lives-By" class="headerlink" title="The One Rule Every Senior Lives By"></a>The One Rule Every Senior Lives By</h3><blockquote>
<p><code>Mono.fromCallable &#123; blocking code &#125;</code><br>‚Üí <strong>Always</strong> pair with <code>.subscribeOn(Schedulers.boundedElastic())</code><br>‚Üí <strong>Or</strong> run on Java 21+ with <code>spring.threads.virtual.enabled=true</code> and delete the <code>subscribeOn</code> forever.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/02/Keyclock-Revocation-Mechanism/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/02/Keyclock-Revocation-Mechanism/" class="post-title-link" itemprop="url">Keyclock Revocation Mechanism</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-02 20:16:06 / Modified: 20:20:07" itemprop="dateCreated datePublished" datetime="2025-12-02T20:16:06-05:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="üî•-Q1-‚Äî-How-does-Keycloak-revoke-access-across-all-sessions-devices-and-clients"><a href="#üî•-Q1-‚Äî-How-does-Keycloak-revoke-access-across-all-sessions-devices-and-clients" class="headerlink" title="üî• Q1 ‚Äî How does Keycloak revoke access across all sessions, devices, and clients?"></a>üî• <strong>Q1 ‚Äî How does Keycloak revoke access across all sessions, devices, and clients?</strong></h1><h3 id="‚≠ê-Senior-Level-Answer"><a href="#‚≠ê-Senior-Level-Answer" class="headerlink" title="‚≠ê Senior-Level Answer"></a>‚≠ê <strong>Senior-Level Answer</strong></h3><p>Keycloak maintains a <strong>server-side Session Store</strong> (in-memory or distributed depending on the cluster).<br>This enables Keycloak to <strong>centrally track active user sessions</strong> including:</p>
<ul>
<li>Each login session</li>
<li>Access tokens issued</li>
<li>Refresh tokens issued</li>
<li>Client sessions</li>
<li>Offline sessions</li>
<li>Device-specific sessions</li>
</ul>
<h3 id="When-a-user-logs-out-or-an-admin-revokes-access-Keycloak-performs"><a href="#When-a-user-logs-out-or-an-admin-revokes-access-Keycloak-performs" class="headerlink" title="When a user logs out or an admin revokes access, Keycloak performs:"></a>When a user logs out or an admin revokes access, Keycloak performs:</h3><h2 id="1-Session-invalidation-in-the-Session-Store"><a href="#1-Session-invalidation-in-the-Session-Store" class="headerlink" title="1. Session invalidation in the Session Store"></a><strong>1. Session invalidation in the Session Store</strong></h2><p>Keycloak marks the user session as <strong>invalid</strong> inside its central session map:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session_id -&gt; state = INVALID</span><br></pre></td></tr></table></figure>

<p>This invalidation immediately affects:</p>
<ul>
<li>All clients (web apps, mobile apps, services)</li>
<li>All sessions (browser, mobile, REST clients)</li>
<li>All tokens linked to the session</li>
</ul>
<p>This is because <strong>all tokens in Keycloak are tied to a Keycloak session ID</strong> (<code>sid</code> claim).</p>
<hr>
<h2 id="2-Refresh-Token-Blacklist-revocation"><a href="#2-Refresh-Token-Blacklist-revocation" class="headerlink" title="2. Refresh Token Blacklist &#x2F; revocation"></a><strong>2. Refresh Token Blacklist &#x2F; revocation</strong></h2><p>Keycloak stores refresh tokens in a <strong>server-side token store</strong> (unlike fully stateless JWT systems).</p>
<p>When the user logs out:</p>
<ul>
<li>All refresh tokens belonging to the session are invalidated.</li>
<li>Any refresh request with those tokens is rejected.</li>
</ul>
<p>This blocks all new access tokens across all devices.</p>
<hr>
<h2 id="3-Token-Introspection-for-OAuth2-Introspection-clients"><a href="#3-Token-Introspection-for-OAuth2-Introspection-clients" class="headerlink" title="3. Token Introspection (for OAuth2 Introspection clients)"></a><strong>3. Token Introspection (for OAuth2 Introspection clients)</strong></h2><p>If a client uses <code>token_introspection</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/protocol/openid-connect/token/introspect</span><br></pre></td></tr></table></figure>

<p>Keycloak will return:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;active&quot;: false</span><br></pre></td></tr></table></figure>

<p>as soon as the session is invalidated.</p>
<p>This enables immediate revocation for ‚Äúonline‚Äù services.</p>
<hr>
<h2 id="4-Realm-wide-or-client-side-Revocation-Events"><a href="#4-Realm-wide-or-client-side-Revocation-Events" class="headerlink" title="4. Realm-wide or client-side Revocation Events"></a><strong>4. Realm-wide or client-side Revocation Events</strong></h2><p>Keycloak issues <strong>revocation events</strong> when:</p>
<ul>
<li>Admin revokes all sessions</li>
<li>Client is removed</li>
<li>Roles or permissions change</li>
<li>User is disabled</li>
</ul>
<p>Clients using <strong>Keycloak Adapters</strong> (Tomcat, Spring, Node, Quarkus) receive the event and <strong>invalidate local caches</strong> of tokens.</p>
<hr>
<h1 id="‚≠ê-Why-Keycloak-Can-Do-This-Technical-Reason"><a href="#‚≠ê-Why-Keycloak-Can-Do-This-Technical-Reason" class="headerlink" title="‚≠ê Why Keycloak Can Do This (Technical Reason)"></a>‚≠ê Why Keycloak Can Do This (Technical Reason)</h1><p>Because <strong>Keycloak is NOT fully stateless</strong>.<br>It manages a <strong>stateful authentication session</strong>, and tokens reference that session.</p>
<p>Therefore, revocation propagates instantly and globally.</p>
<hr>
<h1 id="üî•-Q2-‚Äî-Why-can‚Äôt-typical-stateless-JWT-systems-revoke-access-as-effectively"><a href="#üî•-Q2-‚Äî-Why-can‚Äôt-typical-stateless-JWT-systems-revoke-access-as-effectively" class="headerlink" title="üî• Q2 ‚Äî Why can‚Äôt typical stateless JWT systems revoke access as effectively?"></a>üî• <strong>Q2 ‚Äî Why can‚Äôt typical stateless JWT systems revoke access as effectively?</strong></h1><h3 id="‚≠ê-Senior-Level-Answer-1"><a href="#‚≠ê-Senior-Level-Answer-1" class="headerlink" title="‚≠ê Senior-Level Answer"></a>‚≠ê <strong>Senior-Level Answer</strong></h3><p>A typical stateless JWT architecture uses <strong>self-contained JWTs</strong>:</p>
<ul>
<li>Token verification is done by services <em>locally</em> via public key.</li>
<li>Services do not contact the authorization server again after token issuance.</li>
</ul>
<p>This means:</p>
<h3 id="‚ùå-Once-a-JWT-is-issued-it-cannot-be-revoked-until-it-expires"><a href="#‚ùå-Once-a-JWT-is-issued-it-cannot-be-revoked-until-it-expires" class="headerlink" title="‚ùå Once a JWT is issued, it cannot be revoked until it expires"></a>‚ùå Once a JWT is issued, it cannot be revoked until it expires</h3><p>Unless you add non-standard extensions.</p>
<h3 id="‚ùå-No-central-session-store"><a href="#‚ùå-No-central-session-store" class="headerlink" title="‚ùå No central session store"></a>‚ùå No central session store</h3><p>There is nowhere to mark a session as invalid.</p>
<h3 id="‚ùå-No-refresh-token-blacklist"><a href="#‚ùå-No-refresh-token-blacklist" class="headerlink" title="‚ùå No refresh token blacklist"></a>‚ùå No refresh token blacklist</h3><p>Unless implemented manually with a database or Redis.</p>
<h3 id="‚ùå-No-push-revocation-events-to-API-clients"><a href="#‚ùå-No-push-revocation-events-to-API-clients" class="headerlink" title="‚ùå No push revocation events to API clients"></a>‚ùå No push revocation events to API clients</h3><p>(Standard OAuth2 libraries don‚Äôt have this built in.)</p>
<hr>
<h2 id="üí•-Final-summary"><a href="#üí•-Final-summary" class="headerlink" title="üí• Final summary:"></a>üí• Final summary:</h2><h3 id="Keycloak-stateful-centralized-session-model"><a href="#Keycloak-stateful-centralized-session-model" class="headerlink" title="Keycloak (stateful + centralized session model)"></a><strong>Keycloak (stateful + centralized session model)</strong></h3><p>‚úî Server-side session invalidation<br>‚úî Refresh token revocation<br>‚úî Token introspection<br>‚úî Push revocation events to adapters<br>‚úî Offline session management<br>‚úî Works across multiple devices, browsers, apps<br>‚úî Suitable for enterprise SSO</p>
<h3 id="Common-JWT-only-stateless-systems"><a href="#Common-JWT-only-stateless-systems" class="headerlink" title="Common JWT-only stateless systems"></a><strong>Common JWT-only stateless systems</strong></h3><p>‚ùå No central session<br>‚ùå Cannot revoke tokens already issued<br>‚ùå Must wait until token expiration<br>‚ùå Must manually implement token blacklist<br>‚ùå Cannot force logout across multiple clients</p>
<p>This difference is <em>fundamental</em> to why enterprises choose Keycloak.</p>
<hr>
<h1 id="üî•-Q3-‚Äî-How-does-Keycloak-ensure-cluster-wide-revocation-in-HA-mode"><a href="#üî•-Q3-‚Äî-How-does-Keycloak-ensure-cluster-wide-revocation-in-HA-mode" class="headerlink" title="üî• Q3 ‚Äî How does Keycloak ensure cluster-wide revocation in HA mode?"></a>üî• <strong>Q3 ‚Äî How does Keycloak ensure cluster-wide revocation in HA mode?</strong></h1><h3 id="‚≠ê-Senior-Level-Answer-2"><a href="#‚≠ê-Senior-Level-Answer-2" class="headerlink" title="‚≠ê Senior-Level Answer"></a>‚≠ê Senior-Level Answer</h3><p>Keycloak in cluster mode (Infinispan or newer methods) shares:</p>
<ul>
<li>User sessions</li>
<li>Client sessions</li>
<li>Offline sessions</li>
<li>Login failure counters</li>
<li>Revocation timestamps</li>
</ul>
<p>All nodes listen to <strong>Infinispan cache events</strong>.</p>
<p>So when one node invalidates a session:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cluster-broadcast:</span><br><span class="line">  event = session-revocation</span><br><span class="line">  sid = 7ab3... </span><br></pre></td></tr></table></figure>

<p>Every node immediately removes the session from its local cache.</p>
<p>This ensures <strong>revocation is cluster-wide and instantaneous</strong>.</p>
<hr>
<h1 id="üî•-Q4-‚Äî-How-does-Keycloak-reduce-the-JWT-statelessness-problem"><a href="#üî•-Q4-‚Äî-How-does-Keycloak-reduce-the-JWT-statelessness-problem" class="headerlink" title="üî• Q4 ‚Äî How does Keycloak reduce the JWT statelessness problem?"></a>üî• <strong>Q4 ‚Äî How does Keycloak reduce the JWT statelessness problem?</strong></h1><h3 id="‚≠ê-Keycloak-issues-stateless-JWT-access-tokens-but"><a href="#‚≠ê-Keycloak-issues-stateless-JWT-access-tokens-but" class="headerlink" title="‚≠ê Keycloak issues stateless JWT access tokens but:"></a>‚≠ê Keycloak issues stateless JWT access tokens <strong>but</strong>:</h3><p><strong>1. They have short TTL (5‚Äì15 minutes recommended)</strong><br>So compromise window is small.</p>
<p><strong>2. They are always tied to a session (<code>sid</code> claim).</strong></p>
<p><strong>3. They can be introspected by resource servers if required.</strong></p>
<p>Keycloak combines:</p>
<ul>
<li>Stateless JWT access tokens (performance)</li>
<li>Stateful refresh token &amp; session management (security)</li>
</ul>
<p>This hybrid model is why Keycloak works well for enterprise.</p>
<hr>
<h1 id="üî•-Q5-‚Äî-How-to-architect-revocation-sensitive-microservices-with-Keycloak"><a href="#üî•-Q5-‚Äî-How-to-architect-revocation-sensitive-microservices-with-Keycloak" class="headerlink" title="üî• Q5 ‚Äî How to architect revocation-sensitive microservices with Keycloak?"></a>üî• <strong>Q5 ‚Äî How to architect revocation-sensitive microservices with Keycloak?</strong></h1><h3 id="‚≠ê-Best-practice"><a href="#‚≠ê-Best-practice" class="headerlink" title="‚≠ê Best practice"></a>‚≠ê Best practice</h3><table>
<thead>
<tr>
<th>Token Type</th>
<th>Recommended Use</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Access Token (JWT)</strong></td>
<td>Short TTL (2‚Äì10 min), stateless verification</td>
</tr>
<tr>
<td><strong>Refresh Token</strong></td>
<td>Managed by Keycloak; revocation effective</td>
</tr>
<tr>
<td><strong>Token Introspection</strong></td>
<td>Only for zero-trust or sensitive APIs</td>
</tr>
<tr>
<td><strong>Keycloak Adapters</strong></td>
<td>To receive push revocation events</td>
</tr>
</tbody></table>
<p>Your services should not store long-lived sessions themselves.<br>Let Keycloak handle that.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/02/Deep-Dive-into-Keycloak-II/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/02/Deep-Dive-into-Keycloak-II/" class="post-title-link" itemprop="url">Deep Dive into Keycloak II</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-02 20:05:40 / Modified: 20:19:54" itemprop="dateCreated datePublished" datetime="2025-12-02T20:05:40-05:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-What-is-the-difference-between-OAuth2-and-OpenID-Connect-OIDC"><a href="#1-What-is-the-difference-between-OAuth2-and-OpenID-Connect-OIDC" class="headerlink" title="1. What is the difference between OAuth2 and OpenID Connect (OIDC)?"></a><strong>1. What is the difference between OAuth2 and OpenID Connect (OIDC)?</strong></h1><h3 id="Answer"><a href="#Answer" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>OAuth2 is an <strong>authorization</strong> framework ‚Äî it gives applications access to protected resources via access tokens.<br>OIDC is an <strong>authentication</strong> layer built on top of OAuth2 ‚Äî it provides identity information by adding <strong>ID tokens</strong>, user info endpoint, and standardized flows.</p>
<p>You use OAuth2 when an app needs <em>permissions</em><br>You use OIDC when an app needs <em>login + identity</em>.</p>
<hr>
<h1 id="2-How-does-Keycloak-handle-session-management-compared-to-stateless-JWT-systems"><a href="#2-How-does-Keycloak-handle-session-management-compared-to-stateless-JWT-systems" class="headerlink" title="2. How does Keycloak handle session management compared to stateless JWT systems?"></a><strong>2. How does Keycloak handle session management compared to stateless JWT systems?</strong></h1><h3 id="Answer-1"><a href="#Answer-1" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Keycloak maintains a <strong>server-side session</strong> for each authenticated user.<br>Even though it issues JWTs, it ‚Äúpeeks‚Äù into the token‚Äôs session ID to enforce logout and token invalidation.<br>This means:</p>
<ul>
<li>Keycloak can force logout of any user</li>
<li>Admin can revoke access tokens instantly</li>
<li>Tokens are short-lived; refresh tokens renew them</li>
</ul>
<p>Stateless JWT-only systems <em>cannot</em> revoke tokens without additional infrastructure.</p>
<hr>
<h1 id="3-What‚Äôs-the-purpose-of-a-Keycloak-Realm"><a href="#3-What‚Äôs-the-purpose-of-a-Keycloak-Realm" class="headerlink" title="3. What‚Äôs the purpose of a Keycloak Realm?"></a><strong>3. What‚Äôs the purpose of a Keycloak Realm?</strong></h1><h3 id="Answer-2"><a href="#Answer-2" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>A Realm is an isolated authentication domain.<br>Each realm has:</p>
<ul>
<li>its own clients</li>
<li>identity providers</li>
<li>users</li>
<li>roles</li>
<li>token settings</li>
</ul>
<p>Realms do not share users.<br>This isolates tenants for multi-tenant apps.</p>
<hr>
<h1 id="4-Explain-the-OAuth2-Authorization-Code-Flow-with-PKCE"><a href="#4-Explain-the-OAuth2-Authorization-Code-Flow-with-PKCE" class="headerlink" title="4. Explain the OAuth2 Authorization Code Flow with PKCE."></a><strong>4. Explain the OAuth2 Authorization Code Flow with PKCE.</strong></h1><h3 id="Answer-3"><a href="#Answer-3" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Used by public clients (SPA, mobile).<br>Steps:</p>
<ol>
<li>Client generates a <strong>code verifier</strong> and <strong>challenge</strong></li>
<li>User is redirected to Keycloak login</li>
<li>After successful login, Keycloak returns an <strong>authorization code</strong></li>
<li>Client exchanges the code for tokens including the <strong>code verifier</strong></li>
<li>Keycloak recomputes the challenge to verify request integrity</li>
</ol>
<p>PKCE prevents code interception attacks.</p>
<hr>
<h1 id="5-What-Keycloak-feature-would-you-use-for-Single-Sign-On-across-multiple-apps"><a href="#5-What-Keycloak-feature-would-you-use-for-Single-Sign-On-across-multiple-apps" class="headerlink" title="5. What Keycloak feature would you use for Single Sign-On across multiple apps?"></a><strong>5. What Keycloak feature would you use for Single Sign-On across multiple apps?</strong></h1><h3 id="Answer-4"><a href="#Answer-4" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p><strong>SSO session + OIDC Authorization Code Flow.</strong><br>Apps use the same Keycloak realm; once the user is logged into one app, Keycloak issues tokens to others without re-authentication.</p>
<hr>
<h1 id="6-How-do-you-configure-role-based-access-control-in-Keycloak"><a href="#6-How-do-you-configure-role-based-access-control-in-Keycloak" class="headerlink" title="6. How do you configure role-based access control in Keycloak?"></a><strong>6. How do you configure role-based access control in Keycloak?</strong></h1><h3 id="Answer-5"><a href="#Answer-5" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><ul>
<li>Create <strong>realm roles</strong> or <strong>client roles</strong></li>
<li>Map roles to users or groups</li>
<li>Configure clients to include roles in tokens (scope + mappers)</li>
<li>Your service enforces authorization based on the roles claim in JWT</li>
</ul>
<hr>
<h1 id="7-What-is-the-difference-between-Realm-Roles-and-Client-Roles"><a href="#7-What-is-the-difference-between-Realm-Roles-and-Client-Roles" class="headerlink" title="7. What is the difference between Realm Roles and Client Roles?"></a><strong>7. What is the difference between Realm Roles and Client Roles?</strong></h1><h3 id="Answer-6"><a href="#Answer-6" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><ul>
<li>Realm roles are global across the entire realm</li>
<li>Client roles belong to a specific client (service)</li>
</ul>
<p>Client roles prevent namespace collisions and support service-specific authorization.</p>
<hr>
<h1 id="8-How-do-you-secure-a-Spring-Boot-REST-API-using-Keycloak"><a href="#8-How-do-you-secure-a-Spring-Boot-REST-API-using-Keycloak" class="headerlink" title="8. How do you secure a Spring Boot REST API using Keycloak?"></a><strong>8. How do you secure a Spring Boot REST API using Keycloak?</strong></h1><h3 id="Answer-7"><a href="#Answer-7" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>For Spring Security 6 &#x2F; Boot 3:</p>
<ol>
<li>Use the OAuth2 Resource Server starter</li>
<li>Configure <code>issuer-uri</code> pointed to Keycloak realm</li>
<li>Enable JWT validation</li>
<li>Add authorization rules based on roles in JWT</li>
</ol>
<p>Resource server verifies tokens by fetching Keycloak‚Äôs public keys (JWKS).</p>
<hr>
<h1 id="9-What-are-Keycloak-Identity-Providers"><a href="#9-What-are-Keycloak-Identity-Providers" class="headerlink" title="9. What are Keycloak Identity Providers?"></a><strong>9. What are Keycloak Identity Providers?</strong></h1><h3 id="Answer-8"><a href="#Answer-8" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Identity Providers allow Keycloak to delegate login to external systems like:</p>
<ul>
<li>Google</li>
<li>GitHub</li>
<li>Azure AD</li>
<li>Another Keycloak realm</li>
</ul>
<p>Keycloak becomes an identity broker.</p>
<hr>
<h1 id="10-How-does-token-revocation-work-in-Keycloak"><a href="#10-How-does-token-revocation-work-in-Keycloak" class="headerlink" title="10. How does token revocation work in Keycloak?"></a><strong>10. How does token revocation work in Keycloak?</strong></h1><h3 id="Answer-9"><a href="#Answer-9" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Keycloak stores sessions server-side.<br>When an admin revokes tokens or logs a user out:</p>
<ul>
<li>Active tokens become invalid</li>
<li>Refresh token rotation prevents re-use</li>
<li>Next request with old token fails with 401</li>
</ul>
<p>This is a major advantage over purely stateless JWT systems.</p>
<hr>
<h1 id="11-What-is-Offline-Session-and-Offline-Token"><a href="#11-What-is-Offline-Session-and-Offline-Token" class="headerlink" title="11. What is Offline Session and Offline Token?"></a><strong>11. What is Offline Session and Offline Token?</strong></h1><h3 id="Answer-10"><a href="#Answer-10" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Offline tokens are long-lived refresh tokens not tied to active user sessions.<br>Useful for background jobs or CLI tools.<br>Users do not need to stay logged in.</p>
<hr>
<h1 id="12-How-do-you-integrate-Keycloak-with-an-API-Gateway-e-g-Kong-Nginx-Spring-Cloud-Gateway"><a href="#12-How-do-you-integrate-Keycloak-with-an-API-Gateway-e-g-Kong-Nginx-Spring-Cloud-Gateway" class="headerlink" title="12. How do you integrate Keycloak with an API Gateway (e.g., Kong, Nginx, Spring Cloud Gateway)?"></a><strong>12. How do you integrate Keycloak with an API Gateway (e.g., Kong, Nginx, Spring Cloud Gateway)?</strong></h1><h3 id="Answer-11"><a href="#Answer-11" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Use the gateway as an <strong>OAuth2 resource server</strong>.<br>It:</p>
<ul>
<li>validates JWTs from Keycloak</li>
<li>checks scopes&#x2F;roles</li>
<li>forwards authorized requests to microservices</li>
<li>optionally strips sensitive headers</li>
</ul>
<p>Microservices behind the gateway become stateless and do not validate tokens directly.</p>
<hr>
<h1 id="13-What-is-the-Keycloak-Admin-API-used-for"><a href="#13-What-is-the-Keycloak-Admin-API-used-for" class="headerlink" title="13. What is the Keycloak Admin API used for?"></a><strong>13. What is the Keycloak Admin API used for?</strong></h1><h3 id="Answer-12"><a href="#Answer-12" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Automating user and client management:</p>
<ul>
<li>create&#x2F;update users</li>
<li>reset passwords</li>
<li>assign roles</li>
<li>manage groups</li>
<li>manage clients</li>
<li>trigger impersonation</li>
</ul>
<p>Often used in CI&#x2F;CD or multi-tenant systems.</p>
<hr>
<h1 id="14-How-would-you-scale-Keycloak-for-production"><a href="#14-How-would-you-scale-Keycloak-for-production" class="headerlink" title="14. How would you scale Keycloak for production?"></a><strong>14. How would you scale Keycloak for production?</strong></h1><h3 id="Answer-13"><a href="#Answer-13" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><ul>
<li>Run multiple Keycloak nodes behind a load balancer</li>
<li>Use a shared database (PostgreSQL recommended)</li>
<li>Use sticky sessions only if needed (usually not needed post-Keycloak 17+)</li>
<li>Enable cross-node session cache with Infinispan</li>
<li>Offload static content via reverse proxy</li>
</ul>
<p>Keycloak 21+ with Quarkus has much lower memory footprint and better clustering.</p>
<hr>
<h1 id="15-What-are-the-common-pitfalls-when-integrating-SPAs-React-with-Keycloak"><a href="#15-What-are-the-common-pitfalls-when-integrating-SPAs-React-with-Keycloak" class="headerlink" title="15. What are the common pitfalls when integrating SPAs (React) with Keycloak?"></a><strong>15. What are the common pitfalls when integrating SPAs (React) with Keycloak?</strong></h1><h3 id="Answer-14"><a href="#Answer-14" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><ol>
<li>Storing tokens insecurely (never use localStorage ‚Üí use memory with silent refresh).</li>
<li>Using Implicit Flow (deprecated).</li>
<li>Not handling token refresh properly.</li>
<li>Not using PKCE.</li>
<li>Not validating roles on backend.</li>
</ol>
<p>Best practice: React &#x3D; public client using Authorization Code + PKCE.</p>
<hr>
<h1 id="16-How-do-service-to-service-calls-work-with-Keycloak"><a href="#16-How-do-service-to-service-calls-work-with-Keycloak" class="headerlink" title="16. How do service-to-service calls work with Keycloak?"></a><strong>16. How do service-to-service calls work with Keycloak?</strong></h1><h3 id="Answer-15"><a href="#Answer-15" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Use <strong>Client Credentials Flow</strong>:</p>
<ul>
<li>No user involved</li>
<li>The client authenticates with client secret</li>
<li>Keycloak returns an access token</li>
<li>Service uses token to call downstream service</li>
</ul>
<p>This is machine-to-machine authentication.</p>
<hr>
<h1 id="17-What‚Äôs-the-difference-between-Access-Token-and-ID-Token"><a href="#17-What‚Äôs-the-difference-between-Access-Token-and-ID-Token" class="headerlink" title="17. What‚Äôs the difference between Access Token and ID Token?"></a><strong>17. What‚Äôs the difference between Access Token and ID Token?</strong></h1><h3 id="Answer-16"><a href="#Answer-16" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><ul>
<li>Access token &#x3D; permissions for APIs (authorization)</li>
<li>ID token &#x3D; identity info about the user (authentication)</li>
</ul>
<p>APIs should ignore ID tokens.</p>
<hr>
<h1 id="18-How-do-you-restrict-which-scopes-a-client-may-request"><a href="#18-How-do-you-restrict-which-scopes-a-client-may-request" class="headerlink" title="18. How do you restrict which scopes a client may request?"></a><strong>18. How do you restrict which scopes a client may request?</strong></h1><h3 id="Answer-17"><a href="#Answer-17" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Use <strong>Client Scopes</strong>:</p>
<ul>
<li>Default client scopes</li>
<li>Optional client scopes</li>
<li>Protocol mappers to include additional claims</li>
<li>Scope parameter to control token content</li>
</ul>
<p>This prevents over-privileged tokens.</p>
<hr>
<h1 id="19-What-is-the-Keycloak-Token-Exchange"><a href="#19-What-is-the-Keycloak-Token-Exchange" class="headerlink" title="19. What is the Keycloak Token Exchange?"></a><strong>19. What is the Keycloak Token Exchange?</strong></h1><h3 id="Answer-18"><a href="#Answer-18" class="headerlink" title="Answer:"></a><strong>Answer:</strong></h3><p>Allows exchanging one token for another.<br>Use cases:</p>
<ul>
<li>service-to-service delegation</li>
<li>switching realms</li>
<li>getting a token for another client</li>
<li>impersonation workflows</li>
</ul>
<p>Powerful in microservice architectures.</p>
<hr>
<h1 id="20-How-do-you-debug-token-validation-issues"><a href="#20-How-do-you-debug-token-validation-issues" class="headerlink" title="20. How do you debug token validation issues?"></a><strong>20. How do you debug token validation issues?</strong></h1><h3 id="Steps-to-answer"><a href="#Steps-to-answer" class="headerlink" title="Steps to answer:"></a><strong>Steps to answer:</strong></h3><ol>
<li>Decode token using JWT.io</li>
<li>Verify issuer (iss) matches realm</li>
<li>Confirm audience (aud) includes client ID</li>
<li>Check signature using JWKS</li>
<li>Check token expiration</li>
<li>Check scope&#x2F;roles included</li>
</ol>
<p>Most validation failures come from misconfigured <code>issuer-uri</code> or missing mappers.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/01/Full-Fine-Tuning-vs-LoRA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/01/Full-Fine-Tuning-vs-LoRA/" class="post-title-link" itemprop="url">Full Fine-Tuning vs LoRA</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-01 14:37:04 / Modified: 15:05:29" itemprop="dateCreated datePublished" datetime="2025-12-01T14:37:04-05:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LoRA/" itemprop="url" rel="index"><span itemprop="name">LoRA</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LoRA/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LoRA/AI/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-fine-tuning">What is Fine-Tuning?</a></li>
<li><a href="#full-fine-tuning-explained">Full Fine-Tuning Explained</a></li>
<li><a href="#lora-low-rank-adaptation-explained">LoRA (Low-Rank Adaptation) Explained</a></li>
<li><a href="#technical-comparison">Technical Comparison</a></li>
<li><a href="#real-world-use-cases">Real-World Use Cases</a></li>
<li><a href="#when-to-use-which-method">When to Use Which Method</a></li>
<li><a href="#hands-on-practice-guide">Hands-On Practice Guide</a></li>
<li><a href="#advanced-topics">Advanced Topics</a></li>
<li><a href="#decision-framework">Decision Framework</a></li>
</ol>
<hr>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the era of Large Language Models (LLMs), <strong>fine-tuning</strong> has become the key to adapting pre-trained models to specific tasks. Two main approaches dominate the landscape:</p>
<ul>
<li><strong>Full Fine-Tuning</strong>: Training all model parameters</li>
<li><strong>LoRA (Low-Rank Adaptation)</strong>: Training only a small subset of parameters</li>
</ul>
<hr>
<h2 id="What-is-Fine-Tuning"><a href="#What-is-Fine-Tuning" class="headerlink" title="What is Fine-Tuning?"></a>What is Fine-Tuning?</h2><h3 id="Simple-Analogy"><a href="#Simple-Analogy" class="headerlink" title="Simple Analogy"></a>Simple Analogy</h3><p>Think of a pre-trained model as a <strong>medical doctor with general knowledge</strong>. Fine-tuning is like:</p>
<ul>
<li><strong>Full Fine-Tuning</strong>: Sending the doctor back to medical school to relearn everything with a focus on a specialty</li>
<li><strong>LoRA</strong>: Giving the doctor a specialized handbook they can reference without forgetting their general knowledge</li>
</ul>
<h3 id="Technical-Definition"><a href="#Technical-Definition" class="headerlink" title="Technical Definition"></a>Technical Definition</h3><p>Fine-tuning takes a pre-trained model (trained on massive general data) and continues training it on domain-specific data to improve performance on particular tasks.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Pre-trained Model (General Knowledge)</span><br><span class="line">         ‚Üì</span><br><span class="line">    Fine-Tuning (Specialized Training)</span><br><span class="line">         ‚Üì</span><br><span class="line">Task-Specific Model (Expert Knowledge)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Full-Fine-Tuning-Explained"><a href="#Full-Fine-Tuning-Explained" class="headerlink" title="Full Fine-Tuning Explained"></a>Full Fine-Tuning Explained</h2><h3 id="What-is-Full-Fine-Tuning"><a href="#What-is-Full-Fine-Tuning" class="headerlink" title="What is Full Fine-Tuning?"></a>What is Full Fine-Tuning?</h3><p>Full fine-tuning means <strong>updating ALL parameters</strong> in the model during training.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Model Architecture (Example: 7B parameters)</span><br><span class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ  Layer 1: [All parameters trainable] ‚îÇ ‚Üê Updated</span><br><span class="line">‚îÇ  Layer 2: [All parameters trainable] ‚îÇ ‚Üê Updated</span><br><span class="line">‚îÇ  Layer 3: [All parameters trainable] ‚îÇ ‚Üê Updated</span><br><span class="line">‚îÇ  ...                                ‚îÇ ‚Üê Updated</span><br><span class="line">‚îÇ  Layer N: [All parameters trainable] ‚îÇ ‚Üê Updated</span><br><span class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">Total Trainable: 7,000,000,000 params</span><br></pre></td></tr></table></figure>

<h3 id="How-It-Works"><a href="#How-It-Works" class="headerlink" title="How It Works"></a>How It Works</h3><ol>
<li><strong>Load pre-trained model</strong> (e.g., GPT-3, LLaMA, ChatGLM)</li>
<li><strong>Prepare task-specific dataset</strong> (e.g., medical Q&amp;A, legal documents)</li>
<li><strong>Train ALL parameters</strong> using your dataset</li>
<li><strong>Save the entire model</strong> (full 7B+ parameters)</li>
</ol>
<h3 id="Advantages-‚úÖ"><a href="#Advantages-‚úÖ" class="headerlink" title="Advantages ‚úÖ"></a>Advantages ‚úÖ</h3><ol>
<li><strong>Maximum Performance</strong>: Can achieve the best possible results</li>
<li><strong>Deep Customization</strong>: All parameters adapt to your specific task</li>
<li><strong>Flexible</strong>: Works for any task, especially those very different from pre-training</li>
</ol>
<h3 id="Disadvantages-‚ùå"><a href="#Disadvantages-‚ùå" class="headerlink" title="Disadvantages ‚ùå"></a>Disadvantages ‚ùå</h3><ol>
<li><p><strong>Extremely High Cost</strong>:</p>
<ul>
<li>GPT-3 175B full fine-tuning requires <strong>&gt;2TB GPU memory</strong></li>
<li>Needs high-end GPU clusters (multiple A100s)</li>
<li>Training can cost <strong>$20,000+</strong> per run</li>
</ul>
</li>
<li><p><strong>Long Training Time</strong>: Days or weeks to complete</p>
</li>
<li><p><strong>Storage Overhead</strong>: </p>
<ul>
<li>Each task needs a complete model copy</li>
<li>7B model &#x3D; ~14GB storage per task</li>
<li>10 tasks &#x3D; 140GB storage needed</li>
</ul>
</li>
<li><p><strong>Catastrophic Forgetting</strong>:</p>
<ul>
<li>Model may lose general knowledge</li>
<li>Reduced generalization ability</li>
</ul>
</li>
</ol>
<h3 id="Real-World-Example"><a href="#Real-World-Example" class="headerlink" title="Real-World Example"></a>Real-World Example</h3><p><strong>Google‚Äôs Multilingual Search Optimization</strong></p>
<ul>
<li>Used full fine-tuning on BERT-Large for multilingual search</li>
<li>Result: 25% improvement in low-resource language recall</li>
<li>Cost: Requires massive GPU infrastructure</li>
<li>Benefit: State-of-the-art performance across 100+ languages</li>
</ul>
<hr>
<h2 id="LoRA-Low-Rank-Adaptation-Explained"><a href="#LoRA-Low-Rank-Adaptation-Explained" class="headerlink" title="LoRA (Low-Rank Adaptation) Explained"></a>LoRA (Low-Rank Adaptation) Explained</h2><h3 id="What-is-LoRA"><a href="#What-is-LoRA" class="headerlink" title="What is LoRA?"></a>What is LoRA?</h3><p>LoRA is a <strong>parameter-efficient fine-tuning</strong> method proposed by Microsoft in 2021. Instead of updating all parameters, LoRA:</p>
<ul>
<li><strong>Freezes</strong> the original model weights</li>
<li><strong>Adds small ‚Äúadapter‚Äù matrices</strong> to specific layers</li>
<li><strong>Trains only</strong> these tiny adapters (typically 0.1%-1% of total parameters)</li>
</ul>
<h3 id="Visual-Explanation"><a href="#Visual-Explanation" class="headerlink" title="Visual Explanation"></a>Visual Explanation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Original Transformer Layer</span><br><span class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ  Pre-trained Weight Matrix W           ‚îÇ</span><br><span class="line">‚îÇ  [Frozen - Not Updated]                ‚îÇ</span><br><span class="line">‚îÇ          +                             ‚îÇ</span><br><span class="line">‚îÇ  Low-Rank Adapter: A √ó B               ‚îÇ</span><br><span class="line">‚îÇ  [Trainable - Only These Updated]      ‚îÇ</span><br><span class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line"></span><br><span class="line">Output = W¬∑x + A¬∑B¬∑x</span><br><span class="line">         ‚Üë      ‚Üë</span><br><span class="line">      Frozen  Trained (tiny!)</span><br></pre></td></tr></table></figure>

<h3 id="Mathematical-Foundation"><a href="#Mathematical-Foundation" class="headerlink" title="Mathematical Foundation"></a>Mathematical Foundation</h3><p>For a pre-trained weight matrix <strong>W</strong> (dimension d √ó k):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Full Fine-Tuning:</span><br><span class="line">  Updates: ŒîW (d √ó k parameters)</span><br><span class="line">  Total trainable: d √ó k</span><br><span class="line"></span><br><span class="line">LoRA:</span><br><span class="line">  Decomposes: ŒîW ‚âà A √ó B</span><br><span class="line">  Where: A is (d √ó r), B is (r √ó k)</span><br><span class="line">  Total trainable: d√ór + r√ók</span><br><span class="line">  </span><br><span class="line">Example (d=4096, k=4096, r=8):</span><br><span class="line">  Full: 4096 √ó 4096 = 16,777,216 params</span><br><span class="line">  LoRA: 4096√ó8 + 8√ó4096 = 65,536 params</span><br><span class="line">  Reduction: 99.6%! üéâ</span><br></pre></td></tr></table></figure>

<h3 id="How-LoRA-Works-Step-by-Step"><a href="#How-LoRA-Works-Step-by-Step" class="headerlink" title="How LoRA Works (Step-by-Step)"></a>How LoRA Works (Step-by-Step)</h3><ol>
<li><p><strong>Freeze Original Model</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for param in pretrained_model.parameters():</span><br><span class="line">    param.requires_grad = False  # Don&#x27;t update these</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Inject Low-Rank Matrices</strong></p>
<ul>
<li>Insert matrices A and B into attention layers</li>
<li>Initialize: A with random values, B with zeros</li>
<li>Typically apply to Query, Value projection matrices</li>
</ul>
</li>
<li><p><strong>Train Only Adapters</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for param in lora_adapters.parameters():</span><br><span class="line">    param.requires_grad = True  # Only update these</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Inference</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output = original_weight @ x + (A @ B) @ x</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Advantages-‚úÖ-1"><a href="#Advantages-‚úÖ-1" class="headerlink" title="Advantages ‚úÖ"></a>Advantages ‚úÖ</h3><ol>
<li><p><strong>Extreme Parameter Efficiency</strong>:</p>
<ul>
<li>Reduces trainable parameters by <strong>90-99%</strong></li>
<li>7B model: Train only 7-70M parameters instead of 7B</li>
</ul>
</li>
<li><p><strong>Low Cost, Fast Deployment</strong>:</p>
<ul>
<li>Consumer GPU (RTX 4090, RTX 3090) can fine-tune large models</li>
<li>Training time: Hours instead of days</li>
<li>Cost: <strong>$50-200</strong> instead of $20,000+</li>
</ul>
</li>
<li><p><strong>Multi-Task Flexibility</strong>:</p>
<ul>
<li>Save only adapter weights (~10-100MB per task)</li>
<li>Dynamically load different adapters for different tasks</li>
<li>One base model + multiple adapters &#x3D; multiple specialized models</li>
</ul>
</li>
<li><p><strong>Less Catastrophic Forgetting</strong>:</p>
<ul>
<li>Original weights unchanged</li>
<li>Retains general knowledge better</li>
</ul>
</li>
</ol>
<h3 id="Disadvantages-‚ùå-1"><a href="#Disadvantages-‚ùå-1" class="headerlink" title="Disadvantages ‚ùå"></a>Disadvantages ‚ùå</h3><ol>
<li><p><strong>Rank Parameter Tuning Required</strong>:</p>
<ul>
<li>Too small <code>r</code> (rank) ‚Üí underfitting</li>
<li>Too large <code>r</code> ‚Üí loses efficiency</li>
<li>Needs experimentation</li>
</ul>
</li>
<li><p><strong>‚ÄúIntruder Dimensions‚Äù Problem</strong> (Recent Discovery):</p>
<ul>
<li>LoRA introduces high-ranking singular vectors</li>
<li>Reduces out-of-distribution (OOD) generalization by 5-8%</li>
<li>Less robust in continual learning scenarios</li>
</ul>
</li>
<li><p><strong>Slightly Lower Peak Performance</strong>:</p>
<ul>
<li>May not reach absolute best performance</li>
<li>Gap is usually small (&lt;1-3%) for most tasks</li>
</ul>
</li>
</ol>
<h3 id="Real-World-Examples"><a href="#Real-World-Examples" class="headerlink" title="Real-World Examples"></a>Real-World Examples</h3><p><strong>1. Medical Document Summarization</strong></p>
<ul>
<li>Hospital used LoRA to fine-tune GPT-3 for medical report generation</li>
<li>Result: High-quality summaries, doctor efficiency increased 40%</li>
<li>Cost: Single RTX A6000 GPU, trained in 6 hours</li>
<li>Storage: Base model (14GB) + Adapter (50MB)</li>
</ul>
<p><strong>2. E-commerce Customer Service</strong></p>
<ul>
<li>Online retailer fine-tuned ChatGLM for customer support</li>
<li>Result: Response speed improved 3x, satisfaction up 25%</li>
<li>Deployment: 5 different product category adapters</li>
<li>Total storage: One model + 5 adapters &#x3D; 14.3GB (vs 70GB for 5 full models)</li>
</ul>
<p><strong>3. Financial News Generation</strong></p>
<ul>
<li>News agency fine-tuned GPT-3 for real-time financial reporting</li>
<li>Result: News generation latency reduced to seconds, 40% cost reduction</li>
<li>Adaptation time: 4 hours on 2√ó RTX 4090</li>
</ul>
<hr>
<h2 id="Technical-Comparison"><a href="#Technical-Comparison" class="headerlink" title="Technical Comparison"></a>Technical Comparison</h2><h3 id="Architecture-Comparison"><a href="#Architecture-Comparison" class="headerlink" title="Architecture Comparison"></a>Architecture Comparison</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FULL FINE-TUNING</span><br><span class="line">‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</span><br><span class="line">Input ‚Üí [Layer 1 ‚úèÔ∏è] ‚Üí [Layer 2 ‚úèÔ∏è] ‚Üí [Layer 3 ‚úèÔ∏è] ‚Üí Output</span><br><span class="line">        All Updated   All Updated    All Updated</span><br><span class="line"></span><br><span class="line">LoRA</span><br><span class="line">‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</span><br><span class="line">Input ‚Üí [Layer 1 üîí] ‚Üí [Layer 2 üîí] ‚Üí [Layer 3 üîí] ‚Üí Output</span><br><span class="line">        + Adapter‚úèÔ∏è   + Adapter‚úèÔ∏è    + Adapter‚úèÔ∏è</span><br><span class="line">        </span><br><span class="line">üîí = Frozen (unchanged)</span><br><span class="line">‚úèÔ∏è = Trainable (updated during training)</span><br></pre></td></tr></table></figure>

<h3 id="Detailed-Comparison-Table"><a href="#Detailed-Comparison-Table" class="headerlink" title="Detailed Comparison Table"></a>Detailed Comparison Table</h3><table>
<thead>
<tr>
<th>Aspect</th>
<th>Full Fine-Tuning</th>
<th>LoRA</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Trainable Parameters</strong></td>
<td>100% (e.g., 7B params)</td>
<td>0.1-1% (e.g., 7-70M params)</td>
</tr>
<tr>
<td><strong>GPU Memory</strong></td>
<td>Very High (&gt;80GB for 7B)</td>
<td>Low (24-48GB for 7B)</td>
</tr>
<tr>
<td><strong>Training Time</strong></td>
<td>Days to weeks</td>
<td>Hours to 1-2 days</td>
</tr>
<tr>
<td><strong>Cost per Training</strong></td>
<td>$10,000 - $100,000+</td>
<td>$50 - $500</td>
</tr>
<tr>
<td><strong>Storage per Task</strong></td>
<td>Full model (~14GB for 7B)</td>
<td>Adapter only (~10-100MB)</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>Highest (100% baseline)</td>
<td>Very High (95-99% of full)</td>
</tr>
<tr>
<td><strong>Multi-Task Deployment</strong></td>
<td>Difficult (one model per task)</td>
<td>Easy (one model + N adapters)</td>
</tr>
<tr>
<td><strong>Catastrophic Forgetting</strong></td>
<td>High risk</td>
<td>Low risk</td>
</tr>
<tr>
<td><strong>Hardware Requirements</strong></td>
<td>High-end GPU cluster (A100√ó8)</td>
<td>Consumer GPU (RTX 3090&#x2F;4090)</td>
</tr>
<tr>
<td><strong>Generalization (OOD)</strong></td>
<td>Best</td>
<td>Good (5-8% lower)</td>
</tr>
<tr>
<td><strong>Best For</strong></td>
<td>Maximum performance, unlimited budget</td>
<td>Fast iteration, limited resources</td>
</tr>
</tbody></table>
<h3 id="Memory-Comparison-7B-Model-Example"><a href="#Memory-Comparison-7B-Model-Example" class="headerlink" title="Memory Comparison (7B Model Example)"></a>Memory Comparison (7B Model Example)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Full Fine-Tuning (7B parameters):</span><br><span class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ Model: 14GB                     ‚îÇ</span><br><span class="line">‚îÇ Optimizer States: 42GB          ‚îÇ</span><br><span class="line">‚îÇ Gradients: 14GB                 ‚îÇ</span><br><span class="line">‚îÇ Activations: 20GB               ‚îÇ</span><br><span class="line">‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ</span><br><span class="line">‚îÇ Total: ~90GB                    ‚îÇ</span><br><span class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">Required: 4√ó A100 (40GB each)</span><br><span class="line"></span><br><span class="line">LoRA (7B base + 10M adapter):</span><br><span class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ Base Model: 14GB (frozen)       ‚îÇ</span><br><span class="line">‚îÇ Adapter: 20MB                   ‚îÇ</span><br><span class="line">‚îÇ Optimizer States: 60MB          ‚îÇ</span><br><span class="line">‚îÇ Gradients: 20MB                 ‚îÇ</span><br><span class="line">‚îÇ Activations: 12GB               ‚îÇ</span><br><span class="line">‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ</span><br><span class="line">‚îÇ Total: ~27GB                    ‚îÇ</span><br><span class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">Required: 1√ó RTX 3090/4090 (24GB)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Real-World-Use-Cases"><a href="#Real-World-Use-Cases" class="headerlink" title="Real-World Use Cases"></a>Real-World Use Cases</h2><h3 id="Use-Case-1-Healthcare-Clinical-Note-Generation"><a href="#Use-Case-1-Healthcare-Clinical-Note-Generation" class="headerlink" title="Use Case 1: Healthcare - Clinical Note Generation"></a>Use Case 1: Healthcare - Clinical Note Generation</h3><p><strong>Scenario</strong>: Hospital needs AI to generate structured clinical notes from doctor-patient conversations.</p>
<p><strong>Challenge</strong>:</p>
<ul>
<li>Medical terminology requires domain adaptation</li>
<li>HIPAA compliance &#x3D; can‚Äôt use cloud APIs</li>
<li>Limited budget and GPU resources</li>
</ul>
<p><strong>Solution: LoRA Fine-Tuning</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Approach</span></span><br><span class="line">Base Model: LLaMA-<span class="number">2</span>-7B</span><br><span class="line">Dataset: <span class="number">10</span>,<span class="number">000</span> anonymized clinical conversations</span><br><span class="line">Training: LoRA (r=<span class="number">16</span>, Œ±=<span class="number">32</span>)</span><br><span class="line">Hardware: <span class="number">1</span>√ó RTX A6000 (48GB)</span><br><span class="line">Time: <span class="number">8</span> hours</span><br><span class="line">Cost: ~$<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Results</span></span><br><span class="line">- Accuracy: <span class="number">94</span>% (vs <span class="number">96</span>% <span class="keyword">with</span> full fine-tuning)</span><br><span class="line">- Deployment: One base model + adapter (<span class="number">14.05</span>GB total)</span><br><span class="line">- Multi-specialty: <span class="number">5</span> adapters <span class="keyword">for</span> different departments (<span class="number">14.3</span>GB total)</span><br></pre></td></tr></table></figure>

<p><strong>Why LoRA Won</strong>:</p>
<ul>
<li>‚úÖ Budget-friendly</li>
<li>‚úÖ Fast iteration for different specialties</li>
<li>‚úÖ Meets accuracy requirements</li>
<li>‚úÖ Easy deployment on-premise</li>
</ul>
<hr>
<h3 id="Use-Case-2-Legal-Contract-Analysis"><a href="#Use-Case-2-Legal-Contract-Analysis" class="headerlink" title="Use Case 2: Legal - Contract Analysis"></a>Use Case 2: Legal - Contract Analysis</h3><p><strong>Scenario</strong>: Law firm needs to analyze merger &amp; acquisition contracts for risk factors.</p>
<p><strong>Challenge</strong>:</p>
<ul>
<li>Complex legal language</li>
<li>High accuracy requirement (mistakes &#x3D; legal liability)</li>
<li>Contracts vary significantly by jurisdiction</li>
</ul>
<p><strong>Solution: Full Fine-Tuning</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Approach</span></span><br><span class="line">Base Model: GPT-<span class="number">3.5</span>-turbo-instruct</span><br><span class="line">Dataset: <span class="number">50</span>,<span class="number">000</span> labeled M&amp;A contracts</span><br><span class="line">Training: Full fine-tuning <span class="built_in">all</span> parameters</span><br><span class="line">Hardware: <span class="number">8</span>√ó A100 GPUs (cloud)</span><br><span class="line">Time: <span class="number">4</span> days</span><br><span class="line">Cost: ~$<span class="number">25</span>,<span class="number">000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Results</span></span><br><span class="line">- Accuracy: <span class="number">98.5</span>% (vs <span class="number">95</span>% <span class="keyword">with</span> LoRA r=<span class="number">64</span>)</span><br><span class="line">- Risk detection: <span class="number">99.2</span>% recall (critical <span class="keyword">for</span> legal)</span><br><span class="line">- <span class="literal">False</span> positive rate: <span class="number">1.8</span>% (vs <span class="number">4.2</span>% <span class="keyword">with</span> LoRA)</span><br></pre></td></tr></table></figure>

<p><strong>Why Full Fine-Tuning Won</strong>:</p>
<ul>
<li>‚úÖ Maximum accuracy needed (legal liability)</li>
<li>‚úÖ Budget available (law firm can afford)</li>
<li>‚úÖ Single specialized task</li>
<li>‚úÖ 3% accuracy improvement &#x3D; millions in risk mitigation</li>
</ul>
<hr>
<h3 id="Use-Case-3-E-Commerce-Multi-Category-Product-Descriptions"><a href="#Use-Case-3-E-Commerce-Multi-Category-Product-Descriptions" class="headerlink" title="Use Case 3: E-Commerce - Multi-Category Product Descriptions"></a>Use Case 3: E-Commerce - Multi-Category Product Descriptions</h3><p><strong>Scenario</strong>: Online marketplace needs to generate product descriptions for 10 different categories (electronics, fashion, home, etc.).</p>
<p><strong>Challenge</strong>:</p>
<ul>
<li>10 different writing styles needed</li>
<li>Rapid product launches (new categories added quarterly)</li>
<li>Budget-conscious startup</li>
</ul>
<p><strong>Solution: LoRA with Multi-Adapter Architecture</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Approach</span></span><br><span class="line">Base Model: Qwen-7B</span><br><span class="line">Training: <span class="number">10</span> separate LoRA adapters (r=<span class="number">8</span>)</span><br><span class="line">  - Electronics adapter</span><br><span class="line">  - Fashion adapter</span><br><span class="line">  - Home &amp; Garden adapter</span><br><span class="line">  - Sports adapter</span><br><span class="line">  - ... (<span class="number">6</span> more)</span><br><span class="line">Hardware: <span class="number">1</span>√ó RTX <span class="number">4090</span></span><br><span class="line">Time per adapter: <span class="number">3</span> hours</span><br><span class="line">Total cost: ~$<span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line">Storage:</span><br><span class="line">  Base model: 14GB</span><br><span class="line">  <span class="number">10</span> adapters: <span class="number">10</span> √ó 40MB = 400MB</span><br><span class="line">  Total: <span class="number">14.4</span>GB (vs 140GB <span class="keyword">for</span> <span class="number">10</span> full models)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Runtime</span></span><br><span class="line">Load base model once, swap adapters dynamically:</span><br><span class="line">electronics_model = base + electronics_adapter</span><br><span class="line">fashion_model = base + fashion_adapter</span><br></pre></td></tr></table></figure>

<p><strong>Why LoRA Won</strong>:</p>
<ul>
<li>‚úÖ 10√ó storage savings</li>
<li>‚úÖ Can train new category adapter in hours</li>
<li>‚úÖ Single GPU deployment</li>
<li>‚úÖ Easy A&#x2F;B testing different adapters</li>
</ul>
<hr>
<h3 id="Use-Case-4-Multilingual-Customer-Support"><a href="#Use-Case-4-Multilingual-Customer-Support" class="headerlink" title="Use Case 4: Multilingual Customer Support"></a>Use Case 4: Multilingual Customer Support</h3><p><strong>Scenario</strong>: Global SaaS company needs chatbots for 20 languages.</p>
<p><strong>Challenge</strong>:</p>
<ul>
<li>20 language-specific models needed</li>
<li>Need to update all models when features change</li>
<li>Some languages low-resource (limited training data)</li>
</ul>
<p><strong>LoRA Approach</strong> (Recommended):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Base Model: Multilingual LLaMA-2-13B</span><br><span class="line">Training: 20 language adapters (r=16)</span><br><span class="line"></span><br><span class="line">Storage: 26GB base + (20 √ó 80MB) = 27.6GB</span><br><span class="line">vs Full Fine-Tuning: 20 √ó 26GB = 520GB</span><br><span class="line"></span><br><span class="line">Benefit: Update base model ‚Üí all languages benefit</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="When-to-Use-Which-Method"><a href="#When-to-Use-Which-Method" class="headerlink" title="When to Use Which Method"></a>When to Use Which Method</h2><h3 id="Choose-Full-Fine-Tuning-When"><a href="#Choose-Full-Fine-Tuning-When" class="headerlink" title="Choose Full Fine-Tuning When:"></a>Choose Full Fine-Tuning When:</h3><ol>
<li><p><strong>Maximum Performance is Critical</strong> ‚úÖ</p>
<ul>
<li>Legal, medical, financial applications where errors are costly</li>
<li>Need that extra 2-5% accuracy</li>
</ul>
</li>
<li><p><strong>Large Dataset Available</strong> ‚úÖ</p>
<ul>
<li>Have &gt;100,000 high-quality labeled examples</li>
<li>Data justifies training all parameters</li>
</ul>
</li>
<li><p><strong>Unlimited Budget &amp; Resources</strong> ‚úÖ</p>
<ul>
<li>Access to GPU clusters (8+ A100s)</li>
<li>Can afford $10,000-100,000 training costs</li>
</ul>
</li>
<li><p><strong>Single Specialized Task</strong> ‚úÖ</p>
<ul>
<li>Only need one model for one task</li>
<li>No plan for multi-task deployment</li>
</ul>
</li>
<li><p><strong>Task Very Different from Pre-training</strong> ‚úÖ</p>
<ul>
<li>Specialized domains (medical, legal, scientific)</li>
<li>Low-resource languages</li>
</ul>
</li>
</ol>
<p><strong>Example Decision</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Use Full Fine-Tuning if:</span><br><span class="line">  (Accuracy_requirement &gt; 97%) AND</span><br><span class="line">  (Budget &gt; $10,000) AND</span><br><span class="line">  (Single_task OR Task_very_different)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Choose-LoRA-When"><a href="#Choose-LoRA-When" class="headerlink" title="Choose LoRA When:"></a>Choose LoRA When:</h3><ol>
<li><p><strong>Limited Resources</strong> ‚úÖ</p>
<ul>
<li>Budget &lt; $5,000</li>
<li>Only have consumer GPUs (RTX 3090, 4090)</li>
</ul>
</li>
<li><p><strong>Need Fast Iteration</strong> ‚úÖ</p>
<ul>
<li>Startup environment</li>
<li>Frequent model updates</li>
<li>Rapid experimentation</li>
</ul>
</li>
<li><p><strong>Multi-Task Deployment</strong> ‚úÖ</p>
<ul>
<li>Need models for 5+ different tasks&#x2F;domains</li>
<li>Want to switch between tasks dynamically</li>
</ul>
</li>
<li><p><strong>Storage Constraints</strong> ‚úÖ</p>
<ul>
<li>Limited disk space</li>
<li>Edge device deployment</li>
</ul>
</li>
<li><p><strong>Continuous Learning</strong> ‚úÖ</p>
<ul>
<li>Need to add new capabilities over time</li>
<li>Can‚Äôt afford catastrophic forgetting</li>
</ul>
</li>
</ol>
<p><strong>Example Decision</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Use LoRA if:</span><br><span class="line">  (Budget &lt; $5,000) OR</span><br><span class="line">  (GPU_memory &lt; 80GB) OR</span><br><span class="line">  (Num_tasks &gt; 3) OR</span><br><span class="line">  (Need_fast_iteration)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Hands-On-Practice-Guide"><a href="#Hands-On-Practice-Guide" class="headerlink" title="Hands-On Practice Guide"></a>Hands-On Practice Guide</h2><h3 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install required libraries</span></span><br><span class="line">pip install torch transformers peft datasets accelerate bitsandbytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check GPU</span></span><br><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure>

<h3 id="Practice-1-Full-Fine-Tuning-Small-Model"><a href="#Practice-1-Full-Fine-Tuning-Small-Model" class="headerlink" title="Practice 1: Full Fine-Tuning (Small Model)"></a>Practice 1: Full Fine-Tuning (Small Model)</h3><p><strong>Task</strong>: Fine-tune GPT-2 (small) for custom text generation</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> GPT2LMHeadModel, GPT2Tokenizer, Trainer, TrainingArguments</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. Load pre-trained model</span></span><br><span class="line">model = GPT2LMHeadModel.from_pretrained(<span class="string">&quot;gpt2&quot;</span>)</span><br><span class="line">tokenizer = GPT2Tokenizer.from_pretrained(<span class="string">&quot;gpt2&quot;</span>)</span><br><span class="line">tokenizer.pad_token = tokenizer.eos_token</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Prepare dataset</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;wikitext&quot;</span>, <span class="string">&quot;wikitext-2-raw-v1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_function</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(examples[<span class="string">&quot;text&quot;</span>], truncation=<span class="literal">True</span>, </span><br><span class="line">                     max_length=<span class="number">512</span>, padding=<span class="string">&quot;max_length&quot;</span>)</span><br><span class="line"></span><br><span class="line">tokenized_datasets = dataset.<span class="built_in">map</span>(tokenize_function, batched=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Training configuration (FULL FINE-TUNING)</span></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    output_dir=<span class="string">&quot;./gpt2-finetuned-full&quot;</span>,</span><br><span class="line">    num_train_epochs=<span class="number">3</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">4</span>,</span><br><span class="line">    save_steps=<span class="number">500</span>,</span><br><span class="line">    save_total_limit=<span class="number">2</span>,</span><br><span class="line">    learning_rate=<span class="number">2e-5</span>,</span><br><span class="line">    <span class="comment"># All parameters trainable (default)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Train</span></span><br><span class="line">trainer = Trainer(</span><br><span class="line">    model=model,</span><br><span class="line">    args=training_args,</span><br><span class="line">    train_dataset=tokenized_datasets[<span class="string">&quot;train&quot;</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer.train()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. Save model</span></span><br><span class="line">model.save_pretrained(<span class="string">&quot;./gpt2-finetuned-full&quot;</span>)</span><br><span class="line">tokenizer.save_pretrained(<span class="string">&quot;./gpt2-finetuned-full&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Model size: <span class="subst">&#123;<span class="built_in">sum</span>(p.numel() <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters())&#125;</span> parameters&quot;</span>)</span><br><span class="line"><span class="comment"># Output: ~124M parameters all trained</span></span><br></pre></td></tr></table></figure>

<p><strong>Resource Requirements</strong>:</p>
<ul>
<li>GPU: GTX 1080 Ti or better (11GB+)</li>
<li>Time: ~2 hours</li>
<li>Storage: ~500MB</li>
</ul>
<hr>
<h3 id="Practice-2-LoRA-Fine-Tuning-Large-Model"><a href="#Practice-2-LoRA-Fine-Tuning-Large-Model" class="headerlink" title="Practice 2: LoRA Fine-Tuning (Large Model)"></a>Practice 2: LoRA Fine-Tuning (Large Model)</h3><p><strong>Task</strong>: Fine-tune LLaMA-2-7B for instruction following using LoRA</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForCausalLM, AutoTokenizer, TrainingArguments</span><br><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> LoraConfig, get_peft_model, prepare_model_for_kbit_training</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="keyword">from</span> trl <span class="keyword">import</span> SFTTrainer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. Load base model (with 4-bit quantization for efficiency)</span></span><br><span class="line">model_name = <span class="string">&quot;meta-llama/Llama-2-7b-hf&quot;</span></span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(</span><br><span class="line">    model_name,</span><br><span class="line">    load_in_4bit=<span class="literal">True</span>,  <span class="comment"># Quantization to reduce memory</span></span><br><span class="line">    device_map=<span class="string">&quot;auto&quot;</span></span><br><span class="line">)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line">tokenizer.pad_token = tokenizer.eos_token</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Configure LoRA</span></span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    r=<span class="number">16</span>,                       <span class="comment"># Rank (try 8, 16, 32, 64)</span></span><br><span class="line">    lora_alpha=<span class="number">32</span>,              <span class="comment"># Scaling factor</span></span><br><span class="line">    target_modules=[<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>],  <span class="comment"># Apply to attention</span></span><br><span class="line">    lora_dropout=<span class="number">0.05</span>,</span><br><span class="line">    bias=<span class="string">&quot;none&quot;</span>,</span><br><span class="line">    task_type=<span class="string">&quot;CAUSAL_LM&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Prepare model for LoRA training</span></span><br><span class="line">model = prepare_model_for_kbit_training(model)</span><br><span class="line">model = get_peft_model(model, lora_config)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print trainable parameters</span></span><br><span class="line">model.print_trainable_parameters()</span><br><span class="line"><span class="comment"># Output: trainable params: 4,194,304 || all params: 6,738,415,616 || trainable%: 0.06%</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Load instruction dataset</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;timdettmers/openassistant-guanaco&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. Training configuration</span></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    output_dir=<span class="string">&quot;./llama2-lora&quot;</span>,</span><br><span class="line">    num_train_epochs=<span class="number">3</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">4</span>,</span><br><span class="line">    gradient_accumulation_steps=<span class="number">4</span>,</span><br><span class="line">    learning_rate=<span class="number">2e-4</span>,</span><br><span class="line">    logging_steps=<span class="number">10</span>,</span><br><span class="line">    save_strategy=<span class="string">&quot;epoch&quot;</span>,</span><br><span class="line">    fp16=<span class="literal">True</span>,  <span class="comment"># Mixed precision</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. Train with SFTTrainer (Supervised Fine-Tuning)</span></span><br><span class="line">trainer = SFTTrainer(</span><br><span class="line">    model=model,</span><br><span class="line">    train_dataset=dataset[<span class="string">&quot;train&quot;</span>],</span><br><span class="line">    args=training_args,</span><br><span class="line">    peft_config=lora_config,</span><br><span class="line">    dataset_text_field=<span class="string">&quot;text&quot;</span>,</span><br><span class="line">    max_seq_length=<span class="number">512</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer.train()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. Save only LoRA adapter (tiny!)</span></span><br><span class="line">model.save_pretrained(<span class="string">&quot;./llama2-lora-adapter&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. Load and use later</span></span><br><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> PeftModel</span><br><span class="line"></span><br><span class="line">base_model = AutoModelForCausalLM.from_pretrained(model_name)</span><br><span class="line">lora_model = PeftModel.from_pretrained(base_model, <span class="string">&quot;./llama2-lora-adapter&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate</span></span><br><span class="line">inputs = tokenizer(<span class="string">&quot;Explain quantum computing:&quot;</span>, return_tensors=<span class="string">&quot;pt&quot;</span>)</span><br><span class="line">outputs = lora_model.generate(**inputs, max_length=<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(tokenizer.decode(outputs[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>

<p><strong>Resource Requirements</strong>:</p>
<ul>
<li>GPU: RTX 3090 (24GB) or better</li>
<li>Time: 4-8 hours</li>
<li>Storage: Base model (14GB) + Adapter (50MB)</li>
</ul>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>Only 0.06% of parameters trained! (4M out of 6.7B)</li>
<li>Memory usage: ~18GB (vs ~90GB for full fine-tuning)</li>
<li>Can train multiple adapters and switch between them</li>
</ul>
<hr>
<h3 id="Practice-3-Comparing-LoRA-Ranks"><a href="#Practice-3-Comparing-LoRA-Ranks" class="headerlink" title="Practice 3: Comparing LoRA Ranks"></a>Practice 3: Comparing LoRA Ranks</h3><p><strong>Experiment</strong>: Train same model with different ranks and compare</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Train adapters with different ranks</span></span><br><span class="line">ranks = [<span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>]</span><br><span class="line">results = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> ranks:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span>*<span class="number">50</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Training with rank r=<span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span>*<span class="number">50</span>&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    lora_config = LoraConfig(</span><br><span class="line">        r=r,</span><br><span class="line">        lora_alpha=r*<span class="number">2</span>,  <span class="comment"># Common practice: alpha = 2*r</span></span><br><span class="line">        target_modules=[<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>],</span><br><span class="line">        lora_dropout=<span class="number">0.05</span>,</span><br><span class="line">        bias=<span class="string">&quot;none&quot;</span>,</span><br><span class="line">        task_type=<span class="string">&quot;CAUSAL_LM&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    model = prepare_model_for_kbit_training(base_model)</span><br><span class="line">    model = get_peft_model(model, lora_config)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Train and evaluate</span></span><br><span class="line">    trainer = SFTTrainer(...)</span><br><span class="line">    trainer.train()</span><br><span class="line">    metrics = trainer.evaluate()</span><br><span class="line">    </span><br><span class="line">    results[r] = &#123;</span><br><span class="line">        <span class="string">&#x27;trainable_params&#x27;</span>: <span class="built_in">sum</span>(p.numel() <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters() <span class="keyword">if</span> p.requires_grad),</span><br><span class="line">        <span class="string">&#x27;loss&#x27;</span>: metrics[<span class="string">&#x27;eval_loss&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;adapter_size_mb&#x27;</span>: get_adapter_size(model)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compare results</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.DataFrame(results).T</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Expected output:</span></span><br><span class="line"><span class="comment">#     trainable_params  loss  adapter_size_mb</span></span><br><span class="line"><span class="comment"># 4      2,097,152    2.45       8</span></span><br><span class="line"><span class="comment"># 8      4,194,304    2.31      16</span></span><br><span class="line"><span class="comment"># 16     8,388,608    2.24      32</span></span><br><span class="line"><span class="comment"># 32    16,777,216    2.21      64</span></span><br><span class="line"><span class="comment"># 64    33,554,432    2.19     128</span></span><br></pre></td></tr></table></figure>

<p><strong>Insights</strong>:</p>
<ul>
<li>Rank 4-8: Fast, tiny, good for simple tasks</li>
<li>Rank 16-32: Sweet spot for most tasks</li>
<li>Rank 64+: Approaching full fine-tuning performance</li>
</ul>
<hr>
<h2 id="Advanced-Topics"><a href="#Advanced-Topics" class="headerlink" title="Advanced Topics"></a>Advanced Topics</h2><h3 id="1-QLoRA-Quantized-LoRA"><a href="#1-QLoRA-Quantized-LoRA" class="headerlink" title="1. QLoRA (Quantized LoRA)"></a>1. QLoRA (Quantized LoRA)</h3><p><strong>What</strong>: Combines LoRA with 4-bit quantization for even lower memory usage.</p>
<p><strong>Breakthrough</strong>: Train 65B parameter models on a single 48GB GPU!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BitsAndBytesConfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># QLoRA configuration</span></span><br><span class="line">bnb_config = BitsAndBytesConfig(</span><br><span class="line">    load_in_4bit=<span class="literal">True</span>,</span><br><span class="line">    bnb_4bit_use_double_quant=<span class="literal">True</span>,</span><br><span class="line">    bnb_4bit_quant_type=<span class="string">&quot;nf4&quot;</span>,</span><br><span class="line">    bnb_4bit_compute_dtype=torch.bfloat16</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(</span><br><span class="line">    <span class="string">&quot;meta-llama/Llama-2-70b-hf&quot;</span>,</span><br><span class="line">    quantization_config=bnb_config,</span><br><span class="line">    device_map=<span class="string">&quot;auto&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now train with LoRA as before</span></span><br><span class="line"><span class="comment"># Memory usage: ~40GB for 70B model! üéâ</span></span><br></pre></td></tr></table></figure>

<p><strong>Use Case</strong>: Fine-tune massive models (65B, 70B+) on consumer hardware.</p>
<hr>
<h3 id="2-AdaLoRA-Adaptive-LoRA"><a href="#2-AdaLoRA-Adaptive-LoRA" class="headerlink" title="2. AdaLoRA (Adaptive LoRA)"></a>2. AdaLoRA (Adaptive LoRA)</h3><p><strong>What</strong>: Dynamically adjusts rank during training based on importance.</p>
<p><strong>Benefit</strong>: Automatically finds optimal rank per layer.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> AdaLoraConfig, get_peft_model</span><br><span class="line"></span><br><span class="line">adalora_config = AdaLoraConfig(</span><br><span class="line">    init_r=<span class="number">12</span>,              <span class="comment"># Initial rank</span></span><br><span class="line">    target_r=<span class="number">8</span>,             <span class="comment"># Target rank</span></span><br><span class="line">    tinit=<span class="number">200</span>,              <span class="comment"># Warmup steps</span></span><br><span class="line">    tfinal=<span class="number">1000</span>,            <span class="comment"># Total steps</span></span><br><span class="line">    delta_t=<span class="number">10</span>,             <span class="comment"># Rank adjustment frequency</span></span><br><span class="line">    beta1=<span class="number">0.85</span>,</span><br><span class="line">    beta2=<span class="number">0.85</span>,</span><br><span class="line">    orth_reg_weight=<span class="number">0.5</span>,</span><br><span class="line">    lora_alpha=<span class="number">32</span>,</span><br><span class="line">    lora_dropout=<span class="number">0.1</span>,</span><br><span class="line">    target_modules=[<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>],</span><br><span class="line">    task_type=<span class="string">&quot;CAUSAL_LM&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">model = get_peft_model(model, adalora_config)</span><br></pre></td></tr></table></figure>

<p><strong>Result</strong>: Better performance than fixed-rank LoRA with similar parameter count.</p>
<hr>
<h3 id="3-The-‚ÄúIntruder-Dimensions‚Äù-Problem"><a href="#3-The-‚ÄúIntruder-Dimensions‚Äù-Problem" class="headerlink" title="3. The ‚ÄúIntruder Dimensions‚Äù Problem"></a>3. The ‚ÄúIntruder Dimensions‚Äù Problem</h3><p><strong>Recent Discovery (MIT Research, 2024)</strong>:</p>
<p>LoRA introduces high-ranking singular vectors not present in full fine-tuning. These ‚Äúintruder dimensions‚Äù:</p>
<ul>
<li>Reduce out-of-distribution generalization by 5-8%</li>
<li>Cause more forgetting in continual learning</li>
<li>Appear more with lower ranks (r ‚â§ 16)</li>
</ul>
<p><strong>Visualization</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Full Fine-Tuning Weight Matrix SVD:</span><br><span class="line">Singular Values: [100, 95, 90, 85, 80, ...]  ‚Üê Smooth decay</span><br><span class="line">Singular Vectors: All similar to pre-trained</span><br><span class="line"></span><br><span class="line">LoRA Weight Matrix SVD:</span><br><span class="line">Singular Values: [100, 95, 90, 85, 80, ..., 15, 14, 13]  ‚Üê Similar</span><br><span class="line">                                               ‚Üì</span><br><span class="line">                                    [50, 45, 40]  ‚Üê INTRUDER!</span><br><span class="line">Singular Vectors: Some very different from pre-trained</span><br></pre></td></tr></table></figure>

<p><strong>Solutions</strong>:</p>
<ol>
<li>Use higher rank (r&#x3D;64+) with rank stabilization</li>
<li>Use ‚Äúrank-stabilized LoRA‚Äù techniques</li>
<li>For critical applications, prefer full fine-tuning</li>
</ol>
<hr>
<h3 id="4-Multi-Adapter-Architecture"><a href="#4-Multi-Adapter-Architecture" class="headerlink" title="4. Multi-Adapter Architecture"></a>4. Multi-Adapter Architecture</h3><p><strong>Pattern</strong>: One base model + dynamic adapter loading</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Training phase: Train multiple adapters</span></span><br><span class="line">adapters = &#123;</span><br><span class="line">    <span class="string">&#x27;medical&#x27;</span>: train_lora(base_model, medical_data, r=<span class="number">16</span>),</span><br><span class="line">    <span class="string">&#x27;legal&#x27;</span>: train_lora(base_model, legal_data, r=<span class="number">16</span>),</span><br><span class="line">    <span class="string">&#x27;finance&#x27;</span>: train_lora(base_model, finance_data, r=<span class="number">16</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save adapters</span></span><br><span class="line"><span class="keyword">for</span> name, adapter <span class="keyword">in</span> adapters.items():</span><br><span class="line">    adapter.save_pretrained(<span class="string">f&quot;./adapters/<span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inference phase: Dynamically load adapters</span></span><br><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> PeftModel</span><br><span class="line"></span><br><span class="line">base_model = AutoModelForCausalLM.from_pretrained(<span class="string">&quot;llama-2-7b&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># For medical query</span></span><br><span class="line">medical_model = PeftModel.from_pretrained(base_model, <span class="string">&quot;./adapters/medical&quot;</span>)</span><br><span class="line">response = medical_model.generate(...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch to legal</span></span><br><span class="line">legal_model = PeftModel.from_pretrained(base_model, <span class="string">&quot;./adapters/legal&quot;</span>)</span><br><span class="line">response = legal_model.generate(...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Or merge multiple adapters!</span></span><br><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> PeftModel</span><br><span class="line">multi_model = PeftModel.from_pretrained(base_model, <span class="string">&quot;./adapters/medical&quot;</span>)</span><br><span class="line">multi_model.load_adapter(<span class="string">&quot;./adapters/legal&quot;</span>, adapter_name=<span class="string">&quot;legal&quot;</span>)</span><br><span class="line">multi_model.set_adapter([<span class="string">&quot;medical&quot;</span>, <span class="string">&quot;legal&quot;</span>])  <span class="comment"># Use both!</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Decision-Framework"><a href="#Decision-Framework" class="headerlink" title="Decision Framework"></a>Decision Framework</h2><h3 id="The-Complete-Decision-Tree"><a href="#The-Complete-Decision-Tree" class="headerlink" title="The Complete Decision Tree"></a>The Complete Decision Tree</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">START: Do you need to fine-tune a large language model?</span><br><span class="line">‚îÇ</span><br><span class="line">‚îú‚îÄ‚Üí Q1: What&#x27;s your budget?</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí &lt; $1,000: ‚Üí LoRA (or QLoRA)</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí $1,000 - $10,000: ‚Üí LoRA (consider full if single critical task)</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚Üí &gt; $10,000: ‚Üí Consider full fine-tuning</span><br><span class="line">‚îÇ</span><br><span class="line">‚îú‚îÄ‚Üí Q2: What GPU do you have?</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí Consumer (RTX 3090/4090): ‚Üí LoRA or QLoRA</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí Single A100 (40-80GB): ‚Üí LoRA or Full (for &lt;7B models)</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚Üí GPU Cluster (8+ A100s): ‚Üí Full fine-tuning possible</span><br><span class="line">‚îÇ</span><br><span class="line">‚îú‚îÄ‚Üí Q3: How many tasks?</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí 1 task: ‚Üí Either (depends on other factors)</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí 2-5 tasks: ‚Üí LoRA (multi-adapter)</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚Üí 5+ tasks: ‚Üí Definitely LoRA</span><br><span class="line">‚îÇ</span><br><span class="line">‚îú‚îÄ‚Üí Q4: Accuracy requirements?</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí &gt;98% required: ‚Üí Full fine-tuning</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí 95-98%: ‚Üí LoRA (high rank, r=64+)</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚Üí &lt;95%: ‚Üí LoRA (standard rank, r=8-16)</span><br><span class="line">‚îÇ</span><br><span class="line">‚îú‚îÄ‚Üí Q5: Deployment constraints?</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí Edge devices: ‚Üí LoRA (smaller)</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚Üí Cloud: ‚Üí Either</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚Üí Need rapid updates: ‚Üí LoRA</span><br><span class="line">‚îÇ</span><br><span class="line">‚îî‚îÄ‚Üí Q6: Continual learning needed?</span><br><span class="line">    ‚îú‚îÄ‚Üí Yes, multiple sequential tasks: ‚Üí High-rank LoRA or Full</span><br><span class="line">    ‚îú‚îÄ‚Üí No: ‚Üí Standard LoRA</span><br><span class="line">    ‚îî‚îÄ‚Üí Critical to avoid forgetting: ‚Üí Full fine-tuning</span><br></pre></td></tr></table></figure>

<h3 id="Quick-Selection-Matrix"><a href="#Quick-Selection-Matrix" class="headerlink" title="Quick Selection Matrix"></a>Quick Selection Matrix</h3><table>
<thead>
<tr>
<th>Your Situation</th>
<th>Recommended Method</th>
<th>Rank&#x2F;Config</th>
</tr>
</thead>
<tbody><tr>
<td>Startup, limited GPU, 3+ tasks</td>
<td>LoRA</td>
<td>r&#x3D;8-16</td>
</tr>
<tr>
<td>Enterprise, single critical task</td>
<td>Full Fine-Tuning</td>
<td>All parameters</td>
</tr>
<tr>
<td>Research, multiple experiments</td>
<td>LoRA</td>
<td>r&#x3D;16-32</td>
</tr>
<tr>
<td>&gt;100B model, limited hardware</td>
<td>QLoRA</td>
<td>r&#x3D;8-16, 4-bit</td>
</tr>
<tr>
<td>Medical&#x2F;Legal high-stakes</td>
<td>Full Fine-Tuning</td>
<td>All parameters</td>
</tr>
<tr>
<td>Multi-lingual deployment</td>
<td>LoRA multi-adapter</td>
<td>r&#x3D;16 per language</td>
</tr>
<tr>
<td>Rapid A&#x2F;B testing</td>
<td>LoRA</td>
<td>r&#x3D;8 (fast training)</td>
</tr>
<tr>
<td>Edge device deployment</td>
<td>QLoRA</td>
<td>r&#x3D;4-8, quantized</td>
</tr>
</tbody></table>
<hr>
<h2 id="Best-Practices-Tips"><a href="#Best-Practices-Tips" class="headerlink" title="Best Practices &amp; Tips"></a>Best Practices &amp; Tips</h2><h3 id="For-LoRA-Fine-Tuning"><a href="#For-LoRA-Fine-Tuning" class="headerlink" title="For LoRA Fine-Tuning"></a>For LoRA Fine-Tuning</h3><ol>
<li><p><strong>Start Small, Scale Up</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Experiment progression</span></span><br><span class="line"><span class="number">1.</span> Try r=<span class="number">8</span> first (fast, good baseline)</span><br><span class="line"><span class="number">2.</span> If underfitting, increase to r=<span class="number">16</span></span><br><span class="line"><span class="number">3.</span> For <span class="built_in">complex</span> tasks, <span class="keyword">try</span> r=<span class="number">32</span> <span class="keyword">or</span> r=<span class="number">64</span></span><br><span class="line"><span class="number">4.</span> Monitor validation loss to find sweet spot</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Target the Right Modules</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For most language models</span></span><br><span class="line">target_modules = [<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>]  <span class="comment"># Minimum (queries &amp; values)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For better performance</span></span><br><span class="line">target_modules = [<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;k_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>, <span class="string">&quot;o_proj&quot;</span>]  <span class="comment"># All attention</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For maximum adaptation (more params)</span></span><br><span class="line">target_modules = [<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;k_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>, <span class="string">&quot;o_proj&quot;</span>, </span><br><span class="line">                  <span class="string">&quot;gate_proj&quot;</span>, <span class="string">&quot;up_proj&quot;</span>, <span class="string">&quot;down_proj&quot;</span>]  <span class="comment"># Attention + FFN</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Learning Rate Selection</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LoRA typically needs higher LR than full fine-tuning</span></span><br><span class="line">Full Fine-Tuning: lr = <span class="number">1e-5</span> to <span class="number">5e-5</span></span><br><span class="line">LoRA: lr = <span class="number">1e-4</span> to <span class="number">3e-4</span>  (10x higher!)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rule of thumb</span></span><br><span class="line">lora_lr = full_finetuning_lr * <span class="number">10</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Rank Selection Guide</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Task Complexity        ‚Üí Recommended Rank</span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line">Simple (sentiment)     ‚Üí r=4-8</span><br><span class="line">Medium (summarization) ‚Üí r=8-16</span><br><span class="line">Complex (reasoning)    ‚Üí r=16-32</span><br><span class="line">Very complex (coding)  ‚Üí r=32-64</span><br><span class="line">Approaching full FT    ‚Üí r=128-256</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Prevent Intruder Dimensions</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use rank stabilization</span></span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    r=<span class="number">32</span>,</span><br><span class="line">    lora_alpha=<span class="number">64</span>,</span><br><span class="line">    use_rslora=<span class="literal">True</span>,  <span class="comment"># Rank-stabilized LoRA</span></span><br><span class="line">    <span class="comment"># ... other params</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="For-Full-Fine-Tuning"><a href="#For-Full-Fine-Tuning" class="headerlink" title="For Full Fine-Tuning"></a>For Full Fine-Tuning</h3><ol>
<li><p><strong>Gradient Checkpointing</strong> (Save Memory)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.gradient_checkpointing_enable()</span><br><span class="line"><span class="comment"># Trades computation for memory</span></span><br><span class="line"><span class="comment"># Enables training larger models on same GPU</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Mixed Precision Training</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">training_args = TrainingArguments(</span><br><span class="line">    fp16=<span class="literal">True</span>,  <span class="comment"># For older GPUs</span></span><br><span class="line">    bf16=<span class="literal">True</span>,  <span class="comment"># For A100s (better for large models)</span></span><br><span class="line">    <span class="comment"># Reduces memory usage by 2x</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Distributed Training</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use DeepSpeed for multi-GPU</span></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    deepspeed=<span class="string">&quot;ds_config.json&quot;</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">1</span>,</span><br><span class="line">    gradient_accumulation_steps=<span class="number">16</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ds_config.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;train_batch_size&quot;</span>: <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">    <span class="string">&quot;zero_optimization&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;stage&quot;</span>: <span class="number">3</span>,  <span class="comment"># ZeRO-3: Shard everything</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Prevent Catastrophic Forgetting</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use lower learning rate</span></span><br><span class="line">learning_rate = <span class="number">1e-5</span>  <span class="comment"># vs 2e-4 for pre-training</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Freeze some layers (partial fine-tuning)</span></span><br><span class="line"><span class="keyword">for</span> i, layer <span class="keyword">in</span> <span class="built_in">enumerate</span>(model.layers):</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="number">20</span>:  <span class="comment"># Freeze first 20 layers</span></span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> layer.parameters():</span><br><span class="line">            param.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use elastic weight consolidation (EWC)</span></span><br><span class="line"><span class="comment"># Add regularization term penalizing large weight changes</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="Common-Mistakes-How-to-Avoid-Them"><a href="#Common-Mistakes-How-to-Avoid-Them" class="headerlink" title="Common Mistakes &amp; How to Avoid Them"></a>Common Mistakes &amp; How to Avoid Them</h2><h3 id="Mistake-1-Using-LoRA-rank-that‚Äôs-too-low"><a href="#Mistake-1-Using-LoRA-rank-that‚Äôs-too-low" class="headerlink" title="Mistake 1: Using LoRA rank that‚Äôs too low"></a>Mistake 1: Using LoRA rank that‚Äôs too low</h3><p>‚ùå <strong>Problem</strong>: r&#x3D;4 for complex instruction following</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lora_config = LoraConfig(r=<span class="number">4</span>, ...)  <span class="comment"># Too small!</span></span><br><span class="line"><span class="comment"># Result: Model can&#x27;t learn complex patterns, poor performance</span></span><br></pre></td></tr></table></figure>

<p>‚úÖ <strong>Solution</strong>: Start with r&#x3D;16, increase if needed</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lora_config = LoraConfig(r=<span class="number">16</span>, lora_alpha=<span class="number">32</span>, ...)</span><br><span class="line"><span class="comment"># Monitor validation loss, increase to r=32 if plateauing</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Mistake-2-Wrong-learning-rate"><a href="#Mistake-2-Wrong-learning-rate" class="headerlink" title="Mistake 2: Wrong learning rate"></a>Mistake 2: Wrong learning rate</h3><p>‚ùå <strong>Problem</strong>: Using same LR for LoRA as full fine-tuning</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Full fine-tuning LR used for LoRA</span></span><br><span class="line">training_args = TrainingArguments(learning_rate=<span class="number">2e-5</span>, ...)</span><br><span class="line"><span class="comment"># Result: Slow convergence, underfitting</span></span><br></pre></td></tr></table></figure>

<p>‚úÖ <strong>Solution</strong>: Use 10x higher LR for LoRA</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">training_args = TrainingArguments(learning_rate=<span class="number">2e-4</span>, ...)</span><br><span class="line"><span class="comment"># LoRA adapters need stronger signals to learn</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Mistake-3-Not-quantizing-when-memory-is-tight"><a href="#Mistake-3-Not-quantizing-when-memory-is-tight" class="headerlink" title="Mistake 3: Not quantizing when memory is tight"></a>Mistake 3: Not quantizing when memory is tight</h3><p>‚ùå <strong>Problem</strong>: Trying to load 7B model in FP16 on 16GB GPU</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = AutoModelForCausalLM.from_pretrained(<span class="string">&quot;llama-2-7b&quot;</span>)</span><br><span class="line"><span class="comment"># Result: CUDA Out of Memory error</span></span><br></pre></td></tr></table></figure>

<p>‚úÖ <strong>Solution</strong>: Use 4-bit&#x2F;8-bit quantization</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">model = AutoModelForCausalLM.from_pretrained(</span><br><span class="line">    <span class="string">&quot;llama-2-7b&quot;</span>,</span><br><span class="line">    load_in_4bit=<span class="literal">True</span>,</span><br><span class="line">    device_map=<span class="string">&quot;auto&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># Result: Fits in 8GB GPU!</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Mistake-4-Training-on-too-few-examples"><a href="#Mistake-4-Training-on-too-few-examples" class="headerlink" title="Mistake 4: Training on too few examples"></a>Mistake 4: Training on too few examples</h3><p>‚ùå <strong>Problem</strong>: Fine-tuning on 100 examples</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataset = load_dataset(...)[:<span class="number">100</span>]  <span class="comment"># Only 100 examples</span></span><br><span class="line"><span class="comment"># Result: Overfitting, poor generalization</span></span><br></pre></td></tr></table></figure>

<p>‚úÖ <strong>Solution</strong>: Minimum dataset sizes</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Full Fine-Tuning: 10,000+ examples (ideally 100k+)</span><br><span class="line">LoRA: 1,000+ examples (can work with 500 for simple tasks)</span><br><span class="line">QLoRA: 500+ examples (most efficient)</span><br><span class="line"></span><br><span class="line">If you have &lt;500 examples:</span><br><span class="line">  ‚Üí Use prompt engineering or few-shot learning instead</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Mistake-5-Not-saving-checkpoints"><a href="#Mistake-5-Not-saving-checkpoints" class="headerlink" title="Mistake 5: Not saving checkpoints"></a>Mistake 5: Not saving checkpoints</h3><p>‚ùå <strong>Problem</strong>: Training crashes after 20 hours, no checkpoints</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">training_args = TrainingArguments(</span><br><span class="line">    save_strategy=<span class="string">&quot;no&quot;</span>,  <span class="comment"># Dangerous!</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>‚úÖ <strong>Solution</strong>: Regular checkpointing</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">training_args = TrainingArguments(</span><br><span class="line">    save_strategy=<span class="string">&quot;steps&quot;</span>,</span><br><span class="line">    save_steps=<span class="number">500</span>,</span><br><span class="line">    save_total_limit=<span class="number">3</span>,  <span class="comment"># Keep last 3 checkpoints</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Real-Cost-Comparison"><a href="#Real-Cost-Comparison" class="headerlink" title="Real Cost Comparison"></a>Real Cost Comparison</h2><h3 id="Example-Fine-tuning-LLaMA-2-7B-for-3-epochs-on-10-000-examples"><a href="#Example-Fine-tuning-LLaMA-2-7B-for-3-epochs-on-10-000-examples" class="headerlink" title="Example: Fine-tuning LLaMA-2-7B for 3 epochs on 10,000 examples"></a>Example: Fine-tuning LLaMA-2-7B for 3 epochs on 10,000 examples</h3><p><strong>Full Fine-Tuning</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Hardware: 4√ó A100 (80GB) via AWS</span><br><span class="line">Cost: $32.77/hour per GPU</span><br><span class="line">Duration: 48 hours</span><br><span class="line">Total: $32.77 √ó 4 √ó 48 = $6,293</span><br><span class="line"></span><br><span class="line">Storage: 14GB per model</span><br><span class="line">If 5 tasks: 70GB total</span><br><span class="line"></span><br><span class="line">Total Investment: ~$6,300 + ongoing storage</span><br></pre></td></tr></table></figure>

<p><strong>LoRA (r&#x3D;16)</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Hardware: 1√ó RTX 4090 (24GB) - owned or $2/hour cloud</span><br><span class="line">Cost: $2/hour</span><br><span class="line">Duration: 12 hours</span><br><span class="line">Total: $2 √ó 12 = $24</span><br><span class="line"></span><br><span class="line">Storage: 14GB base + (5 √ó 50MB adapters) = 14.25GB</span><br><span class="line"></span><br><span class="line">Total Investment: ~$24 + one-time GPU purchase (~$1,600)</span><br></pre></td></tr></table></figure>

<p><strong>Savings: 99.6%</strong> üéâ</p>
<hr>
<h2 id="Latest-Research-Trends-2024-2025"><a href="#Latest-Research-Trends-2024-2025" class="headerlink" title="Latest Research &amp; Trends (2024-2025)"></a>Latest Research &amp; Trends (2024-2025)</h2><h3 id="1-LoRA-and-LoRA-FA"><a href="#1-LoRA-and-LoRA-FA" class="headerlink" title="1. LoRA+ and LoRA-FA"></a>1. LoRA+ and LoRA-FA</h3><ul>
<li><strong>LoRA+</strong>: Different learning rates for A and B matrices</li>
<li><strong>LoRA-FA</strong>: Frozen-A variant (only train B matrix)</li>
<li>Result: Faster convergence, better performance</li>
</ul>
<h3 id="2-DoRA-Weight-Decomposed-LoRA"><a href="#2-DoRA-Weight-Decomposed-LoRA" class="headerlink" title="2. DoRA (Weight-Decomposed LoRA)"></a>2. DoRA (Weight-Decomposed LoRA)</h3><ul>
<li>Decomposes weights into magnitude and direction</li>
<li>Bridges gap between LoRA and full fine-tuning</li>
<li>20% better performance on reasoning tasks</li>
</ul>
<h3 id="3-MultiLoRA-LoRA-Composition"><a href="#3-MultiLoRA-LoRA-Composition" class="headerlink" title="3. MultiLoRA &amp; LoRA Composition"></a>3. MultiLoRA &amp; LoRA Composition</h3><ul>
<li>Train multiple LoRA adapters</li>
<li>Compose them at inference time</li>
<li>Example: (medical_adapter √ó 0.7) + (general_adapter √ó 0.3)</li>
</ul>
<h3 id="4-LoRA-for-Vision-Multimodal-Models"><a href="#4-LoRA-for-Vision-Multimodal-Models" class="headerlink" title="4. LoRA for Vision &amp; Multimodal Models"></a>4. LoRA for Vision &amp; Multimodal Models</h3><ul>
<li>VoRA: LoRA for vision transformers</li>
<li>Successful for CLIP, Stable Diffusion fine-tuning</li>
<li>90% memory reduction for image model fine-tuning</li>
</ul>
<hr>
<h2 id="Summary-Recommendations"><a href="#Summary-Recommendations" class="headerlink" title="Summary &amp; Recommendations"></a>Summary &amp; Recommendations</h2><h3 id="The-Bottom-Line"><a href="#The-Bottom-Line" class="headerlink" title="The Bottom Line"></a>The Bottom Line</h3><p><strong>LoRA is the default choice for most practitioners in 2024-2025.</strong></p>
<p>Reasons:</p>
<ul>
<li>‚úÖ 99% cost reduction</li>
<li>‚úÖ Accessible on consumer hardware</li>
<li>‚úÖ Fast iteration (hours vs days)</li>
<li>‚úÖ Easy multi-task deployment</li>
<li>‚úÖ Good enough performance for most applications (95-99% of full)</li>
</ul>
<p><strong>Full Fine-Tuning is for special cases:</strong></p>
<ul>
<li>High-stakes applications (medical, legal, financial)</li>
<li>Unlimited budget and resources</li>
<li>Need absolute best performance</li>
<li>Research settings exploring model limits</li>
</ul>
<h3 id="Your-Action-Plan"><a href="#Your-Action-Plan" class="headerlink" title="Your Action Plan"></a>Your Action Plan</h3><p><strong>Week 1: Start with LoRA</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> Choose base model (LLaMA-<span class="number">2</span>-7B, Mistral-7B, Qwen)</span><br><span class="line"><span class="number">2.</span> Prepare <span class="number">1</span>,<span class="number">000</span>+ examples</span><br><span class="line"><span class="number">3.</span> Train LoRA (r=<span class="number">16</span>) on <span class="number">1</span>√ó GPU</span><br><span class="line"><span class="number">4.</span> Evaluate on validation <span class="built_in">set</span></span><br><span class="line"><span class="number">5.</span> Iterate on rank <span class="keyword">and</span> hyperparameters</span><br></pre></td></tr></table></figure>

<p><strong>Week 2: Optimize</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> Experiment <span class="keyword">with</span> ranks: <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span></span><br><span class="line"><span class="number">2.</span> Try different target modules</span><br><span class="line"><span class="number">3.</span> Test QLoRA <span class="keyword">if</span> memory constrained</span><br><span class="line"><span class="number">4.</span> A/B test different adapters</span><br></pre></td></tr></table></figure>

<p><strong>Month 2+: Scale if Needed</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> performance &lt; requirements:</span><br><span class="line">    <span class="keyword">if</span> budget_available:</span><br><span class="line">        <span class="keyword">try</span> full fine-tuning</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">try</span> higher rank LoRA (r=<span class="number">64</span>-<span class="number">128</span>)</span><br><span class="line">        <span class="keyword">or</span> <span class="keyword">try</span> DoRA/LoRA+ variants</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Additional-Resources"><a href="#Additional-Resources" class="headerlink" title="Additional Resources"></a>Additional Resources</h2><h3 id="Code-Repositories"><a href="#Code-Repositories" class="headerlink" title="Code Repositories"></a>Code Repositories</h3><ul>
<li><strong>Hugging Face PEFT</strong>: <a target="_blank" rel="noopener" href="https://github.com/huggingface/peft">https://github.com/huggingface/peft</a></li>
<li><strong>LoRA Paper</strong>: <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2106.09685">https://arxiv.org/abs/2106.09685</a></li>
<li><strong>QLoRA Paper</strong>: <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2305.14314">https://arxiv.org/abs/2305.14314</a></li>
</ul>
<h3 id="Tutorials"><a href="#Tutorials" class="headerlink" title="Tutorials"></a>Tutorials</h3><ul>
<li>Hugging Face LoRA Tutorial: <a target="_blank" rel="noopener" href="https://huggingface.co/docs/peft">https://huggingface.co/docs/peft</a></li>
<li>Fast.ai Practical Deep Learning: <a target="_blank" rel="noopener" href="https://course.fast.ai/">https://course.fast.ai</a></li>
</ul>
<h3 id="Communities"><a href="#Communities" class="headerlink" title="Communities"></a>Communities</h3><ul>
<li>Hugging Face Forums: <a target="_blank" rel="noopener" href="https://discuss.huggingface.co/">https://discuss.huggingface.co</a></li>
<li>r&#x2F;LocalLLaMA (Reddit): For LoRA discussions</li>
<li>EleutherAI Discord: For research discussions</li>
</ul>
<hr>
<p><strong>Remember</strong>:</p>
<ul>
<li>Start with LoRA (r&#x3D;16)</li>
<li>Scale to full fine-tuning only if truly needed</li>
<li>Focus on data quality over method choice</li>
<li>Iterate quickly and measure results</li>
</ul>
<p><strong>The best method is the one that:</strong></p>
<ol>
<li>Fits your budget</li>
<li>Meets your accuracy requirements</li>
<li>Enables fast iteration</li>
<li>Scales with your needs</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/11/21/WebFlux-Deep-Dive-Operators-Types-and-Real-World-Use-Cases/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/21/WebFlux-Deep-Dive-Operators-Types-and-Real-World-Use-Cases/" class="post-title-link" itemprop="url">WebFlux Deep Dive: Operators, Types, and Real-World Use Cases</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-11-21 16:30:04 / Modified: 16:31:17" itemprop="dateCreated datePublished" datetime="2025-11-21T16:30:04-05:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><a href="#core-reactive-types">Core Reactive Types</a></li>
<li><a href="#creation-operators">Creation Operators</a></li>
<li><a href="#transformation-operators">Transformation Operators</a></li>
<li><a href="#combination-operators">Combination Operators</a></li>
<li><a href="#error-handling-operators">Error Handling Operators</a></li>
<li><a href="#scheduling--threading">Scheduling &amp; Threading</a></li>
<li><a href="#advanced-patterns">Advanced Patterns</a></li>
</ol>
<h2 id="Core-Reactive-Types"><a href="#Core-Reactive-Types" class="headerlink" title="Core Reactive Types"></a>Core Reactive Types</h2><h3 id="Mono-Single-Result-Container"><a href="#Mono-Single-Result-Container" class="headerlink" title="Mono - Single Result Container"></a>Mono - Single Result Container</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mono represents a stream that emits 0 or 1 element</span></span><br><span class="line"><span class="comment"> * Perfect for: HTTP responses, database saves, single calculations</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonoDeepDive</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Creation examples</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monoCreation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Empty Mono</span></span><br><span class="line">        Mono&lt;String&gt; empty = Mono.empty();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// From value</span></span><br><span class="line">        Mono&lt;String&gt; staticValue = Mono.just(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// From nullable</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">possiblyNull</span> <span class="operator">=</span> getFromCache();</span><br><span class="line">        Mono&lt;String&gt; nullable = Mono.justOrEmpty(possiblyNull);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// From supplier (lazy)</span></span><br><span class="line">        Mono&lt;String&gt; lazy = Mono.fromSupplier(() -&gt; expensiveOperation());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// From callable</span></span><br><span class="line">        Mono&lt;String&gt; fromCallable = Mono.fromCallable(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> database.getUser(userId); <span class="comment">// Potentially blocking</span></span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// From future</span></span><br><span class="line">        CompletableFuture&lt;String&gt; future = asyncHttpCall();</span><br><span class="line">        Mono&lt;String&gt; fromFuture = Mono.fromFuture(future);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Real-world use case: User profile lookup</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;UserProfile&gt; <span class="title function_">getUserProfile</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; userRepository.findById(userId))</span><br><span class="line">                  .filter(Optional::isPresent)</span><br><span class="line">                  .map(Optional::get)</span><br><span class="line">                  .switchIfEmpty(Mono.error(<span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(userId)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flux-Multiple-Results-Stream"><a href="#Flux-Multiple-Results-Stream" class="headerlink" title="Flux - Multiple Results Stream"></a>Flux - Multiple Results Stream</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Flux represents a stream that emits 0 to N elements</span></span><br><span class="line"><span class="comment"> * Perfect for: Collections, real-time streams, paginated results</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FluxDeepDive</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Creation examples</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fluxCreation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// From values</span></span><br><span class="line">        Flux&lt;String&gt; fromValues = Flux.just(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// From array</span></span><br><span class="line">        Flux&lt;String&gt; fromArray = Flux.fromArray(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// From iterable</span></span><br><span class="line">        Flux&lt;String&gt; fromList = Flux.fromIterable(Arrays.asList(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Range</span></span><br><span class="line">        Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Interval (real-time stream)</span></span><br><span class="line">        Flux&lt;Long&gt; ticker = Flux.interval(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate (stateful stream)</span></span><br><span class="line">        Flux&lt;Integer&gt; fibonacci = Flux.generate(</span><br><span class="line">            () -&gt; <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">1</span>&#125;, <span class="comment">// initial state</span></span><br><span class="line">            (state, sink) -&gt; &#123;</span><br><span class="line">                sink.next(state[<span class="number">0</span>]);</span><br><span class="line">                <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> state[<span class="number">0</span>] + state[<span class="number">1</span>];</span><br><span class="line">                state[<span class="number">0</span>] = state[<span class="number">1</span>];</span><br><span class="line">                state[<span class="number">1</span>] = next;</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Real-world use case: Real-time stock prices</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;StockPrice&gt; <span class="title function_">getStockPrices</span><span class="params">(String symbol)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">                  .flatMap(tick -&gt; </span><br><span class="line">                      Mono.fromCallable(() -&gt; stockService.getCurrentPrice(symbol))</span><br><span class="line">                          .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">                  )</span><br><span class="line">                  .take(<span class="number">100</span>); <span class="comment">// Only take 100 price updates</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Transformation-Operators"><a href="#Transformation-Operators" class="headerlink" title="Transformation Operators"></a>Transformation Operators</h2><h3 id="map-vs-flatMap-The-Critical-Difference"><a href="#map-vs-flatMap-The-Critical-Difference" class="headerlink" title="map vs flatMap - The Critical Difference"></a>map vs flatMap - The Critical Difference</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransformationOperators</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * map: Synchronous 1:1 transformation</span></span><br><span class="line"><span class="comment">     * Use when: Transformation is fast, non-blocking, CPU-bound</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mapOperator</span><span class="params">()</span> &#123;</span><br><span class="line">        Flux&lt;String&gt; names = Flux.just(<span class="string">&quot;john&quot;</span>, <span class="string">&quot;jane&quot;</span>, <span class="string">&quot;bob&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Synchronous transformation - stays in same thread</span></span><br><span class="line">        Flux&lt;String&gt; capitalized = names.map(name -&gt; name.toUpperCase());</span><br><span class="line">        <span class="comment">// Output: JOHN, JANE, BOB</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Real-world: Data enrichment (fast)</span></span><br><span class="line">        Flux&lt;User&gt; users = getUserIds()</span><br><span class="line">            .map(id -&gt; <span class="keyword">new</span> <span class="title class_">User</span>(id, <span class="string">&quot;user-&quot;</span> + id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * flatMap: Asynchronous 1:N transformation</span></span><br><span class="line"><span class="comment">     * Use when: Need to call async APIs, database, external services</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flatMapOperator</span><span class="params">()</span> &#123;</span><br><span class="line">        Flux&lt;String&gt; userIds = Flux.just(<span class="string">&quot;user1&quot;</span>, <span class="string">&quot;user2&quot;</span>, <span class="string">&quot;user3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Asynchronous transformation - can change threads</span></span><br><span class="line">        Flux&lt;User&gt; users = userIds.flatMap(id -&gt; </span><br><span class="line">            userRepository.findByIdAsync(id) <span class="comment">// Returns Mono&lt;User&gt;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Real-world: Fetch user details from multiple services</span></span><br><span class="line">        Flux&lt;Order&gt; orders = getOrderIds()</span><br><span class="line">            .flatMap(orderId -&gt; </span><br><span class="line">                orderService.getOrderAsync(orderId)</span><br><span class="line">                    .onErrorResume(e -&gt; Mono.empty()) <span class="comment">// Skip failed orders</span></span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * flatMapMany: Convert Mono to Flux</span></span><br><span class="line"><span class="comment">     * Use when: You have Mono that emits multiple items</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flatMapManyOperator</span><span class="params">()</span> &#123;</span><br><span class="line">        Mono&lt;String&gt; csvData = readCsvFile();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Convert Mono&lt;String&gt; to Flux&lt;String[]&gt;</span></span><br><span class="line">        Flux&lt;String[]&gt; rows = csvData.flatMapMany(content -&gt; </span><br><span class="line">            Flux.fromArray(content.split(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">                .map(line -&gt; line.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Real-world: Get user and their recent activities</span></span><br><span class="line">        Mono&lt;User&gt; user = getUserProfile(userId);</span><br><span class="line">        Flux&lt;Activity&gt; activities = user.flatMapMany(u -&gt; </span><br><span class="line">            activityService.getRecentActivities(u.getId())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Advanced-Transformation-Operators"><a href="#Advanced-Transformation-Operators" class="headerlink" title="Advanced Transformation Operators"></a>Advanced Transformation Operators</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedTransformations</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * concatMap vs flatMap - Ordering guarantee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">orderingGuarantees</span><span class="params">()</span> &#123;</span><br><span class="line">        Flux&lt;String&gt; ids = Flux.just(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// flatMap - no ordering guarantee (faster)</span></span><br><span class="line">        Flux&lt;String&gt; unordered = ids.flatMap(id -&gt; </span><br><span class="line">            asyncOperation(id).delayElement(Duration.ofMillis(randomDelay()))</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// concatMap - preserves order (slower but ordered)</span></span><br><span class="line">        Flux&lt;String&gt; ordered = ids.concatMap(id -&gt; </span><br><span class="line">            asyncOperation(id).delayElement(Duration.ofMillis(randomDelay()))</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Real-world: Processing messages with ordering requirement</span></span><br><span class="line">        Flux&lt;Message&gt; kafkaMessages = kafkaReceiver.receive();</span><br><span class="line">        kafkaMessages</span><br><span class="line">            .concatMap(msg -&gt; processMessage(msg)) <span class="comment">// Maintain message order</span></span><br><span class="line">            .subscribe();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * switchMap - Cancel previous emissions</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">switchMapOperator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Real-world: Search-as-you-type</span></span><br><span class="line">        Flux&lt;String&gt; searchTerms = keyPressEvents();</span><br><span class="line">        </span><br><span class="line">        Flux&lt;SearchResults&gt; results = searchTerms</span><br><span class="line">            .debounce(Duration.ofMillis(<span class="number">300</span>)) <span class="comment">// Wait for typing to stop</span></span><br><span class="line">            .switchMap(term -&gt; </span><br><span class="line">                searchService.search(term) <span class="comment">// Cancel previous search if new term arrives</span></span><br><span class="line">                    .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * groupBy - Group elements by key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">groupByOperator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Real-world: Group orders by customer</span></span><br><span class="line">        Flux&lt;Order&gt; orders = orderStream();</span><br><span class="line">        </span><br><span class="line">        Flux&lt;GroupedFlux&lt;String, Order&gt;&gt; byCustomer = orders</span><br><span class="line">            .groupBy(Order::getCustomerId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process each customer&#x27;s orders separately</span></span><br><span class="line">        byCustomer.flatMap(group -&gt; </span><br><span class="line">            group</span><br><span class="line">                .window(Duration.ofMinutes(<span class="number">5</span>)) <span class="comment">// Window by time</span></span><br><span class="line">                .flatMap(window -&gt; calculateCustomerStats(window))</span><br><span class="line">        ).subscribe();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Combination-Operators"><a href="#Combination-Operators" class="headerlink" title="Combination Operators"></a>Combination Operators</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CombinationOperators</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * zip - Combine multiple publishers</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">zipOperator</span><span class="params">()</span> &#123;</span><br><span class="line">        Mono&lt;User&gt; user = getUser(userId);</span><br><span class="line">        Mono&lt;Profile&gt; profile = getProfile(userId);</span><br><span class="line">        Mono&lt;Preferences&gt; prefs = getPreferences(userId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Wait for all to complete, then combine</span></span><br><span class="line">        Mono&lt;UserDashboard&gt; dashboard = Mono.zip(user, profile, prefs)</span><br><span class="line">            .map(tuple -&gt; &#123;</span><br><span class="line">                <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> tuple.getT1();</span><br><span class="line">                <span class="type">Profile</span> <span class="variable">p</span> <span class="operator">=</span> tuple.getT2();</span><br><span class="line">                <span class="type">Preferences</span> <span class="variable">pref</span> <span class="operator">=</span> tuple.getT3();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDashboard</span>(u, p, pref);</span><br><span class="line">            &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Real-world: Aggregate data from multiple microservices</span></span><br><span class="line">        Mono&lt;OrderDetails&gt; orderDetails = Mono.zip(</span><br><span class="line">            orderService.getOrder(orderId),</span><br><span class="line">            paymentService.getPayment(orderId),</span><br><span class="line">            shippingService.getTracking(orderId)</span><br><span class="line">        ).map(t -&gt; OrderDetails.aggregate(t.getT1(), t.getT2(), t.getT3()));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * merge vs concat - Parallel vs sequential combination</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mergeVsConcat</span><span class="params">()</span> &#123;</span><br><span class="line">        Flux&lt;String&gt; stream1 = Flux.just(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>).delayElements(Duration.ofMillis(<span class="number">100</span>));</span><br><span class="line">        Flux&lt;String&gt; stream2 = Flux.just(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>).delayElements(Duration.ofMillis(<span class="number">50</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// merge - interleaves as they arrive (faster)</span></span><br><span class="line">        Flux&lt;String&gt; merged = Flux.merge(stream1, stream2);</span><br><span class="line">        <span class="comment">// Possible output: 1, A, 2, B, 3, C</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// concat - waits for first to complete (ordered)</span></span><br><span class="line">        Flux&lt;String&gt; concatenated = Flux.concat(stream1, stream2);</span><br><span class="line">        <span class="comment">// Guaranteed output: A, B, C, 1, 2, 3</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * combineLatest - Combine latest from multiple streams</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">combineLatest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Real-world: Real-time dashboard with multiple data sources</span></span><br><span class="line">        Flux&lt;Double&gt; stockPrice = stockPriceStream();</span><br><span class="line">        Flux&lt;Double&gt; exchangeRate = exchangeRateStream();</span><br><span class="line">        Flux&lt;News&gt; newsFeed = newsStream();</span><br><span class="line">        </span><br><span class="line">        Flux&lt;Dashboard&gt; dashboard = Flux.combineLatest(</span><br><span class="line">            Arrays::asList,</span><br><span class="line">            stockPrice, exchangeRate, newsFeed</span><br><span class="line">        ).map(data -&gt; &#123;</span><br><span class="line">            <span class="type">Double</span> <span class="variable">price</span> <span class="operator">=</span> (Double) data[<span class="number">0</span>];</span><br><span class="line">            <span class="type">Double</span> <span class="variable">rate</span> <span class="operator">=</span> (Double) data[<span class="number">1</span>];</span><br><span class="line">            <span class="type">News</span> <span class="variable">news</span> <span class="operator">=</span> (News) data[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dashboard</span>(price, rate, news);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Error-Handling-Operators"><a href="#Error-Handling-Operators" class="headerlink" title="Error Handling Operators"></a>Error Handling Operators</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorHandlingOperators</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Comprehensive error handling strategies</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">errorHandling</span><span class="params">()</span> &#123;</span><br><span class="line">        Flux&lt;String&gt; dataStream = getDataStream();</span><br><span class="line">        </span><br><span class="line">        dataStream</span><br><span class="line">            <span class="comment">// 1. Timeout handling</span></span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">30</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. Retry with backoff</span></span><br><span class="line">            .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. Fallback values</span></span><br><span class="line">            .onErrorReturn(<span class="string">&quot;fallback-value&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. Fallback method</span></span><br><span class="line">            .onErrorResume(error -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (error <span class="keyword">instanceof</span> TimeoutException) &#123;</span><br><span class="line">                    <span class="keyword">return</span> getCachedData();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error <span class="keyword">instanceof</span> DatabaseException) &#123;</span><br><span class="line">                    <span class="keyword">return</span> getBackupData();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> Flux.error(error);</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. Log and continue</span></span><br><span class="line">            .doOnError(error -&gt; </span><br><span class="line">                log.error(<span class="string">&quot;Stream processing failed&quot;</span>, error)</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            .subscribe();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Circuit breaker pattern</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">circuitBreaker</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CircuitBreaker</span> <span class="variable">circuitBreaker</span> <span class="operator">=</span> CircuitBreaker.ofDefaults(<span class="string">&quot;backendService&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Flux&lt;String&gt; resilientStream = Flux.interval(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">            .flatMap(tick -&gt; </span><br><span class="line">                Mono.fromCallable(() -&gt; externalService.call())</span><br><span class="line">                    .transformDeferred(CircuitBreakerOperator.of(circuitBreaker))</span><br><span class="line">                    .onErrorResume(e -&gt; Mono.just(<span class="string">&quot;fallback&quot;</span>))</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Scheduling-Threading"><a href="#Scheduling-Threading" class="headerlink" title="Scheduling &amp; Threading"></a>Scheduling &amp; Threading</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SchedulingDeepDive</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Proper threading model for different operations</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">schedulingOperators</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// CPU-intensive work</span></span><br><span class="line">        Flux&lt;Integer&gt; cpuIntensive = Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">            .parallel() <span class="comment">// Process in parallel</span></span><br><span class="line">            .runOn(Schedulers.parallel())</span><br><span class="line">            .map(i -&gt; expensiveComputation(i))</span><br><span class="line">            .sequential();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// I/O intensive work</span></span><br><span class="line">        Flux&lt;String&gt; ioIntensive = Flux.just(<span class="string">&quot;id1&quot;</span>, <span class="string">&quot;id2&quot;</span>, <span class="string">&quot;id3&quot;</span>)</span><br><span class="line">            .flatMap(id -&gt; </span><br><span class="line">                Mono.fromCallable(() -&gt; database.query(id))</span><br><span class="line">                    .subscribeOn(Schedulers.boundedElastic()) <span class="comment">// Offload blocking I/O</span></span><br><span class="line">            );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Real-time processing with different schedulers</span></span><br><span class="line">        Flux.interval(Duration.ofMillis(<span class="number">10</span>))</span><br><span class="line">            .publishOn(Schedulers.single()) <span class="comment">// Dedicated thread for downstream</span></span><br><span class="line">            .map(tick -&gt; transformData(tick))</span><br><span class="line">            .publishOn(Schedulers.boundedElastic()) <span class="comment">// Switch threads for I/O</span></span><br><span class="line">            .flatMap(data -&gt; saveToDatabase(data))</span><br><span class="line">            .subscribeOn(Schedulers.parallel()) <span class="comment">// Where subscription happens</span></span><br><span class="line">            .subscribe();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Scheduler types and when to use them</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">schedulerTypes</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Schedulers.immediate() - Current thread</span></span><br><span class="line">        <span class="comment">// Schedulers.single() - Single dedicated thread</span></span><br><span class="line">        <span class="comment">// Schedulers.parallel() - Fixed pool for CPU work</span></span><br><span class="line">        <span class="comment">// Schedulers.boundedElastic() - For blocking I/O (preferred over elastic)</span></span><br><span class="line">        <span class="comment">// Schedulers.elastic() - Legacy, unlimited threads (avoid)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Advanced-Patterns-Real-World-Use-Cases"><a href="#Advanced-Patterns-Real-World-Use-Cases" class="headerlink" title="Advanced Patterns &amp; Real-World Use Cases"></a>Advanced Patterns &amp; Real-World Use Cases</h2><h3 id="Pattern-1-API-Gateway-with-Rate-Limiting"><a href="#Pattern-1-API-Gateway-with-Rate-Limiting" class="headerlink" title="Pattern 1: API Gateway with Rate Limiting"></a>Pattern 1: API Gateway with Rate Limiting</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiGatewayService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;ApiResponse&gt; <span class="title function_">handleConcurrentRequests</span><span class="params">(Flux&lt;ApiRequest&gt; requests)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> requests</span><br><span class="line">            .window(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// Window by time</span></span><br><span class="line">            .flatMap(window -&gt; </span><br><span class="line">                window</span><br><span class="line">                    .limitRate(<span class="number">100</span>) <span class="comment">// Limit to 100 requests per second</span></span><br><span class="line">                    .flatMap(<span class="built_in">this</span>::processRequest, <span class="number">10</span>) <span class="comment">// Max 10 concurrent</span></span><br><span class="line">            )</span><br><span class="line">            .onErrorResume(error -&gt; </span><br><span class="line">                Flux.just(ApiResponse.error(<span class="string">&quot;Service unavailable&quot;</span>))</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Mono&lt;ApiResponse&gt; <span class="title function_">processRequest</span><span class="params">(ApiRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.zip(</span><br><span class="line">            userService.validateToken(request.getToken()),</span><br><span class="line">            rateLimitService.checkLimit(request.getUserId())</span><br><span class="line">        )</span><br><span class="line">        .flatMap(tuple -&gt; routingService.routeRequest(request))</span><br><span class="line">        .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">        .retryWhen(Retry.fixedDelay(<span class="number">2</span>, Duration.ofMillis(<span class="number">100</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-2-Real-Time-Data-Pipeline"><a href="#Pattern-2-Real-Time-Data-Pipeline" class="headerlink" title="Pattern 2: Real-Time Data Pipeline"></a>Pattern 2: Real-Time Data Pipeline</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataPipeline</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;ProcessedData&gt; <span class="title function_">createPipeline</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kafkaSource.stream()</span><br><span class="line">            .groupBy(message -&gt; message.getPartitionKey()) <span class="comment">// Maintain ordering per key</span></span><br><span class="line">            .flatMap(partitionStream -&gt; </span><br><span class="line">                partitionStream</span><br><span class="line">                    .window(Duration.ofSeconds(<span class="number">5</span>)) <span class="comment">// Batch processing</span></span><br><span class="line">                    .flatMap(<span class="built_in">this</span>::processBatch)</span><br><span class="line">                    .flatMap(<span class="built_in">this</span>::enrichWithExternalData)</span><br><span class="line">                    .flatMap(<span class="built_in">this</span>::validateAndTransform)</span><br><span class="line">                    .buffer(<span class="number">100</span>) <span class="comment">// Buffer for bulk insert</span></span><br><span class="line">                    .flatMap(<span class="built_in">this</span>::bulkInsertToDatabase)</span><br><span class="line">            , <span class="number">32</span>) <span class="comment">// Process 32 partitions concurrently</span></span><br><span class="line">            .metrics() <span class="comment">// Monitor performance</span></span><br><span class="line">            .doOnNext(metrics::recordProcessingTime);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Mono&lt;ProcessedData&gt; <span class="title function_">processBatch</span><span class="params">(Flux&lt;Message&gt; batch)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> batch</span><br><span class="line">            .collectList()</span><br><span class="line">            .flatMap(list -&gt; </span><br><span class="line">                Mono.fromCallable(() -&gt; sparkService.processBatch(list))</span><br><span class="line">                    .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-3-Resilient-Service-Composition"><a href="#Pattern-3-Resilient-Service-Composition" class="headerlink" title="Pattern 3: Resilient Service Composition"></a>Pattern 3: Resilient Service Composition</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResilientServiceComposition</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;OrderResult&gt; <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> validateOrder(order)</span><br><span class="line">            .flatMap(validated -&gt; </span><br><span class="line">                Mono.zip(</span><br><span class="line">                    reserveInventory(validated).onErrorReturn(InventoryReservation.failed()),</span><br><span class="line">                    processPayment(validated).onErrorReturn(PaymentResult.failed()),</span><br><span class="line">                    updateShipping(validated).onErrorReturn(ShippingUpdate.failed())</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            .map(tuple -&gt; &#123;</span><br><span class="line">                <span class="comment">// Compose final result from partial successes/failures</span></span><br><span class="line">                <span class="keyword">return</span> OrderResult.fromComponents(</span><br><span class="line">                    tuple.getT1(), </span><br><span class="line">                    tuple.getT2(), </span><br><span class="line">                    tuple.getT3()</span><br><span class="line">                );</span><br><span class="line">            &#125;)</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">30</span>))</span><br><span class="line">            .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Performance-Best-Practices"><a href="#Performance-Best-Practices" class="headerlink" title="Performance Best Practices"></a>Performance Best Practices</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceBestPractices</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. Avoid blocking in reactive chains</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">badExample</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">            .map(i -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> blockingDatabaseCall(i); <span class="comment">// ‚ùå BLOCKING!</span></span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">goodExample</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">            .flatMap(i -&gt; </span><br><span class="line">                Mono.fromCallable(() -&gt; blockingDatabaseCall(i))</span><br><span class="line">                    .subscribeOn(Schedulers.boundedElastic()) <span class="comment">// ‚úÖ Correct</span></span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. Use backpressure properly</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Data&gt; <span class="title function_">handleBackpressure</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fastProducer()</span><br><span class="line">            .onBackpressureBuffer(<span class="number">1000</span>) <span class="comment">// Buffer up to 1000 elements</span></span><br><span class="line">            .onBackpressureDrop(dropped -&gt; log.warn(<span class="string">&quot;Dropped: &#123;&#125;&quot;</span>, dropped))</span><br><span class="line">            .concatMap(<span class="built_in">this</span>::slowConsumer, <span class="number">5</span>); <span class="comment">// Control concurrency</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. Monitor and tune</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monitoring</span><span class="params">()</span> &#123;</span><br><span class="line">        Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">            .name(<span class="string">&quot;processing.pipeline&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;batch&quot;</span>)</span><br><span class="line">            .metrics()</span><br><span class="line">            .doOnNext(item -&gt; </span><br><span class="line">                Metrics.counter(<span class="string">&quot;items.processed&quot;</span>).increment()</span><br><span class="line">            )</span><br><span class="line">            .subscribe();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/10/22/Hexo-and-NexT-Theme/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/10/22/Hexo-and-NexT-Theme/" class="post-title-link" itemprop="url">Hexo and NexT Theme</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-10-22 14:38:42" itemprop="dateCreated datePublished" datetime="2025-10-22T14:38:42-04:00">2025-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-11-21 16:23:35" itemprop="dateModified" datetime="2025-11-21T16:23:35-05:00">2025-11-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-ÂÆâË£Ö-NexT-‰∏ªÈ¢ò"><a href="#1-ÂÆâË£Ö-NexT-‰∏ªÈ¢ò" class="headerlink" title="1. ÂÆâË£Ö NexT ‰∏ªÈ¢ò"></a>1. ÂÆâË£Ö NexT ‰∏ªÈ¢ò</h2><h3 id="ÊñπÊ≥ï‰∏ÄÔºö‰ΩøÁî®-GitÔºàÊé®ËçêÔºâ"><a href="#ÊñπÊ≥ï‰∏ÄÔºö‰ΩøÁî®-GitÔºàÊé®ËçêÔºâ" class="headerlink" title="ÊñπÊ≥ï‰∏ÄÔºö‰ΩøÁî® GitÔºàÊé®ËçêÔºâ"></a>ÊñπÊ≥ï‰∏ÄÔºö‰ΩøÁî® GitÔºàÊé®ËçêÔºâ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ËøõÂÖ•‰Ω†ÁöÑ Hexo Á´ôÁÇπÁõÆÂΩï</span></span><br><span class="line"><span class="built_in">cd</span> your-hexo-site</span><br><span class="line"></span><br><span class="line"><span class="comment"># ÂÖãÈöÜ NexT ‰∏ªÈ¢òÂà∞ themes/next ÁõÆÂΩï</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<h3 id="ÊñπÊ≥ï‰∫åÔºö‰ΩøÁî®-npm"><a href="#ÊñπÊ≥ï‰∫åÔºö‰ΩøÁî®-npm" class="headerlink" title="ÊñπÊ≥ï‰∫åÔºö‰ΩøÁî® npm"></a>ÊñπÊ≥ï‰∫åÔºö‰ΩøÁî® npm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ‰ΩøÁî® npm ÂÆâË£Ö</span></span><br><span class="line">npm install hexo-theme-next</span><br></pre></td></tr></table></figure>

<h2 id="2-ÂêØÁî®-NexT-‰∏ªÈ¢ò"><a href="#2-ÂêØÁî®-NexT-‰∏ªÈ¢ò" class="headerlink" title="2. ÂêØÁî® NexT ‰∏ªÈ¢ò"></a>2. ÂêØÁî® NexT ‰∏ªÈ¢ò</h2><h3 id="2-1-‰øÆÊîπ‰∏ªÈÖçÁΩÆÊñá‰ª∂-config-yml"><a href="#2-1-‰øÆÊîπ‰∏ªÈÖçÁΩÆÊñá‰ª∂-config-yml" class="headerlink" title="2.1 ‰øÆÊîπ‰∏ªÈÖçÁΩÆÊñá‰ª∂ _config.yml"></a>2.1 ‰øÆÊîπ‰∏ªÈÖçÁΩÆÊñá‰ª∂ <code>_config.yml</code></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Á´ôÁÇπÈÖçÁΩÆ</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">‰Ω†ÁöÑÁΩëÁ´ôÊ†áÈ¢ò</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">ÁΩëÁ´ôÂâØÊ†áÈ¢ò</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">ÁΩëÁ´ôÊèèËø∞</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="string">ÂÖ≥ÈîÆËØç1,</span> <span class="string">ÂÖ≥ÈîÆËØç2</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">‰Ω†ÁöÑÂêçÂ≠ó</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://yourusername.github.io</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"><span class="attr">pretty_urls:</span></span><br><span class="line">  <span class="attr">trailing_index:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">trailing_html:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ÁõÆÂΩïÈÖçÁΩÆ</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></span><br><span class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span></span><br><span class="line"><span class="attr">skip_render:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ‰∏ªÈ¢òÈÖçÁΩÆ</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br></pre></td></tr></table></figure>

<h2 id="3-È™åËØÅ‰∏ªÈ¢òÂÆâË£Ö"><a href="#3-È™åËØÅ‰∏ªÈ¢òÂÆâË£Ö" class="headerlink" title="3. È™åËØÅ‰∏ªÈ¢òÂÆâË£Ö"></a>3. È™åËØÅ‰∏ªÈ¢òÂÆâË£Ö</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ê∏ÖÁêÜÂπ∂ÈáçÊñ∞ÁîüÊàê</span></span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># ÁîüÊàêÈùôÊÄÅÊñá‰ª∂</span></span><br><span class="line">hexo generate</span><br><span class="line"></span><br><span class="line"><span class="comment"># ÂêØÂä®Êú¨Âú∞ÊúçÂä°Âô®È¢ÑËßà</span></span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>

<p>ËÆøÈóÆ <code>http://localhost:4000</code> Êü•Áúã‰∏ªÈ¢òÊïàÊûú„ÄÇ</p>
<h2 id="4-NexT-‰∏ªÈ¢òÈÖçÁΩÆ"><a href="#4-NexT-‰∏ªÈ¢òÈÖçÁΩÆ" class="headerlink" title="4. NexT ‰∏ªÈ¢òÈÖçÁΩÆ"></a>4. NexT ‰∏ªÈ¢òÈÖçÁΩÆ</h2><h3 id="4-1-‰∫ÜËß£ÈÖçÁΩÆÊñá‰ª∂ÁªìÊûÑ"><a href="#4-1-‰∫ÜËß£ÈÖçÁΩÆÊñá‰ª∂ÁªìÊûÑ" class="headerlink" title="4.1 ‰∫ÜËß£ÈÖçÁΩÆÊñá‰ª∂ÁªìÊûÑ"></a>4.1 ‰∫ÜËß£ÈÖçÁΩÆÊñá‰ª∂ÁªìÊûÑ</h3><p>NexT Êúâ‰∏§‰∏™‰∏ªË¶ÅÈÖçÁΩÆÊñá‰ª∂Ôºö</p>
<ul>
<li><strong>‰∏ªÈÖçÁΩÆÊñá‰ª∂</strong>: <code>_config.yml</code> (Hexo Ê†πÁõÆÂΩï)</li>
<li><strong>‰∏ªÈ¢òÈÖçÁΩÆÊñá‰ª∂</strong>: <code>themes/next/_config.yml</code></li>
</ul>
<h3 id="4-2-ÈÖçÁΩÆ‰∏ªÈ¢òÊñπÊ°à"><a href="#4-2-ÈÖçÁΩÆ‰∏ªÈ¢òÊñπÊ°à" class="headerlink" title="4.2 ÈÖçÁΩÆ‰∏ªÈ¢òÊñπÊ°à"></a>4.2 ÈÖçÁΩÆ‰∏ªÈ¢òÊñπÊ°à</h3><p>NexT Êèê‰æõÂõõÁßç‰∏ªÈ¢òÊñπÊ°àÔºåÂú® <code>themes/next/_config.yml</code> ‰∏≠Ôºö</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Schemes</span></span><br><span class="line"><span class="comment"># scheme: Muse</span></span><br><span class="line"><span class="comment"># scheme: Mist</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">Gemini</span></span><br><span class="line"><span class="comment"># scheme: Pisces</span></span><br></pre></td></tr></table></figure>

<p>ÂèñÊ∂àÊ≥®Èáä‰Ω†ÂñúÊ¨¢ÁöÑÊñπÊ°à„ÄÇ</p>
<h3 id="4-3-Âü∫Êú¨Â§ñËßÇÈÖçÁΩÆ"><a href="#4-3-Âü∫Êú¨Â§ñËßÇÈÖçÁΩÆ" class="headerlink" title="4.3 Âü∫Êú¨Â§ñËßÇÈÖçÁΩÆ"></a>4.3 Âü∫Êú¨Â§ñËßÇÈÖçÁΩÆ</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Âú® themes/next/_config.yml ‰∏≠</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ÁΩëÁ´ôÂõæÊ†á</span></span><br><span class="line"><span class="attr">favicon:</span></span><br><span class="line">  <span class="attr">small:</span> <span class="string">/images/favicon-16x16-next.png</span></span><br><span class="line">  <span class="attr">medium:</span> <span class="string">/images/favicon-32x32-next.png</span></span><br><span class="line">  <span class="attr">apple_touch_icon:</span> <span class="string">/images/apple-touch-icon-next.png</span></span><br><span class="line">  <span class="attr">safari_pinned_tab:</span> <span class="string">/images/logo.svg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ÁΩëÁ´ôÂæΩÊ†á</span></span><br><span class="line"><span class="attr">logo:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">/images/logo.svg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ËèúÂçïÈÖçÁΩÆ</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-user</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="comment"># schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line">  <span class="comment"># sitemap: /sitemap/ || fa fa-sitemap</span></span><br><span class="line">  <span class="comment"># commonweal: /404/ || fa fa-heartbeat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Á§æ‰∫§ÈìæÊé•</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">GitHub:</span> <span class="string">https://github.com/yourusername</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">  <span class="attr">E-Mail:</span> <span class="string">mailto:your-email@example.com</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-envelope</span></span><br><span class="line">  <span class="comment"># Weibo: https://weibo.com/yourusername || fab fa-weibo</span></span><br><span class="line">  <span class="comment"># Twitter: https://twitter.com/yourusername || fab fa-twitter</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ‰æßËæπÊ†èËÆæÁΩÆ</span></span><br><span class="line"><span class="attr">sidebar:</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">left</span></span><br><span class="line">  <span class="attr">display:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">offset:</span> <span class="number">12</span></span><br><span class="line">  <span class="attr">b2t:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">scrollpercent:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Â§¥ÂÉèËÆæÁΩÆ</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">/images/avatar.png</span></span><br><span class="line">  <span class="attr">rounded:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">rotated:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="5-ÂàõÂª∫ÂøÖË¶ÅÁöÑÈ°µÈù¢"><a href="#5-ÂàõÂª∫ÂøÖË¶ÅÁöÑÈ°µÈù¢" class="headerlink" title="5. ÂàõÂª∫ÂøÖË¶ÅÁöÑÈ°µÈù¢"></a>5. ÂàõÂª∫ÂøÖË¶ÅÁöÑÈ°µÈù¢</h2><h3 id="5-1-ÂàõÂª∫ÂÖ≥‰∫éÈ°µÈù¢"><a href="#5-1-ÂàõÂª∫ÂÖ≥‰∫éÈ°µÈù¢" class="headerlink" title="5.1 ÂàõÂª∫ÂÖ≥‰∫éÈ°µÈù¢"></a>5.1 ÂàõÂª∫ÂÖ≥‰∫éÈ°µÈù¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page about</span><br></pre></td></tr></table></figure>

<p>ÁºñËæë <code>source/about/index.md</code>Ôºö</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: ÂÖ≥‰∫éÊàë</span><br><span class="line">date: 2024-01-01 00:00:00</span><br><span class="line"><span class="section">type: about</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line">ËøôÈáåÂÜôÂÖ≥‰∫éÊàëÁöÑÂÜÖÂÆπ...</span><br></pre></td></tr></table></figure>

<h3 id="5-2-ÂàõÂª∫Ê†áÁ≠æÈ°µÈù¢"><a href="#5-2-ÂàõÂª∫Ê†áÁ≠æÈ°µÈù¢" class="headerlink" title="5.2 ÂàõÂª∫Ê†áÁ≠æÈ°µÈù¢"></a>5.2 ÂàõÂª∫Ê†áÁ≠æÈ°µÈù¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure>

<p>ÁºñËæë <code>source/tags/index.md</code>Ôºö</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Ê†áÁ≠æ</span><br><span class="line">date: 2024-01-01 00:00:00</span><br><span class="line"><span class="section">type: tags</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-ÂàõÂª∫ÂàÜÁ±ªÈ°µÈù¢"><a href="#5-3-ÂàõÂª∫ÂàÜÁ±ªÈ°µÈù¢" class="headerlink" title="5.3 ÂàõÂª∫ÂàÜÁ±ªÈ°µÈù¢"></a>5.3 ÂàõÂª∫ÂàÜÁ±ªÈ°µÈù¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page categories</span><br></pre></td></tr></table></figure>

<p>ÁºñËæë <code>source/categories/index.md</code>Ôºö</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: ÂàÜÁ±ª</span><br><span class="line">date: 2024-01-01 00:00:00</span><br><span class="line"><span class="section">type: categories</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>

<h2 id="6-È´òÁ∫ßÂäüËÉΩÈÖçÁΩÆ"><a href="#6-È´òÁ∫ßÂäüËÉΩÈÖçÁΩÆ" class="headerlink" title="6. È´òÁ∫ßÂäüËÉΩÈÖçÁΩÆ"></a>6. È´òÁ∫ßÂäüËÉΩÈÖçÁΩÆ</h2><h3 id="6-1-‰ª£Á†ÅÈ´ò‰∫Æ"><a href="#6-1-‰ª£Á†ÅÈ´ò‰∫Æ" class="headerlink" title="6.1 ‰ª£Á†ÅÈ´ò‰∫Æ"></a>6.1 ‰ª£Á†ÅÈ´ò‰∫Æ</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Âú® themes/next/_config.yml ‰∏≠</span></span><br><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="comment"># ‰ª£Á†ÅÂùó‰∏ªÈ¢ò</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">darker</span></span><br><span class="line">  <span class="attr">prism:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">prism</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">prism-dark</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">show_result:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">style:</span> <span class="string">flat</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-ÈòÖËØªËøõÂ∫¶"><a href="#6-2-ÈòÖËØªËøõÂ∫¶" class="headerlink" title="6.2 ÈòÖËØªËøõÂ∫¶"></a>6.2 ÈòÖËØªËøõÂ∫¶</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ÈòÖËØªËøõÂ∫¶Êù°</span></span><br><span class="line"><span class="attr">reading_progress:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;#37c6c0&quot;</span></span><br><span class="line">  <span class="attr">height:</span> <span class="string">3px</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-Êï∞Â≠¶ÂÖ¨ÂºèÊîØÊåÅ"><a href="#6-3-Êï∞Â≠¶ÂÖ¨ÂºèÊîØÊåÅ" class="headerlink" title="6.3 Êï∞Â≠¶ÂÖ¨ÂºèÊîØÊåÅ"></a>6.3 Êï∞Â≠¶ÂÖ¨ÂºèÊîØÊåÅ</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Math Formulas Render Support</span></span><br><span class="line"><span class="attr">math:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mathjax:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Available values: none | ams | all</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="string">none</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">katex:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">copy_tex:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-ËØÑËÆ∫Á≥ªÁªü"><a href="#6-4-ËØÑËÆ∫Á≥ªÁªü" class="headerlink" title="6.4 ËØÑËÆ∫Á≥ªÁªü"></a>6.4 ËØÑËÆ∫Á≥ªÁªü</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Â§öÁßçËØÑËÆ∫Á≥ªÁªüÂèØÈÄâ</span></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="comment"># ÂèØÁî®ÁöÑÂÄº: utterances | giscus | disqus | disqusjs | changyan | livere | remark42 | valine</span></span><br><span class="line">  <span class="comment"># ÈÄâÊã©‰∏ÄÁßçÂêØÁî®</span></span><br><span class="line">  <span class="attr">provider:</span> <span class="string">utterances</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Utterances ÈÖçÁΩÆ</span></span><br><span class="line"><span class="attr">utterances:</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">yourusername/your-repo</span>  <span class="comment"># ‰Ω†ÁöÑ GitHub ‰ªìÂ∫ì</span></span><br><span class="line">  <span class="attr">issue_term:</span> <span class="string">pathname</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">utterances</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">github-light</span></span><br></pre></td></tr></table></figure>

<h3 id="6-5-ÊêúÁ¥¢ÂäüËÉΩ"><a href="#6-5-ÊêúÁ¥¢ÂäüËÉΩ" class="headerlink" title="6.5 ÊêúÁ¥¢ÂäüËÉΩ"></a>6.5 ÊêúÁ¥¢ÂäüËÉΩ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ÂÆâË£ÖÊêúÁ¥¢Êèí‰ª∂</span></span><br><span class="line">npm install hexo-generator-searchdb</span><br></pre></td></tr></table></figure>

<p>Âú® Hexo ‰∏ªÈÖçÁΩÆÊñá‰ª∂‰∏≠Ê∑ªÂä†Ôºö</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ÊêúÁ¥¢ÈÖçÁΩÆ</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">content:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br></pre></td></tr></table></figure>

<p>Âú®‰∏ªÈ¢òÈÖçÁΩÆ‰∏≠ÂêØÁî®Ôºö</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Local Search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">unescape:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">preload:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="7-Ëá™ÂÆö‰πâÊ†∑ÂºèÂíåÂ∏ÉÂ±Ä"><a href="#7-Ëá™ÂÆö‰πâÊ†∑ÂºèÂíåÂ∏ÉÂ±Ä" class="headerlink" title="7. Ëá™ÂÆö‰πâÊ†∑ÂºèÂíåÂ∏ÉÂ±Ä"></a>7. Ëá™ÂÆö‰πâÊ†∑ÂºèÂíåÂ∏ÉÂ±Ä</h2><h3 id="7-1-Ëá™ÂÆö‰πâ-CSS"><a href="#7-1-Ëá™ÂÆö‰πâ-CSS" class="headerlink" title="7.1 Ëá™ÂÆö‰πâ CSS"></a>7.1 Ëá™ÂÆö‰πâ CSS</h3><p>ÂàõÂª∫ <code>source/_data/styles.styl</code>Ôºö</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ëá™ÂÆö‰πâÊ†∑Âºè</span></span><br><span class="line"><span class="comment">// ÁΩëÁ´ôËÉåÊôØ</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f7f9fa</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ÊñáÁ´†Ê†∑Âºè</span></span><br><span class="line"><span class="selector-class">.post-block</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ÈìæÊé•È¢úËâ≤</span></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3498db</span>;</span><br><span class="line">  <span class="selector-pseudo">&amp;:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#2980b9</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Âú®‰∏ªÈ¢òÈÖçÁΩÆ‰∏≠ÂêØÁî®Ëá™ÂÆö‰πâÊ†∑ÂºèÔºö</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-Ëá™ÂÆö‰πâÈ°µÈù¢Â∏ÉÂ±Ä"><a href="#7-2-Ëá™ÂÆö‰πâÈ°µÈù¢Â∏ÉÂ±Ä" class="headerlink" title="7.2 Ëá™ÂÆö‰πâÈ°µÈù¢Â∏ÉÂ±Ä"></a>7.2 Ëá™ÂÆö‰πâÈ°µÈù¢Â∏ÉÂ±Ä</h3><p>ÂàõÂª∫Ëá™ÂÆö‰πâÂ∏ÉÂ±ÄÊñá‰ª∂ <code>themes/next/layout/_custom/custom-layout.swig</code>Ôºö</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;_layout.swig&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;custom-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; page.title &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;custom-content&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; page.content &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-‰ºòÂåñÂíåÈÉ®ÁΩ≤"><a href="#8-‰ºòÂåñÂíåÈÉ®ÁΩ≤" class="headerlink" title="8. ‰ºòÂåñÂíåÈÉ®ÁΩ≤"></a>8. ‰ºòÂåñÂíåÈÉ®ÁΩ≤</h2><h3 id="8-1-ÂÆâË£ÖÂøÖË¶ÅÊèí‰ª∂"><a href="#8-1-ÂÆâË£ÖÂøÖË¶ÅÊèí‰ª∂" class="headerlink" title="8.1 ÂÆâË£ÖÂøÖË¶ÅÊèí‰ª∂"></a>8.1 ÂÆâË£ÖÂøÖË¶ÅÊèí‰ª∂</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ÂÆâË£ÖÂ∏∏Áî®Êèí‰ª∂</span></span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">npm install hexo-generator-sitemap --save</span><br><span class="line">npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure>

<h3 id="8-2-ÈÉ®ÁΩ≤ÈÖçÁΩÆ"><a href="#8-2-ÈÉ®ÁΩ≤ÈÖçÁΩÆ" class="headerlink" title="8.2 ÈÉ®ÁΩ≤ÈÖçÁΩÆ"></a>8.2 ÈÉ®ÁΩ≤ÈÖçÁΩÆ</h3><p>Âú® Hexo ‰∏ªÈÖçÁΩÆÊñá‰ª∂‰∏≠Ê∑ªÂä†Ôºö</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ÈÉ®ÁΩ≤ÈÖçÁΩÆ</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/yourusername/yourusername.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">&quot;Site updated: <span class="template-variable">&#123;&#123; now(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-ÈÉ®ÁΩ≤ÂëΩ‰ª§"><a href="#8-3-ÈÉ®ÁΩ≤ÂëΩ‰ª§" class="headerlink" title="8.3 ÈÉ®ÁΩ≤ÂëΩ‰ª§"></a>8.3 ÈÉ®ÁΩ≤ÂëΩ‰ª§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ê∏ÖÁêÜ„ÄÅÁîüÊàê„ÄÅÈÉ®ÁΩ≤</span></span><br><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ÊàñËÄÖ‰ΩøÁî®ÁÆÄÂÜô</span></span><br><span class="line">hexo clean &amp;&amp; hexo g -d</span><br></pre></td></tr></table></figure>

<h2 id="9-ÊïÖÈöúÊéíÈô§"><a href="#9-ÊïÖÈöúÊéíÈô§" class="headerlink" title="9. ÊïÖÈöúÊéíÈô§"></a>9. ÊïÖÈöúÊéíÈô§</h2><h3 id="9-1-Â∏∏ËßÅÈóÆÈ¢ò"><a href="#9-1-Â∏∏ËßÅÈóÆÈ¢ò" class="headerlink" title="9.1 Â∏∏ËßÅÈóÆÈ¢ò"></a>9.1 Â∏∏ËßÅÈóÆÈ¢ò</h3><ol>
<li><p><strong>‰∏ªÈ¢ò‰∏çÁîüÊïà</strong>Ôºö</p>
<ul>
<li>Ê£ÄÊü• <code>theme: next</code> ÈÖçÁΩÆ</li>
<li>ËøêË°å <code>hexo clean</code></li>
</ul>
</li>
<li><p><strong>È°µÈù¢ 404</strong>Ôºö</p>
<ul>
<li>Ê£ÄÊü•ËèúÂçïÈÖçÁΩÆÁöÑË∑ØÂæÑ</li>
<li>Á°ÆËÆ§È°µÈù¢Â∑≤ÂàõÂª∫</li>
</ul>
</li>
<li><p><strong>Ê†∑ÂºèÂºÇÂ∏∏</strong>Ôºö</p>
<ul>
<li>Ê£ÄÊü•Ëá™ÂÆö‰πâ CSS ËØ≠Ê≥ï</li>
<li>Á°ÆËÆ§Â≠ó‰ΩìÊñá‰ª∂Ë∑ØÂæÑ</li>
</ul>
</li>
</ol>
<h3 id="9-2-Ë∞ÉËØïÊäÄÂ∑ß"><a href="#9-2-Ë∞ÉËØïÊäÄÂ∑ß" class="headerlink" title="9.2 Ë∞ÉËØïÊäÄÂ∑ß"></a>9.2 Ë∞ÉËØïÊäÄÂ∑ß</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ËØ¶ÁªÜË∞ÉËØï‰ø°ÊÅØ</span></span><br><span class="line">hexo generate --debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ê£ÄÊü•ÈÖçÁΩÆ</span></span><br><span class="line">hexo config</span><br></pre></td></tr></table></figure>

<h2 id="10-ÊúÄ‰Ω≥ÂÆûË∑µ"><a href="#10-ÊúÄ‰Ω≥ÂÆûË∑µ" class="headerlink" title="10. ÊúÄ‰Ω≥ÂÆûË∑µ"></a>10. ÊúÄ‰Ω≥ÂÆûË∑µ</h2><ol>
<li><strong>ÁâàÊú¨ÊéßÂà∂</strong>ÔºöÂ∞ÜÊï¥‰∏™ Hexo È°πÁõÆÊé®ÈÄÅÂà∞‰∏Ä‰∏™ÂçïÁã¨ÁöÑ‰ªìÂ∫ì</li>
<li><strong>Â§á‰ªΩÈÖçÁΩÆ</strong>ÔºöÂÆöÊúüÂ§á‰ªΩ‰∏ªÈ¢òÈÖçÁΩÆÊñá‰ª∂</li>
<li><strong>Ê∏êËøõÂºèÈÖçÁΩÆ</strong>Ôºö‰∏ÄÊ¨°Âè™‰øÆÊîπ‰∏Ä‰∏™ÂäüËÉΩÔºåÊµãËØïÂêéÂÜçÁªßÁª≠</li>
<li><strong>‰ΩøÁî® CDN</strong>ÔºöÂØπ‰∫éÈùôÊÄÅËµÑÊ∫ê‰ΩøÁî® CDN Âä†ÈÄü</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
