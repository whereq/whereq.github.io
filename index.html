<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="WhereQ">
<meta property="og:url" content="https://www.whereq.com/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Dazhi Zhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">WhereQ</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/28/Deep-Dive-into-Spring-Scheduler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/28/Deep-Dive-into-Spring-Scheduler/" class="post-title-link" itemprop="url">Deep Dive into Spring Scheduler</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-28 16:20:09 / Modified: 16:21:26" itemprop="dateCreated datePublished" datetime="2024-10-28T16:20:09-04:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Spring-Boot/Spring-Scheduler/" itemprop="url" rel="index"><span itemprop="name">Spring Scheduler</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#understanding-spring-scheduler-basics">Understanding Spring Scheduler Basics</a><ul>
<li><a href="#enabling-scheduling">Enabling Scheduling</a></li>
<li><a href="#simple-scheduling-with-scheduled">Simple Scheduling with <code>@Scheduled</code></a></li>
</ul>
</li>
<li><a href="#scheduling-scenarios">Scheduling Scenarios</a><ul>
<li><a href="#sequential-job-execution">Sequential Job Execution</a></li>
<li><a href="#parallel-job-execution">Parallel Job Execution</a></li>
<li><a href="#job-waiting-until-previous-job-completes">Job Waiting Until Previous Job Completes</a></li>
</ul>
</li>
<li><a href="#cron-expressions-and-fixed-rates">Cron Expressions and Fixed Rates</a><ul>
<li><a href="#fixed-rate-vs-fixed-delay">Fixed Rate vs Fixed Delay</a></li>
<li><a href="#using-cron-expressions">Using Cron Expressions</a></li>
</ul>
</li>
<li><a href="#conditional-scheduling-with-annotations">Conditional Scheduling with Annotations</a><ul>
<li><a href="#conditional-scheduling-example">Conditional Scheduling Example</a></li>
</ul>
</li>
<li><a href="#real-world-production-sample-code">Real-World Production Sample Code</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><strong>Spring Scheduler</strong> provides a simple way to schedule tasks within a Spring application. It offers flexibility in managing <strong>time-based events</strong> and <strong>task execution</strong>, allowing developers to configure tasks in a variety of ways, including sequential, parallel, and conditional execution.</p>
<hr>
<p><a name="understanding-spring-scheduler-basics"></a></p>
<h2 id="Understanding-Spring-Scheduler-Basics"><a href="#Understanding-Spring-Scheduler-Basics" class="headerlink" title="Understanding Spring Scheduler Basics"></a>Understanding Spring Scheduler Basics</h2><p>Spring Scheduler uses annotations to simplify the scheduling of methods within beans. The primary annotation used is <code>@Scheduled</code>, which can define various timing configurations, such as fixed rate, fixed delay, and cron expressions.</p>
<p><a name="enabling-scheduling"></a></p>
<h3 id="Enabling-Scheduling"><a href="#Enabling-Scheduling" class="headerlink" title="Enabling Scheduling"></a>Enabling Scheduling</h3><p>Before defining tasks, enable scheduling in your Spring application by adding the <code>@EnableScheduling</code> annotation.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SchedulingConfig</span> &#123;</span><br><span class="line">    <span class="comment">// Any other scheduling-related configuration if needed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="simple-scheduling-with-scheduled"></a></p>
<h3 id="Simple-Scheduling-with-Scheduled"><a href="#Simple-Scheduling-with-Scheduled" class="headerlink" title="Simple Scheduling with @Scheduled"></a>Simple Scheduling with <code>@Scheduled</code></h3><p>The <code>@Scheduled</code> annotation can be applied to any method to enable scheduling. Below is a simple example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleScheduler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This message prints every 5 seconds.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, <code>printMessage()</code> runs every 5 seconds.</p>
<hr>
<p><a name="scheduling-scenarios"></a></p>
<h2 id="Scheduling-Scenarios"><a href="#Scheduling-Scenarios" class="headerlink" title="Scheduling Scenarios"></a>Scheduling Scenarios</h2><p>Spring Scheduler supports various scenarios for task scheduling, which can be useful for specific use cases in a production environment.</p>
<p><a name="sequential-job-execution"></a></p>
<h3 id="Sequential-Job-Execution"><a href="#Sequential-Job-Execution" class="headerlink" title="Sequential Job Execution"></a>Sequential Job Execution</h3><p>In sequential execution, jobs run in a specific order, with each job waiting for the previous one to complete before starting.</p>
<p><strong>Example: Sequential Scheduling Using Fixed Delay</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SequentialScheduler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 10000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">job1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Job 1 started.&quot;</span>);</span><br><span class="line">        <span class="comment">// simulate a delay</span></span><br><span class="line">        <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">2000</span>); &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Job 1 completed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 10000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">job2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Job 2 started after Job 1.&quot;</span>);</span><br><span class="line">        <span class="comment">// simulate a delay</span></span><br><span class="line">        <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">3000</span>); &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Job 2 completed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With <code>fixedDelay</code>, Job 2 only begins after Job 1 completes.</p>
<p><a name="parallel-job-execution"></a></p>
<h3 id="Parallel-Job-Execution"><a href="#Parallel-Job-Execution" class="headerlink" title="Parallel Job Execution"></a>Parallel Job Execution</h3><p>To execute jobs in parallel, we configure a task executor that runs multiple tasks concurrently.</p>
<p><strong>Example: Parallel Scheduling Using a Custom Task Executor</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelSchedulingConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title function_">taskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">2</span>); <span class="comment">// Number of concurrent tasks allowed</span></span><br><span class="line">        executor.setMaxPoolSize(<span class="number">5</span>);</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelScheduler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 10000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">jobA</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Parallel Job A started.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 10000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">jobB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Parallel Job B started concurrently with Job A.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With <code>@Async</code>, <code>jobA</code> and <code>jobB</code> run concurrently, allowing for parallel execution.</p>
<p><a name="job-waiting-until-previous-job-completes"></a></p>
<h3 id="Job-Waiting-Until-Previous-Job-Completes"><a href="#Job-Waiting-Until-Previous-Job-Completes" class="headerlink" title="Job Waiting Until Previous Job Completes"></a>Job Waiting Until Previous Job Completes</h3><p>To configure jobs to wait for previous jobs to finish, use <code>fixedDelay</code> with asynchronous methods to ensure that each task waits until its predecessor is completed.</p>
<p><strong>Diagram: Job Waiting until Previous Job Completes</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Job 1   ---&gt; Wait ---&gt;   Job 2   ---&gt; Wait ---&gt;   Job 3</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WaitingScheduler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 12000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">job</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Job started and waits until the previous instance completes.&quot;</span>);</span><br><span class="line">        <span class="comment">// Simulate processing time</span></span><br><span class="line">        <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">5000</span>); &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Job completed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this scenario, each new execution waits until the previous one finishes.</p>
<hr>
<p><a name="cron-expressions-and-fixed-rates"></a></p>
<h2 id="Cron-Expressions-and-Fixed-Rates"><a href="#Cron-Expressions-and-Fixed-Rates" class="headerlink" title="Cron Expressions and Fixed Rates"></a>Cron Expressions and Fixed Rates</h2><p>Spring Scheduler allows defining precise timing patterns using <strong>fixed rate</strong>, <strong>fixed delay</strong>, and <strong>cron expressions</strong>.</p>
<p><a name="fixed-rate-vs-fixed-delay"></a></p>
<h3 id="Fixed-Rate-vs-Fixed-Delay"><a href="#Fixed-Rate-vs-Fixed-Delay" class="headerlink" title="Fixed Rate vs Fixed Delay"></a>Fixed Rate vs Fixed Delay</h3><ul>
<li><strong>Fixed Rate</strong>: Executes a task at a specified interval, regardless of task completion time.</li>
<li><strong>Fixed Delay</strong>: Executes a task with a delay between the end of the previous execution and the start of the next.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(fixedRate = 60000)</span> <span class="comment">// Executes every 60 seconds</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fixedRateTask</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Fixed Rate Task&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Scheduled(fixedDelay = 60000)</span> <span class="comment">// Executes with a 60-second delay after completion</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fixedDelayTask</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Fixed Delay Task&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="using-cron-expressions"></a></p>
<h3 id="Using-Cron-Expressions"><a href="#Using-Cron-Expressions" class="headerlink" title="Using Cron Expressions"></a>Using Cron Expressions</h3><p>Cron expressions allow precise scheduling based on time. Format: <code>second minute hour day month weekday</code>.</p>
<p><strong>Example: Scheduling a Task for 5:00 AM Every Day</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;0 0 5 * * ?&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dailyTask</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;This task runs at 5:00 AM every day.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="conditional-scheduling-with-annotations"></a></p>
<h2 id="Conditional-Scheduling-with-Annotations"><a href="#Conditional-Scheduling-with-Annotations" class="headerlink" title="Conditional Scheduling with Annotations"></a>Conditional Scheduling with Annotations</h2><p>Spring allows scheduling tasks based on conditions. Combining <code>@ConditionalOnProperty</code> with <code>@Scheduled</code>, we can configure tasks to run only when certain conditions are met.</p>
<p><a name="conditional-scheduling-example"></a></p>
<h3 id="Conditional-Scheduling-Example"><a href="#Conditional-Scheduling-Example" class="headerlink" title="Conditional Scheduling Example"></a>Conditional Scheduling Example</h3><p>This example schedules a job only if a specific property is set to <code>true</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;scheduler.enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConditionalScheduler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 10000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">conditionalTask</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This task runs only if &#x27;scheduler.enabled=true&#x27;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To enable or disable this task, add <code>scheduler.enabled=true</code> or <code>false</code> in the configuration.</p>
<hr>
<p><a name="real-world-production-sample-code"></a></p>
<h2 id="Real-World-Production-Sample-Code"><a href="#Real-World-Production-Sample-Code" class="headerlink" title="Real-World Production Sample Code"></a>Real-World Production Sample Code</h2><p>Below is a production-level example that schedules multiple jobs with different timings and conditions.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductionSchedulerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title function_">taskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">3</span>);</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">5</span>);</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;scheduler.run&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductionScheduler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 12 * * ?&quot;)</span> <span class="comment">// Executes at noon daily</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dailySummaryJob</span><span class="params">()</span> &#123;</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line"> System.out.println(<span class="string">&quot;Executing daily summary job...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 15000)</span> <span class="comment">// Executes every 15 seconds after the previous execution ends</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">periodicCleanupJob</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Running periodic cleanup job...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Spring Scheduler provides flexibility and control over task scheduling. By using <code>@Scheduled</code> with different configurations, we can create complex scheduling workflows that address specific business needs.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/28/Deep-Dive-into-Avro-and-Parquet-Formats/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/28/Deep-Dive-into-Avro-and-Parquet-Formats/" class="post-title-link" itemprop="url">Deep Dive into Avro and Parquet Formats</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-28 16:10:12 / Modified: 16:19:57" itemprop="dateCreated datePublished" datetime="2024-10-28T16:10:12-04:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Avro/" itemprop="url" rel="index"><span itemprop="name">Avro</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Avro/Parquet/" itemprop="url" rel="index"><span itemprop="name">Parquet</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#understanding-avro-format">Understanding Avro Format</a><ul>
<li><a href="#avro-schema">Avro Schema</a></li>
<li><a href="#schema-registry">Schema Registry</a></li>
<li><a href="#storage-architecture-for-avro-in-hdfss3">Storage Architecture for Avro in HDFS&#x2F;S3</a></li>
<li><a href="#sample-code-in-spark">Sample Code in Spark</a></li>
</ul>
</li>
<li><a href="#exploring-parquet-format">Exploring Parquet Format</a><ul>
<li><a href="#parquet-schema-and-compression">Parquet Schema and Compression</a></li>
<li><a href="#storage-architecture-for-parquet-in-hdfss3">Storage Architecture for Parquet in HDFS&#x2F;S3</a></li>
<li><a href="#sample-code-in-spark-1">Sample Code in Spark</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>As data systems grow in complexity and scale, choosing efficient data serialization formats becomes crucial. This article provides a deep dive into <strong>Apache Avro</strong> and <strong>Apache Parquet</strong>, two popular formats in the <strong>Big Data</strong> ecosystem. Both formats have distinct characteristics, making them suitable for different types of data and use cases.</p>
<hr>
<p><a name="understanding-avro-format"></a></p>
<h2 id="Understanding-Avro-Format"><a href="#Understanding-Avro-Format" class="headerlink" title="Understanding Avro Format"></a>Understanding Avro Format</h2><p><strong>Apache Avro</strong> is a data serialization format that facilitates the encoding of complex data structures into a compact, binary format, making it highly efficient for streaming and storage.</p>
<p><a name="avro-schema"></a></p>
<h3 id="Avro-Schema"><a href="#Avro-Schema" class="headerlink" title="Avro Schema"></a>Avro Schema</h3><p>The Avro schema describes the structure of data stored in Avro format and is defined using <strong>JSON</strong>. Avro schemas allow the specification of nested fields, and each schema comprises two parts:</p>
<ul>
<li><strong>Primitive types</strong>: <code>null</code>, <code>boolean</code>, <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>bytes</code>, and <code>string</code>.</li>
<li><strong>Complex types</strong>: <code>record</code>, <code>enum</code>, <code>array</code>, <code>map</code>, <code>union</code>, and <code>fixed</code>.</li>
</ul>
<p><strong>Example Avro Schema</strong>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;record&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Employee&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;email&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span> <span class="string">&quot;string&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;salary&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;double&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>In this schema:</p>
<ul>
<li>The <code>Employee</code> record has fields <code>id</code>, <code>name</code>, <code>email</code>, and <code>salary</code>.</li>
<li>The <code>email</code> field is optional, allowing <code>null</code> values.</li>
</ul>
<p><a name="schema-registry"></a></p>
<h3 id="Schema-Registry"><a href="#Schema-Registry" class="headerlink" title="Schema Registry"></a>Schema Registry</h3><p><strong>Schema Registry</strong> is a crucial component that allows the storage and retrieval of schemas used by producers and consumers of data. It ensures that producers and consumers agree on the data structure, supporting <strong>schema evolution</strong> and <strong>compatibility checks</strong>.</p>
<p><strong>Diagram: Schema Registry Workflow</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-----------+            +--------------------+</span><br><span class="line">| Producer  |   Write    |  Schema Registry   |</span><br><span class="line">|           | ----------&gt; |                    |</span><br><span class="line">+-----------+            +--------------------+</span><br><span class="line">    |</span><br><span class="line">    |</span><br><span class="line">    |    Write</span><br><span class="line">    v</span><br><span class="line">+-----------+                  +-----------------+</span><br><span class="line">|  Data     |    Read/Write    |    Consumer     |</span><br><span class="line">|  Storage  | &lt;--------------&gt; |                 |</span><br><span class="line">+-----------+                  +-----------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Producers</strong> register the schema before sending data to storage.</li>
<li><strong>Consumers</strong> fetch the schema from the registry to deserialize and understand the data.</li>
</ul>
<p><a name="storage-architecture-for-avro-in-hdfs-s3"></a></p>
<h3 id="Storage-Architecture-for-Avro-in-HDFS-S3"><a href="#Storage-Architecture-for-Avro-in-HDFS-S3" class="headerlink" title="Storage Architecture for Avro in HDFS&#x2F;S3"></a>Storage Architecture for Avro in HDFS&#x2F;S3</h3><p>When storing Avro data in <strong>HDFS</strong> or <strong>S3</strong>, Avro files contain both the schema and data, allowing each file to be fully self-contained and readable independently.</p>
<p><strong>Diagram: Avro Storage in HDFS&#x2F;S3</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+------------------------+</span><br><span class="line">|   HDFS or S3 Storage   |</span><br><span class="line">+------------------------+</span><br><span class="line">          |</span><br><span class="line">+------------------------+</span><br><span class="line">|       Avro File        |</span><br><span class="line">|      + Schema          |</span><br><span class="line">+------------------------+</span><br><span class="line">         |</span><br><span class="line">+------------------------+</span><br><span class="line">|       Blocks           |</span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Each Avro file</strong> contains schema and data blocks, making it easily portable across storage platforms.</li>
<li><strong>Data Access</strong>: Avro files can be read without external dependencies, as each file includes the required schema.</li>
</ul>
<p><a name="sample-code-in-spark-avro"></a></p>
<h3 id="Sample-Code-in-Spark"><a href="#Sample-Code-in-Spark" class="headerlink" title="Sample Code in Spark"></a>Sample Code in Spark</h3><p>Below is a Spark example that reads data from an Avro file, processes it, and writes it back to HDFS as Avro format.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">DataFrame</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.avro._</span><br><span class="line"></span><br><span class="line"><span class="comment">// Initialize Spark session</span></span><br><span class="line"><span class="keyword">val</span> spark = <span class="type">SparkSession</span>.builder</span><br><span class="line">    .appName(<span class="string">&quot;AvroExample&quot;</span>)</span><br><span class="line">    .getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the Avro schema as JSON</span></span><br><span class="line"><span class="keyword">val</span> avroSchema = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;type&quot;: &quot;record&quot;,</span></span><br><span class="line"><span class="string">  &quot;name&quot;: &quot;Employee&quot;,</span></span><br><span class="line"><span class="string">  &quot;fields&quot;: [</span></span><br><span class="line"><span class="string">    &#123;&quot;name&quot;: &quot;id&quot;, &quot;type&quot;: &quot;int&quot;&#125;,</span></span><br><span class="line"><span class="string">    &#123;&quot;name&quot;: &quot;name&quot;, &quot;type&quot;: &quot;string&quot;&#125;,</span></span><br><span class="line"><span class="string">    &#123;&quot;name&quot;: &quot;email&quot;, &quot;type&quot;: [&quot;null&quot;, &quot;string&quot;], &quot;default&quot;: null&#125;,</span></span><br><span class="line"><span class="string">    &#123;&quot;name&quot;: &quot;salary&quot;, &quot;type&quot;: &quot;double&quot;&#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Read Avro file from HDFS</span></span><br><span class="line"><span class="keyword">val</span> df: <span class="type">DataFrame</span> = spark.read</span><br><span class="line">    .format(<span class="string">&quot;avro&quot;</span>)</span><br><span class="line">    .load(<span class="string">&quot;hdfs://path/to/input/avro/file&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Process the DataFrame (example: filter employees with salary &gt; 5000)</span></span><br><span class="line"><span class="keyword">val</span> filteredDf = df.filter(<span class="string">&quot;salary &gt; 5000&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write back to HDFS in Avro format</span></span><br><span class="line">filteredDf.write</span><br><span class="line">    .format(<span class="string">&quot;avro&quot;</span>)</span><br><span class="line">    .option(<span class="string">&quot;avroSchema&quot;</span>, avroSchema)</span><br><span class="line">    .save(<span class="string">&quot;hdfs://path/to/output/avro/file&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="exploring-parquet-format"></a></p>
<h2 id="Exploring-Parquet-Format"><a href="#Exploring-Parquet-Format" class="headerlink" title="Exploring Parquet Format"></a>Exploring Parquet Format</h2><p><strong>Apache Parquet</strong> is a columnar storage format optimized for complex nested data structures, making it an ideal choice for <strong>big data processing</strong>.</p>
<p><a name="parquet-schema-and-compression"></a></p>
<h3 id="Parquet-Schema-and-Compression"><a href="#Parquet-Schema-and-Compression" class="headerlink" title="Parquet Schema and Compression"></a>Parquet Schema and Compression</h3><p>Parquet organizes data in columns, allowing for efficient compression and encoding. This format is particularly beneficial for queries that scan specific columns.</p>
<p><strong>Compression Techniques</strong>:</p>
<ul>
<li><strong>Dictionary Encoding</strong>: Reduces data size by replacing duplicate values with codes.</li>
<li><strong>Bit Packing</strong>: Optimizes storage by packing multiple values into smaller data units.</li>
</ul>
<p><strong>Diagram: Parquet File Structure</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------+</span><br><span class="line">|           Parquet           |</span><br><span class="line">+-----------------------------+</span><br><span class="line">|      Row Group 1            |</span><br><span class="line">|    +--------------------+    |</span><br><span class="line">|    | Column 1          |    |</span><br><span class="line">|    | Column 2          |    |</span><br><span class="line">|    | ...               |    |</span><br><span class="line">|    +--------------------+    |</span><br><span class="line">|                             |</span><br><span class="line">|      Row Group 2            |</span><br><span class="line">|    +--------------------+    |</span><br><span class="line">|    | Column 1          |    |</span><br><span class="line">|    | Column 2          |    |</span><br><span class="line">|    | ...               |    |</span><br><span class="line">+-----------------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>Each <strong>Row Group</strong> contains columns stored together, optimizing compression and query performance.</li>
<li><strong>Columnar storage</strong> allows quick access to specific fields, reducing read and write times.</li>
</ul>
<p><a name="storage-architecture-for-parquet-in-hdfs-s3"></a></p>
<h3 id="Storage-Architecture-for-Parquet-in-HDFS-S3"><a href="#Storage-Architecture-for-Parquet-in-HDFS-S3" class="headerlink" title="Storage Architecture for Parquet in HDFS&#x2F;S3"></a>Storage Architecture for Parquet in HDFS&#x2F;S3</h3><p>In HDFS&#x2F;S3 storage, Parquet files are organized in row groups with each column stored independently within those groups.</p>
<p><strong>Diagram: Parquet Storage in HDFS&#x2F;S3</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+------------------------+</span><br><span class="line">|   HDFS or S3 Storage   |</span><br><span class="line">+------------------------+</span><br><span class="line">          |</span><br><span class="line">+------------------------+</span><br><span class="line">|     Parquet File       |</span><br><span class="line">+------------------------+</span><br><span class="line">         |</span><br><span class="line">+------------------------+</span><br><span class="line">|   Row Groups           |</span><br><span class="line">+------------------------+</span><br><span class="line">         |</span><br><span class="line">+------------------------+</span><br><span class="line">| Columns within Groups  |</span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Row Groups</strong>: Partitioned sections that allow for distributed reads.</li>
<li><strong>Columns</strong>: Stored separately within each row group for efficient access.</li>
</ul>
<p><a name="sample-code-in-spark-parquet"></a></p>
<h3 id="Sample-Code-in-Spark-1"><a href="#Sample-Code-in-Spark-1" class="headerlink" title="Sample Code in Spark"></a>Sample Code in Spark</h3><p>Below is a Spark example that reads data from a Parquet file, performs transformations, and writes it back to HDFS as Parquet format.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">DataFrame</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Initialize Spark session</span></span><br><span class="line"><span class="keyword">val</span> spark = <span class="type">SparkSession</span>.builder</span><br><span class="line">    .appName(<span class="string">&quot;ParquetExample&quot;</span>)</span><br><span class="line">    .getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read Parquet file from HDFS</span></span><br><span class="line"><span class="keyword">val</span> df: <span class="type">DataFrame</span> = spark.read</span><br><span class="line">    .parquet(<span class="string">&quot;hdfs://path/to/input/parquet/file&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Process the DataFrame (example: select employees with salary &gt; 5000)</span></span><br><span class="line"><span class="keyword">val</span> filteredDf = df.filter(<span class="string">&quot;salary &gt; 5000&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write back to HDFS in Parquet format</span></span><br><span class="line">filteredDf.write</span><br><span class="line">    .parquet(<span class="string">&quot;hdfs://path/to/output/parquet/file&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This article provided an in-depth look at <strong>Avro</strong> and <strong>Parquet</strong> formats, exploring their unique characteristics, schema management, and storage architectures. With examples in <strong>Spark</strong>, we demonstrated practical implementations in a <strong>real-world</strong> production environment, highlighting the versatility of both formats for big data solutions.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/28/Building-a-ChatGPT-like-System-II/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/28/Building-a-ChatGPT-like-System-II/" class="post-title-link" itemprop="url">Building a ChatGPT-like System - II</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-28 16:01:29 / Modified: 16:11:32" itemprop="dateCreated datePublished" datetime="2024-10-28T16:01:29-04:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ChatGPT/" itemprop="url" rel="index"><span itemprop="name">ChatGPT</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#system-overview">System Overview</a></li>
<li><a href="#1-core-dialogue-architecture">1. Core Dialogue Architecture</a><ul>
<li><a href="#diagram-core-dialogue-flow">Diagram: Core Dialogue Flow</a></li>
</ul>
</li>
<li><a href="#2-session-and-history-management">2. Session and History Management</a><ul>
<li><a href="#problem-of-stateless-inference">Problem of Stateless Inference</a></li>
<li><a href="#diagram-enhanced-system-with-session-and-history-management">Diagram: Enhanced System with Session and History Management</a></li>
</ul>
</li>
<li><a href="#3-rest-api-design">3. REST API Design</a></li>
<li><a href="#4-message-structure-and-prompt-format">4. Message Structure and Prompt Format</a></li>
<li><a href="#5-managing-history-and-context">5. Managing History and Context</a><ul>
<li><a href="#techniques-for-history-management">Techniques for History Management</a></li>
</ul>
</li>
<li><a href="#6-system-extensions-and-scalability">6. System Extensions and Scalability</a></li>
<li><a href="#7-caching-strategies">7. Caching Strategies</a><ul>
<li><a href="#diagram-cache-with-vector-embeddings-for-similar-query-detection">Diagram: Cache with Vector Embeddings for Similar Query Detection</a></li>
<li><a href="#cache-scope-considerations">Cache Scope Considerations</a></li>
</ul>
</li>
<li><a href="#8-elastic-scaling-and-load-balancing">8. Elastic Scaling and Load Balancing</a><ul>
<li><a href="#diagram-load-balanced-system-architecture-with-elastic-scaling">Diagram: Load Balanced System Architecture with Elastic Scaling</a></li>
</ul>
</li>
<li><a href="#9-production-readiness">9. Production Readiness</a><ul>
<li><a href="#checklist-for-production">Checklist for Production</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<hr>
<p>This guide provides an in-depth exploration of building a ChatGPT-style conversational AI system. We cover everything from model setup and inference engine design to system architecture, incorporating caching, scalability, and production-ready features.</p>
<p><a name="system-overview"></a></p>
<h2 id="System-Overview"><a href="#System-Overview" class="headerlink" title="System Overview"></a>System Overview</h2><p>A conversational AI system has several core components responsible for processing, generating, and managing dialogue flow with users. This overview explains the minimal structure for a functional, extensible ChatGPT-style system.</p>
<p><a name="1-core-dialogue-architecture"></a></p>
<h2 id="1-Core-Dialogue-Architecture"><a href="#1-Core-Dialogue-Architecture" class="headerlink" title="1. Core Dialogue Architecture"></a>1. Core Dialogue Architecture</h2><p>The architecture focuses on the interaction between the user, the web interface, and the inference engine that generates responses.</p>
<h3 id="Diagram-Core-Dialogue-Flow"><a href="#Diagram-Core-Dialogue-Flow" class="headerlink" title="Diagram: Core Dialogue Flow"></a>Diagram: Core Dialogue Flow</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------------+               +-------------------+               +-----------------------+</span><br><span class="line">|    Web UI     | &lt;-- HTTP --&gt;  |   Server/API      | &lt;-- REST --&gt;  |   Inference Runtime   |</span><br><span class="line">| (User Access) |               | (Request Routing) |               | (LLM Model Handling)  |</span><br><span class="line">+---------------+               +-------------------+               +-----------------------+</span><br><span class="line">            ^                                                         |</span><br><span class="line">            |&lt;--------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Web UI</strong>: Handles user interaction and displays responses.</li>
<li><strong>Server&#x2F;API</strong>: Receives requests and forwards them to the <code>inference runtime</code>.</li>
<li><strong>Inference Runtime</strong>: Loads the large language model (LLM), processes the input, and generates a response.</li>
</ol>
<p><a name="2-session-and-history-management"></a></p>
<h2 id="2-Session-and-History-Management"><a href="#2-Session-and-History-Management" class="headerlink" title="2. Session and History Management"></a>2. Session and History Management</h2><h3 id="Problem-of-Stateless-Inference"><a href="#Problem-of-Stateless-Inference" class="headerlink" title="Problem of Stateless Inference"></a>Problem of Stateless Inference</h3><p>Standard <code>inference runtimes</code> are typically stateless, meaning they cannot recall previous messages in a conversation. To handle multi-turn dialogue, we integrate a database to persist session data and user message history.</p>
<h3 id="Diagram-Enhanced-System-with-Session-and-History-Management"><a href="#Diagram-Enhanced-System-with-Session-and-History-Management" class="headerlink" title="Diagram: Enhanced System with Session and History Management"></a>Diagram: Enhanced System with Session and History Management</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+               +-------------------+               +-----------------------+</span><br><span class="line">|    Web UI     | &lt;-- HTTP --&gt;  |   Server/API      | &lt;-- REST --&gt;  |   Inference Runtime   |</span><br><span class="line">|               |               |                   |               |                       |</span><br><span class="line">+---------------+               +-------------------+               +-----------------------+</span><br><span class="line">                                          |</span><br><span class="line">                +---------------- Database ----------------+</span><br><span class="line">                |   User Session, ChatID, and Messages     |</span><br><span class="line">                +------------------------------------------+</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Database</strong>: Stores user sessions, chat histories, and other metadata.</li>
<li><strong>Server&#x2F;API</strong>: Uses REST endpoints to interact with the database, retrieving history when needed.</li>
</ol>
<p><a name="3-rest-api-design"></a></p>
<h2 id="3-REST-API-Design"><a href="#3-REST-API-Design" class="headerlink" title="3. REST API Design"></a>3. REST API Design</h2><p>The Server&#x2F;API manages communication with the Web UI via REST APIs, handling user requests, responses, and session tracking.</p>
<p><strong>REST Endpoints:</strong></p>
<ul>
<li><strong>POST &#x2F;chat</strong>: Starts a new conversation.</li>
<li><strong>POST &#x2F;chat&#x2F;:chatID&#x2F;completion</strong>: Continues a conversation in an existing session.</li>
<li><strong>GET &#x2F;chats</strong>: Retrieves the list of active sessions.</li>
<li><strong>DELETE &#x2F;chat&#x2F;:chatID</strong>: Deletes a specified session.</li>
</ul>
<p><strong>Sample API Call to Start a Conversation</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://yourserver.com/chat \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;userID&quot;: &quot;12345&quot;, &quot;message&quot;: &quot;Hello, ChatGPT!&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a name="4-message-structure-and-prompt-format"></a></p>
<h2 id="4-Message-Structure-and-Prompt-Format"><a href="#4-Message-Structure-and-Prompt-Format" class="headerlink" title="4. Message Structure and Prompt Format"></a>4. Message Structure and Prompt Format</h2><p>The <strong>prompt format</strong> structures conversation history and provides context to the model.</p>
<p><strong>Example Prompt Format in JSON</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;system&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;You are a helpful assistant.&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello!&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello there, how may I assist you today?&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;How are you?&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Role</strong>: Indicates the message source (<code>system</code>, <code>user</code>, or <code>assistant</code>).</li>
<li><strong>Content</strong>: The message text.</li>
</ol>
<p><a name="5-managing-history-and-context"></a></p>
<h2 id="5-Managing-History-and-Context"><a href="#5-Managing-History-and-Context" class="headerlink" title="5. Managing History and Context"></a>5. Managing History and Context</h2><h3 id="Techniques-for-History-Management"><a href="#Techniques-for-History-Management" class="headerlink" title="Techniques for History Management"></a>Techniques for History Management</h3><ul>
<li><strong>Direct Prompt Fill</strong>: Append all previous messages to the prompt, suitable for short interactions.</li>
<li><strong>Context Truncation</strong>: Omit older messages when context length exceeds the model’s token limit.</li>
<li><strong>History Summarization</strong>: Generate a summary of prior messages to condense the context, enabling longer conversations within token limits.</li>
</ul>
<p><a name="6-system-extensions-and-scalability"></a></p>
<h2 id="6-System-Extensions-and-Scalability"><a href="#6-System-Extensions-and-Scalability" class="headerlink" title="6. System Extensions and Scalability"></a>6. System Extensions and Scalability</h2><p>In a high-traffic environment, it is essential to scale the system horizontally and incorporate caching for repeated requests.</p>
<p><a name="7-caching-strategies"></a></p>
<h2 id="7-Caching-Strategies"><a href="#7-Caching-Strategies" class="headerlink" title="7. Caching Strategies"></a>7. Caching Strategies</h2><p>Implementing caching reduces redundant processing for similar queries. This approach involves caching semantic meanings of requests rather than exact matches.</p>
<h3 id="Diagram-Cache-with-Vector-Embeddings-for-Similar-Query-Detection"><a href="#Diagram-Cache-with-Vector-Embeddings-for-Similar-Query-Detection" class="headerlink" title="Diagram: Cache with Vector Embeddings for Similar Query Detection"></a>Diagram: Cache with Vector Embeddings for Similar Query Detection</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+                  +------------+               +----------------+</span><br><span class="line">|   User Query  |  -&gt; Embedding -&gt; |   Cache    |  Cache Hit -&gt; |   Response     |</span><br><span class="line">+---------------+                  +------------+               +----------------+</span><br><span class="line">               | No Hit                                      </span><br><span class="line">               v</span><br><span class="line">+---------------------------+          +--------------------+               </span><br><span class="line">|  Text Embedding Model     |   --&gt;    | Vector Storage and |</span><br><span class="line">|  (e.g., BERT/Word2Vec)    |          |  Search Database   |</span><br><span class="line">+---------------------------+          +--------------------+</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Embedding Runtime</strong>: Converts queries into vector embeddings.</li>
<li><strong>Vector Storage</strong>: Stores embeddings to detect semantically similar queries.</li>
</ol>
<h3 id="Cache-Scope-Considerations"><a href="#Cache-Scope-Considerations" class="headerlink" title="Cache Scope Considerations"></a>Cache Scope Considerations</h3><ul>
<li><strong>Single User Cache</strong>: Stores responses per user session.</li>
<li><strong>Global Cache</strong>: Shared across all users, introducing potential privacy considerations.</li>
</ul>
<p><a name="8-elastic-scaling-and-load-balancing"></a></p>
<h2 id="8-Elastic-Scaling-and-Load-Balancing"><a href="#8-Elastic-Scaling-and-Load-Balancing" class="headerlink" title="8. Elastic Scaling and Load Balancing"></a>8. Elastic Scaling and Load Balancing</h2><p>Scaling is crucial for supporting high traffic. Stateless components like the server and <code>inference runtime</code> can be scaled horizontally using Kubernetes.</p>
<h3 id="Diagram-Load-Balanced-System-Architecture-with-Elastic-Scaling"><a href="#Diagram-Load-Balanced-System-Architecture-with-Elastic-Scaling" class="headerlink" title="Diagram: Load Balanced System Architecture with Elastic Scaling"></a>Diagram: Load Balanced System Architecture with Elastic Scaling</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------+           +---------------+         +--------------------------+</span><br><span class="line">|  Gateway                 |   ---&gt;    |   Server      |   ---&gt;  |  Inference               |</span><br><span class="line">|                          |           |               |         |  Runtime (Auto-scalable) |</span><br><span class="line">|  Load Balancer           |           |  (Stateless)  |         |                          |</span><br><span class="line">+--------------------------+           +---------------+         +--------------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Gateway</strong>: Distributes traffic across multiple servers.</li>
<li><strong>Message Queue (MQ)</strong>: Handles requests asynchronously for stable inference.</li>
</ul>
<p><a name="9-production-readiness"></a></p>
<h2 id="9-Production-Readiness"><a href="#9-Production-Readiness" class="headerlink" title="9. Production Readiness"></a>9. Production Readiness</h2><p>To make the system production-ready, additional steps are essential.</p>
<h3 id="Checklist-for-Production"><a href="#Checklist-for-Production" class="headerlink" title="Checklist for Production"></a>Checklist for Production</h3><ul>
<li><strong>Technology Selection</strong>:<ul>
<li><strong>Database</strong>: PostgreSQL or MongoDB for session persistence.</li>
<li><strong>Inference Engine</strong>: Use efficient models like <code>llama.cpp</code>, <code>HuggingFace Transformers</code>, or <code>vLLM</code>.</li>
</ul>
</li>
<li><strong>Observability</strong>:<ul>
<li>Implement logging, tracing, and metrics.</li>
</ul>
</li>
<li><strong>CI&#x2F;CD and Deployment</strong>:<ul>
<li>Use Kubernetes or cloud-based deployment environments.</li>
</ul>
</li>
</ul>
<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This guide provides a foundational approach to building a ChatGPT-like system, managing sessions, scaling the architecture, and ensuring production reliability. From basic dialogue to advanced caching and scalability, these steps can help create a highly responsive and robust conversational AI.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/28/Building-a-ChatGPT-like-System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/28/Building-a-ChatGPT-like-System/" class="post-title-link" itemprop="url">Building a ChatGPT-like System</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-28 15:42:35 / Modified: 16:01:12" itemprop="dateCreated datePublished" datetime="2024-10-28T15:42:35-04:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ChatGPT/" itemprop="url" rel="index"><span itemprop="name">ChatGPT</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#system-overview">System Overview</a></li>
<li><a href="#session-and-historical-message-management">Session and Historical Message Management</a><ul>
<li><a href="#communication-protocols-and-apis">Communication Protocols and APIs</a></li>
<li><a href="#standardized-prompt-format">Standardized Prompt Format</a></li>
<li><a href="#managing-historical-messages">Managing Historical Messages</a></li>
</ul>
</li>
<li><a href="#system-expansion">System Expansion</a><ul>
<li><a href="#adding-cache-mechanism">Adding Cache Mechanism</a></li>
<li><a href="#scope-of-caching">Scope of Caching</a></li>
<li><a href="#elastic-scalability">Elastic Scalability</a></li>
</ul>
</li>
<li><a href="#production-readiness">Production Readiness</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><strong>ChatGPT</strong> is a conversational system based on <strong>Large Language Models (LLMs)</strong>. This article introduces the process of building a system similar to ChatGPT, covering everything from the <strong>model</strong>, <strong>inference engine</strong>, to the overall <strong>architecture</strong>.</p>
<hr>
<p><a name="system-overview"></a></p>
<h2 id="System-Overview"><a href="#System-Overview" class="headerlink" title="System Overview"></a>System Overview</h2><p>Our primary focus will be on the core of the conversation system.</p>
<p><strong>System Diagram:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">       +--------------+</span><br><span class="line">       |    Web       |</span><br><span class="line">       |  Interface   |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">       +--------------+</span><br><span class="line">       |   Server     |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">+--------------------------+</span><br><span class="line">|   Inference Runtime      |</span><br><span class="line">|   (LLM Inference Engine) |</span><br><span class="line">+--------------------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">       +--------------+</span><br><span class="line">       |   Response   |</span><br><span class="line">       +--------------+</span><br></pre></td></tr></table></figure>

<p><img src="/images/Building-a-ChatGPT-like-System/image-1.png" alt="Core Dialogue Flow"></p>
<p>In this basic system framework:</p>
<ul>
<li>The <strong>web interface</strong> interacts with users, </li>
<li>The <strong>server</strong> receives user requests and forwards them to the <strong>inference runtime</strong> (inference engine), </li>
<li>The <strong>inference runtime</strong> loads the <strong>LLM</strong> to generate a response, returning it to the user.</li>
</ul>
<hr>
<p><a name="session-and-historical-message-management"></a></p>
<h2 id="Session-and-Historical-Message-Management"><a href="#Session-and-Historical-Message-Management" class="headerlink" title="Session and Historical Message Management"></a>Session and Historical Message Management</h2><p>However, the above system has a critical flaw: it lacks <strong>session</strong> and <strong>historical message management</strong> for users. Common <strong>inference runtimes</strong> are typically <strong>stateless</strong> and do not directly support multi-turn conversations with historical context storage, meaning the system “forgets” previous exchanges within a single session.</p>
<p>To address this, we need some essential modifications.</p>
<p><strong>Enhanced System Diagram:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">       +--------------+</span><br><span class="line">       |    Web       |</span><br><span class="line">       |  Interface   |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">       +--------------+</span><br><span class="line">       |   Server     |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">+--------------------------+</span><br><span class="line">|   Inference Runtime      |</span><br><span class="line">|   (LLM Inference Engine) |</span><br><span class="line">+--------------------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">       +--------------+</span><br><span class="line">       |  Database    |</span><br><span class="line">       +--------------+</span><br></pre></td></tr></table></figure>

<p><img src="/images/Building-a-ChatGPT-like-System/image-2.png" alt="Enhanced System with Session ahdn History Management"></p>
<p>In this setup, we introduce a <strong>database component</strong> to store user sessions and historical messages.</p>
<h3 id="Communication-Protocols-and-APIs"><a href="#Communication-Protocols-and-APIs" class="headerlink" title="Communication Protocols and APIs"></a>Communication Protocols and APIs</h3><p>For communication, the <strong>web interface</strong> and <strong>server</strong> can use <strong>HTTP</strong> protocols. Basic REST APIs might include:</p>
<ul>
<li><strong><code>POST /chat</code></strong>: Initiate a new session.</li>
<li><strong><code>POST /chat/:chatID/completion</code></strong>: Continue a conversation within an existing session.</li>
<li><strong><code>GET /chats</code></strong>: Retrieve a list of sessions.</li>
<li><strong><code>DELETE /chat/:chatID</code></strong>: Delete a specific session.</li>
</ul>
<p>The <strong>server</strong> persists data in the database, structuring conversation messages with essential fields like <code>userID</code>, <code>chatID</code>, <code>userMessage</code>, and <code>assistantMessage</code>.</p>
<h3 id="Standardized-Prompt-Format"><a href="#Standardized-Prompt-Format" class="headerlink" title="Standardized Prompt Format"></a>Standardized Prompt Format</h3><p>When sending data to the <strong>inference runtime</strong>, the server uses a standardized <strong>prompt format</strong>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;You are a helpful assistant.&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello!&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello there, how may I assist you today?&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;How are you?&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>The <code>role</code> field represents different participants: <code>system</code> defines the conversation context, <code>user</code> represents user input, and <code>assistant</code> represents the model’s output.</p>
<h3 id="Managing-Historical-Messages"><a href="#Managing-Historical-Messages" class="headerlink" title="Managing Historical Messages"></a>Managing Historical Messages</h3><p>There are several ways to handle historical messages:</p>
<ul>
<li><strong>Direct Prompt Filling</strong>: Add historical messages in the prompt as <code>user</code> and <code>assistant</code> entries. This works well for short conversations.</li>
<li><strong>Dynamic Context Adjustment</strong>: Discard earlier messages to fit within the LLM’s token limit.</li>
<li><strong>Message Summarization</strong>: Use the inference engine to summarize conversation history, compressing information before filling the prompt.</li>
</ul>
<p>With session and historical message management, we establish a basic system framework.</p>
<hr>
<p><a name="system-expansion"></a></p>
<h2 id="System-Expansion"><a href="#System-Expansion" class="headerlink" title="System Expansion"></a>System Expansion</h2><p>As the user base grows, the system will require further scalability.</p>
<h3 id="Adding-Cache-Mechanism"><a href="#Adding-Cache-Mechanism" class="headerlink" title="Adding Cache Mechanism"></a>Adding Cache Mechanism</h3><p>One approach to scalability is implementing a <strong>cache</strong> to avoid repeated inference processes. The cache <strong>key-value</strong> pair would be the user’s question and the AI’s response. A cache hit would depend on whether the semantic content of the question is similar. For example, if two questions have different wording but the same meaning, the system should return the same response.</p>
<p><strong>Enhanced Caching System Diagram:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">       +--------------+</span><br><span class="line">       |    Web       |</span><br><span class="line">       |  Interface   |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">       +--------------+</span><br><span class="line">       |   Server     |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">+--------------------------+</span><br><span class="line">|   Inference Runtime      |</span><br><span class="line">|   (LLM Inference Engine) |</span><br><span class="line">+--------------------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">+--------------------------+</span><br><span class="line">|       Embedding          |</span><br><span class="line">|    Runtime &amp; Model       |</span><br><span class="line">+--------------------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">+--------------------------+</span><br><span class="line">| Vector Storage &amp; Search  |</span><br><span class="line">+--------------------------+</span><br></pre></td></tr></table></figure>

<p><img src="/images/Building-a-ChatGPT-like-System/image-3.png" alt="Cache with Vector Embeddings for Similar Query Detection"></p>
<p>Apart from the <strong>cache module</strong>, we add <strong>embedding runtime</strong> and a <strong>text embedding model</strong> to convert text into <strong>vectors</strong>. If two vectors are close, their text content is semantically similar. <strong>Vector storage and search</strong> modules are used to store and retrieve vectors.</p>
<h3 id="Scope-of-Caching"><a href="#Scope-of-Caching" class="headerlink" title="Scope of Caching"></a>Scope of Caching</h3><p>Caching can be scoped to:</p>
<ul>
<li><strong>Single-user cache</strong>: Caching value is low as users rarely repeat the same question.</li>
<li><strong>Global cache</strong>: Allows reuse across users, but risks exposing sensitive data.</li>
</ul>
<p>After data analysis and validation, decide if cache implementation is beneficial.</p>
<h3 id="Elastic-Scalability"><a href="#Elastic-Scalability" class="headerlink" title="Elastic Scalability"></a>Elastic Scalability</h3><p><strong>Elastic scaling</strong> is another key to handling high concurrency. The <strong>server</strong> is stateless, which allows for easy horizontal scaling.</p>
<p><strong>Scalability System Diagram:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">       +--------------+</span><br><span class="line">       |    Web       |</span><br><span class="line">       |  Interface   |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">       +--------------+</span><br><span class="line">       |   Gateway    |</span><br><span class="line">       |  (Load Bal.) |</span><br><span class="line">       +--------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">+--------------------------+</span><br><span class="line">|   Server Instances       |</span><br><span class="line">+--------------------------+</span><br><span class="line">              |</span><br><span class="line">              |</span><br><span class="line">              v</span><br><span class="line">+--------------------------+</span><br><span class="line">|   Inference Runtimes     |</span><br><span class="line">+--------------------------+</span><br></pre></td></tr></table></figure>

<p><img src="/images/Building-a-ChatGPT-like-System/image-4.png" alt="Load Balanced System Architecture with Elastic Scaling"></p>
<p>Here, we introduce a <strong>gateway</strong> for load balancing. The <strong>inference runtime</strong> is also stateless and supports elastic scaling, but it requires more hardware resources and may respond slower than the server. To maintain stability under peak load, add a <strong>message queue (MQ)</strong> and change request handling to asynchronous, improving system resilience.</p>
<hr>
<p><a name="production-readiness"></a></p>
<h2 id="Production-Readiness"><a href="#Production-Readiness" class="headerlink" title="Production Readiness"></a>Production Readiness</h2><p>The system architecture covers the basic logic, but to achieve <strong>production-readiness</strong>, further steps are necessary:</p>
<ul>
<li><strong>Technology Selection</strong>: Choose a database (e.g., PostgreSQL or MongoDB) and inference engine (e.g., <code>llama.cpp</code>, <code>HuggingFace Transformers</code>, <code>vLLM</code>) and map logical components to physical components.</li>
<li><strong>Observability</strong>: Integrate <strong>logging</strong>, <strong>tracing</strong>, <strong>metrics</strong>, and set up monitoring and alerting.</li>
<li><strong>CI&#x2F;CD and Deployment Environment</strong>: Configure automation pipelines for continuous integration and deployment, and select the appropriate environment (e.g., <strong>cloud platforms</strong> or <strong>Kubernetes</strong>).</li>
</ul>
<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This article provides an overview of constructing a ChatGPT-like system, covering the core conversation flow and expanding to include session management and historical message storage. We discussed strategies for system expansion and laid out steps toward production readiness.</p>
<hr>
<p><a name="references"></a></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ggerganov/llama.cpp">llama.cpp GitHub</a></li>
<li><a target="_blank" rel="noopener" href="https://platform.openai.com/docs/api-reference/chat/create">OpenAI API Reference</a></li>
</ul>
<pre><code>
This enhanced Markdown document covers each requested update, including detailed technical sections, diagrams, keywords, and sections for expansion and production readiness.
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/28/Spark-in-Kubernetes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/28/Spark-in-Kubernetes/" class="post-title-link" itemprop="url">Spark in Kubernetes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-28 11:55:22 / Modified: 12:09:57" itemprop="dateCreated datePublished" datetime="2024-10-28T11:55:22-04:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Kubernetes/Spark/" itemprop="url" rel="index"><span itemprop="name">Spark</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#architecture-overview">Architecture Overview</a><ul>
<li><a href="#diagram-architecture-overview">Diagram: Architecture Overview</a></li>
</ul>
</li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#1-configuring-google-cloud-storage-gcs-bucket">1. Configuring Google Cloud Storage (GCS) Bucket</a></li>
<li><a href="#2-deploying-postgresql-for-hive-metadata">2. Deploying PostgreSQL for Hive Metadata</a><ul>
<li><a href="#postgresql-yaml">PostgreSQL YAML</a></li>
</ul>
</li>
<li><a href="#3-installing-hive-metastore">3. Installing Hive Metastore</a><ul>
<li><a href="#hive-configuration">Hive Configuration</a></li>
</ul>
</li>
<li><a href="#4-deploying-spark-master-and-workers">4. Deploying Spark Master and Workers</a><ul>
<li><a href="#spark-master-and-worker-statefulset-yaml">Spark Master and Worker StatefulSet YAML</a></li>
</ul>
</li>
<li><a href="#5-setting-up-the-spark-history-server">5. Setting Up the Spark History Server</a><ul>
<li><a href="#spark-history-server-yaml">Spark History Server YAML</a></li>
</ul>
</li>
<li><a href="#6-configuring-ingress">6. Configuring Ingress</a><ul>
<li><a href="#ingress-yaml">Ingress YAML</a></li>
</ul>
</li>
<li><a href="#7-testing-the-deployment-with-spark-job">7. Testing the Deployment with Spark Job</a></li>
<li><a href="#furthermore">Furthermore</a><ul>
<li><a href="#statefulset-vs-deployment">StatefulSet vs Deployment</a></li>
<li><a href="#1-spark-master-and-worker-as-statefulsets">1. <strong>Spark Master and Worker as StatefulSets</strong></a></li>
<li><a href="#2-spark-history-server-as-a-deployment">2. <strong>Spark History Server as a Deployment</strong></a></li>
</ul>
</li>
<li><a href="#summary-table">Summary Table</a></li>
</ul>
<hr>
<p>This guide covers the steps to deploy an Apache Spark cluster with a master, two workers, and a Spark History Server on Kubernetes. It configures a GCS bucket as the default file system and installs Hive with PostgreSQL as its backend. An Ingress is set up for accessing the Spark UI and History Server.</p>
<p><a name="architecture-overview"></a></p>
<h2 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h2><p>The setup includes the following components:</p>
<ul>
<li><strong>Spark Master and Workers</strong>: Deployed using StatefulSets for stable identity and persistence.</li>
<li><strong>History Server</strong>: Deployed using a Deployment and configured to store Spark event logs in GCS.</li>
<li><strong>Hive and PostgreSQL</strong>: PostgreSQL is used as the backend for Hive metadata, and Hive is deployed to store Spark tables.</li>
<li><strong>Ingress</strong>: Provides external access to Spark Master UI and History Server UI.</li>
</ul>
<h3 id="Diagram-Architecture-Overview"><a href="#Diagram-Architecture-Overview" class="headerlink" title="Diagram: Architecture Overview"></a>Diagram: Architecture Overview</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+---------------------------+</span><br><span class="line">|                           |</span><br><span class="line">|        Kubernetes         |</span><br><span class="line">|                           |</span><br><span class="line">+---------------------------+</span><br><span class="line">|                           |</span><br><span class="line">|  +---------+   +---------+|</span><br><span class="line">|  |  Spark  |   |  Spark  ||</span><br><span class="line">|  |  Master |   | Workers ||</span><br><span class="line">|  +---------+   +---------+|</span><br><span class="line">|                           |</span><br><span class="line">|        +-----------+      |</span><br><span class="line">|        |  History  |      |</span><br><span class="line">|        |  Server   |      |</span><br><span class="line">|        +-----------+      |</span><br><span class="line">|            |              |</span><br><span class="line">|         Ingress           |</span><br><span class="line">+---------------------------+</span><br><span class="line">           |</span><br><span class="line">    External Access</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="prerequisites"></a></p>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><ul>
<li><strong>Kubernetes Cluster</strong> with access to deploy resources.</li>
<li><strong>kubectl</strong> command-line tool configured to access the cluster.</li>
<li><strong>Helm</strong> for deploying Hive and PostgreSQL.</li>
<li><strong>Google Cloud Storage (GCS)</strong> bucket created for Spark event logs.</li>
<li><strong>Google Cloud SDK</strong> installed and configured for authentication to GCS.</li>
</ul>
<hr>
<p><a name="1-configuring-google-cloud-storage-gcs-bucket"></a></p>
<h2 id="1-Configuring-Google-Cloud-Storage-GCS-Bucket"><a href="#1-Configuring-Google-Cloud-Storage-GCS-Bucket" class="headerlink" title="1. Configuring Google Cloud Storage (GCS) Bucket"></a>1. Configuring Google Cloud Storage (GCS) Bucket</h2><ol>
<li><p>Create a GCS bucket if not already created:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsutil mb gs://your-spark-event-logs</span><br></pre></td></tr></table></figure>
</li>
<li><p>Set up a GCS service account key and save it as a Kubernetes secret. This will allow Spark to access GCS:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic gcs-key \</span><br><span class="line">--from-file=key.json=/path/to/gcs-service-account-key.json</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<p><a name="2-deploying-postgresql-for-hive-metadata"></a></p>
<h2 id="2-Deploying-PostgreSQL-for-Hive-Metadata"><a href="#2-Deploying-PostgreSQL-for-Hive-Metadata" class="headerlink" title="2. Deploying PostgreSQL for Hive Metadata"></a>2. Deploying PostgreSQL for Hive Metadata</h2><p>PostgreSQL will act as the relational database for Hive’s metadata.</p>
<h3 id="PostgreSQL-YAML"><a href="#PostgreSQL-YAML" class="headerlink" title="PostgreSQL YAML"></a>PostgreSQL YAML</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">postgresql-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">postgresql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">postgresql</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">postgresql</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">postgresql</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">postgres:13</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_DB</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;hive_metastore&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;hiveuser&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;hivepassword&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/var/lib/postgresql/data&quot;</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">postgresql-data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">postgresql-data</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">postgresql-pvc</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="3-installing-hive-metastore"></a></p>
<h2 id="3-Installing-Hive-Metastore"><a href="#3-Installing-Hive-Metastore" class="headerlink" title="3. Installing Hive Metastore"></a>3. Installing Hive Metastore</h2><p>Hive Metastore will manage metadata for Spark. </p>
<h3 id="Hive-Configuration"><a href="#Hive-Configuration" class="headerlink" title="Hive Configuration"></a>Hive Configuration</h3><ol>
<li><p>Download and install Hive Helm chart:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm install hive bitnami/hive --<span class="built_in">set</span> postgresql.enabled=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Update Hive configuration to use PostgreSQL.</p>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Values.yaml for Hive</span></span><br><span class="line"><span class="attr">hive:</span></span><br><span class="line">  <span class="attr">metastore:</span></span><br><span class="line">    <span class="attr">databaseType:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:postgresql://postgresql-service/hive_metastore</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">hiveuser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">hivepassword</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="4-deploying-spark-master-and-workers"></a></p>
<h2 id="4-Deploying-Spark-Master-and-Workers"><a href="#4-Deploying-Spark-Master-and-Workers" class="headerlink" title="4. Deploying Spark Master and Workers"></a>4. Deploying Spark Master and Workers</h2><h3 id="Spark-Master-and-Worker-StatefulSet-YAML"><a href="#Spark-Master-and-Worker-StatefulSet-YAML" class="headerlink" title="Spark Master and Worker StatefulSet YAML"></a>Spark Master and Worker StatefulSet YAML</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-master</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">spark-master</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">spark</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">spark</span></span><br><span class="line">        <span class="attr">role:</span> <span class="string">master</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">spark-master</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spark:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">7077</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPARK_MASTER_HOST</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;spark-master&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-worker</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">spark</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">spark</span></span><br><span class="line">        <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">spark-worker</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spark:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8081</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPARK_WORKER_CORES</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPARK_WORKER_MEMORY</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;1G&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPARK_MASTER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;spark://spark-master:7077&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="5-setting-up-the-spark-history-server"></a></p>
<h2 id="5-Setting-Up-the-Spark-History-Server"><a href="#5-Setting-Up-the-Spark-History-Server" class="headerlink" title="5. Setting Up the Spark History Server"></a>5. Setting Up the Spark History Server</h2><p>The History Server will read event logs from the GCS bucket for job history.</p>
<h3 id="Spark-History-Server-YAML"><a href="#Spark-History-Server-YAML" class="headerlink" title="Spark History Server YAML"></a>Spark History Server YAML</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-history-server</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">spark-history</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">spark-history</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">spark-history-server</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spark:latest</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPARK_HISTORY_OPTS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;-Dspark.history.fs.logDirectory=gs://your-spark-event-logs&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/opt/spark/work-dir</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">gcs-key</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">key.json</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">gcs-key</span></span><br><span class="line">        <span class="attr">secret:</span></span><br><span class="line">          <span class="attr">secretName:</span> <span class="string">gcs-key</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="6-configuring-ingress"></a></p>
<h2 id="6-Configuring-Ingress"><a href="#6-Configuring-Ingress" class="headerlink" title="6. Configuring Ingress"></a>6. Configuring Ingress</h2><p>Ingress will expose the Spark Master UI and History Server UI.</p>
<h3 id="Ingress-YAML"><a href="#Ingress-YAML" class="headerlink" title="Ingress YAML"></a>Ingress YAML</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">spark.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/master</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">spark-master</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">8080</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/history</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">spark-history-server</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">18080</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="7-testing-the-deployment-with-spark-job"></a></p>
<h2 id="7-Testing-the-Deployment-with-Spark-Job"><a href="#7-Testing-the-Deployment-with-Spark-Job" class="headerlink" title="7. Testing the Deployment with Spark Job"></a>7. Testing the Deployment with Spark Job</h2><p>To verify the installation, use <code>spark-submit</code> to run a simple calculation for PI.</p>
<ol>
<li><p>Submit a PI calculation job using <code>spark-submit</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it spark-master-0 -- spark-submit \</span><br><span class="line">--class org.apache.spark.examples.SparkPi \</span><br><span class="line">--master spark://spark-master:7077 \</span><br><span class="line">/opt/spark/examples/jars/spark-examples_2.12-3.0.1.jar 1000</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check the Spark Master and History Server UIs</p>
</li>
</ol>
<p> to confirm job execution and view logs.</p>
<h2 id="Furthermore"><a href="#Furthermore" class="headerlink" title="Furthermore"></a>Furthermore</h2><h3 id="StatefulSet-vs-Deployment"><a href="#StatefulSet-vs-Deployment" class="headerlink" title="StatefulSet vs Deployment"></a>StatefulSet vs Deployment</h3><p>In the official Helm chart for Apache Spark, the choice of <strong>StatefulSet</strong> for Spark Master and Worker, and <strong>Deployment</strong> for the Spark History Server, aligns with the specific requirements and behaviors of each component. Here’s a breakdown of the reasons for these design choices:</p>
<h3 id="1-Spark-Master-and-Worker-as-StatefulSets"><a href="#1-Spark-Master-and-Worker-as-StatefulSets" class="headerlink" title="1. Spark Master and Worker as StatefulSets"></a>1. <strong>Spark Master and Worker as StatefulSets</strong></h3><ul>
<li><strong>Persistence and Stability</strong>: The Spark Master and Worker nodes need stable, unique identities to communicate reliably. Using <strong>StatefulSet</strong> ensures that each replica (instance) has a stable network identity (hostname) and, if configured, persistent storage.</li>
<li><strong>Leader Election and Failover</strong>: Spark Master in standalone mode has a primary leader and backup node architecture, where the leader is responsible for the cluster state. StatefulSets allow these nodes to maintain consistent, unique identifiers, which is crucial for leader election and failover without disrupting the Spark cluster.</li>
<li><strong>Worker Registration</strong>: Spark Workers register with the Master, and having a unique, stable network identity ensures workers don’t inadvertently re-register or conflict with each other after restarts or failures. StatefulSets are the preferred way to handle this kind of behavior.</li>
</ul>
<h3 id="2-Spark-History-Server-as-a-Deployment"><a href="#2-Spark-History-Server-as-a-Deployment" class="headerlink" title="2. Spark History Server as a Deployment"></a>2. <strong>Spark History Server as a Deployment</strong></h3><ul>
<li><strong>Stateless Operation</strong>: The Spark History Server is fundamentally a stateless application. It reads from a pre-configured storage (such as HDFS or S3) where application logs are stored but doesn’t require persistent storage for its own operation. Using a <strong>Deployment</strong> is appropriate here, as the history server can be easily replicated or scaled without maintaining unique identities.</li>
<li><strong>Easier Scaling and Update Management</strong>: Deployments provide automatic scaling and rolling updates, which are more suitable for stateless services. If you need to increase the availability of the history server, you can simply increase the replica count in the Deployment, and Kubernetes will handle the scaling automatically.</li>
<li><strong>Failure Recovery</strong>: Since there’s no dependency on unique network identities or persistent state, if the History Server pod fails, it can be easily recreated without any additional orchestration, which is exactly what Deployments are optimized for.</li>
</ul>
<h2 id="Summary-Table"><a href="#Summary-Table" class="headerlink" title="Summary Table"></a>Summary Table</h2><table>
<thead>
<tr>
<th>Component</th>
<th>Kubernetes Kind</th>
<th>Purpose</th>
<th>Reasoning</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Spark Master</strong></td>
<td>StatefulSet</td>
<td>Primary and backup master for Spark cluster</td>
<td>Needs stable identity for cluster coordination and leader election</td>
</tr>
<tr>
<td><strong>Spark Worker</strong></td>
<td>StatefulSet</td>
<td>Worker nodes that register with Spark Master</td>
<td>Stable network identity ensures reliable registration and communication with Master</td>
</tr>
<tr>
<td><strong>Spark History Server</strong></td>
<td>Deployment</td>
<td>Reads logs and provides historical application data</td>
<td>Stateless and doesn’t need unique identities; easier to scale and restart as a Deployment</td>
</tr>
</tbody></table>
<p>This setup optimizes the deployment structure for each Spark component’s unique requirements, leveraging Kubernetes’ StatefulSet and Deployment resources for their intended purposes.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/28/Comprehensive-Guide-to-Kubernetes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/28/Comprehensive-Guide-to-Kubernetes/" class="post-title-link" itemprop="url">Comprehensive Guide to Kubernetes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-28 11:51:24 / Modified: 15:51:10" itemprop="dateCreated datePublished" datetime="2024-10-28T11:51:24-04:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#cluster">Cluster</a></li>
<li><a href="#node">Node</a></li>
<li><a href="#pod">Pod</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#service">Service</a></li>
<li><a href="#ingress">Ingress</a></li>
<li><a href="#configmap">ConfigMap</a></li>
<li><a href="#secret">Secret</a></li>
<li><a href="#persistent-volume-pv-and-persistent-volume-claim-pvc">Persistent Volume (PV) and Persistent Volume Claim (PVC)</a></li>
<li><a href="#namespace">Namespace</a></li>
<li><a href="#daemonset">DaemonSet</a></li>
<li><a href="#job-and-cronjob">Job and CronJob</a></li>
<li><a href="#horizontal-pod-autoscaler-hpa">Horizontal Pod Autoscaler (HPA)</a></li>
<li><a href="#statefulset">StatefulSet</a></li>
<li><a href="#volume-and-storageclass">Volume and StorageClass</a></li>
<li><a href="#networkpolicy">NetworkPolicy</a></li>
<li><a href="#custom-resource-definitions-crds">Custom Resource Definitions (CRDs)</a></li>
<li><a href="#helm-charts">Helm Charts</a></li>
</ul>
<hr>
<p>This guide provides a detailed overview of Kubernetes concepts, examples, use cases, installation YAML examples, and visual representations of the architecture. </p>
<p><a name="cluster"></a></p>
<h2 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h2><p>A <strong>Kubernetes Cluster</strong> is a group of nodes (machines) that host and manage containerized applications. Each cluster has at least one master node, which controls the state of the cluster, and multiple worker nodes.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>A cloud-based cluster with one master node and multiple worker nodes in Google Kubernetes Engine (GKE).</p>
<h3 id="Use-Case"><a href="#Use-Case" class="headerlink" title="Use Case"></a>Use Case</h3><p>An ideal setup for running a production microservices application with high availability.</p>
<h4 id="YAML-Structure-for-Cluster-Creation"><a href="#YAML-Structure-for-Cluster-Creation" class="headerlink" title="YAML Structure for Cluster Creation"></a>YAML Structure for Cluster Creation</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="node"></a></p>
<h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h2><p>A <strong>Node</strong> is a single machine within a Kubernetes cluster, capable of running one or more pods.</p>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><p>In a cloud environment, each node could be a virtual machine instance.</p>
<h3 id="Use-Case-1"><a href="#Use-Case-1" class="headerlink" title="Use Case"></a>Use Case</h3><p>Nodes distribute workloads across the infrastructure.</p>
<h4 id="YAML-Snippet"><a href="#YAML-Snippet" class="headerlink" title="YAML Snippet"></a>YAML Snippet</h4><p>The node configuration is usually specified by the cluster management tool (e.g., GKE or EKS) rather than in YAML, as it pertains to the infrastructure layer.</p>
<hr>
<p><a name="pod"></a></p>
<h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><p>A <strong>Pod</strong> is the smallest deployable unit in Kubernetes, which can contain one or more containers.</p>
<h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h3><p>A pod running a web server container and a logging container.</p>
<h3 id="Use-Case-2"><a href="#Use-Case-2" class="headerlink" title="Use Case"></a>Use Case</h3><p>Running tightly coupled applications together within the same lifecycle.</p>
<h4 id="YAML-Structure-for-Pod"><a href="#YAML-Structure-for-Pod" class="headerlink" title="YAML Structure for Pod"></a>YAML Structure for Pod</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-server-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-server</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logger</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">fluentd</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="deployment"></a></p>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><p>A <strong>Deployment</strong> is a Kubernetes object for managing a group of identical pods. It provides capabilities like rolling updates and rollback.</p>
<h3 id="Example-3"><a href="#Example-3" class="headerlink" title="Example"></a>Example</h3><p>A deployment with three replicas of a web server pod.</p>
<h3 id="Use-Case-3"><a href="#Use-Case-3" class="headerlink" title="Use Case"></a>Use Case</h3><p>Maintaining a stable version of an application by managing pod replicas.</p>
<h4 id="YAML-Structure-for-Deployment"><a href="#YAML-Structure-for-Deployment" class="headerlink" title="YAML Structure for Deployment"></a>YAML Structure for Deployment</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.4</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="service"></a></p>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>A <strong>Service</strong> provides a stable endpoint for accessing a set of pods.</p>
<h3 id="Example-4"><a href="#Example-4" class="headerlink" title="Example"></a>Example</h3><p>A service that exposes an application to the public internet.</p>
<h3 id="Use-Case-4"><a href="#Use-Case-4" class="headerlink" title="Use Case"></a>Use Case</h3><p>Load balancing traffic to an application across multiple pods.</p>
<h4 id="YAML-Structure-for-Service"><a href="#YAML-Structure-for-Service" class="headerlink" title="YAML Structure for Service"></a>YAML Structure for Service</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="ingress"></a></p>
<h2 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h2><p><strong>Ingress</strong> manages external access to services, typically using HTTP.</p>
<h3 id="Example-5"><a href="#Example-5" class="headerlink" title="Example"></a>Example</h3><p>An ingress with rules to route traffic to different services based on URL paths.</p>
<h3 id="Use-Case-5"><a href="#Use-Case-5" class="headerlink" title="Use Case"></a>Use Case</h3><p>Routing <code>/api</code> to backend services and <code>/static</code> to frontend services on the same domain.</p>
<h4 id="YAML-Structure-for-Ingress"><a href="#YAML-Structure-for-Ingress" class="headerlink" title="YAML Structure for Ingress"></a>YAML Structure for Ingress</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/api</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">api-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/static</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">static-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="configmap"></a></p>
<h2 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h2><p>A <strong>ConfigMap</strong> stores non-sensitive configuration data.</p>
<h3 id="Example-6"><a href="#Example-6" class="headerlink" title="Example"></a>Example</h3><p>A ConfigMap for environment-specific variables.</p>
<h3 id="Use-Case-6"><a href="#Use-Case-6" class="headerlink" title="Use Case"></a>Use Case</h3><p>Keeping configuration separate from the application code.</p>
<h4 id="YAML-Structure-for-ConfigMap"><a href="#YAML-Structure-for-ConfigMap" class="headerlink" title="YAML Structure for ConfigMap"></a>YAML Structure for ConfigMap</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">config-demo</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">DATABASE_URL:</span> <span class="string">&quot;jdbc:mysql://dbhost:3306/mydatabase&quot;</span></span><br><span class="line">  <span class="attr">DEBUG_LEVEL:</span> <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="secret"></a></p>
<h2 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h2><p>A <strong>Secret</strong> stores sensitive information, like passwords and tokens.</p>
<h3 id="Example-7"><a href="#Example-7" class="headerlink" title="Example"></a>Example</h3><p>A secret containing API keys for external services.</p>
<h3 id="Use-Case-7"><a href="#Use-Case-7" class="headerlink" title="Use Case"></a>Use Case</h3><p>Securing sensitive data without exposing it in the code.</p>
<h4 id="YAML-Structure-for-Secret"><a href="#YAML-Structure-for-Secret" class="headerlink" title="YAML Structure for Secret"></a>YAML Structure for Secret</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">api-key-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">api-key:</span> <span class="string">c29tZS1yYW5kb20ta2V5Cg==</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="persistent-volume-pv-and-persistent-volume-claim-pvc"></a></p>
<h2 id="Persistent-Volume-PV-and-Persistent-Volume-Claim-PVC"><a href="#Persistent-Volume-PV-and-Persistent-Volume-Claim-PVC" class="headerlink" title="Persistent Volume (PV) and Persistent Volume Claim (PVC)"></a>Persistent Volume (PV) and Persistent Volume Claim (PVC)</h2><p>A <strong>Persistent Volume</strong> provides storage, while a <strong>Persistent Volume Claim</strong> is a request for that storage.</p>
<h3 id="Example-8"><a href="#Example-8" class="headerlink" title="Example"></a>Example</h3><p>A PV representing cloud disk storage and a PVC used by a database pod.</p>
<h3 id="Use-Case-8"><a href="#Use-Case-8" class="headerlink" title="Use Case"></a>Use Case</h3><p>Ensuring data persistence for applications that require durable storage.</p>
<h4 id="YAML-Structure-for-PV-and-PVC"><a href="#YAML-Structure-for-PV-and-PVC" class="headerlink" title="YAML Structure for PV and PVC"></a>YAML Structure for PV and PVC</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv-storage</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">10Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;/mnt/data&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc-storage</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">8Gi</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="namespace"></a></p>
<h2 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h2><p>A <strong>Namespace</strong> is a way to divide cluster resources among multiple users.</p>
<h3 id="Example-9"><a href="#Example-9" class="headerlink" title="Example"></a>Example</h3><p>Separate namespaces for development, staging, and production environments.</p>
<h3 id="Use-Case-9"><a href="#Use-Case-9" class="headerlink" title="Use Case"></a>Use Case</h3><p>Organizing resources for different environments or teams.</p>
<h4 id="YAML-Structure-for-Namespace"><a href="#YAML-Structure-for-Namespace" class="headerlink" title="YAML Structure for Namespace"></a>YAML Structure for Namespace</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-environment</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="daemonset"></a></p>
<h2 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h2><p>A <strong>DaemonSet</strong> ensures that specific pods run on each node.</p>
<h3 id="Example-10"><a href="#Example-10" class="headerlink" title="Example"></a>Example</h3><p>Running a logging agent on every node in the cluster.</p>
<h3 id="Use-Case-10"><a href="#Use-Case-10" class="headerlink" title="Use Case"></a>Use Case</h3><p>Managing node-wide services like logging or monitoring.</p>
<h4 id="YAML-Structure-for-DaemonSet"><a href="#YAML-Structure-for-DaemonSet" class="headerlink" title="YAML Structure for DaemonSet"></a>YAML Structure for DaemonSet</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">logger</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">logger</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">logger</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">fluent/fluentd</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="job-and-cronjob"></a></p>
<h2 id="Job-and-CronJob"><a href="#Job-and-CronJob" class="headerlink" title="Job and CronJob"></a>Job and CronJob</h2><p><strong>Job</strong> runs a one-time task, while <strong>CronJob</strong> schedules a recurring task.</p>
<h3 id="Example-11"><a href="#Example-11" class="headerlink" title="Example"></a>Example</h3><p>A Job to back up a database once and a CronJob to clean up logs daily.</p>
<h3 id="Use-Case-11"><a href="#Use-Case-11" class="headerlink" title="Use Case"></a>Use Case</h3><p>Automating scheduled tasks or batch processing.</p>
<h4 id="YAML-Structure-for-Job-and-CronJob"><a href="#YAML-Structure-for-Job-and-CronJob" class="headerlink" title="YAML Structure for Job and CronJob"></a>YAML Structure for Job and CronJob</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">backup-job</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">backup</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">backup-tool</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">daily-cleanup</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;0 0 * * *&quot;</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cleanup</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">cleanup-tool</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="horizontal-pod-autoscaler-hpa"></a></p>
<h2 id="Horizontal-Pod-Autoscaler-HPA"><a href="#Horizontal-Pod-Autoscaler-HPA" class="headerlink" title="Horizontal Pod Autoscaler (HPA)"></a>Horizontal Pod Autoscaler (HPA)</h2><p>The <strong>HPA</strong> scales pod replicas automatically based on resource utilization.</p>
<h3 id="Example-12"><a href="#Example-12" class="headerlink" title="Example"></a>Example</h3><p>Scaling web server pods based on CPU usage.</p>
<h3 id="Use-Case-12"><a href="#Use-Case-12" class="headerlink" title="Use Case"></a>Use Case</h3><p>Scaling applications to handle variable workloads.</p>
<h4 id="YAML-Structure-for-HPA"><a href="#YAML-Structure-for-HPA" class="headerlink" title="YAML Structure for HPA"></a>YAML Structure for HPA</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-hpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="string">scaleTarget</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Ref:</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">web-deployment</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">targetCPUUtilizationPercentage:</span> <span class="number">70</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="statefulset"></a></p>
<h2 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h2><p>A <strong>StatefulSet</strong> manages stateful applications with unique and persistent storage.</p>
<h3 id="Example-13"><a href="#Example-13" class="headerlink" title="Example"></a>Example</h3><p>A StatefulSet for a MongoDB replica set.</p>
<h3 id="Use-Case-13"><a href="#Use-Case-13" class="headerlink" title="Use Case"></a>Use Case</h3><p>Managing stateful applications where each instance requires its own storage.</p>
<h4 id="YAML-Structure-for-StatefulSet"><a href="#YAML-Structure-for-StatefulSet" class="headerlink" title="YAML Structure for StatefulSet"></a>YAML Structure for StatefulSet</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;mongo&quot;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongo</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongo</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mongo</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">27017</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">mongo</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="volume-and-storageclass"></a></p>
<h2 id="Volume-and-StorageClass"><a href="#Volume-and-StorageClass" class="headerlink" title="Volume and StorageClass"></a>Volume and StorageClass</h2><p><strong>Volumes</strong> provide storage to pods, while <strong>StorageClass</strong> defines types of storage.</p>
<h3 id="Example-14"><a href="#Example-14" class="headerlink" title="Example"></a>Example</h3><p>SSD-based storage for a database application.</p>
<h3 id="Use-Case-14"><a href="#Use-Case-14" class="headerlink" title="Use Case"></a>Use Case</h3><p>Choosing storage for applications based on performance requirements.</p>
<h4 id="YAML-Structure-for-StorageClass-and-Volume"><a href="#YAML-Structure-for-StorageClass-and-Volume" class="headerlink" title="YAML Structure for StorageClass and Volume"></a>YAML Structure for StorageClass and Volume</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fast</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/aws-ebs</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">gp2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fast-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">fast</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">50Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="networkpolicy"></a></p>
<h2 id="NetworkPolicy"><a href="#NetworkPolicy" class="headerlink" title="NetworkPolicy"></a>NetworkPolicy</h2><p><strong>NetworkPolicy</strong> defines network access rules between pods.</p>
<h3 id="Example-15"><a href="#Example-15" class="headerlink" title="Example"></a>Example</h3><p>Restricting access to specific pods.</p>
<h3 id="Use-Case-15"><a href="#Use-Case-15" class="headerlink" title="Use Case"></a>Use Case</h3><p>Securing inter-service communication.</p>
<h4 id="YAML-Structure-for-NetworkPolicy"><a href="#YAML-Structure-for-NetworkPolicy" class="headerlink" title="YAML Structure for NetworkPolicy"></a>YAML Structure for NetworkPolicy</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deny-all</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Egress</span></span><br><span class="line">  <span class="attr">ingress:</span> []</span><br><span class="line">  <span class="attr">egress:</span> []</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="custom-resource-definitions-crds"></a></p>
<h2 id="Custom-Resource-Definitions-CRDs"><a href="#Custom-Resource-Definitions-CRDs" class="headerlink" title="Custom Resource Definitions (CRDs)"></a>Custom Resource Definitions (CRDs)</h2><p><strong>CRDs</strong> extend Kubernetes by allowing users to create custom resources.</p>
<h3 id="Example-16"><a href="#Example-16" class="headerlink" title="Example"></a>Example</h3><p>A custom resource to manage database schema migrations.</p>
<h3 id="Use-Case-16"><a href="#Use-Case-16" class="headerlink" title="Use Case"></a>Use Case</h3><p>Adding domain-specific resources for applications.</p>
<h4 id="YAML-Structure-for-CRD"><a href="#YAML-Structure-for-CRD" class="headerlink" title="YAML Structure for CRD"></a>YAML Structure for CRD</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">migrations.mycompany.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">mycompany.com</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">migrations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">migration</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Migration</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a name="helm-charts"></a></p>
<h2 id="Helm-Charts"><a href="#Helm-Charts" class="headerlink" title="Helm Charts"></a>Helm Charts</h2><p><strong>Helm</strong> is a package manager for Kubernetes, and <strong>Helm Charts</strong> are pre-configured packages.</p>
<h3 id="Example-17"><a href="#Example-17" class="headerlink" title="Example"></a>Example</h3><p>A Helm chart for deploying a WordPress site.</p>
<h3 id="Use-Case-17"><a href="#Use-Case-17" class="headerlink" title="Use Case"></a>Use Case</h3><p>Simplifying application deployment and management.</p>
<h4 id="Example-Helm-Command"><a href="#Example-Helm-Command" class="headerlink" title="Example Helm Command"></a>Example Helm Command</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install my-wordpress bitnami/wordpress</span><br></pre></td></tr></table></figure>

<hr>
<p>These concepts are essential for understanding and operating Kubernetes in production, allowing you to deploy, manage, and scale applications effectively. Each example and YAML configuration highlights the power and flexibility Kubernetes offers in a variety of scenarios.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-Spring-Boot-and-Quarkus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-into-Spring-Boot-and-Quarkus/" class="post-title-link" itemprop="url">Deep Dive into Spring Boot and Quarkus</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 23:38:08 / Modified: 23:46:51" itemprop="dateCreated datePublished" datetime="2024-10-27T23:38:08-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Spring-Boot/Quarkus/" itemprop="url" rel="index"><span itemprop="name">Quarkus</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#architecture">Architecture</a><ul>
<li><a href="#21-overview">2.1 Overview</a><ul>
<li><a href="#spring-boot">Spring Boot</a></li>
<li><a href="#quarkus">Quarkus</a></li>
</ul>
</li>
<li><a href="#22-microservices">2.2 Microservices</a><ul>
<li><a href="#spring-boot-1">Spring Boot</a></li>
<li><a href="#quarkus-1">Quarkus</a></li>
</ul>
</li>
<li><a href="#23-dependency-injection">2.3 Dependency Injection</a><ul>
<li><a href="#spring-boot-2">Spring Boot</a></li>
<li><a href="#quarkus-2">Quarkus</a></li>
</ul>
</li>
<li><a href="#24-reactive-programming">2.4 Reactive Programming</a><ul>
<li><a href="#spring-boot-3">Spring Boot</a></li>
<li><a href="#quarkus-3">Quarkus</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#performance">Performance</a><ul>
<li><a href="#31-startup-time">3.1 Startup Time</a><ul>
<li><a href="#spring-boot-4">Spring Boot</a></li>
<li><a href="#quarkus-4">Quarkus</a></li>
</ul>
</li>
<li><a href="#32-memory-usage">3.2 Memory Usage</a><ul>
<li><a href="#spring-boot-5">Spring Boot</a></li>
<li><a href="#quarkus-5">Quarkus</a></li>
</ul>
</li>
<li><a href="#33-runtime-efficiency">3.3 Runtime Efficiency</a><ul>
<li><a href="#spring-boot-6">Spring Boot</a></li>
<li><a href="#quarkus-6">Quarkus</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ecosystem-and-community">Ecosystem and Community</a><ul>
<li><a href="#41-spring-ecosystem">4.1 Spring Ecosystem</a></li>
<li><a href="#42-quarkus-ecosystem">4.2 Quarkus Ecosystem</a></li>
<li><a href="#43-community-support">4.3 Community Support</a><ul>
<li><a href="#spring-boot-7">Spring Boot</a></li>
<li><a href="#quarkus-7">Quarkus</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sample-code">Sample Code</a><ul>
<li><a href="#51-spring-boot-example">5.1 Spring Boot Example</a></li>
<li><a href="#52-quarkus-example">5.2 Quarkus Example</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Spring Boot and Quarkus are two of the most popular frameworks for building Java applications. Both frameworks aim to simplify the development process and provide robust solutions for modern application development. However, they have different philosophies and approaches. This article will provide a detailed comparison of Spring Boot and Quarkus, exploring their architecture, performance, ecosystem, and community support.</p>
<p><a name="architecture"></a></p>
<h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p><a name="21-overview"></a></p>
<h3 id="2-1-Overview"><a href="#2-1-Overview" class="headerlink" title="2.1 Overview"></a>2.1 Overview</h3><h4 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot is built on top of the Spring framework and provides a streamlined way to create stand-alone, production-grade Spring-based applications. It leverages the Spring ecosystem to offer a wide range of features out of the box.</p>
<h4 id="Quarkus"><a href="#Quarkus" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus is a Kubernetes-native Java framework designed for OpenJDK HotSpot and GraalVM. It is optimized for low memory usage and fast startup times, making it ideal for cloud-native applications.</p>
<p><a name="22-microservices"></a></p>
<h3 id="2-2-Microservices"><a href="#2-2-Microservices" class="headerlink" title="2.2 Microservices"></a>2.2 Microservices</h3><h4 id="Spring-Boot-1"><a href="#Spring-Boot-1" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot is well-suited for building microservices. It provides built-in support for service discovery, configuration management, and circuit breakers through Spring Cloud Kubernetes, which integrates with Kubernetes’ native service discovery mechanisms.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+       +-------------------+       +----------------------------------+</span><br><span class="line">| Spring Boot       |       | Spring Cloud      |       | Kubernetes                       |</span><br><span class="line">| Microservice      |       | Kubernetes        |       | (Service Discovery and Config    |</span><br><span class="line">+-------------------+       +-------------------+       +----------------------------------+</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (1) Service Discovery     |                           |</span><br><span class="line">        |--------------------------&gt;|                           |</span><br><span class="line">        |                           | (2) Configuration Fetch   |</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (3) Circuit Breaker       |                           |</span><br><span class="line">        |&lt;--------------------------|                           |</span><br><span class="line">        |                           |                           |</span><br><span class="line">+-------------------+       +-------------------+       +--------------------------------+</span><br><span class="line">| Spring Boot       |       | Spring Cloud      |       | Kubernetes                     |</span><br><span class="line">| Microservice      |       | Kubernetes        |       | (Service Discovery and Config  |</span><br><span class="line">+-------------------+       +-------------------+       +--------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="Quarkus-1"><a href="#Quarkus-1" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus also supports microservices with extensions for service discovery, configuration management, and fault tolerance. It integrates well with Kubernetes and provides native support for GraalVM.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Quarkus           |       | Kubernetes        |       | GraalVM           |</span><br><span class="line">| Microservice      |       | (Service Discovery|       | (Native Image)    |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (1) Service Discovery     |                           |</span><br><span class="line">        |--------------------------&gt;|                           |</span><br><span class="line">        |                           | (2) Configuration Fetch  |</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (3) Native Image Build    |                           |</span><br><span class="line">        |&lt;--------------------------|                           |</span><br><span class="line">        |                           |                           |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Quarkus           |       | Kubernetes        |       | GraalVM           |</span><br><span class="line">| Microservice      |       | (Service Discovery|       | (Native Image)    |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br></pre></td></tr></table></figure>

<p><a name="23-dependency-injection"></a></p>
<h3 id="2-3-Dependency-Injection"><a href="#2-3-Dependency-Injection" class="headerlink" title="2.3 Dependency Injection"></a>2.3 Dependency Injection</h3><h4 id="Spring-Boot-2"><a href="#Spring-Boot-2" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot uses the Spring Framework’s dependency injection mechanism, which is based on the Inversion of Control (IoC) principle.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Spring Boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/message&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> myService.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Quarkus-2"><a href="#Quarkus-2" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus uses the Contexts and Dependency Injection (CDI) standard for dependency injection, which is part of the Java EE specification.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApplicationScoped</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Quarkus!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Path(&quot;/message&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyResource</span> &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces(MediaType.TEXT_PLAIN)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> myService.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="24-reactive-programming"></a></p>
<h3 id="2-4-Reactive-Programming"><a href="#2-4-Reactive-Programming" class="headerlink" title="2.4 Reactive Programming"></a>2.4 Reactive Programming</h3><h4 id="Spring-Boot-3"><a href="#Spring-Boot-3" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot supports reactive programming through Spring WebFlux, which is built on top of Project Reactor.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReactiveController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/reactive-message&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">getReactiveMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="string">&quot;Hello, Reactive Spring Boot!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Quarkus-3"><a href="#Quarkus-3" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus supports reactive programming through its Reactive Streams Operators and integrates well with frameworks like Vert.x.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Path(&quot;/reactive-message&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReactiveResource</span> &#123;</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces(MediaType.TEXT_PLAIN)</span></span><br><span class="line">    <span class="keyword">public</span> Uni&lt;String&gt; <span class="title function_">getReactiveMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Uni.createFrom().item(<span class="string">&quot;Hello, Reactive Quarkus!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="performance"></a></p>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><p><a name="31-startup-time"></a></p>
<h3 id="3-1-Startup-Time"><a href="#3-1-Startup-Time" class="headerlink" title="3.1 Startup Time"></a>3.1 Startup Time</h3><h4 id="Spring-Boot-4"><a href="#Spring-Boot-4" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot applications typically have a longer startup time due to the extensive initialization of the Spring framework.</p>
<h4 id="Quarkus-4"><a href="#Quarkus-4" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus applications have a much faster startup time, especially when using GraalVM to build native images.</p>
<p><a name="32-memory-usage"></a></p>
<h3 id="3-2-Memory-Usage"><a href="#3-2-Memory-Usage" class="headerlink" title="3.2 Memory Usage"></a>3.2 Memory Usage</h3><h4 id="Spring-Boot-5"><a href="#Spring-Boot-5" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot applications generally consume more memory due to the heavyweight nature of the Spring framework.</p>
<h4 id="Quarkus-5"><a href="#Quarkus-5" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus applications consume less memory, making them more efficient for containerized environments.</p>
<p><a name="33-runtime-efficiency"></a></p>
<h3 id="3-3-Runtime-Efficiency"><a href="#3-3-Runtime-Efficiency" class="headerlink" title="3.3 Runtime Efficiency"></a>3.3 Runtime Efficiency</h3><h4 id="Spring-Boot-6"><a href="#Spring-Boot-6" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot applications are optimized for traditional Java runtime environments.</p>
<h4 id="Quarkus-6"><a href="#Quarkus-6" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus applications are optimized for modern, cloud-native environments and can take advantage of GraalVM for native execution.</p>
<p><a name="ecosystem-and-community"></a></p>
<h2 id="Ecosystem-and-Community"><a href="#Ecosystem-and-Community" class="headerlink" title="Ecosystem and Community"></a>Ecosystem and Community</h2><p><a name="41-spring-ecosystem"></a></p>
<h3 id="4-1-Spring-Ecosystem"><a href="#4-1-Spring-Ecosystem" class="headerlink" title="4.1 Spring Ecosystem"></a>4.1 Spring Ecosystem</h3><p>Spring Boot benefits from the extensive Spring ecosystem, which includes Spring Data, Spring Security, Spring Cloud Kubernetes, and many other modules.</p>
<p><a name="42-quarkus-ecosystem"></a></p>
<h3 id="4-2-Quarkus-Ecosystem"><a href="#4-2-Quarkus-Ecosystem" class="headerlink" title="4.2 Quarkus Ecosystem"></a>4.2 Quarkus Ecosystem</h3><p>Quarkus has a growing ecosystem with extensions for various technologies, including databases, messaging systems, and cloud services.</p>
<p><a name="43-community-support"></a></p>
<h3 id="4-3-Community-Support"><a href="#4-3-Community-Support" class="headerlink" title="4.3 Community Support"></a>4.3 Community Support</h3><h4 id="Spring-Boot-7"><a href="#Spring-Boot-7" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><p>Spring Boot has a large and active community, with extensive documentation, tutorials, and third-party libraries.</p>
<h4 id="Quarkus-7"><a href="#Quarkus-7" class="headerlink" title="Quarkus"></a>Quarkus</h4><p>Quarkus has a rapidly growing community, with increasing support from Red Hat and other contributors.</p>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><p><a name="51-spring-boot-example"></a></p>
<h3 id="5-1-Spring-Boot-Example"><a href="#5-1-Spring-Boot-Example" class="headerlink" title="5.1 Spring Boot Example"></a>5.1 Spring Boot Example</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootExample.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Spring Boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="52-quarkus-example"></a></p>
<h3 id="5-2-Quarkus-Example"><a href="#5-2-Quarkus-Example" class="headerlink" title="5.2 Quarkus Example"></a>5.2 Quarkus Example</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.quarkus.runtime.Quarkus;</span><br><span class="line"><span class="keyword">import</span> io.quarkus.runtime.annotations.QuarkusMain;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.GET;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Path;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Produces;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.MediaType;</span><br><span class="line"></span><br><span class="line"><span class="meta">@QuarkusMain</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuarkusExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Quarkus.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Path(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloResource</span> &#123;</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Produces(MediaType.TEXT_PLAIN)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Quarkus!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Both Spring Boot and Quarkus are powerful frameworks for building Java applications, each with its own strengths and weaknesses. Spring Boot offers a mature and feature-rich ecosystem, making it a great choice for a wide range of applications. Quarkus, on the other hand, is optimized for modern, cloud-native environments and provides excellent performance and efficiency.</p>
<p>Choosing between Spring Boot and Quarkus depends on the specific requirements of your project, including performance, ecosystem, and community support. By understanding the differences and capabilities of both frameworks, you can make an informed decision that best suits your needs.</p>
<p><a name="references"></a></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-boot">Spring Boot Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://quarkus.io/guides/">Quarkus Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://www.baeldung.com/spring-boot-vs-quarkus">Spring Boot vs Quarkus: A Comprehensive Comparison</a></li>
</ul>
<hr>
<p>This article provides a comprehensive comparison of Spring Boot and Quarkus, covering their architecture, performance, ecosystem, and community support. By understanding these frameworks, developers can choose the best tool for their projects and build efficient and scalable applications.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-Keycloak/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-into-Keycloak/" class="post-title-link" itemprop="url">Deep Dive into Keycloak</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 23:31:11 / Modified: 23:32:50" itemprop="dateCreated datePublished" datetime="2024-10-27T23:31:11-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Keycloak/" itemprop="url" rel="index"><span itemprop="name">Keycloak</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#keycloak-architecture">Keycloak Architecture</a><ul>
<li><a href="#21-overview">2.1 Overview</a></li>
<li><a href="#22-key-components">2.2 Key Components</a></li>
<li><a href="#23-authentication-flows">2.3 Authentication Flows</a></li>
<li><a href="#24-authorization-services">2.4 Authorization Services</a></li>
<li><a href="#25-user-federation">2.5 User Federation</a></li>
<li><a href="#26-identity-brokering">2.6 Identity Brokering</a></li>
<li><a href="#27-admin-console">2.7 Admin Console</a></li>
</ul>
</li>
<li><a href="#practical-applications">Practical Applications</a><ul>
<li><a href="#31-single-sign-on-sso">3.1 Single Sign-On (SSO)</a></li>
<li><a href="#32-api-security">3.2 API Security</a></li>
<li><a href="#33-user-management">3.3 User Management</a></li>
<li><a href="#34-custom-extensions">3.4 Custom Extensions</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Keycloak is an open-source Identity and Access Management (IAM) solution that provides authentication, authorization, and user management for modern applications and services. It is designed to be easy to integrate with existing systems and supports a wide range of protocols and standards, including OAuth 2.0, OpenID Connect, and SAML. This article will delve into the architecture of Keycloak, exploring its components, features, and practical applications.</p>
<p><a name="keycloak-architecture"></a></p>
<h2 id="Keycloak-Architecture"><a href="#Keycloak-Architecture" class="headerlink" title="Keycloak Architecture"></a>Keycloak Architecture</h2><p><a name="21-overview"></a></p>
<h3 id="2-1-Overview"><a href="#2-1-Overview" class="headerlink" title="2.1 Overview"></a>2.1 Overview</h3><p>Keycloak is built on a modular architecture that allows for flexibility and extensibility. It consists of several key components that work together to provide a comprehensive IAM solution. The architecture can be divided into the following main areas:</p>
<ul>
<li><strong>Authentication</strong>: Handles user authentication and session management.</li>
<li><strong>Authorization</strong>: Provides fine-grained access control and permissions management.</li>
<li><strong>User Federation</strong>: Integrates with external user stores.</li>
<li><strong>Identity Brokering</strong>: Allows users to authenticate using external identity providers.</li>
<li><strong>Admin Console</strong>: Provides a web-based interface for managing Keycloak.</li>
</ul>
<p><a name="22-key-components"></a></p>
<h3 id="2-2-Key-Components"><a href="#2-2-Key-Components" class="headerlink" title="2.2 Key Components"></a>2.2 Key Components</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Client Application|       | Keycloak Server   |       | External Identity |</span><br><span class="line">| (e.g., Web App)   |       | (Auth Server)     |       | Provider (e.g.,   |</span><br><span class="line">|                   |       |                   |       | Google, Facebook)|</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (1) Authentication Request|                           |</span><br><span class="line">        |--------------------------&gt;|                           |</span><br><span class="line">        |                           | (2) Redirect to Auth Server|</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (3) User Authentication  |</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (4) Authorization Grant  |</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (5) Access Token Request  |</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (6) Access Token Response|</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (7) Access Resource       |                           |</span><br><span class="line">        |&lt;--------------------------|                           |</span><br><span class="line">        |                           |                           |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Resource Server   |       | Keycloak Server   |       | External Identity |</span><br><span class="line">| (e.g., API)       |       | (Auth Server)     |       | Provider (e.g.,   |</span><br><span class="line">|                   |       |                   |       | Google, Facebook)|</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br></pre></td></tr></table></figure>

<p><a name="23-authentication-flows"></a></p>
<h3 id="2-3-Authentication-Flows"><a href="#2-3-Authentication-Flows" class="headerlink" title="2.3 Authentication Flows"></a>2.3 Authentication Flows</h3><p>Keycloak supports various authentication flows, including:</p>
<ul>
<li><strong>Standard Flow</strong>: The default flow where the client redirects the user to the Keycloak server for authentication.</li>
<li><strong>Implicit Flow</strong>: Suitable for client-side applications where the access token is returned directly to the client.</li>
<li><strong>Direct Access Grants</strong>: Allows clients to obtain an access token using the resource owner’s credentials.</li>
<li><strong>Client Credentials</strong>: Used for machine-to-machine communication.</li>
</ul>
<p><a name="24-authorization-services"></a></p>
<h3 id="2-4-Authorization-Services"><a href="#2-4-Authorization-Services" class="headerlink" title="2.4 Authorization Services"></a>2.4 Authorization Services</h3><p>Keycloak provides fine-grained authorization services, including:</p>
<ul>
<li><strong>Role-Based Access Control (RBAC)</strong>: Assigns roles to users and defines permissions based on those roles.</li>
<li><strong>Policy-Based Access Control (PBAC)</strong>: Uses policies to define complex access control rules.</li>
<li><strong>Permission Management</strong>: Allows administrators to manage permissions for resources and users.</li>
</ul>
<p><a name="25-user-federation"></a></p>
<h3 id="2-5-User-Federation"><a href="#2-5-User-Federation" class="headerlink" title="2.5 User Federation"></a>2.5 User Federation</h3><p>Keycloak supports user federation, allowing integration with external user stores such as LDAP and Active Directory. This enables organizations to manage users in their existing user stores while leveraging Keycloak for authentication and authorization.</p>
<p><a name="26-identity-brokering"></a></p>
<h3 id="2-6-Identity-Brokering"><a href="#2-6-Identity-Brokering" class="headerlink" title="2.6 Identity Brokering"></a>2.6 Identity Brokering</h3><p>Keycloak supports identity brokering, allowing users to authenticate using external identity providers such as Google, Facebook, and GitHub. This enables organizations to provide a seamless authentication experience for users who prefer to use their existing accounts.</p>
<p><a name="27-admin-console"></a></p>
<h3 id="2-7-Admin-Console"><a href="#2-7-Admin-Console" class="headerlink" title="2.7 Admin Console"></a>2.7 Admin Console</h3><p>Keycloak provides a web-based admin console that allows administrators to manage users, roles, clients, and other Keycloak entities. The admin console is a powerful tool for configuring and managing Keycloak.</p>
<p><a name="practical-applications"></a></p>
<h2 id="Practical-Applications"><a href="#Practical-Applications" class="headerlink" title="Practical Applications"></a>Practical Applications</h2><p><a name="31-single-sign-on-sso"></a></p>
<h3 id="3-1-Single-Sign-On-SSO"><a href="#3-1-Single-Sign-On-SSO" class="headerlink" title="3.1 Single Sign-On (SSO)"></a>3.1 Single Sign-On (SSO)</h3><p>Keycloak enables Single Sign-On (SSO), allowing users to authenticate once and access multiple applications without re-entering their credentials. This is particularly useful in enterprise environments where users need to access multiple internal applications.</p>
<p><a name="32-api-security"></a></p>
<h3 id="3-2-API-Security"><a href="#3-2-API-Security" class="headerlink" title="3.2 API Security"></a>3.2 API Security</h3><p>Keycloak is widely used to secure APIs by providing access tokens that grant limited access to resources. This is essential for building secure microservices architectures.</p>
<p><a name="33-user-management"></a></p>
<h3 id="3-3-User-Management"><a href="#3-3-User-Management" class="headerlink" title="3.3 User Management"></a>3.3 User Management</h3><p>Keycloak provides comprehensive user management features, including user registration, profile management, and password management. It also supports user federation, allowing integration with external user stores.</p>
<p><a name="34-custom-extensions"></a></p>
<h3 id="3-4-Custom-Extensions"><a href="#3-4-Custom-Extensions" class="headerlink" title="3.4 Custom Extensions"></a>3.4 Custom Extensions</h3><p>Keycloak is highly extensible, allowing developers to create custom extensions to meet specific requirements. This includes custom authentication flows, custom user federation providers, and custom identity providers.</p>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Keycloak is a powerful and flexible Identity and Access Management solution that provides comprehensive authentication, authorization, and user management capabilities. Its modular architecture and support for various protocols and standards make it a popular choice for securing modern applications and services.</p>
<p>Understanding the architecture and features of Keycloak is essential for developers and administrators who want to leverage its capabilities to build secure and scalable applications. By leveraging Keycloak, organizations can provide a seamless and secure authentication and authorization experience for their users.</p>
<p><a name="references"></a></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.keycloak.org/documentation">Keycloak Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/keycloak/keycloak">Keycloak GitHub Repository</a></li>
<li><a target="_blank" rel="noopener" href="https://www.keycloak.org/getting-started">Keycloak: A Comprehensive Guide</a></li>
</ul>
<hr>
<p>This article provides a comprehensive overview of Keycloak, covering its architecture, components, and practical applications. By understanding Keycloak, developers and administrators can build secure and scalable applications that meet the demands of today’s digital landscape.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-OAuth-2-0-and-OpenID-Connect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-into-OAuth-2-0-and-OpenID-Connect/" class="post-title-link" itemprop="url">Deep Dive into OAuth 2.0 and OpenID Connect</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 23:23:58 / Modified: 23:28:14" itemprop="dateCreated datePublished" datetime="2024-10-27T23:23:58-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/OAuth/" itemprop="url" rel="index"><span itemprop="name">OAuth</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#oauth-20-the-authorization-framework">OAuth 2.0: The Authorization Framework</a><ul>
<li><a href="#11-overview">1.1 Overview</a></li>
<li><a href="#12-key-components">1.2 Key Components</a></li>
<li><a href="#13-authorization-grant-types">1.3 Authorization Grant Types</a></li>
<li><a href="#14-access-tokens-and-refresh-tokens">1.4 Access Tokens and Refresh Tokens</a></li>
<li><a href="#15-security-considerations">1.5 Security Considerations</a></li>
</ul>
</li>
<li><a href="#openid-connect-the-authentication-layer">OpenID Connect: The Authentication Layer</a><ul>
<li><a href="#21-overview">2.1 Overview</a></li>
<li><a href="#22-key-components">2.2 Key Components</a></li>
<li><a href="#23-authentication-flows">2.3 Authentication Flows</a></li>
<li><a href="#24-claims-and-scopes">2.4 Claims and Scopes</a></li>
<li><a href="#25-security-considerations">2.5 Security Considerations</a></li>
</ul>
</li>
<li><a href="#practical-applications">Practical Applications</a><ul>
<li><a href="#31-single-sign-on-sso">3.1 Single Sign-On (SSO)</a></li>
<li><a href="#32-api-authorization">3.2 API Authorization</a></li>
<li><a href="#33-mobile-and-iot-applications">3.3 Mobile and IoT Applications</a></li>
<li><a href="#34-federated-identity">3.4 Federated Identity</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In the modern web ecosystem, securing user data and managing authentication and authorization are critical tasks. OAuth 2.0 and OpenID Connect (OIDC) are two widely adopted standards that help developers achieve these goals. OAuth 2.0 focuses on authorization, while OpenID Connect extends OAuth 2.0 to provide authentication. This article will delve into the intricacies of both protocols, exploring their architecture, components, and practical applications.</p>
<p><a name="oauth-20-the-authorization-framework"></a></p>
<h2 id="OAuth-2-0-The-Authorization-Framework"><a href="#OAuth-2-0-The-Authorization-Framework" class="headerlink" title="OAuth 2.0: The Authorization Framework"></a>OAuth 2.0: The Authorization Framework</h2><p><a name="11-overview"></a></p>
<h3 id="1-1-Overview"><a href="#1-1-Overview" class="headerlink" title="1.1 Overview"></a>1.1 Overview</h3><p>OAuth 2.0 is an authorization framework that enables third-party applications to obtain limited access to a user’s resources without exposing the user’s credentials. It is designed to work across different platforms and environments, including web applications, mobile apps, and APIs.</p>
<p><a name="12-key-components"></a></p>
<h3 id="1-2-Key-Components"><a href="#1-2-Key-Components" class="headerlink" title="1.2 Key Components"></a>1.2 Key Components</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Resource Owner    |       | Client            |       | Authorization    |</span><br><span class="line">| (User)            |       | (Application)     |       | Server            |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (1) Authorization Request |                           |</span><br><span class="line">        |--------------------------&gt;|                           |</span><br><span class="line">        |                           | (2) Redirect to Auth Server|</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (3) User Authentication  |</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (4) Authorization Grant  |</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (5) Access Token Request  |</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (6) Access Token Response|</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (7) Access Resource       |                           |</span><br><span class="line">        |&lt;--------------------------|                           |</span><br><span class="line">        |                           |                           |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Resource Server   |       | Client            |       | Authorization    |</span><br><span class="line">| (API)             |       | (Application)     |       | Server            |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br></pre></td></tr></table></figure>

<p><a name="13-authorization-grant-types"></a></p>
<h3 id="1-3-Authorization-Grant-Types"><a href="#1-3-Authorization-Grant-Types" class="headerlink" title="1.3 Authorization Grant Types"></a>1.3 Authorization Grant Types</h3><p>OAuth 2.0 defines several grant types, each suited for different use cases:</p>
<ul>
<li><strong>Authorization Code</strong>: Used for server-side web applications. The client receives an authorization code from the authorization server and exchanges it for an access token.</li>
<li><strong>Implicit</strong>: Used for client-side web applications. The access token is returned directly to the client.</li>
<li><strong>Resource Owner Password Credentials</strong>: Used when the client has a trusted relationship with the resource owner (e.g., a mobile app).</li>
<li><strong>Client Credentials</strong>: Used for machine-to-machine communication where the client itself is the resource owner.</li>
<li><strong>Device Code</strong>: Used for devices with limited input capabilities (e.g., smart TVs).</li>
</ul>
<p><a name="14-access-tokens-and-refresh-tokens"></a></p>
<h3 id="1-4-Access-Tokens-and-Refresh-Tokens"><a href="#1-4-Access-Tokens-and-Refresh-Tokens" class="headerlink" title="1.4 Access Tokens and Refresh Tokens"></a>1.4 Access Tokens and Refresh Tokens</h3><ul>
<li><strong>Access Token</strong>: A credential that the client uses to access the resource server. It has a limited lifetime and is typically short-lived.</li>
<li><strong>Refresh Token</strong>: A long-lived token that the client can use to obtain a new access token when the current one expires.</li>
</ul>
<p><a name="15-security-considerations"></a></p>
<h3 id="1-5-Security-Considerations"><a href="#1-5-Security-Considerations" class="headerlink" title="1.5 Security Considerations"></a>1.5 Security Considerations</h3><ul>
<li><strong>Token Storage</strong>: Access tokens should be stored securely, especially in client-side applications.</li>
<li><strong>Token Expiry</strong>: Access tokens should have a short expiration time to minimize the risk of misuse.</li>
<li><strong>Token Revocation</strong>: Mechanisms should be in place to revoke tokens if they are compromised.</li>
</ul>
<p><a name="openid-connect-the-authentication-layer"></a></p>
<h2 id="OpenID-Connect-The-Authentication-Layer"><a href="#OpenID-Connect-The-Authentication-Layer" class="headerlink" title="OpenID Connect: The Authentication Layer"></a>OpenID Connect: The Authentication Layer</h2><p><a name="21-overview"></a></p>
<h3 id="2-1-Overview"><a href="#2-1-Overview" class="headerlink" title="2.1 Overview"></a>2.1 Overview</h3><p>OpenID Connect (OIDC) is an authentication layer built on top of OAuth 2.0. It allows clients to verify the identity of the end-user based on the authentication performed by an authorization server. OIDC adds an ID token, which contains information about the authenticated user.</p>
<p><a name="22-key-components"></a></p>
<h3 id="2-2-Key-Components"><a href="#2-2-Key-Components" class="headerlink" title="2.2 Key Components"></a>2.2 Key Components</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Resource Owner    |       | Client            |       | Authorization    |</span><br><span class="line">| (User)            |       | (Application)     |       | Server            |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (1) Authorization Request |                           |</span><br><span class="line">        |--------------------------&gt;|                           |</span><br><span class="line">        |                           | (2) Redirect to Auth Server|</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (3) User Authentication  |</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (4) Authorization Grant  |</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (5) Access Token Request  |</span><br><span class="line">        |                           |--------------------------&gt;|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (6) Access Token Response|</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (7) Access Resource       |                           |</span><br><span class="line">        |&lt;--------------------------|                           |</span><br><span class="line">        |                           |                           |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Resource Server   |       | Client            |       | Authorization    |</span><br><span class="line">| (API)             |       | (Application)     |       | Server            |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">        |                           |                           |</span><br><span class="line">        |                           | (8) ID Token             |</span><br><span class="line">        |                           |&lt;--------------------------|</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (9) UserInfo Request      |                           |</span><br><span class="line">        |&lt;--------------------------|                           |</span><br><span class="line">        |                           |                           |</span><br><span class="line">        | (10) UserInfo Response    |                           |</span><br><span class="line">        |&lt;--------------------------|                           |</span><br><span class="line">        |                           |                           |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br><span class="line">| Resource Server   |       | Client            |       | Authorization    |</span><br><span class="line">| (API)             |       | (Application)     |       | Server            |</span><br><span class="line">+-------------------+       +-------------------+       +-------------------+</span><br></pre></td></tr></table></figure>

<p><a name="23-authentication-flows"></a></p>
<h3 id="2-3-Authentication-Flows"><a href="#2-3-Authentication-Flows" class="headerlink" title="2.3 Authentication Flows"></a>2.3 Authentication Flows</h3><ul>
<li><strong>Authorization Code Flow</strong>: Similar to OAuth 2.0’s authorization code grant, but with the addition of the ID token.</li>
<li><strong>Implicit Flow</strong>: Similar to OAuth 2.0’s implicit grant, but with the addition of the ID token.</li>
<li><strong>Hybrid Flow</strong>: Combines aspects of both the authorization code and implicit flows.</li>
</ul>
<p><a name="24-claims-and-scopes"></a></p>
<h3 id="2-4-Claims-and-Scopes"><a href="#2-4-Claims-and-Scopes" class="headerlink" title="2.4 Claims and Scopes"></a>2.4 Claims and Scopes</h3><ul>
<li><strong>Claims</strong>: Information about the authenticated user, such as name, email, and profile picture.</li>
<li><strong>Scopes</strong>: Permissions requested by the client, such as <code>openid</code>, <code>profile</code>, <code>email</code>, and <code>address</code>.</li>
</ul>
<p><a name="25-security-considerations"></a></p>
<h3 id="2-5-Security-Considerations"><a href="#2-5-Security-Considerations" class="headerlink" title="2.5 Security Considerations"></a>2.5 Security Considerations</h3><ul>
<li><strong>Token Validation</strong>: Clients must validate ID tokens to ensure they are authentic and have not been tampered with.</li>
<li><strong>Scope Management</strong>: Clients should request only the scopes necessary for their functionality.</li>
<li><strong>Session Management</strong>: Mechanisms should be in place to manage user sessions and handle logout.</li>
</ul>
<p><a name="practical-applications"></a></p>
<h2 id="Practical-Applications"><a href="#Practical-Applications" class="headerlink" title="Practical Applications"></a>Practical Applications</h2><p><a name="31-single-sign-on-sso"></a></p>
<h3 id="3-1-Single-Sign-On-SSO"><a href="#3-1-Single-Sign-On-SSO" class="headerlink" title="3.1 Single Sign-On (SSO)"></a>3.1 Single Sign-On (SSO)</h3><p>OAuth 2.0 and OpenID Connect enable Single Sign-On (SSO), allowing users to authenticate once and access multiple applications without re-entering their credentials. This is particularly useful in enterprise environments where users need to access multiple internal applications.</p>
<p><a name="32-api-authorization"></a></p>
<h3 id="3-2-API-Authorization"><a href="#3-2-API-Authorization" class="headerlink" title="3.2 API Authorization"></a>3.2 API Authorization</h3><p>OAuth 2.0 is widely used to secure APIs by providing access tokens that grant limited access to resources. This is essential for building secure microservices architectures.</p>
<p><a name="33-mobile-and-iot-applications"></a></p>
<h3 id="3-3-Mobile-and-IoT-Applications"><a href="#3-3-Mobile-and-IoT-Applications" class="headerlink" title="3.3 Mobile and IoT Applications"></a>3.3 Mobile and IoT Applications</h3><p>OAuth 2.0’s device code grant type is particularly useful for devices with limited input capabilities, such as smart TVs and IoT devices. It allows users to authenticate on a secondary device (e.g., a smartphone) and grant access to the primary device.</p>
<p><a name="34-federated-identity"></a></p>
<h3 id="3-4-Federated-Identity"><a href="#3-4-Federated-Identity" class="headerlink" title="3.4 Federated Identity"></a>3.4 Federated Identity</h3><p>OpenID Connect enables federated identity, allowing users to authenticate using their existing credentials from a trusted identity provider (e.g., Google, Facebook). This reduces the need for users to create new accounts and manage multiple sets of credentials.</p>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>OAuth 2.0 and OpenID Connect are powerful tools for securing modern web applications. OAuth 2.0 provides a flexible framework for authorization, while OpenID Connect adds an authentication layer on top of it. Together, they enable secure, scalable, and user-friendly authentication and authorization solutions.</p>
<p>Understanding the intricacies of these protocols is essential for developers building secure applications in today’s interconnected world. By leveraging OAuth 2.0 and OpenID Connect, developers can ensure that their applications are both secure and user-friendly.</p>
<p><a name="references"></a></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749">OAuth 2.0 Specification</a></li>
<li><a target="_blank" rel="noopener" href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a></li>
<li><a target="_blank" rel="noopener" href="https://www.oauth.com/">OAuth 2.0 and OpenID Connect: A Comprehensive Guide</a></li>
</ul>
<p>This article provides a comprehensive overview of OAuth 2.0 and OpenID Connect, covering their architecture, components, and practical applications. By understanding these protocols, developers can build secure and scalable applications that meet the demands of today’s digital landscape.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-MapStruct-A-Java-Bean-Mapping-Framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/27/Deep-Dive-into-MapStruct-A-Java-Bean-Mapping-Framework/" class="post-title-link" itemprop="url">Deep Dive into MapStruct: A Java Bean Mapping Framework</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 22:41:24 / Modified: 22:57:33" itemprop="dateCreated datePublished" datetime="2024-10-27T22:41:24-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/MapStruct/" itemprop="url" rel="index"><span itemprop="name">MapStruct</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#why-use-mapstruct">Why Use MapStruct?</a></li>
<li><a href="#how-to-use-mapstruct-in-spring-boot">How to Use MapStruct in Spring Boot</a></li>
<li><a href="#benefits-and-advantages">Benefits and Advantages</a></li>
<li><a href="#textual-diagram">Textual Diagram</a></li>
<li><a href="#sample-code">Sample Code</a></li>
<li><a href="#generated-mapper-code">Generated Mapper Code</a></li>
<li><a href="#excluding-certain-attributes">Excluding Certain Attributes</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>MapStruct is a Java annotation processor for the generation of type-safe and performant bean mapping code. It simplifies the mapping between different Java bean types by automatically generating the necessary mapping code at compile time. This article will explore why and how to use MapStruct in a Spring Boot application, its benefits and advantages, and provide detailed sample code.</p>
<hr>
<p><a name="why-use-mapstruct"></a></p>
<h2 id="Why-Use-MapStruct"><a href="#Why-Use-MapStruct" class="headerlink" title="Why Use MapStruct?"></a>Why Use MapStruct?</h2><h3 id="Manual-Mapping"><a href="#Manual-Mapping" class="headerlink" title="Manual Mapping"></a>Manual Mapping</h3><p>Manual mapping between Java beans can be tedious and error-prone. It often involves writing repetitive and boilerplate code, which can lead to maintenance issues.</p>
<h3 id="Reflection-Based-Mapping"><a href="#Reflection-Based-Mapping" class="headerlink" title="Reflection-Based Mapping"></a>Reflection-Based Mapping</h3><p>Frameworks like Dozer use reflection to map beans, which can be slow and difficult to debug. Reflection-based mapping also lacks type safety and can lead to runtime errors.</p>
<h3 id="MapStruct"><a href="#MapStruct" class="headerlink" title="MapStruct"></a>MapStruct</h3><p>MapStruct generates mapping code at compile time, ensuring type safety and performance. It reduces boilerplate code and makes the mapping process more maintainable and easier to debug.</p>
<hr>
<p><a name="how-to-use-mapstruct-in-spring-boot"></a></p>
<h2 id="How-to-Use-MapStruct-in-Spring-Boot"><a href="#How-to-Use-MapStruct-in-Spring-Boot" class="headerlink" title="How to Use MapStruct in Spring Boot"></a>How to Use MapStruct in Spring Boot</h2><h3 id="Step-1-Add-Dependencies"><a href="#Step-1-Add-Dependencies" class="headerlink" title="Step 1: Add Dependencies"></a>Step 1: Add Dependencies</h3><p>Add the necessary dependencies to your <code>pom.xml</code> file. Note that we are using the latest version of MapStruct.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot Starter --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- MapStruct --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- MapStruct Processor --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Step-2-Define-Mapping-Interface"><a href="#Step-2-Define-Mapping-Interface" class="headerlink" title="Step 2: Define Mapping Interface"></a>Step 2: Define Mapping Interface</h3><p>Create a mapping interface using the <code>@Mapper</code> annotation.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mapstruct.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.factory.Mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;birthDate&quot;, target = &quot;birthDate&quot;, dateFormat = &quot;yyyyMMdd&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// Exclude password attribute</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;email&quot;, target = &quot;emailAddress&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;birthDate&quot;, expression = &quot;java(LocalDate.parse(userDTO.getBirthDate(), DateTimeFormatter.ofPattern(\&quot;yyyyMMdd\&quot;)))&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// Exclude password attribute</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO userDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Step-3-Use-the-Mapper"><a href="#Step-3-Use-the-Mapper" class="headerlink" title="Step 3: Use the Mapper"></a>Step 3: Use the Mapper</h3><p>Inject the mapper into your service or controller and use it to map between beans.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> UserMapper.INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.userToUserDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.userDTOToUser(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="benefits-and-advantages"></a></p>
<h2 id="Benefits-and-Advantages"><a href="#Benefits-and-Advantages" class="headerlink" title="Benefits and Advantages"></a>Benefits and Advantages</h2><h3 id="Type-Safety"><a href="#Type-Safety" class="headerlink" title="Type Safety"></a>Type Safety</h3><p>MapStruct generates type-safe mapping code at compile time, reducing the risk of runtime errors.</p>
<h3 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h3><p>Since the mapping code is generated at compile time, it avoids the performance overhead associated with reflection-based mapping.</p>
<h3 id="Maintainability"><a href="#Maintainability" class="headerlink" title="Maintainability"></a>Maintainability</h3><p>MapStruct reduces boilerplate code, making the mapping process more maintainable and easier to understand.</p>
<h3 id="Customization"><a href="#Customization" class="headerlink" title="Customization"></a>Customization</h3><p>MapStruct allows for easy customization of mappings through annotations and configuration options.</p>
<hr>
<p><a name="textual-diagram"></a></p>
<h2 id="Textual-Diagram"><a href="#Textual-Diagram" class="headerlink" title="Textual Diagram"></a>Textual Diagram</h2><pre><code class="highlight mermaid">graph TD
    A[User Entity] --&gt;|MapStruct| B[User DTO]
    B --&gt;|MapStruct| C[User Entity]
    D[User Service] --&gt;|Uses| A
    D --&gt;|Uses| B
    E[User Controller] --&gt;|Uses| D</code></pre>

<h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><ol>
<li><strong>User Entity</strong>: Represents the domain object.</li>
<li><strong>User DTO</strong>: Represents the data transfer object.</li>
<li><strong>MapStruct</strong>: Generates mapping code between User Entity and User DTO.</li>
<li><strong>User Service</strong>: Uses the MapStruct-generated mapper to convert between User Entity and User DTO.</li>
<li><strong>User Controller</strong>: Uses the User Service to handle requests and responses.</li>
</ol>
<hr>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="User-Entity"><a href="#User-Entity" class="headerlink" title="User Entity"></a>User Entity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String emailAddress;</span><br><span class="line">    <span class="keyword">private</span> LocalDate birthDate;</span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">// Password attribute to be excluded</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="User-DTO"><a href="#User-DTO" class="headerlink" title="User DTO"></a>User DTO</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String birthDate;</span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">// Password attribute to be excluded</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="User-Mapper"><a href="#User-Mapper" class="headerlink" title="User Mapper"></a>User Mapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mapstruct.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.factory.Mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;birthDate&quot;, target = &quot;birthDate&quot;, dateFormat = &quot;yyyyMMdd&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// Exclude password attribute</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;email&quot;, target = &quot;emailAddress&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;birthDate&quot;, expression = &quot;java(LocalDate.parse(userDTO.getBirthDate(), DateTimeFormatter.ofPattern(\&quot;yyyyMMdd\&quot;)))&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// Exclude password attribute</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO userDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="User-Service"><a href="#User-Service" class="headerlink" title="User Service"></a>User Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> UserMapper.INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.userToUserDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.userDTOToUser(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="User-Controller"><a href="#User-Controller" class="headerlink" title="User Controller"></a>User Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserDTO</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(); <span class="comment">// Assume this is fetched from a repository</span></span><br><span class="line">        <span class="keyword">return</span> userService.getUserDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getUser(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="generated-mapper-code"></a></p>
<h2 id="Generated-Mapper-Code"><a href="#Generated-Mapper-Code" class="headerlink" title="Generated Mapper Code"></a>Generated Mapper Code</h2><p>After compiling the project, MapStruct will generate the following mapper implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        userDTO.setId(user.getId());</span><br><span class="line">        userDTO.setName(user.getName());</span><br><span class="line">        userDTO.setEmail(user.getEmailAddress());</span><br><span class="line">        userDTO.setBirthDate(user.getBirthDate().format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMMdd&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userDTO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userDTO == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(userDTO.getId());</span><br><span class="line">        user.setName(userDTO.getName());</span><br><span class="line">        user.setEmailAddress(userDTO.getEmail());</span><br><span class="line">        user.setBirthDate(LocalDate.parse(userDTO.getBirthDate(), DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMMdd&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="excluding-certain-attributes"></a></p>
<h2 id="Excluding-Certain-Attributes"><a href="#Excluding-Certain-Attributes" class="headerlink" title="Excluding Certain Attributes"></a>Excluding Certain Attributes</h2><h3 id="Exclude-Attribute-Example"><a href="#Exclude-Attribute-Example" class="headerlink" title="Exclude Attribute Example"></a>Exclude Attribute Example</h3><p>In the <code>UserMapper</code> interface, we use the <code>@Mapping</code> annotation with <code>ignore = true</code> to exclude the <code>password</code> attribute from the mapping.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;birthDate&quot;, target = &quot;birthDate&quot;, dateFormat = &quot;yyyyMMdd&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// Exclude password attribute</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;email&quot;, target = &quot;emailAddress&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;birthDate&quot;, expression = &quot;java(LocalDate.parse(userDTO.getBirthDate(), DateTimeFormatter.ofPattern(\&quot;yyyyMMdd\&quot;)))&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// Exclude password attribute</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO userDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Generated-Mapper-Code-with-Exclusion"><a href="#Generated-Mapper-Code-with-Exclusion" class="headerlink" title="Generated Mapper Code with Exclusion"></a>Generated Mapper Code with Exclusion</h3><p>The generated mapper code will exclude the <code>password</code> attribute from the mapping.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        userDTO.setId(user.getId());</span><br><span class="line">        userDTO.setName(user.getName());</span><br><span class="line">        userDTO.setEmail(user.getEmailAddress());</span><br><span class="line">        userDTO.setBirthDate(user.getBirthDate().format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMMdd&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userDTO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userDTO == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(userDTO.getId());</span><br><span class="line">        user.setName(userDTO.getName());</span><br><span class="line">        user.setEmailAddress(userDTO.getEmail());</span><br><span class="line">        user.setBirthDate(LocalDate.parse(userDTO.getBirthDate(), DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMMdd&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>MapStruct is a powerful and efficient Java bean mapping framework that simplifies the process of mapping between different Java bean types. By generating type-safe and performant mapping code at compile time, MapStruct reduces boilerplate code, improves maintainability, and enhances the overall quality of your Spring Boot applications. Whether you are working on a small project or a large enterprise application, MapStruct is a valuable tool that can significantly streamline your development process.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
