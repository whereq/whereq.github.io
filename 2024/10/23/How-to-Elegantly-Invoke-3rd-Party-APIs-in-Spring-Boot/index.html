<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="How to Elegantly Invoke 3rd Party APIs in Spring Boot with Retries and Circuit Breakers 1. Basic API Invocation Using RestTemplate Key Points: 2. Elegant Error Handling with RestTemplate Key Points:">
<meta property="og:type" content="article">
<meta property="og:title" content="How to Elegantly Invoke 3rd Party APIs in Spring Boot">
<meta property="og:url" content="https://www.whereq.com/2024/10/23/How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:description" content="How to Elegantly Invoke 3rd Party APIs in Spring Boot with Retries and Circuit Breakers 1. Basic API Invocation Using RestTemplate Key Points: 2. Elegant Error Handling with RestTemplate Key Points:">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-10-24T00:20:44.000Z">
<meta property="article:modified_time" content="2024-10-25T22:21:45.270Z">
<meta property="article:author" content="Dazhi Zhang">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="API">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/2024/10/23/How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.whereq.com/2024/10/23/How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot/","path":"2024/10/23/How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot/","title":"How to Elegantly Invoke 3rd Party APIs in Spring Boot"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>How to Elegantly Invoke 3rd Party APIs in Spring Boot | WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WhereQ</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot-with-Retries-and-Circuit-Breakers"><span class="nav-number">1.</span> <span class="nav-text">How to Elegantly Invoke 3rd Party APIs in Spring Boot with Retries and Circuit Breakers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Basic-API-Invocation-Using-RestTemplate"><span class="nav-number">1.0.1.</span> <span class="nav-text">1. Basic API Invocation Using RestTemplate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Points"><span class="nav-number">1.0.2.</span> <span class="nav-text">Key Points:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Elegant-Error-Handling-with-RestTemplate"><span class="nav-number">1.0.3.</span> <span class="nav-text">2. Elegant Error Handling with RestTemplate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Points-1"><span class="nav-number">1.0.4.</span> <span class="nav-text">Key Points:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Retries-Using-RetryTemplate-with-Annotations"><span class="nav-number">1.0.5.</span> <span class="nav-text">3. Retries Using RetryTemplate with Annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-Retryable-Annotation"><span class="nav-number">1.0.5.1.</span> <span class="nav-text">Using @Retryable Annotation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Explanation"><span class="nav-number">1.0.5.2.</span> <span class="nav-text">Explanation:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Points-2"><span class="nav-number">1.0.6.</span> <span class="nav-text">Key Points:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Circuit-Breaker-with-Resilience4j-and-Annotations"><span class="nav-number">1.0.7.</span> <span class="nav-text">4. Circuit Breaker with Resilience4j and Annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dependency-Setup"><span class="nav-number">1.0.7.1.</span> <span class="nav-text">Dependency Setup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Circuit-Breaker-Configuration"><span class="nav-number">1.0.7.2.</span> <span class="nav-text">Circuit Breaker Configuration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-Resilience4j-Annotations"><span class="nav-number">1.0.7.3.</span> <span class="nav-text">Using Resilience4j Annotations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Explanation-1"><span class="nav-number">1.0.7.4.</span> <span class="nav-text">Explanation:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Points-3"><span class="nav-number">1.0.8.</span> <span class="nav-text">Key Points:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Sample-Code-with-Annotations"><span class="nav-number">1.0.9.</span> <span class="nav-text">5. Sample Code with Annotations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Points-4"><span class="nav-number">1.0.10.</span> <span class="nav-text">Key Points:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Diagrams"><span class="nav-number">1.0.11.</span> <span class="nav-text">Diagrams</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Points-5"><span class="nav-number">1.0.12.</span> <span class="nav-text">Key Points:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Conclusion"><span class="nav-number">1.0.13.</span> <span class="nav-text">6. Conclusion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Takeaways"><span class="nav-number">1.0.14.</span> <span class="nav-text">Key Takeaways:</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">110</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">70</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/23/How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="How to Elegantly Invoke 3rd Party APIs in Spring Boot | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          How to Elegantly Invoke 3rd Party APIs in Spring Boot
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-23 20:20:44" itemprop="dateCreated datePublished" datetime="2024-10-23T20:20:44-04:00">2024-10-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-10-25 18:21:45" itemprop="dateModified" datetime="2024-10-25T18:21:45-04:00">2024-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/API/" itemprop="url" rel="index"><span itemprop="name">API</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><ul>
<li><a href="#how-to-elegantly-invoke-3rd-party-apis-in-spring-boot-with-retries-and-circuit-breakers">How to Elegantly Invoke 3rd Party APIs in Spring Boot with Retries and Circuit Breakers</a><ul>
<li><a href="#1-basic-api-invocation-using-resttemplate">1. Basic API Invocation Using <code>RestTemplate</code></a></li>
<li><a href="#key-points">Key Points:</a></li>
<li><a href="#2-elegant-error-handling-with-resttemplate">2. Elegant Error Handling with <code>RestTemplate</code></a></li>
<li><a href="#key-points-1">Key Points:</a></li>
<li><a href="#3-retries-using-retrytemplate-with-annotations">3. Retries Using <code>RetryTemplate</code> with Annotations</a><ul>
<li><a href="#using-retryable-annotation">Using <code>@Retryable</code> Annotation</a></li>
<li><a href="#explanation">Explanation:</a></li>
</ul>
</li>
<li><a href="#key-points-2">Key Points:</a></li>
<li><a href="#4-circuit-breaker-with-resilience4j-and-annotations">4. Circuit Breaker with Resilience4j and Annotations</a><ul>
<li><a href="#dependency-setup">Dependency Setup</a></li>
<li><a href="#circuit-breaker-configuration">Circuit Breaker Configuration</a></li>
<li><a href="#using-resilience4j-annotations">Using Resilience4j Annotations</a></li>
<li><a href="#explanation-1">Explanation:</a></li>
</ul>
</li>
<li><a href="#key-points-3">Key Points:</a></li>
<li><a href="#5-sample-code-with-annotations">5. Sample Code with Annotations</a></li>
<li><a href="#key-points-4">Key Points:</a></li>
<li><a href="#diagrams">Diagrams</a></li>
<li><a href="#key-points-5">Key Points:</a></li>
<li><a href="#6-conclusion">6. Conclusion</a></li>
<li><a href="#key-takeaways">Key Takeaways:</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot-with-Retries-and-Circuit-Breakers"><a href="#How-to-Elegantly-Invoke-3rd-Party-APIs-in-Spring-Boot-with-Retries-and-Circuit-Breakers" class="headerlink" title="How to Elegantly Invoke 3rd Party APIs in Spring Boot with Retries and Circuit Breakers"></a>How to Elegantly Invoke 3rd Party APIs in Spring Boot with Retries and Circuit Breakers</h1><hr>
<p>When integrating with third-party APIs, ensuring robust and fault-tolerant API invocations is crucial for a resilient microservices architecture. In this updated guide, we will expand on retry mechanisms and fallback strategies, introducing annotations for retries and fallbacks. We will also explore enhanced usage of Resilience4j for circuit breaking, along with retry policies via <code>RetryTemplate</code> and Spring’s <code>@Retryable</code> annotation.</p>
<hr>
<h3 id="1-Basic-API-Invocation-Using-RestTemplate"><a href="#1-Basic-API-Invocation-Using-RestTemplate" class="headerlink" title="1. Basic API Invocation Using RestTemplate"></a>1. Basic API Invocation Using <code>RestTemplate</code></h3><p><a name="1-basic-api-invocation-using-resttemplate"></a></p>
<p>We start with a simple HTTP client in Spring Boot, using <code>RestTemplate</code> to invoke a third-party API. Although basic, this approach lacks resilience for handling errors or failures in the third-party service.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiService</span><span class="params">(RestTemplateBuilder restTemplateBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplateBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">invokeExternalApi</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Key-Points"><a href="#Key-Points" class="headerlink" title="Key Points:"></a>Key Points:</h3><ul>
<li><strong>RestTemplate</strong>: Basic HTTP client for API invocation.</li>
<li><strong>Lack of Resilience</strong>: No built-in error handling or retry mechanisms.</li>
</ul>
<hr>
<h3 id="2-Elegant-Error-Handling-with-RestTemplate"><a href="#2-Elegant-Error-Handling-with-RestTemplate" class="headerlink" title="2. Elegant Error Handling with RestTemplate"></a>2. Elegant Error Handling with <code>RestTemplate</code></h3><p><a name="2-elegant-error-handling-with-resttemplate"></a></p>
<p>Error handling can be enhanced by implementing custom error handling for different types of HTTP status codes using <code>ResponseErrorHandler</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiService</span><span class="params">(RestTemplateBuilder restTemplateBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplateBuilder</span><br><span class="line">                            .errorHandler(<span class="keyword">new</span> <span class="title class_">CustomErrorHandler</span>())  <span class="comment">// custom error handler</span></span><br><span class="line">                            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">invokeExternalApi</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (HttpClientErrorException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Client error: &quot;</span> + ex.getStatusCode();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (HttpServerErrorException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Server error: &quot;</span> + ex.getStatusCode();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomErrorHandler</span> <span class="keyword">implements</span> <span class="title class_">ResponseErrorHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasError</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> response.getStatusCode().is4xxClientError() || response.getStatusCode().is5xxServerError();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleError</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// Custom error handling</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Key-Points-1"><a href="#Key-Points-1" class="headerlink" title="Key Points:"></a>Key Points:</h3><ul>
<li><strong>Custom Error Handler</strong>: Implements <code>ResponseErrorHandler</code> for fine-grained error handling.</li>
<li><strong>Exception Handling</strong>: Catches specific HTTP exceptions for client and server errors.</li>
</ul>
<hr>
<h3 id="3-Retries-Using-RetryTemplate-with-Annotations"><a href="#3-Retries-Using-RetryTemplate-with-Annotations" class="headerlink" title="3. Retries Using RetryTemplate with Annotations"></a>3. Retries Using <code>RetryTemplate</code> with Annotations</h3><p><a name="3-retries-using-retrytemplate-with-annotations"></a></p>
<p>Spring Retry provides powerful retry mechanisms that can be applied using annotations for cleaner code. The <code>@Retryable</code> annotation helps trigger automatic retries when exceptions occur.</p>
<h4 id="Using-Retryable-Annotation"><a href="#Using-Retryable-Annotation" class="headerlink" title="Using @Retryable Annotation"></a>Using <code>@Retryable</code> Annotation</h4><p><a name="using-retryable-annotation"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiService</span><span class="params">(RestTemplateBuilder restTemplateBuilder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplateBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Retryable(</span></span><br><span class="line"><span class="meta">        value = &#123; HttpServerErrorException.class &#125;,</span></span><br><span class="line"><span class="meta">        maxAttempts = 5,</span></span><br><span class="line"><span class="meta">        backoff = @Backoff(delay = 2000)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">invokeExternalApiWithRetry</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Recover</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">recover</span><span class="params">(HttpServerErrorException e, String url)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Fallback response for: &quot;</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation:"></a>Explanation:</h4><p><a name="explanation"></a></p>
<ul>
<li><strong>@Retryable</strong>: Specifies retryable exceptions (e.g., <code>HttpServerErrorException</code>), with configurable maximum attempts and backoff strategy.</li>
<li><strong>@Recover</strong>: Defines a fallback method that triggers when retries are exhausted.</li>
</ul>
<h3 id="Key-Points-2"><a href="#Key-Points-2" class="headerlink" title="Key Points:"></a>Key Points:</h3><ul>
<li><strong>Retry Logic</strong>: Automatically retries failed API calls.</li>
<li><strong>Fallback Mechanism</strong>: Provides a fallback response when retries fail.</li>
</ul>
<hr>
<h3 id="4-Circuit-Breaker-with-Resilience4j-and-Annotations"><a href="#4-Circuit-Breaker-with-Resilience4j-and-Annotations" class="headerlink" title="4. Circuit Breaker with Resilience4j and Annotations"></a>4. Circuit Breaker with Resilience4j and Annotations</h3><p><a name="4-circuit-breaker-with-resilience4j-and-annotations"></a></p>
<p>Resilience4j is a lightweight, easy-to-use fault tolerance library designed for Java 8 and functional programming. It provides circuit breaking capabilities similar to Hystrix but with a more modern approach.</p>
<h4 id="Dependency-Setup"><a href="#Dependency-Setup" class="headerlink" title="Dependency Setup"></a>Dependency Setup</h4><p>First, add the necessary dependencies to your <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.resilience4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>resilience4j-spring-boot3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Circuit-Breaker-Configuration"><a href="#Circuit-Breaker-Configuration" class="headerlink" title="Circuit Breaker Configuration"></a>Circuit Breaker Configuration</h4><p>Configure the circuit breaker in your Spring Boot application:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Resilience4jConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CircuitBreakerConfig <span class="title function_">circuitBreakerConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CircuitBreakerConfig.custom()</span><br><span class="line">            .failureRateThreshold(<span class="number">50</span>)</span><br><span class="line">            .waitDurationInOpenState(Duration.ofMillis(<span class="number">1000</span>))</span><br><span class="line">            .ringBufferSizeInClosedState(<span class="number">2</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CircuitBreakerRegistry <span class="title function_">circuitBreakerRegistry</span><span class="params">(CircuitBreakerConfig circuitBreakerConfig)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CircuitBreakerRegistry.of(circuitBreakerConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CircuitBreaker <span class="title function_">circuitBreaker</span><span class="params">(CircuitBreakerRegistry circuitBreakerRegistry)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> circuitBreakerRegistry.circuitBreaker(<span class="string">&quot;externalApi&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Using-Resilience4j-Annotations"><a href="#Using-Resilience4j-Annotations" class="headerlink" title="Using Resilience4j Annotations"></a>Using Resilience4j Annotations</h4><p>Apply the circuit breaker to your service method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiService</span><span class="params">(RestTemplateBuilder restTemplateBuilder, CircuitBreaker circuitBreaker)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplateBuilder.build();</span><br><span class="line">        <span class="built_in">this</span>.circuitBreaker = circuitBreaker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CircuitBreaker(name = &quot;externalApi&quot;, fallbackMethod = &quot;fallbackMethod&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">invokeApiWithCircuitBreaker</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fallbackMethod</span><span class="params">(String url, Throwable t)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Fallback response for: &quot;</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Explanation-1"><a href="#Explanation-1" class="headerlink" title="Explanation:"></a>Explanation:</h4><p><a name="explanation-1"></a></p>
<ul>
<li><strong>CircuitBreaker</strong>: Configures the circuit breaker with custom settings.</li>
<li><strong>@CircuitBreaker</strong>: Annotates the method to be protected by the circuit breaker.</li>
<li><strong>Fallback Method</strong>: Provides a fallback response when the circuit breaker trips.</li>
</ul>
<h3 id="Key-Points-3"><a href="#Key-Points-3" class="headerlink" title="Key Points:"></a>Key Points:</h3><ul>
<li><strong>Resilience4j</strong>: Modern fault tolerance library replacing Hystrix.</li>
<li><strong>Circuit Breaker</strong>: Prevents cascading failures by short-circuiting failed API calls.</li>
<li><strong>Fallback Method</strong>: Provides a fallback response when the circuit breaker trips.</li>
</ul>
<hr>
<h3 id="5-Sample-Code-with-Annotations"><a href="#5-Sample-Code-with-Annotations" class="headerlink" title="5. Sample Code with Annotations"></a>5. Sample Code with Annotations</h3><p><a name="5-sample-code-with-annotations"></a></p>
<p>Combining both <code>@Retryable</code> and Resilience4j’s <code>@CircuitBreaker</code>, we create a highly resilient service capable of handling third-party API failures.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiService</span><span class="params">(RestTemplateBuilder restTemplateBuilder, CircuitBreaker circuitBreaker)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplateBuilder.build();</span><br><span class="line">        <span class="built_in">this</span>.circuitBreaker = circuitBreaker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Retryable(</span></span><br><span class="line"><span class="meta">        value = &#123; HttpServerErrorException.class &#125;,</span></span><br><span class="line"><span class="meta">        maxAttempts = 5,</span></span><br><span class="line"><span class="meta">        backoff = @Backoff(delay = 1000)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@CircuitBreaker(name = &quot;externalApi&quot;, fallbackMethod = &quot;fallbackMethod&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">invokeApi</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Recover</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">retryRecovery</span><span class="params">(HttpServerErrorException e, String url)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Retry failed for: &quot;</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fallbackMethod</span><span class="params">(String url, Throwable t)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Circuit breaker fallback for: &quot;</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Key-Points-4"><a href="#Key-Points-4" class="headerlink" title="Key Points:"></a>Key Points:</h3><ul>
<li><strong>Combined Resilience</strong>: Combines retries and circuit breaking for improved fault tolerance.</li>
<li><strong>Fallback Handling</strong>: Provides fallback responses for both retry failures and circuit breaker trips.</li>
</ul>
<hr>
<h3 id="Diagrams"><a href="#Diagrams" class="headerlink" title="Diagrams"></a>Diagrams</h3><p><a name="diagrams"></a></p>
<p>To visualize how retries and circuit breakers work together, the following diagram illustrates the flow:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+      +------------------+</span><br><span class="line">| API Call Attempt  |----&gt; | Retry Logic      |</span><br><span class="line">+-------------------+      +------------------+</span><br><span class="line">                              |</span><br><span class="line">            Retry Success&lt;----+----&gt;Retry Failure</span><br><span class="line">                              |</span><br><span class="line">                          Circuit Breaker</span><br><span class="line">                              |</span><br><span class="line">            Success&lt;-----------+------------&gt;Fallback</span><br></pre></td></tr></table></figure>

<h3 id="Key-Points-5"><a href="#Key-Points-5" class="headerlink" title="Key Points:"></a>Key Points:</h3><ul>
<li><strong>API Call Attempt</strong>: Initial API invocation.</li>
<li><strong>Retry Logic</strong>: Retries the API call if it fails.</li>
<li><strong>Circuit Breaker</strong>: Evaluates whether to invoke the fallback method after retries fail.</li>
</ul>
<hr>
<h3 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a>6. Conclusion</h3><p><a name="6-conclusion"></a></p>
<p>In Spring Boot, integrating with third-party APIs elegantly involves applying retry mechanisms and circuit breaker patterns. Using <code>@Retryable</code> and Resilience4j annotations simplifies the code, making it more resilient to failures and easier to maintain. The combination of these two approaches ensures that your system can handle both intermittent and persistent issues with third-party APIs.</p>
<h3 id="Key-Takeaways"><a href="#Key-Takeaways" class="headerlink" title="Key Takeaways:"></a>Key Takeaways:</h3><ul>
<li><strong>Resilient API Invocations</strong>: Use retries and circuit breakers for fault tolerance.</li>
<li><strong>Annotation-Based Configuration</strong>: Simplifies implementation and maintenance.</li>
<li><strong>Fallback Strategies</strong>: Provide graceful degradation when API calls fail.</li>
</ul>
<p>By mastering these techniques, you can build robust and resilient microservices that gracefully handle third-party API failures.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring-Boot/" rel="tag"><i class="fa fa-tag"></i> Spring Boot</a>
              <a href="/tags/API/" rel="tag"><i class="fa fa-tag"></i> API</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/10/23/Kafka-Producer-Tuning-Guide/" rel="prev" title="Kafka Producer Tuning Guide">
                  <i class="fa fa-angle-left"></i> Kafka Producer Tuning Guide
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/10/23/Deep-Dive-Spring-Boot-Retry-Mechanism-and-Implementation/" rel="next" title="Deep Dive Spring Boot Retry Mechanism and Implementation">
                  Deep Dive Spring Boot Retry Mechanism and Implementation <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
