<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Introduction Caffeine Cache Overview Key Features   Configuring Caffeine Cache in Spring Boot Adding Dependencies Enabling Caching Configuring Cache Manager YAML Configuration Explanation of Caffeine">
<meta property="og:type" content="article">
<meta property="og:title" content="Deep Dive into Caffeine Cache and Integration with Spring Boot">
<meta property="og:url" content="https://www.whereq.com/2024/10/27/Deep-Dive-into-Caffeine-Cache-and-Integration-with-Spring-Boot/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:description" content="Introduction Caffeine Cache Overview Key Features   Configuring Caffeine Cache in Spring Boot Adding Dependencies Enabling Caching Configuring Cache Manager YAML Configuration Explanation of Caffeine">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-10-27T17:55:44.000Z">
<meta property="article:modified_time" content="2024-10-27T18:58:57.293Z">
<meta property="article:author" content="Dazhi Zhang">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="Deep Dive">
<meta property="article:tag" content="Cache">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-Caffeine-Cache-and-Integration-with-Spring-Boot/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.whereq.com/2024/10/27/Deep-Dive-into-Caffeine-Cache-and-Integration-with-Spring-Boot/","path":"2024/10/27/Deep-Dive-into-Caffeine-Cache-and-Integration-with-Spring-Boot/","title":"Deep Dive into Caffeine Cache and Integration with Spring Boot"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Deep Dive into Caffeine Cache and Integration with Spring Boot | WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WhereQ</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Caffeine-Cache-Overview"><span class="nav-number">2.</span> <span class="nav-text">Caffeine Cache Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Features"><span class="nav-number">2.1.</span> <span class="nav-text">Key Features</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configuring-Caffeine-Cache-in-Spring-Boot"><span class="nav-number">3.</span> <span class="nav-text">Configuring Caffeine Cache in Spring Boot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Adding-Dependencies"><span class="nav-number">3.1.</span> <span class="nav-text">Adding Dependencies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enabling-Caching"><span class="nav-number">3.2.</span> <span class="nav-text">Enabling Caching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-Cache-Manager"><span class="nav-number">3.3.</span> <span class="nav-text">Configuring Cache Manager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#YAML-Configuration"><span class="nav-number">3.4.</span> <span class="nav-text">YAML Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Explanation-of-Caffeine-Cache-Configuration"><span class="nav-number">3.5.</span> <span class="nav-text">Explanation of Caffeine Cache Configuration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-Caffeine-Cache-Works"><span class="nav-number">4.</span> <span class="nav-text">How Caffeine Cache Works</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cache-Population"><span class="nav-number">4.1.</span> <span class="nav-text">Cache Population</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cache-Eviction"><span class="nav-number">4.2.</span> <span class="nav-text">Cache Eviction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Expiration"><span class="nav-number">4.3.</span> <span class="nav-text">Expiration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Statistics"><span class="nav-number">4.4.</span> <span class="nav-text">Statistics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Statistics-Recording"><span class="nav-number">4.4.1.</span> <span class="nav-text">Statistics Recording</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Tracking-Cache-Hits-Misses-and-Evictions"><span class="nav-number">4.4.2.</span> <span class="nav-text">Tracking Cache Hits, Misses, and Evictions</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Caffeine-Cache-Internals"><span class="nav-number">5.</span> <span class="nav-text">Caffeine Cache Internals</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cache-Interface"><span class="nav-number">5.1.</span> <span class="nav-text">Cache Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Caffeine-Class"><span class="nav-number">5.2.</span> <span class="nav-text">Caffeine Class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BoundedLocalCache-Class"><span class="nav-number">5.3.</span> <span class="nav-text">BoundedLocalCache Class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Detailed-Logic-in-Caffeine-Cache"><span class="nav-number">5.4.</span> <span class="nav-text">Detailed Logic in Caffeine Cache</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Cache-Lookup"><span class="nav-number">5.4.1.</span> <span class="nav-text">Cache Lookup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cache-Miss-and-Method-Execution"><span class="nav-number">5.4.2.</span> <span class="nav-text">Cache Miss and Method Execution</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cache-Update"><span class="nav-number">5.4.3.</span> <span class="nav-text">Cache Update</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Real-Life-Production-Use-Cases"><span class="nav-number">6.</span> <span class="nav-text">Real-Life Production Use Cases</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-User-Profile-Caching"><span class="nav-number">6.1.</span> <span class="nav-text">1. User Profile Caching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Product-Catalog-Caching"><span class="nav-number">6.2.</span> <span class="nav-text">2. Product Catalog Caching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-API-Response-Caching"><span class="nav-number">6.3.</span> <span class="nav-text">3. API Response Caching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Session-Data-Caching"><span class="nav-number">6.4.</span> <span class="nav-text">4. Session Data Caching</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sample-Code"><span class="nav-number">7.</span> <span class="nav-text">Sample Code</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Caffeine-Cache-Configuration"><span class="nav-number">7.1.</span> <span class="nav-text">Caffeine Cache Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#User-Service-with-Caching"><span class="nav-number">7.2.</span> <span class="nav-text">User Service with Caching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flow-Diagram"><span class="nav-number">7.3.</span> <span class="nav-text">Flow Diagram</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Explanation-of-the-Flow-Diagram"><span class="nav-number">7.4.</span> <span class="nav-text">Explanation of the Flow Diagram</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Statistics-Logging-Tracking-and-Mornitoring"><span class="nav-number">8.</span> <span class="nav-text">Statistics Logging, Tracking and Mornitoring</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Logging-Cache-Statistics"><span class="nav-number">8.1.</span> <span class="nav-text">1. Logging Cache Statistics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Logging-Cache-Statistics-with-SLF4J"><span class="nav-number">8.1.1.</span> <span class="nav-text">Example: Logging Cache Statistics with SLF4J</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Integrating-with-GUI-Tools"><span class="nav-number">8.2.</span> <span class="nav-text">2. Integrating with GUI Tools</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Step-1-Add-Prometheus-and-Grafana-Dependencies"><span class="nav-number">8.2.1.</span> <span class="nav-text">Step 1: Add Prometheus and Grafana Dependencies</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Step-2-Configure-Prometheus-Metrics-Collector"><span class="nav-number">8.2.2.</span> <span class="nav-text">Step 2: Configure Prometheus Metrics Collector</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Step-3-Configure-Prometheus-and-Grafana"><span class="nav-number">8.2.3.</span> <span class="nav-text">Step 3: Configure Prometheus and Grafana</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example-Prometheus-Configuration"><span class="nav-number">8.3.</span> <span class="nav-text">Example: Prometheus Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example-Grafana-Dashboard"><span class="nav-number">8.4.</span> <span class="nav-text">Example: Grafana Dashboard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Summary"><span class="nav-number">8.5.</span> <span class="nav-text">Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">9.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2024/10/27/Deep-Dive-into-Caffeine-Cache-and-Integration-with-Spring-Boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Deep Dive into Caffeine Cache and Integration with Spring Boot | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Deep Dive into Caffeine Cache and Integration with Spring Boot
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-10-27 13:55:44 / Modified: 14:58:57" itemprop="dateCreated datePublished" datetime="2024-10-27T13:55:44-04:00">2024-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/" itemprop="url" rel="index"><span itemprop="name">Deep Dive</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/" itemprop="url" rel="index"><span itemprop="name">Cache</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Dive/Cache/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#caffeine-cache-overview">Caffeine Cache Overview</a><ul>
<li><a href="#key-features">Key Features</a></li>
</ul>
</li>
<li><a href="#configuring-caffeine-cache-in-spring-boot">Configuring Caffeine Cache in Spring Boot</a><ul>
<li><a href="#adding-dependencies">Adding Dependencies</a></li>
<li><a href="#enabling-caching">Enabling Caching</a></li>
<li><a href="#configuring-cache-manager">Configuring Cache Manager</a></li>
<li><a href="#yaml-configuration">YAML Configuration</a></li>
<li><a href="#explanation-of-caffeine-cache-configuration">Explanation of Caffeine Cache Configuration</a></li>
</ul>
</li>
<li><a href="#how-caffeine-cache-works">How Caffeine Cache Works</a><ul>
<li><a href="#cache-population">Cache Population</a></li>
<li><a href="#cache-eviction">Cache Eviction</a></li>
<li><a href="#expiration">Expiration</a></li>
<li><a href="#statistics">Statistics</a><ul>
<li><a href="#statistics-recording">Statistics Recording</a></li>
<li><a href="#tracking-cache-hits-misses-and-evictions">Tracking Cache Hits, Misses, and Evictions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#caffeine-cache-internals">Caffeine Cache Internals</a><ul>
<li><a href="#cache-interface">Cache Interface</a></li>
<li><a href="#caffeine-class">Caffeine Class</a></li>
<li><a href="#boundedlocalcache-class">BoundedLocalCache Class</a></li>
<li><a href="#detailed-logic-in-caffeine-cache">Detailed Logic in Caffeine Cache</a><ul>
<li><a href="#cache-lookup">Cache Lookup</a></li>
<li><a href="#cache-miss-and-method-execution">Cache Miss and Method Execution</a></li>
<li><a href="#cache-update">Cache Update</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#real-life-production-use-cases">Real-Life Production Use Cases</a><ul>
<li><a href="#1-user-profile-caching">1. <strong>User Profile Caching</strong></a></li>
<li><a href="#2-product-catalog-caching">2. <strong>Product Catalog Caching</strong></a></li>
<li><a href="#3-api-response-caching">3. <strong>API Response Caching</strong></a></li>
<li><a href="#4-session-data-caching">4. <strong>Session Data Caching</strong></a></li>
</ul>
</li>
<li><a href="#sample-code">Sample Code</a><ul>
<li><a href="#caffeine-cache-configuration">Caffeine Cache Configuration</a></li>
<li><a href="#user-service-with-caching">User Service with Caching</a></li>
<li><a href="#flow-diagram">Flow Diagram</a></li>
<li><a href="#explanation-of-the-flow-diagram">Explanation of the Flow Diagram</a></li>
</ul>
</li>
<li><a href="#statistics-logging-tracking-and-mornitoring">Statistics Logging, Tracking and Mornitoring</a><ul>
<li><a href="#1-logging-cache-statistics">1. <strong>Logging Cache Statistics</strong></a><ul>
<li><a href="#example-logging-cache-statistics-with-slf4j">Example: Logging Cache Statistics with SLF4J</a></li>
</ul>
</li>
<li><a href="#2-integrating-with-gui-tools">2. <strong>Integrating with GUI Tools</strong></a><ul>
<li><a href="#step-1-add-prometheus-and-grafana-dependencies">Step 1: Add Prometheus and Grafana Dependencies</a></li>
<li><a href="#step-2-configure-prometheus-metrics-collector">Step 2: Configure Prometheus Metrics Collector</a></li>
<li><a href="#step-3-configure-prometheus-and-grafana">Step 3: Configure Prometheus and Grafana</a></li>
</ul>
</li>
<li><a href="#example-prometheus-configuration">Example: Prometheus Configuration</a></li>
<li><a href="#example-grafana-dashboard">Example: Grafana Dashboard</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<hr>
<p><a name="introduction"></a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Caffeine is a high-performance, near-optimal caching library for Java, widely used in Spring Boot applications to improve performance by reducing the load on databases and other backend services. This article delves into the details of Caffeine cache, its integration with Spring Boot, and how it works under the hood. We’ll also provide real-life production use cases and sample code to illustrate its usage.</p>
<hr>
<p><a name="caffeine-cache-overview"></a></p>
<h2 id="Caffeine-Cache-Overview"><a href="#Caffeine-Cache-Overview" class="headerlink" title="Caffeine Cache Overview"></a>Caffeine Cache Overview</h2><p>Caffeine is designed to be efficient and easy to use, providing advanced features like eviction policies, time-based expiration, and statistics recording. It uses a combination of data structures and algorithms to manage cache entries efficiently.</p>
<h3 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features"></a>Key Features</h3><ul>
<li><strong>High Performance</strong>: Optimized for fast read and write operations.</li>
<li><strong>Eviction Policies</strong>: Supports LRU, FIFO, and LFU eviction policies.</li>
<li><strong>Time-Based Expiration</strong>: Entries can be expired after a specified period of inactivity or since they were last written.</li>
<li><strong>Statistics Recording</strong>: Tracks cache hits, misses, and evictions for monitoring and tuning.</li>
</ul>
<hr>
<p><a name="configuring-caffeine-cache-in-spring-boot"></a></p>
<h2 id="Configuring-Caffeine-Cache-in-Spring-Boot"><a href="#Configuring-Caffeine-Cache-in-Spring-Boot" class="headerlink" title="Configuring Caffeine Cache in Spring Boot"></a>Configuring Caffeine Cache in Spring Boot</h2><h3 id="Adding-Dependencies"><a href="#Adding-Dependencies" class="headerlink" title="Adding Dependencies"></a><a name="adding-dependencies"></a>Adding Dependencies</h3><p>First, ensure you have the necessary dependencies in your <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>caffeine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Enabling-Caching"><a href="#Enabling-Caching" class="headerlink" title="Enabling Caching"></a><a name="enabling-caching"></a>Enabling Caching</h3><p>Enable caching in your Spring Boot application by adding the <code>@EnableCaching</code> annotation to your main application class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Cache-Manager"><a href="#Configuring-Cache-Manager" class="headerlink" title="Configuring Cache Manager"></a><a name="configuring-cache-manager"></a>Configuring Cache Manager</h3><p>Create a configuration class to set up Caffeine cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.caffeine.CaffeineCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CaffeineCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CaffeineCacheManager</span>(<span class="string">&quot;userCache&quot;</span>, <span class="string">&quot;productCache&quot;</span>);</span><br><span class="line">        cacheManager.setCaffeine(caffeineCacheBuilder());</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Caffeine&lt;Object, Object&gt; <span class="title function_">caffeineCacheBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">500</span>)</span><br><span class="line">                .expireAfterAccess(<span class="number">600</span>, TimeUnit.SECONDS)</span><br><span class="line">                .recordStats();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="YAML-Configuration"><a href="#YAML-Configuration" class="headerlink" title="YAML Configuration"></a><a name="yaml-configuration"></a>YAML Configuration</h3><p>You can also configure Caffeine cache using YAML:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">caffeine</span></span><br><span class="line">    <span class="attr">cache-names:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">userCache</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">productCache</span></span><br><span class="line">    <span class="attr">caffeine:</span></span><br><span class="line">      <span class="attr">spec:</span> <span class="string">maximumSize=500,expireAfterAccess=600s</span></span><br></pre></td></tr></table></figure>

<h3 id="Explanation-of-Caffeine-Cache-Configuration"><a href="#Explanation-of-Caffeine-Cache-Configuration" class="headerlink" title="Explanation of Caffeine Cache Configuration"></a>Explanation of Caffeine Cache Configuration</h3><ul>
<li><strong><code>CaffeineCacheManager</code></strong>: Manages multiple caches, each identified by a name.</li>
<li><strong>Cache Names</strong>: <code>&quot;userCache&quot;</code> and <code>&quot;productCache&quot;</code> are used to identify different caches.</li>
<li><strong><code>maximumSize(500)</code></strong>: Sets the maximum number of entries the cache can hold.</li>
<li><strong><code>expireAfterAccess(600, TimeUnit.SECONDS)</code></strong>: Specifies that entries should be expired after 600 seconds of inactivity.</li>
<li><strong><code>recordStats()</code></strong>: Enables statistics recording for monitoring cache performance.</li>
</ul>
<hr>
<p><a name="how-caffeine-cache-works"></a></p>
<h2 id="How-Caffeine-Cache-Works"><a href="#How-Caffeine-Cache-Works" class="headerlink" title="How Caffeine Cache Works"></a>How Caffeine Cache Works</h2><h3 id="Cache-Population"><a href="#Cache-Population" class="headerlink" title="Cache Population"></a><a name="cache-population"></a>Cache Population</h3><p>When a cache miss occurs, Caffeine fetches the data from the underlying data source (e.g., database) and stores it in the cache.</p>
<h3 id="Cache-Eviction"><a href="#Cache-Eviction" class="headerlink" title="Cache Eviction"></a><a name="cache-eviction"></a>Cache Eviction</h3><p>Caffeine uses various eviction policies to manage the cache size:</p>
<ul>
<li><strong>Least Recently Used (LRU)</strong>: Evicts the least recently used entries first.</li>
<li><strong>First In, First Out (FIFO)</strong>: Evicts the oldest entries first.</li>
<li><strong>Least Frequently Used (LFU)</strong>: Evicts the least frequently used entries first.</li>
</ul>
<h3 id="Expiration"><a href="#Expiration" class="headerlink" title="Expiration"></a><a name="expiration"></a>Expiration</h3><p>Caffeine supports time-based expiration:</p>
<ul>
<li><strong>Expire After Access</strong>: Entries are expired after a specified period of inactivity.</li>
<li><strong>Expire After Write</strong>: Entries are expired after a specified period since they were last written.</li>
</ul>
<h3 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a><a name="statistics"></a>Statistics</h3><p>Caffeine can record statistics such as cache hits, misses, and evictions, which can be useful for monitoring and tuning the cache.</p>
<h4 id="Statistics-Recording"><a href="#Statistics-Recording" class="headerlink" title="Statistics Recording"></a>Statistics Recording</h4><p>Caffeine provides a <code>recordStats()</code> method that enables the collection of cache statistics. This method returns a <code>Caffeine</code> instance that will record statistics for the cache.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Caffeine&lt;Object, Object&gt; <span class="title function_">caffeineCacheBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">500</span>)</span><br><span class="line">            .expireAfterAccess(<span class="number">600</span>, TimeUnit.SECONDS)</span><br><span class="line">            .recordStats();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Tracking-Cache-Hits-Misses-and-Evictions"><a href="#Tracking-Cache-Hits-Misses-and-Evictions" class="headerlink" title="Tracking Cache Hits, Misses, and Evictions"></a>Tracking Cache Hits, Misses, and Evictions</h4><p>Once statistics recording is enabled, you can access the statistics using the <code>stats()</code> method on the cache. This method returns a <code>CacheStats</code> object that contains various metrics:</p>
<ul>
<li><strong><code>hitCount()</code></strong>: The number of successful cache hits.</li>
<li><strong><code>missCount()</code></strong>: The number of cache misses.</li>
<li><strong><code>evictionCount()</code></strong>: The number of cache evictions.</li>
<li><strong><code>loadSuccessCount()</code></strong>: The number of times a cache miss was successfully loaded.</li>
<li><strong><code>loadFailureCount()</code></strong>: The number of times a cache miss failed to load.</li>
</ul>
<p>Here’s an example of how to access and log cache statistics:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.stats.CacheStats;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheStatisticsExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">100</span>)</span><br><span class="line">                .recordStats()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Perform cache operations</span></span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Access cache statistics</span></span><br><span class="line">        <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">        System.out.println(<span class="string">&quot;Cache Hits: &quot;</span> + stats.hitCount());</span><br><span class="line">        System.out.println(<span class="string">&quot;Cache Misses: &quot;</span> + stats.missCount());</span><br><span class="line">        System.out.println(<span class="string">&quot;Cache Evictions: &quot;</span> + stats.evictionCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="caffeine-cache-internals"></a></p>
<h2 id="Caffeine-Cache-Internals"><a href="#Caffeine-Cache-Internals" class="headerlink" title="Caffeine Cache Internals"></a>Caffeine Cache Internals</h2><h3 id="Cache-Interface"><a href="#Cache-Interface" class="headerlink" title="Cache Interface"></a><a name="cache-interface"></a>Cache Interface</h3><p>The <code>Cache</code> interface defines the core operations for interacting with the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span>&lt;K, V&gt; &#123;</span><br><span class="line">    V <span class="title function_">getIfPresent</span><span class="params">(K key)</span>;</span><br><span class="line">    V <span class="title function_">get</span><span class="params">(K key, Function&lt;? <span class="built_in">super</span> K, ? extends V&gt; mappingFunction)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">invalidate</span><span class="params">(K key)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">invalidateAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">long</span> <span class="title function_">estimatedSize</span><span class="params">()</span>;</span><br><span class="line">    CacheStats <span class="title function_">stats</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Caffeine-Class"><a href="#Caffeine-Class" class="headerlink" title="Caffeine Class"></a><a name="caffeine-class"></a>Caffeine Class</h3><p>The <code>Caffeine</code> class is the builder for creating cache instances:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Caffeine</span>&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Caffeine&lt;K, V&gt;newBuilder() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Caffeine</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Caffeine&lt;K, V&gt; <span class="title function_">maximumSize</span><span class="params">(<span class="type">long</span> maximumSize)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Caffeine&lt;K, V&gt; <span class="title function_">expireAfterAccess</span><span class="params">(<span class="type">long</span> duration, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cache&lt;K, V&gt; <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BoundedLocalCache</span>&lt;&gt;(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BoundedLocalCache-Class"><a href="#BoundedLocalCache-Class" class="headerlink" title="BoundedLocalCache Class"></a><a name="boundedlocalcache-class"></a>BoundedLocalCache Class</h3><p>The <code>BoundedLocalCache</code> class is the core implementation of the cache, handling operations like get, put, and eviction:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">BoundedLocalCache</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">LocalCache</span>&lt;K, V&gt; &#123;</span><br><span class="line">    BoundedLocalCache(Caffeine&lt;K, V&gt; builder) &#123;</span><br><span class="line">        <span class="comment">// Initialization</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">getIfPresent</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invalidate</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">estimatedSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CacheStats <span class="title function_">stats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Detailed-Logic-in-Caffeine-Cache"><a href="#Detailed-Logic-in-Caffeine-Cache" class="headerlink" title="Detailed Logic in Caffeine Cache"></a>Detailed Logic in Caffeine Cache</h3><h4 id="Cache-Lookup"><a href="#Cache-Lookup" class="headerlink" title="Cache Lookup"></a>Cache Lookup</h4><p>Caffeine uses a <code>ConcurrentHashMap</code> to store cache entries. When a lookup is performed, Caffeine checks if the key exists in the map:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">getIfPresent</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K, V&gt; node = data.get(key);</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Additional logic for expiration and eviction checks</span></span><br><span class="line">    <span class="keyword">return</span> node.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cache-Miss-and-Method-Execution"><a href="#Cache-Miss-and-Method-Execution" class="headerlink" title="Cache Miss and Method Execution"></a>Cache Miss and Method Execution</h4><p>If the key is not found in the cache, the method is executed, and the result is stored in the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(K key, Function&lt;? <span class="built_in">super</span> K, ? extends V&gt; mappingFunction)</span> &#123;</span><br><span class="line">    <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> getIfPresent(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    value = mappingFunction.apply(key);</span><br><span class="line">    put(key, value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cache-Update"><a href="#Cache-Update" class="headerlink" title="Cache Update"></a>Cache Update</h4><p>When the result is fetched from the database, it is stored in the cache:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    Node&lt;K, V&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(key, value);</span><br><span class="line">    data.put(key, node);</span><br><span class="line">    <span class="comment">// Additional logic for eviction and expiration</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a name="real-life-production-use-cases"></a></p>
<h2 id="Real-Life-Production-Use-Cases"><a href="#Real-Life-Production-Use-Cases" class="headerlink" title="Real-Life Production Use Cases"></a>Real-Life Production Use Cases</h2><h3 id="1-User-Profile-Caching"><a href="#1-User-Profile-Caching" class="headerlink" title="1. User Profile Caching"></a>1. <strong>User Profile Caching</strong></h3><p>In a social media application, user profiles are frequently accessed. Caching user profiles can significantly reduce the load on the database and improve response times.</p>
<h3 id="2-Product-Catalog-Caching"><a href="#2-Product-Catalog-Caching" class="headerlink" title="2. Product Catalog Caching"></a>2. <strong>Product Catalog Caching</strong></h3><p>In an e-commerce application, product catalogs are often large and frequently accessed. Caching product data can improve performance and reduce database load.</p>
<h3 id="3-API-Response-Caching"><a href="#3-API-Response-Caching" class="headerlink" title="3. API Response Caching"></a>3. <strong>API Response Caching</strong></h3><p>In microservices, caching API responses can reduce the number of calls to downstream services, improving overall system performance.</p>
<h3 id="4-Session-Data-Caching"><a href="#4-Session-Data-Caching" class="headerlink" title="4. Session Data Caching"></a>4. <strong>Session Data Caching</strong></h3><p>In applications with user sessions, caching session data can reduce the load on session storage systems and improve scalability.</p>
<hr>
<p><a name="sample-code"></a></p>
<h2 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h2><h3 id="Caffeine-Cache-Configuration"><a href="#Caffeine-Cache-Configuration" class="headerlink" title="Caffeine Cache Configuration"></a>Caffeine Cache Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.caffeine.CaffeineCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CaffeineCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CaffeineCacheManager</span>(<span class="string">&quot;userCache&quot;</span>, <span class="string">&quot;productCache&quot;</span>);</span><br><span class="line">        cacheManager.setCaffeine(caffeineCacheBuilder());</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Caffeine&lt;Object, Object&gt; <span class="title function_">caffeineCacheBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">500</span>)</span><br><span class="line">                .expireAfterAccess(<span class="number">600</span>, TimeUnit.SECONDS)</span><br><span class="line">                .recordStats();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="User-Service-with-Caching"><a href="#User-Service-with-Caching" class="headerlink" title="User Service with Caching"></a>User Service with Caching</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Fetch user from database</span></span><br><span class="line">        <span class="keyword">return</span> fetchUserFromDatabase(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User <span class="title function_">fetchUserFromDatabase</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Database query logic</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(userId, <span class="string">&quot;John Doe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flow-Diagram"><a href="#Flow-Diagram" class="headerlink" title="Flow Diagram"></a>Flow Diagram</h3><p>Here’s a textual diagram to illustrate the flow:</p>
<pre><code class="highlight mermaid">graph TD
    A[Client Request] --&gt; B&#123;Cache Lookup&#125;
    B --&gt;|Cache Hit| C[Return Cached Data]
    B --&gt;|Cache Miss| D[Execute Method]
    D --&gt; E[Fetch from Database]
    E --&gt; F[Update Cache]
    F --&gt; C</code></pre>

<h3 id="Explanation-of-the-Flow-Diagram"><a href="#Explanation-of-the-Flow-Diagram" class="headerlink" title="Explanation of the Flow Diagram"></a>Explanation of the Flow Diagram</h3><ol>
<li><strong>Client Request</strong>: The client makes a request to fetch a user by ID.</li>
<li><strong>Cache Lookup</strong>: The cache manager looks up the <code>userId</code> in the <code>&quot;userCache&quot;</code>.</li>
<li><strong>Cache Hit</strong>: If the user is found in the cache, the cached data is returned immediately.</li>
<li><strong>Cache Miss</strong>: If the user is not found in the cache, the method <code>getUserById(Long userId)</code> is executed.</li>
<li><strong>Execute Method</strong>: The method fetches the user from the database.</li>
<li><strong>Fetch from Database</strong>: The user is retrieved from the database.</li>
<li><strong>Update Cache</strong>: The fetched user is stored in the cache.</li>
<li><strong>Return Cached Data</strong>: The user data is returned to the client.</li>
</ol>
<hr>
<h2 id="Statistics-Logging-Tracking-and-Mornitoring"><a href="#Statistics-Logging-Tracking-and-Mornitoring" class="headerlink" title="Statistics Logging, Tracking and Mornitoring"></a>Statistics Logging, Tracking and Mornitoring</h2><p>Caffeine’s statistics can be tracked using logging tools and even integrated with GUI tools for better visualization and monitoring. </p>
<h3 id="1-Logging-Cache-Statistics"><a href="#1-Logging-Cache-Statistics" class="headerlink" title="1. Logging Cache Statistics"></a>1. <strong>Logging Cache Statistics</strong></h3><p>Log cache statistics using a logging framework like SLF4J or Log4j. This allows you to periodically log the cache metrics to a log file or console.</p>
<h4 id="Example-Logging-Cache-Statistics-with-SLF4J"><a href="#Example-Logging-Cache-Statistics-with-SLF4J" class="headerlink" title="Example: Logging Cache Statistics with SLF4J"></a>Example: Logging Cache Statistics with SLF4J</h4><p>First, add the necessary dependencies in <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Next, configure cache to log statistics periodically:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.stats.CacheStats;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheStatisticsLogger</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(CacheStatisticsLogger.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">                .maximumSize(<span class="number">100</span>)</span><br><span class="line">                .recordStats()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Perform cache operations</span></span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Log cache statistics</span></span><br><span class="line">        logCacheStats(cache);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logCacheStats</span><span class="params">(Cache&lt;?, ?&gt; cache)</span> &#123;</span><br><span class="line">        <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">        logger.info(<span class="string">&quot;Cache Hits: &#123;&#125;&quot;</span>, stats.hitCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Cache Misses: &#123;&#125;&quot;</span>, stats.missCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Cache Evictions: &#123;&#125;&quot;</span>, stats.evictionCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Load Success Count: &#123;&#125;&quot;</span>, stats.loadSuccessCount());</span><br><span class="line">        logger.info(<span class="string">&quot;Load Failure Count: &#123;&#125;&quot;</span>, stats.loadFailureCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Integrating-with-GUI-Tools"><a href="#2-Integrating-with-GUI-Tools" class="headerlink" title="2. Integrating with GUI Tools"></a>2. <strong>Integrating with GUI Tools</strong></h3><p>Integrate Caffeine’s statistics with GUI tools like Grafana or Prometheus for better visualization and monitoring. Here’s an example of how to integrate with Prometheus and Grafana.</p>
<h4 id="Step-1-Add-Prometheus-and-Grafana-Dependencies"><a href="#Step-1-Add-Prometheus-and-Grafana-Dependencies" class="headerlink" title="Step 1: Add Prometheus and Grafana Dependencies"></a>Step 1: Add Prometheus and Grafana Dependencies</h4><p>Add the necessary dependencies to <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient_hotspot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient_servlet<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.prometheus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simpleclient_spring_boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Step-2-Configure-Prometheus-Metrics-Collector"><a href="#Step-2-Configure-Prometheus-Metrics-Collector" class="headerlink" title="Step 2: Configure Prometheus Metrics Collector"></a>Step 2: Configure Prometheus Metrics Collector</h4><p>Create a configuration class to collect cache statistics using Prometheus:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;</span><br><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.stats.CacheStats;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.CollectorRegistry;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.Counter;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.Gauge;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.exporter.MetricsServlet;</span><br><span class="line"><span class="keyword">import</span> io.prometheus.client.hotspot.DefaultExports;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrometheusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">100</span>)</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheHits</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_hits_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache hits.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheMisses</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_misses_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache misses.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">cacheEvictions</span> <span class="operator">=</span> Counter.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_evictions_total&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Total number of cache evictions.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Gauge</span> <span class="variable">cacheSize</span> <span class="operator">=</span> Gauge.build()</span><br><span class="line">            .name(<span class="string">&quot;cache_size&quot;</span>)</span><br><span class="line">            .help(<span class="string">&quot;Current size of the cache.&quot;</span>)</span><br><span class="line">            .register();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        DefaultExports.initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean&lt;MetricsServlet&gt; <span class="title function_">metricsServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CollectorRegistry</span> <span class="variable">collectorRegistry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CollectorRegistry</span>();</span><br><span class="line">        collectorRegistry.register(cacheHits);</span><br><span class="line">        collectorRegistry.register(cacheMisses);</span><br><span class="line">        collectorRegistry.register(cacheEvictions);</span><br><span class="line">        collectorRegistry.register(cacheSize);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MetricsServlet</span>(collectorRegistry), <span class="string">&quot;/metrics&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Cache&lt;String, String&gt; <span class="title function_">cache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Runnable <span class="title function_">cacheStatsCollector</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> () -&gt; &#123;</span><br><span class="line">            <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">            cacheHits.inc(stats.hitCount());</span><br><span class="line">            cacheMisses.inc(stats.missCount());</span><br><span class="line">            cacheEvictions.inc(stats.evictionCount());</span><br><span class="line">            cacheSize.set(cache.estimatedSize());</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Step-3-Configure-Prometheus-and-Grafana"><a href="#Step-3-Configure-Prometheus-and-Grafana" class="headerlink" title="Step 3: Configure Prometheus and Grafana"></a>Step 3: Configure Prometheus and Grafana</h4><ol>
<li><p><strong>Prometheus</strong>: Configure Prometheus to scrape the metrics endpoint (<code>/metrics</code>) of the Spring Boot application.</p>
</li>
<li><p><strong>Grafana</strong>: Set up Grafana to visualize the metrics collected by Prometheus. Dashboards can be created to display cache hits, misses, evictions, and other relevant metrics.</p>
</li>
</ol>
<h3 id="Example-Prometheus-Configuration"><a href="#Example-Prometheus-Configuration" class="headerlink" title="Example: Prometheus Configuration"></a>Example: Prometheus Configuration</h3><p>Create a <code>prometheus.yml</code> file:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring-boot-app&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/metrics&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:8080&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Example-Grafana-Dashboard"><a href="#Example-Grafana-Dashboard" class="headerlink" title="Example: Grafana Dashboard"></a>Example: Grafana Dashboard</h3><ol>
<li><strong>Add Prometheus as a Data Source</strong> in Grafana.</li>
<li><strong>Create a Dashboard</strong> and add panels to visualize the cache metrics:<ul>
<li><strong>Cache Hits</strong>: <code>cache_hits_total</code></li>
<li><strong>Cache Misses</strong>: <code>cache_misses_total</code></li>
<li><strong>Cache Evictions</strong>: <code>cache_evictions_total</code></li>
<li><strong>Cache Size</strong>: <code>cache_size</code></li>
</ul>
</li>
</ol>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>By logging cache statistics using a logging framework like SLF4J or integrating with monitoring tools like Prometheus and Grafana, we can effectively track and visualize the performance of the Caffeine cache. This allows us to monitor cache hits, misses, evictions, and other metrics, helping us to tune and optimize the cache for better performance.</p>
<p><a name="conclusion"></a></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Caffeine cache is a powerful tool for improving the performance and scalability of Spring Boot applications. By understanding how Caffeine works, including its eviction policies and expiration</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring-Boot/" rel="tag"><i class="fa fa-tag"></i> Spring Boot</a>
              <a href="/tags/Deep-Dive/" rel="tag"><i class="fa fa-tag"></i> Deep Dive</a>
              <a href="/tags/Cache/" rel="tag"><i class="fa fa-tag"></i> Cache</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/10/27/Deep-Dive-into-Memory-Cache-in-Spring-Boot-Application/" rel="prev" title="Deep Dive into Memory Cache in Spring Boot Application">
                  <i class="fa fa-angle-left"></i> Deep Dive into Memory Cache in Spring Boot Application
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/10/27/Deep-Dive-into-Caching-for-Distributed-Systems/" rel="next" title="Deep Dive into Caching for Distributed Systems">
                  Deep Dive into Caching for Distributed Systems <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
