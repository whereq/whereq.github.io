<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.whereq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="This is a comprehensive deep dive into the most crucial operators in Project Reactor, which is the foundation of Spring WebFlux. Understanding these operators is key to mastering non-blocking, reactiv">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring WebFlux Guide - 2025">
<meta property="og:url" content="https://www.whereq.com/2025/12/02/Spring-WebFlux-Guide-2025/index.html">
<meta property="og:site_name" content="WhereQ">
<meta property="og:description" content="This is a comprehensive deep dive into the most crucial operators in Project Reactor, which is the foundation of Spring WebFlux. Understanding these operators is key to mastering non-blocking, reactiv">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-12-03T04:05:55.000Z">
<meta property="article:modified_time" content="2025-12-03T04:11:41.751Z">
<meta property="article:author" content="Dazhi Zhang">
<meta property="article:tag" content="WebFlux">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.whereq.com/2025/12/02/Spring-WebFlux-Guide-2025/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.whereq.com/2025/12/02/Spring-WebFlux-Guide-2025/","path":"2025/12/02/Spring-WebFlux-Guide-2025/","title":"Spring WebFlux Guide - 2025"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Spring WebFlux Guide - 2025 | WhereQ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WhereQ</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-articles"><a href="/articles/" rel="section"><i class="fa fa-file fa-fw"></i>Articles</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%F0%9F%8F%97%EF%B8%8F-Composition-and-Transformation-Operators"><span class="nav-number">1.</span> <span class="nav-text">1. üèóÔ∏è Composition and Transformation Operators</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%F0%9F%A4%9D-Combination-and-Merging-Operators"><span class="nav-number">2.</span> <span class="nav-text">2. ü§ù Combination and Merging Operators</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E2%8F%B1%EF%B8%8F-Error-Handling-and-Resilience-Operators"><span class="nav-number">3.</span> <span class="nav-text">3. ‚è±Ô∏è Error Handling and Resilience Operators</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%F0%9F%94%97-Backpressure-and-Hot-Cold-Operators"><span class="nav-number">4.</span> <span class="nav-text">4. üîó Backpressure and Hot&#x2F;Cold Operators</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Deepseek"><span class="nav-number"></span> <span class="nav-text">Deepseek</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-WebFlux-Operators-Comprehensive-Guide"><span class="nav-number"></span> <span class="nav-text">Spring WebFlux Operators: Comprehensive Guide</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Reactive-Programming-Operators-Deep-Dive"><span class="nav-number">1.</span> <span class="nav-text">Reactive Programming Operators Deep Dive</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Table-of-Contents"><span class="nav-number">2.</span> <span class="nav-text">Table of Contents</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Core-Concepts-Reactor-Basics"><span class="nav-number">3.</span> <span class="nav-text">1. Core Concepts &amp; Reactor Basics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reactive-Streams-Specification"><span class="nav-number">3.1.</span> <span class="nav-text">Reactive Streams Specification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cold-vs-Hot-Publishers"><span class="nav-number">3.2.</span> <span class="nav-text">Cold vs Hot Publishers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Creation-Operators"><span class="nav-number">4.</span> <span class="nav-text">2. Creation Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Static-Creation-Methods"><span class="nav-number">4.1.</span> <span class="nav-text">Static Creation Methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Programmatic-Creation"><span class="nav-number">4.2.</span> <span class="nav-text">Programmatic Creation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Transformation-Operators"><span class="nav-number">5.</span> <span class="nav-text">3. Transformation Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Element-Transformation"><span class="nav-number">5.1.</span> <span class="nav-text">Element Transformation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flattening-Operators"><span class="nav-number">5.2.</span> <span class="nav-text">Flattening Operators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Buffering-Windowing"><span class="nav-number">5.3.</span> <span class="nav-text">Buffering &amp; Windowing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Filtering-Operators"><span class="nav-number">6.</span> <span class="nav-text">4. Filtering Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-Filtering"><span class="nav-number">6.1.</span> <span class="nav-text">Basic Filtering</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Taking-Skipping"><span class="nav-number">6.2.</span> <span class="nav-text">Taking &amp; Skipping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sampling-Throttling"><span class="nav-number">6.3.</span> <span class="nav-text">Sampling &amp; Throttling</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Combining-Operators"><span class="nav-number">7.</span> <span class="nav-text">5. Combining Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sequential-Combination"><span class="nav-number">7.1.</span> <span class="nav-text">Sequential Combination</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Parallel-Combination"><span class="nav-number">7.2.</span> <span class="nav-text">Parallel Combination</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pairing-Operators"><span class="nav-number">7.3.</span> <span class="nav-text">Pairing Operators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Race-Conditions"><span class="nav-number">7.4.</span> <span class="nav-text">Race Conditions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Error-Handling-Operators"><span class="nav-number">8.</span> <span class="nav-text">6. Error Handling Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-Recovery"><span class="nav-number">8.1.</span> <span class="nav-text">Error Recovery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Retry-Strategies"><span class="nav-number">8.2.</span> <span class="nav-text">Retry Strategies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Timeout-Fallback"><span class="nav-number">8.3.</span> <span class="nav-text">Timeout &amp; Fallback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-Classification"><span class="nav-number">8.4.</span> <span class="nav-text">Error Classification</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Utility-Operators"><span class="nav-number">9.</span> <span class="nav-text">7. Utility Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Side-Effects"><span class="nav-number">9.1.</span> <span class="nav-text">Side Effects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-Metrics"><span class="nav-number">9.2.</span> <span class="nav-text">Debugging &amp; Metrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conditional-Operators"><span class="nav-number">9.3.</span> <span class="nav-text">Conditional Operators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Collecting-Reducing"><span class="nav-number">9.4.</span> <span class="nav-text">Collecting &amp; Reducing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Schedulers-Threading"><span class="nav-number">10.</span> <span class="nav-text">8. Schedulers &amp; Threading</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Scheduler-Types"><span class="nav-number">10.1.</span> <span class="nav-text">Scheduler Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Threading-Operators"><span class="nav-number">10.2.</span> <span class="nav-text">Threading Operators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Context-Propagation"><span class="nav-number">10.3.</span> <span class="nav-text">Context Propagation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-Backpressure-Operators"><span class="nav-number">11.</span> <span class="nav-text">9. Backpressure Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Backpressure-Strategies"><span class="nav-number">11.1.</span> <span class="nav-text">Backpressure Strategies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Request-Management"><span class="nav-number">11.2.</span> <span class="nav-text">Request Management</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Real-World-Patterns"><span class="nav-number">12.</span> <span class="nav-text">10. Real-World Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pattern-1-API-Gateway-Aggregation"><span class="nav-number">12.1.</span> <span class="nav-text">Pattern 1: API Gateway Aggregation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pattern-2-Event-Driven-Processing"><span class="nav-number">12.2.</span> <span class="nav-text">Pattern 2: Event-Driven Processing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pattern-3-Reactive-Caching"><span class="nav-number">12.3.</span> <span class="nav-text">Pattern 3: Reactive Caching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pattern-4-WebFlux-Security-Chain"><span class="nav-number">12.4.</span> <span class="nav-text">Pattern 4: WebFlux Security Chain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pattern-5-Database-Reactive-Transactions"><span class="nav-number">12.5.</span> <span class="nav-text">Pattern 5: Database Reactive Transactions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Summary-Cheat-Sheet"><span class="nav-number">13.</span> <span class="nav-text">Summary Cheat Sheet</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Golden-Rules"><span class="nav-number">13.1.</span> <span class="nav-text">Golden Rules:</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dazhi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">149</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">132</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">87</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.whereq.com/2025/12/02/Spring-WebFlux-Guide-2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dazhi Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhereQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Spring WebFlux Guide - 2025 | WhereQ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring WebFlux Guide - 2025
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-02 23:05:55 / Modified: 23:11:41" itemprop="dateCreated datePublished" datetime="2025-12-02T23:05:55-05:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebFlux/" itemprop="url" rel="index"><span itemprop="name">WebFlux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>This is a comprehensive deep dive into the most crucial operators in <strong>Project Reactor</strong>, which is the foundation of <strong>Spring WebFlux</strong>. Understanding these operators is key to mastering non-blocking, reactive programming.</p>
<p>The operators are organized into functional categories, detailing their usage and real-world application.</p>
<hr>
<h2 id="1-üèóÔ∏è-Composition-and-Transformation-Operators"><a href="#1-üèóÔ∏è-Composition-and-Transformation-Operators" class="headerlink" title="1. üèóÔ∏è Composition and Transformation Operators"></a>1. üèóÔ∏è Composition and Transformation Operators</h2><p>These operators modify the data emitted by a <code>Publisher</code> (Mono or Flux).</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>map()</code></strong></td>
<td align="left"><code>T -&gt; V</code> (Synchronous transformation)</td>
<td align="left">Applies a synchronous function to each item. <strong>Returns a simple value.</strong></td>
<td align="left">Converting a database entity (<code>UserEntity</code>) into a Data Transfer Object (<code>UserDTO</code>) after retrieval.</td>
</tr>
<tr>
<td align="left"><strong><code>flatMap()</code></strong></td>
<td align="left"><code>T -&gt; Publisher&lt;V&gt;</code> (Asynchronous transformation)</td>
<td align="left">Applies an asynchronous function that returns a new <code>Publisher</code>. Essential for <strong>chaining non-blocking I&#x2F;O operations.</strong></td>
<td align="left">Chaining microservice calls: Get <code>userId</code> (Mono A) $\rightarrow$ Use <code>userId</code> to call an external service (Mono B) $\rightarrow$ Use result B to save to the database (Mono C).</td>
</tr>
<tr>
<td align="left"><strong><code>concatMap()</code></strong></td>
<td align="left"><code>T -&gt; Publisher&lt;V&gt;</code> (Sequential <code>flatMap</code>)</td>
<td align="left">Similar to <code>flatMap</code>, but it processes and emits the results of the inner <code>Publisher</code> <strong>sequentially</strong>, preserving the original order of elements.</td>
<td align="left">Processing file uploads: Ensures that multiple files in a list are processed and saved to storage one after the other, respecting the order received, even though the I&#x2F;O operations are async.</td>
</tr>
<tr>
<td align="left"><strong><code>filter()</code></strong></td>
<td align="left"><code>T -&gt; Boolean</code></td>
<td align="left">Selectively includes items based on a predicate.</td>
<td align="left">Excluding users with an <code>isActive: false</code> status before returning a list of clients.</td>
</tr>
<tr>
<td align="left"><strong><code>cast()</code></strong></td>
<td align="left"><code>T -&gt; V</code> (Type conversion)</td>
<td align="left">Converts each element to a specified type.</td>
<td align="left">Converting an object retrieved from a generic cache (<code>Object</code>) to its expected type (<code>Product</code>).</td>
</tr>
</tbody></table>
<hr>
<h2 id="2-ü§ù-Combination-and-Merging-Operators"><a href="#2-ü§ù-Combination-and-Merging-Operators" class="headerlink" title="2. ü§ù Combination and Merging Operators"></a>2. ü§ù Combination and Merging Operators</h2><p>These operators combine the output from two or more source <code>Publishers</code>.</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>merge()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;... -&gt; Flux&lt;T&gt;</code> (Non-deterministic)</td>
<td align="left"><strong>Interleaves</strong> the elements from multiple sources as they arrive. The output order <strong>is not guaranteed</strong> and depends on timing.</td>
<td align="left">Combining real-time notifications: Combining two async streams of notifications (e.g., email and SMS alerts) into one feed where the order of arrival is acceptable.</td>
</tr>
<tr>
<td align="left"><strong><code>zip()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;, Publisher&lt;V&gt; -&gt; Mono&lt;Tuple2&lt;T, V&gt;&gt;</code> (Pairwise)</td>
<td align="left"><strong>Combines the <em>n</em>-th element</strong> from each source into a <code>Tuple</code> (or custom object) once all sources have emitted an element.</td>
<td align="left">Parallel data enrichment: Fetching a user profile (<code>Mono&lt;User&gt;</code>) and their recent transaction history (<code>Mono&lt;History&gt;</code>) concurrently, then combining both results into a single object for the API response.</td>
</tr>
<tr>
<td align="left"><strong><code>combineLatest()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;, Publisher&lt;V&gt; -&gt; Flux&lt;Tuple2&lt;T, V&gt;&gt;</code> (Emission-driven)</td>
<td align="left">Emits a new item whenever <strong>any</strong> source emits an item, combining the newly emitted item with the <strong>latest</strong> item from all other sources.</td>
<td align="left">Real-time dashboards: Combining a stream of stock prices with a stream of news headlines. A price update triggers a new emission with the latest price and the latest headline.</td>
</tr>
<tr>
<td align="left"><strong><code>concat()</code></strong></td>
<td align="left"><code>Publisher&lt;T&gt;... -&gt; Flux&lt;T&gt;</code> (Sequential)</td>
<td align="left"><strong>Appends</strong> one <code>Publisher</code> after another. The second source does not start emitting until the first source completes.</td>
<td align="left">Fallback data loading: First attempt to load data from a fast cache (<code>Mono A</code>). If A completes empty, immediately execute a database query (<code>Mono B</code>).</td>
</tr>
</tbody></table>
<hr>
<h2 id="3-‚è±Ô∏è-Error-Handling-and-Resilience-Operators"><a href="#3-‚è±Ô∏è-Error-Handling-and-Resilience-Operators" class="headerlink" title="3. ‚è±Ô∏è Error Handling and Resilience Operators"></a>3. ‚è±Ô∏è Error Handling and Resilience Operators</h2><p>These operators manage exceptions and provide fallbacks.</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>onErrorReturn()</code></strong></td>
<td align="left"><code>Class&lt;E&gt;, T</code> (Simple fallback value)</td>
<td align="left">When an error of a specific type occurs, it immediately <strong>replaces the error signal with a default, static value</strong> and completes the sequence normally.</td>
<td align="left">Handling an external API timeout: If the <code>weatherService.get()</code> call fails with a <code>TimeoutException</code>, return a cached default value like <code>&quot;Weather Unknown&quot;</code> instead of propagating the error.</td>
</tr>
<tr>
<td align="left"><strong><code>onErrorResume()</code></strong></td>
<td align="left"><code>Class&lt;E&gt;, Function&lt;E, Publisher&lt;V&gt;&gt;</code> (Fallback publisher)</td>
<td align="left">When an error occurs, it <strong>switches to a fallback <code>Publisher</code></strong>.</td>
<td align="left">Database failure: If the primary database query fails, switch to a fallback query that reads from a reliable but slightly stale read replica.</td>
</tr>
<tr>
<td align="left"><strong><code>retry()</code></strong></td>
<td align="left"><code>long times</code> (Retry N times)</td>
<td align="left"><strong>Resubscribes</strong> to the source <code>Publisher</code> upon receiving an error signal, up to a specified number of times.</td>
<td align="left">Transient network errors: Automatically retrying an external HTTP call up to three times to overcome temporary network hiccups before giving up.</td>
</tr>
<tr>
<td align="left"><strong><code>doOnError()</code></strong></td>
<td align="left"><code>Consumer&lt;Throwable&gt;</code> (Side effect)</td>
<td align="left">Allows execution of a <strong>side effect</strong> (logging, metrics tracking) when an error occurs, without modifying or consuming the error itself. The error is still passed downstream.</td>
<td align="left">Logging exceptions: Recording the full stack trace and metrics to a monitoring system before the error is propagated up the pipeline to be handled by an exception handler.</td>
</tr>
</tbody></table>
<hr>
<h2 id="4-üîó-Backpressure-and-Hot-Cold-Operators"><a href="#4-üîó-Backpressure-and-Hot-Cold-Operators" class="headerlink" title="4. üîó Backpressure and Hot&#x2F;Cold Operators"></a>4. üîó Backpressure and Hot&#x2F;Cold Operators</h2><p>These manage resource flow and execution model.</p>
<table>
<thead>
<tr>
<th align="left">Operator</th>
<th align="left">Signature &amp; Description</th>
<th align="left">Key Difference</th>
<th align="left">Real-World Use Case</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>subscribeOn()</code></strong></td>
<td align="left"><code>Scheduler</code> (Where execution starts)</td>
<td align="left">Determines the <strong>Scheduler (thread)</strong> on which the entire source execution pipeline begins. Crucial for moving blocking operations off the main Event Loop.</td>
<td align="left"><strong>Moving Blocking Code:</strong> Ensuring a blocking JDBC call or a CPU-intensive synchronous task runs on <code>Schedulers.boundedElastic()</code>.</td>
</tr>
<tr>
<td align="left"><strong><code>publishOn()</code></strong></td>
<td align="left"><code>Scheduler</code> (Where subsequent ops run)</td>
<td align="left">Changes the <code>Scheduler</code> used by <strong>all operators downstream</strong> of this call. Does not affect the source.</td>
<td align="left"><strong>Context Switching:</strong> After a heavy calculation, switching back to <code>Schedulers.parallel()</code> for non-blocking operations to maximize efficiency.</td>
</tr>
<tr>
<td align="left"><strong><code>share()</code></strong></td>
<td align="left"><code>Mono&lt;T&gt; -&gt; Mono&lt;T&gt;</code> (Multi-subscription)</td>
<td align="left">Allows multiple subscribers to share a single subscription to the source <code>Publisher</code>, ensuring the source logic is executed only once.</td>
<td align="left">Caching a slow computation: Executing an expensive initialization task (e.g., loading a large configuration file) once, then providing that result to dozens of services without re-running the load logic.</td>
</tr>
<tr>
<td align="left"><strong><code>delayElements()</code></strong></td>
<td align="left"><code>Duration</code> (Time-based pacing)</td>
<td align="left">Introduces a delay between the emissions of elements, effectively implementing <strong>backpressure by time</strong>.</td>
<td align="left">Throttling a data stream: Pacing a fast stream of data to match the input rate required by a slower downstream component (like a legacy API with strict rate limits).</td>
</tr>
</tbody></table>
<h1 id="Deepseek"><a href="#Deepseek" class="headerlink" title="Deepseek"></a>Deepseek</h1><h1 id="Spring-WebFlux-Operators-Comprehensive-Guide"><a href="#Spring-WebFlux-Operators-Comprehensive-Guide" class="headerlink" title="Spring WebFlux Operators: Comprehensive Guide"></a><strong>Spring WebFlux Operators: Comprehensive Guide</strong></h1><h2 id="Reactive-Programming-Operators-Deep-Dive"><a href="#Reactive-Programming-Operators-Deep-Dive" class="headerlink" title="Reactive Programming Operators Deep Dive"></a>Reactive Programming Operators Deep Dive</h2><hr>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a><strong>Table of Contents</strong></h2><ol>
<li><a href="#1-core-concepts--reactor-basics">Core Concepts &amp; Reactor Basics</a></li>
<li><a href="#2-creation-operators">Creation Operators</a></li>
<li><a href="#3-transformation-operators">Transformation Operators</a></li>
<li><a href="#4-filtering-operators">Filtering Operators</a></li>
<li><a href="#5-combining-operators">Combining Operators</a></li>
<li><a href="#6-error-handling-operators">Error Handling Operators</a></li>
<li><a href="#7-utility-operators">Utility Operators</a></li>
<li><a href="#8-schedulers--threading">Schedulers &amp; Threading</a></li>
<li><a href="#9-backpressure-operators">Backpressure Operators</a></li>
<li><a href="#10-real-world-patterns">Real-World Patterns</a></li>
</ol>
<hr>
<h2 id="1-Core-Concepts-Reactor-Basics"><a href="#1-Core-Concepts-Reactor-Basics" class="headerlink" title="1. Core Concepts &amp; Reactor Basics"></a><strong>1. Core Concepts &amp; Reactor Basics</strong></h2><h3 id="Reactive-Streams-Specification"><a href="#Reactive-Streams-Specification" class="headerlink" title="Reactive Streams Specification"></a><strong>Reactive Streams Specification</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Core Interfaces</span></span><br><span class="line">Publisher&lt;T&gt;    <span class="comment">// Emits data</span></span><br><span class="line">Subscriber&lt;T&gt;   <span class="comment">// Consumes data</span></span><br><span class="line">Subscription    <span class="comment">// Controls flow (backpressure)</span></span><br><span class="line">Processor&lt;T,R&gt;  <span class="comment">// Both publisher and subscriber</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Reactor Implementations</span></span><br><span class="line">Mono&lt;T&gt;         <span class="comment">// 0-1 element</span></span><br><span class="line">Flux&lt;T&gt;         <span class="comment">// 0-N elements</span></span><br></pre></td></tr></table></figure>

<h3 id="Cold-vs-Hot-Publishers"><a href="#Cold-vs-Hot-Publishers" class="headerlink" title="Cold vs Hot Publishers"></a><strong>Cold vs Hot Publishers</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// COLD: Each subscriber gets fresh data stream</span></span><br><span class="line">Flux&lt;Integer&gt; coldFlux = Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .doOnSubscribe(s -&gt; System.out.println(<span class="string">&quot;New subscription&quot;</span>));</span><br><span class="line"></span><br><span class="line">coldFlux.subscribe(); <span class="comment">// Prints: New subscription</span></span><br><span class="line">coldFlux.subscribe(); <span class="comment">// Prints: New subscription (again)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HOT: Shares data among subscribers</span></span><br><span class="line">ConnectableFlux&lt;Integer&gt; hotFlux = Flux.interval(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .publish(); <span class="comment">// Convert to hot publisher</span></span><br><span class="line"></span><br><span class="line">hotFlux.connect(); <span class="comment">// Start emitting</span></span><br><span class="line">hotFlux.subscribe(v -&gt; System.out.println(<span class="string">&quot;Sub1: &quot;</span> + v));</span><br><span class="line">Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">hotFlux.subscribe(v -&gt; System.out.println(<span class="string">&quot;Sub2: &quot;</span> + v)); <span class="comment">// Misses first 3 values</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Use case: Real-time stock prices</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StockController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectableFlux&lt;StockPrice&gt; priceStream;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StockController</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.priceStream = Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">            .map(tick -&gt; fetchStockPrice())</span><br><span class="line">            .publish();</span><br><span class="line">        <span class="built_in">this</span>.priceStream.connect();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/prices&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;StockPrice&gt; <span class="title function_">streamPrices</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> priceStream;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-Creation-Operators"><a href="#2-Creation-Operators" class="headerlink" title="2. Creation Operators"></a><strong>2. Creation Operators</strong></h2><h3 id="Static-Creation-Methods"><a href="#Static-Creation-Methods" class="headerlink" title="Static Creation Methods"></a><strong>Static Creation Methods</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. just() - Fixed values</span></span><br><span class="line">Mono.just(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">Flux.just(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. empty() - Complete without value</span></span><br><span class="line">Mono.empty()  <span class="comment">// Completes immediately</span></span><br><span class="line">Flux.empty()  <span class="comment">// Completes immediately</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. error() - Complete with error</span></span><br><span class="line">Mono.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Failed&quot;</span>))</span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Failed&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. never() - Never completes (for testing)</span></span><br><span class="line">Mono.never()</span><br><span class="line">Flux.never()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. from...() - From existing sources</span></span><br><span class="line">Flux.fromIterable(List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">Flux.fromStream(Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">Flux.fromArray(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">Mono.fromFuture(CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;result&quot;</span>))</span><br><span class="line">Mono.fromCallable(() -&gt; database.query())</span><br><span class="line">Mono.fromRunnable(() -&gt; cleanup()) <span class="comment">// Returns Mono&lt;Void&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. range() - Number sequence</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>) <span class="comment">// 1,2,3,...,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. interval() - Periodic emissions</span></span><br><span class="line">Flux.interval(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// 0,1,2,3,... every second</span></span><br><span class="line">    .take(<span class="number">5</span>) <span class="comment">// 0,1,2,3,4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. defer() - Deferred creation (per subscription)</span></span><br><span class="line">Flux.defer(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (System.currentTimeMillis() % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.just(<span class="string">&quot;Even&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.just(<span class="string">&quot;Odd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Each subscription gets potentially different result</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Database connection per request</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUser</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Mono.defer(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// Create new connection per subscription</span></span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; userRepository.findById(id))</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Programmatic-Creation"><a href="#Programmatic-Creation" class="headerlink" title="Programmatic Creation"></a><strong>Programmatic Creation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 9. create() - Bridge with callback APIs</span></span><br><span class="line">Flux.create(sink -&gt; &#123;</span><br><span class="line">    <span class="comment">// Bridge to event-based APIs</span></span><br><span class="line">    <span class="type">EventListener</span> <span class="variable">listener</span> <span class="operator">=</span> event -&gt; &#123;</span><br><span class="line">        sink.next(event.getData());</span><br><span class="line">        <span class="keyword">if</span> (event.isComplete()) &#123;</span><br><span class="line">            sink.complete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    eventSource.register(listener);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Cleanup on cancel</span></span><br><span class="line">    sink.onCancel(() -&gt; eventSource.unregister(listener));</span><br><span class="line">    sink.onDispose(() -&gt; eventSource.unregister(listener));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: WebSocket to Flux bridge</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Message&gt; <span class="title function_">createWebSocketStream</span><span class="params">(WebSocketSession session)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.create(sink -&gt; &#123;</span><br><span class="line">        session.sendMessage(<span class="keyword">new</span> <span class="title class_">TextMessage</span>(<span class="string">&quot;CONNECTED&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        session.addHandler(<span class="keyword">new</span> <span class="title class_">WebSocketHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(WebSocketSession session, WebSocketMessage&lt;?&gt; message)</span> &#123;</span><br><span class="line">                sink.next(convert(message));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus status)</span> &#123;</span><br><span class="line">                sink.complete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        sink.onDispose(() -&gt; session.close());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. generate() - Synchronous, stateful generation</span></span><br><span class="line">Flux.generate(</span><br><span class="line">    () -&gt; <span class="number">0</span>, <span class="comment">// Initial state</span></span><br><span class="line">    (state, sink) -&gt; &#123;</span><br><span class="line">        sink.next(<span class="string">&quot;Value: &quot;</span> + state);</span><br><span class="line">        <span class="keyword">if</span> (state == <span class="number">10</span>) &#123;</span><br><span class="line">            sink.complete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span>; <span class="comment">// New state</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 11. push() - Single-threaded async generation (like create but single-threaded)</span></span><br><span class="line">Flux.push(sink -&gt; &#123;</span><br><span class="line">    <span class="comment">// For single-threaded producers</span></span><br><span class="line">    singleThreadedEventEmitter.onData(data -&gt; sink.next(data));</span><br><span class="line">    singleThreadedEventEmitter.onComplete(() -&gt; sink.complete());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 12. using() - Resource management</span></span><br><span class="line">Flux.using(</span><br><span class="line">    () -&gt; database.getConnection(),           <span class="comment">// Resource supplier</span></span><br><span class="line">    connection -&gt; Flux.fromIterable(connection.query()), <span class="comment">// Flux factory</span></span><br><span class="line">    connection -&gt; connection.close()          <span class="comment">// Cleanup</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-Transformation-Operators"><a href="#3-Transformation-Operators" class="headerlink" title="3. Transformation Operators"></a><strong>3. Transformation Operators</strong></h2><h3 id="Element-Transformation"><a href="#Element-Transformation" class="headerlink" title="Element Transformation"></a><strong>Element Transformation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. map() - Synchronous 1:1 transformation</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">Flux&lt;String&gt; strings = numbers.map(n -&gt; <span class="string">&quot;Number: &quot;</span> + n);</span><br><span class="line"><span class="comment">// 1 ‚Üí &quot;Number: 1&quot;, 2 ‚Üí &quot;Number: 2&quot;, ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. flatMap() - Asynchronous 1:N transformation</span></span><br><span class="line">Flux&lt;User&gt; users = Flux.just(<span class="string">&quot;user1&quot;</span>, <span class="string">&quot;user2&quot;</span>, <span class="string">&quot;user3&quot;</span>);</span><br><span class="line">Flux&lt;Order&gt; orders = users.flatMap(username -&gt; </span><br><span class="line">    orderRepository.findByUser(username) <span class="comment">// Returns Flux&lt;Order&gt;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// Concatenates all inner Flux emissions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. concatMap() - Preserves order (slower)</span></span><br><span class="line">users.concatMap(username -&gt; </span><br><span class="line">    orderRepository.findByUser(username)</span><br><span class="line">);</span><br><span class="line"><span class="comment">// Waits for each inner Flux to complete before starting next</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. flatMapSequential() - Preserves source order but subscribes eagerly</span></span><br><span class="line">users.flatMapSequential(username -&gt; </span><br><span class="line">    orderRepository.findByUser(username)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Parallel API calls with ordering</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">getProductsWithReviews</span><span class="params">(List&lt;String&gt; productIds)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(productIds)</span><br><span class="line">        .flatMap(id -&gt; </span><br><span class="line">            productService.getProduct(id)  <span class="comment">// Mono&lt;Product&gt;</span></span><br><span class="line">                .flatMap(product -&gt;</span><br><span class="line">                    reviewService.getReviews(id)  <span class="comment">// Mono&lt;List&lt;Review&gt;&gt;</span></span><br><span class="line">                        .map(reviews -&gt; &#123;</span><br><span class="line">                            product.setReviews(reviews);</span><br><span class="line">                            <span class="keyword">return</span> product;</span><br><span class="line">                        &#125;)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. switchMap() - Cancels previous inner publisher</span></span><br><span class="line">searchInputFlux</span><br><span class="line">    .debounce(Duration.ofMillis(<span class="number">300</span>))</span><br><span class="line">    .switchMap(query -&gt; </span><br><span class="line">        searchService.search(query) <span class="comment">// Cancels previous search if new query arrives</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. transform() - Operator composition</span></span><br><span class="line">Function&lt;Flux&lt;String&gt;, Flux&lt;String&gt;&gt; filterAndTransform =</span><br><span class="line">    flux -&gt; flux</span><br><span class="line">        .filter(s -&gt; !s.isEmpty())</span><br><span class="line">        .map(String::toUpperCase);</span><br><span class="line"></span><br><span class="line">Flux&lt;String&gt; result = Flux.just(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">    .transform(filterAndTransform);</span><br></pre></td></tr></table></figure>

<h3 id="Flattening-Operators"><a href="#Flattening-Operators" class="headerlink" title="Flattening Operators"></a><strong>Flattening Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7. flatMap vs flatMapMany</span></span><br><span class="line">Mono&lt;List&lt;Integer&gt;&gt; monoList = Mono.just(List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">Flux&lt;Integer&gt; flux = monoList.flatMapMany(Flux::fromIterable);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. concatMap vs flatMap comparison</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .flatMap(i -&gt; </span><br><span class="line">        Mono.just(i * <span class="number">10</span>)</span><br><span class="line">            .delayElement(Duration.ofMillis(i * <span class="number">100</span>))</span><br><span class="line">    );</span><br><span class="line"><span class="comment">// Output order: 10, 20, 30 (may vary due to delays)</span></span><br><span class="line"></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .concatMap(i -&gt; </span><br><span class="line">        Mono.just(i * <span class="number">10</span>)</span><br><span class="line">            .delayElement(Duration.ofMillis(i * <span class="number">100</span>))</span><br><span class="line">    );</span><br><span class="line"><span class="comment">// Output order: 10, 20, 30 (guaranteed order)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: File processing with backpressure</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">processLargeFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.using(</span><br><span class="line">        () -&gt; Files.lines(Paths.get(filePath)),</span><br><span class="line">        Flux::fromStream,</span><br><span class="line">        Stream::close</span><br><span class="line">    )</span><br><span class="line">    .flatMap(line -&gt; </span><br><span class="line">        Mono.fromCallable(() -&gt; expensiveProcessing(line))</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">        <span class="number">5</span> <span class="comment">// Maximum concurrency</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. groupBy() - Group elements by key</span></span><br><span class="line">Flux&lt;Transaction&gt; transactions = getTransactions();</span><br><span class="line">Flux&lt;GroupedFlux&lt;String, Transaction&gt;&gt; grouped = </span><br><span class="line">    transactions.groupBy(tx -&gt; tx.getCategory());</span><br><span class="line"></span><br><span class="line">grouped.flatMap(group -&gt; </span><br><span class="line">    group</span><br><span class="line">        .buffer(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">        .map(list -&gt; <span class="keyword">new</span> <span class="title class_">CategorySummary</span>(group.key(), list))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. window() - Split into windows</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .window(<span class="number">10</span>) <span class="comment">// Flux&lt;Flux&lt;Integer&gt;&gt; with windows of size 10</span></span><br><span class="line">    .flatMap(window -&gt; </span><br><span class="line">        window.reduce(<span class="number">0</span>, Integer::sum)</span><br><span class="line">            .map(sum -&gt; <span class="string">&quot;Window sum: &quot;</span> + sum)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// Time-based windowing</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .window(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .flatMap(window -&gt; window.count())</span><br><span class="line">    .subscribe(count -&gt; System.out.println(<span class="string">&quot;Events per second: &quot;</span> + count));</span><br></pre></td></tr></table></figure>

<h3 id="Buffering-Windowing"><a href="#Buffering-Windowing" class="headerlink" title="Buffering &amp; Windowing"></a><strong>Buffering &amp; Windowing</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. buffer() - Collect into lists</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .buffer(<span class="number">3</span>) <span class="comment">// [1,2,3], [4,5,6], [7,8,9], [10]</span></span><br><span class="line">    .subscribe(list -&gt; System.out.println(list));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. bufferTimeout() - Size OR time based</span></span><br><span class="line">messageFlux</span><br><span class="line">    .bufferTimeout(<span class="number">100</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .subscribe(batch -&gt; batchProcessor.process(batch));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. bufferWhile() / bufferUntil()</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">numbers.bufferWhile(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>); <span class="comment">// Buffer while even</span></span><br><span class="line">numbers.bufferUntil(n -&gt; n % <span class="number">3</span> == <span class="number">0</span>); <span class="comment">// Buffer until divisible by 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Batch database inserts</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">saveMessages</span><span class="params">(Flux&lt;Message&gt; messages)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> messages</span><br><span class="line">        .buffer(<span class="number">100</span>) <span class="comment">// Batch size</span></span><br><span class="line">        .delayElements(Duration.ofMillis(<span class="number">100</span>)) <span class="comment">// Throttle</span></span><br><span class="line">        .flatMap(batch -&gt; </span><br><span class="line">            Mono.fromRunnable(() -&gt; batchInsert(batch))</span><br><span class="line">                .subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            <span class="number">3</span> <span class="comment">// Max concurrent batches</span></span><br><span class="line">        )</span><br><span class="line">        .then();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. window() vs buffer()</span></span><br><span class="line">Flux&lt;Integer&gt; source = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">source.buffer(<span class="number">3</span>);  <span class="comment">// Returns Flux&lt;List&lt;Integer&gt;&gt;</span></span><br><span class="line">source.window(<span class="number">3</span>);  <span class="comment">// Returns Flux&lt;Flux&lt;Integer&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. windowUntilChanged() - Window on changing values</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    .windowUntilChanged()</span><br><span class="line">    .flatMap(window -&gt; window.collectList())</span><br><span class="line"><span class="comment">// Windows: [1,1], [2,2], [1], [3,3]</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-Filtering-Operators"><a href="#4-Filtering-Operators" class="headerlink" title="4. Filtering Operators"></a><strong>4. Filtering Operators</strong></h2><h3 id="Basic-Filtering"><a href="#Basic-Filtering" class="headerlink" title="Basic Filtering"></a><strong>Basic Filtering</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. filter() - Predicate-based filtering</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">Flux&lt;Integer&gt; even = numbers.filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ignoreElements() - Ignore all, just completion/error</span></span><br><span class="line">Mono&lt;Void&gt; completion = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .ignoreElements(); <span class="comment">// Only onComplete/onError signals</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. distinct() - Remove duplicates</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">    .distinct() <span class="comment">// 1, 2, 3, 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. distinctUntilChanged() - Remove consecutive duplicates</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    .distinctUntilChanged() <span class="comment">// 1, 2, 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Rate limiting duplicate requests</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Response&gt; <span class="title function_">handleRequests</span><span class="params">(Flux&lt;Request&gt; requests)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> requests</span><br><span class="line">        .distinct(Request::getId) <span class="comment">// Ignore duplicate IDs</span></span><br><span class="line">        .filter(req -&gt; !isBlocked(req.getIp()))</span><br><span class="line">        .flatMap(<span class="built_in">this</span>::processRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Taking-Skipping"><a href="#Taking-Skipping" class="headerlink" title="Taking &amp; Skipping"></a><strong>Taking &amp; Skipping</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. take(n) - Take first N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>).take(<span class="number">5</span>); <span class="comment">// 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. takeLast(n) - Take last N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>).takeLast(<span class="number">5</span>); <span class="comment">// 96,97,98,99,100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. takeWhile(predicate) - Take while true</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .takeWhile(n -&gt; n &lt; <span class="number">5</span>); <span class="comment">// 1,2,3,4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. takeUntil(predicate) - Take until true (inclusive)</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .takeUntil(n -&gt; n == <span class="number">5</span>); <span class="comment">// 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. skip(n) - Skip first N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>).skip(<span class="number">5</span>); <span class="comment">// 6,7,8,9,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. skipLast(n) - Skip last N elements</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>).skipLast(<span class="number">5</span>); <span class="comment">// 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. skipWhile(predicate) - Skip while true</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .skipWhile(n -&gt; n &lt; <span class="number">5</span>); <span class="comment">// 5,6,7,8,9,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. skipUntil(predicate) - Skip until true</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .skipUntil(n -&gt; n == <span class="number">5</span>); <span class="comment">// 5,6,7,8,9,10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Pagination with take/skip</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">getUsers</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findAll()</span><br><span class="line">        .skip(page * size)</span><br><span class="line">        .take(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. takeDuration() / skipDuration() - Time-based</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .take(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// Take for 1 second</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. elementAt() - Get element at index</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .elementAt(<span class="number">5</span>); <span class="comment">// Mono with value 6</span></span><br></pre></td></tr></table></figure>

<h3 id="Sampling-Throttling"><a href="#Sampling-Throttling" class="headerlink" title="Sampling &amp; Throttling"></a><strong>Sampling &amp; Throttling</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. sample(Duration) - Last element in time window</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .sample(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// Emit last value every second</span></span><br><span class="line">    .subscribe(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. sampleFirst(Duration) - First element in time window</span></span><br><span class="line">messageFlux.sampleFirst(Duration.ofMillis(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. sampleTimeout() - Sample with dynamic duration</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .sampleTimeout(</span><br><span class="line">        v -&gt; Mono.delay(Duration.ofMillis(<span class="number">50</span> + v * <span class="number">10</span>))</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. throttleFirst / throttleLast (alias for sample)</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">50</span>))</span><br><span class="line">    .throttleFirst(Duration.ofSeconds(<span class="number">1</span>)) <span class="comment">// First in window</span></span><br><span class="line">    .throttleLast(Duration.ofSeconds(<span class="number">1</span>))  <span class="comment">// Last in window (same as sample)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: UI event throttling</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Result&gt; <span class="title function_">search</span><span class="params">(Flux&lt;String&gt; queries)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queries</span><br><span class="line">            .filter(query -&gt; query.length() &gt; <span class="number">2</span>)</span><br><span class="line">            .debounce(Duration.ofMillis(<span class="number">300</span>)) <span class="comment">// Wait for pause</span></span><br><span class="line">            .distinctUntilChanged() <span class="comment">// Ignore same query</span></span><br><span class="line">            .switchMap(<span class="built_in">this</span>::executeSearch); <span class="comment">// Cancel previous</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. debounce - Wait for quiet period</span></span><br><span class="line">buttonClickFlux</span><br><span class="line">    .debounce(Duration.ofMillis(<span class="number">250</span>)) <span class="comment">// Prevent double clicks</span></span><br><span class="line">    .subscribe(<span class="built_in">this</span>::handleClick);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-Combining-Operators"><a href="#5-Combining-Operators" class="headerlink" title="5. Combining Operators"></a><strong>5. Combining Operators</strong></h2><h3 id="Sequential-Combination"><a href="#Sequential-Combination" class="headerlink" title="Sequential Combination"></a><strong>Sequential Combination</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. concatWith() - Sequential concatenation</span></span><br><span class="line">Flux&lt;Integer&gt; flux1 = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">Flux&lt;Integer&gt; flux2 = Flux.just(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">flux1.concatWith(flux2); <span class="comment">// 1,2,3,4,5,6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. concat() - Static version</span></span><br><span class="line">Flux.concat(flux1, flux2, Flux.just(<span class="number">7</span>, <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. concatDelayError() - Delay errors until end</span></span><br><span class="line">Flux.concatDelayError(</span><br><span class="line">    Flux.just(<span class="number">1</span>, <span class="number">2</span>).concatWith(Mono.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())),</span><br><span class="line">    Flux.just(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">); <span class="comment">// Emits: 1,2,3,4 then error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Fallback service calls</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">getProducts</span><span class="params">(String category)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> primaryService.getProducts(category)</span><br><span class="line">        .concatWith(secondaryService.getProducts(category))</span><br><span class="line">        .take(<span class="number">10</span>); <span class="comment">// Get up to 10 from either source</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Parallel-Combination"><a href="#Parallel-Combination" class="headerlink" title="Parallel Combination"></a><strong>Parallel Combination</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. mergeWith() - Interleave emissions</span></span><br><span class="line">Flux&lt;Integer&gt; flux1 = Flux.interval(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span>);</span><br><span class="line">Flux&lt;Integer&gt; flux2 = Flux.interval(Duration.ofMillis(<span class="number">150</span>))</span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">flux1.mergeWith(flux2); <span class="comment">// Interleaved: 0,1,2,3,4,5,...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. merge() - Static version</span></span><br><span class="line">Flux.merge(flux1, flux2, flux3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. mergeSequential() - Subscribe in order, emit as arrive</span></span><br><span class="line">Flux.mergeSequential(flux1, flux2); <span class="comment">// Maintains subscription order</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. mergeOrdered() - Merge with ordering</span></span><br><span class="line">Flux.mergeOrdered(</span><br><span class="line">    Comparator.naturalOrder(),</span><br><span class="line">    flux1, flux2</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Aggregating multiple data sources</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;StockPrice&gt; <span class="title function_">getAllStockPrices</span><span class="params">(List&lt;String&gt; symbols)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(symbols)</span><br><span class="line">        .flatMap(symbol -&gt; </span><br><span class="line">            stockService.getPriceStream(symbol),</span><br><span class="line">            <span class="number">5</span> <span class="comment">// Max concurrent subscriptions</span></span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pairing-Operators"><a href="#Pairing-Operators" class="headerlink" title="Pairing Operators"></a><strong>Pairing Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. zipWith() - Pair-wise combination</span></span><br><span class="line">Flux&lt;Integer&gt; numbers = Flux.range(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">Flux&lt;String&gt; letters = Flux.just(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line"></span><br><span class="line">numbers.zipWith(letters, (n, l) -&gt; n + l);</span><br><span class="line"><span class="comment">// [1A, 2B, 3C]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. zip() - Static version</span></span><br><span class="line">Flux.zip(numbers, letters, more)</span><br><span class="line">    .map(tuple -&gt; tuple.getT1() + tuple.getT2());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. zip with combinator</span></span><br><span class="line">Flux.zip(</span><br><span class="line">    obj -&gt; <span class="keyword">new</span> <span class="title class_">Combined</span>((String)obj[<span class="number">0</span>], (Integer)obj[<span class="number">1</span>]),</span><br><span class="line">    flux1, flux2</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Parallel API calls with aggregation</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;UserProfile&gt; <span class="title function_">getUserProfile</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Mono.zip(</span><br><span class="line">        userService.getUser(userId),</span><br><span class="line">        orderService.getOrders(userId),</span><br><span class="line">        paymentService.getPaymentMethods(userId)</span><br><span class="line">    ).map(tuple -&gt; <span class="keyword">new</span> <span class="title class_">UserProfile</span>(</span><br><span class="line">        tuple.getT1(),</span><br><span class="line">        tuple.getT2(),</span><br><span class="line">        tuple.getT3()</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. combineLatest - Latest from each</span></span><br><span class="line">Flux.combineLatest(</span><br><span class="line">    flux1, flux2,</span><br><span class="line">    (v1, v2) -&gt; v1 + <span class="string">&quot; - &quot;</span> + v2</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Real-time dashboard</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;DashboardData&gt; <span class="title function_">getDashboard</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.combineLatest(</span><br><span class="line">        cpuMetrics,</span><br><span class="line">        memoryMetrics,</span><br><span class="line">        networkMetrics,</span><br><span class="line">        (cpu, memory, network) -&gt; <span class="keyword">new</span> <span class="title class_">DashboardData</span>(cpu, memory, network)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Race-Conditions"><a href="#Race-Conditions" class="headerlink" title="Race Conditions"></a><strong>Race Conditions</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. firstWithSignal / firstWithValue - Race to emit</span></span><br><span class="line">Mono&lt;String&gt; cache = getFromCache(key);</span><br><span class="line">Mono&lt;String&gt; db = getFromDatabase(key);</span><br><span class="line"></span><br><span class="line">Mono.firstWithSignal(cache, db) <span class="comment">// First to emit any signal</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line">Mono.firstWithValue(cache, db) <span class="comment">// First to emit a value</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Circuit breaker with fallbacks</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&gt; <span class="title function_">callWithFallback</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> primaryService.call(request)</span><br><span class="line">        .timeout(Duration.ofSeconds(<span class="number">2</span>))</span><br><span class="line">        .onErrorResume(e -&gt; </span><br><span class="line">            Mono.firstWithValue(</span><br><span class="line">                secondaryService.call(request),</span><br><span class="line">                Mono.just(Response.fallback())</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. amb (deprecated, use firstWithSignal)</span></span><br><span class="line">Flux.firstWithSignal(source1, source2, source3);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-Error-Handling-Operators"><a href="#6-Error-Handling-Operators" class="headerlink" title="6. Error Handling Operators"></a><strong>6. Error Handling Operators</strong></h2><h3 id="Error-Recovery"><a href="#Error-Recovery" class="headerlink" title="Error Recovery"></a><strong>Error Recovery</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. onErrorReturn - Provide fallback value</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .map(n -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Boom!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;)</span><br><span class="line">    .onErrorReturn(<span class="number">0</span>); <span class="comment">// 1, 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. onErrorResume - Switch to fallback publisher</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Failed&quot;</span>))</span><br><span class="line">    .onErrorResume(e -&gt; </span><br><span class="line">        Flux.just(<span class="string">&quot;fallback1&quot;</span>, <span class="string">&quot;fallback2&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. onErrorContinue - Continue with next element</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">    .map(n -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">3</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Skip 3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> n * <span class="number">10</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .onErrorContinue((e, obj) -&gt; </span><br><span class="line">        log.error(<span class="string">&quot;Skipped &#123;&#125; due to &#123;&#125;&quot;</span>, obj, e.getMessage())</span><br><span class="line">    ); <span class="comment">// 10, 20, 40</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Resilient API calls</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">getProductsWithRetry</span><span class="params">(List&lt;String&gt; ids)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(ids)</span><br><span class="line">        .flatMap(id -&gt; </span><br><span class="line">            productService.getProduct(id)</span><br><span class="line">                .onErrorResume(e -&gt; &#123;</span><br><span class="line">                    log.warn(<span class="string">&quot;Failed for &#123;&#125;, trying fallback&quot;</span>, id);</span><br><span class="line">                    <span class="keyword">return</span> fallbackService.getProduct(id);</span><br><span class="line">                &#125;)</span><br><span class="line">                .onErrorResume(e -&gt; &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;Complete failure for &#123;&#125;&quot;</span>, id);</span><br><span class="line">                    <span class="keyword">return</span> Mono.just(Product.unavailable(id));</span><br><span class="line">                &#125;)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Retry-Strategies"><a href="#Retry-Strategies" class="headerlink" title="Retry Strategies"></a><strong>Retry Strategies</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. retry() - Simple retry</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .retry(<span class="number">3</span>); <span class="comment">// Retry 3 times</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. retryWhen - Advanced retry with backoff</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">        .maxBackoff(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .jitter(<span class="number">0.5</span>) <span class="comment">// Add randomness</span></span><br><span class="line">        .doBeforeRetry(retrySignal -&gt; </span><br><span class="line">            log.warn(<span class="string">&quot;Retrying attempt &#123;&#125;&quot;</span>, retrySignal.totalRetries())</span><br><span class="line">        )</span><br><span class="line">        .onRetryExhaustedThrow((spec, signal) -&gt; </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ServiceUnavailableException</span>(<span class="string">&quot;Max retries exceeded&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. retryWhen with predicate</span></span><br><span class="line">.retryWhen(Retry.fixedDelay(<span class="number">5</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .filter(e -&gt; e <span class="keyword">instanceof</span> TimeoutException)</span><br><span class="line">    .doBeforeRetry(retrySignal -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (retrySignal.totalRetries() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            refreshConnection();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Exponential backoff for external APIs</span></span><br><span class="line"><span class="keyword">private</span> RetrySpec <span class="title function_">apiRetrySpec</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Retry.backoff(<span class="number">5</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">        .maxBackoff(Duration.ofMinutes(<span class="number">1</span>))</span><br><span class="line">        .transientErrors(<span class="literal">true</span>) <span class="comment">// Retry on 5xx errors</span></span><br><span class="line">        .doBeforeRetry(retry -&gt; </span><br><span class="line">            metrics.recordRetry(retry.failure())</span><br><span class="line">        )</span><br><span class="line">        .onRetryExhaustedThrow((spec, signal) -&gt; </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ApiException</span>(<span class="string">&quot;Service unavailable after retries&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&gt; <span class="title function_">callExternalApi</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> webClient.post()</span><br><span class="line">        .bodyValue(request)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(Response.class)</span><br><span class="line">        .retryWhen(apiRetrySpec());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Timeout-Fallback"><a href="#Timeout-Fallback" class="headerlink" title="Timeout &amp; Fallback"></a><strong>Timeout &amp; Fallback</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. timeout - Timeout with fallback</span></span><br><span class="line">Flux.interval(Duration.ofSeconds(<span class="number">2</span>))</span><br><span class="line">    .timeout(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .onErrorResume(TimeoutException.class, e -&gt; </span><br><span class="line">        Flux.just(-<span class="number">1L</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. timeout with fallback publisher</span></span><br><span class="line">slowFlux</span><br><span class="line">    .timeout(Duration.ofSeconds(<span class="number">1</span>), fallbackFlux)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Service call with timeout cascade</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&gt; <span class="title function_">callServiceWithTimeouts</span><span class="params">(Request req)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> primaryService.call(req)</span><br><span class="line">        .timeout(Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">        .onErrorResume(TimeoutException.class, e -&gt;</span><br><span class="line">            secondaryService.call(req)</span><br><span class="line">                .timeout(Duration.ofMillis(<span class="number">200</span>))</span><br><span class="line">        )</span><br><span class="line">        .onErrorResume(TimeoutException.class, e -&gt;</span><br><span class="line">            tertiaryService.call(req)</span><br><span class="line">                .timeout(Duration.ofMillis(<span class="number">500</span>))</span><br><span class="line">        )</span><br><span class="line">        .onErrorReturn(Response.fallback());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Error-Classification"><a href="#Error-Classification" class="headerlink" title="Error Classification"></a><strong>Error Classification</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. onErrorMap - Transform error</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Connection failed&quot;</span>))</span><br><span class="line">    .onErrorMap(IOException.class, e -&gt; </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;Service unavailable&quot;</span>, e)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. onErrorMap with predicate</span></span><br><span class="line">.onErrorMap(e -&gt; e.getMessage().contains(<span class="string">&quot;timeout&quot;</span>), </span><br><span class="line">    e -&gt; <span class="keyword">new</span> <span class="title class_">TimeoutException</span>(<span class="string">&quot;Operation timed out&quot;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. doOnError - Side effect on error</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .doOnError(e -&gt; </span><br><span class="line">        metrics.incrementError(e.getClass().getSimpleName())</span><br><span class="line">    )</span><br><span class="line">    .onErrorResume(e -&gt; Mono.empty());</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Circuit breaker pattern</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircuitBreakerService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Data&gt; <span class="title function_">getDataWithCircuitBreaker</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.defer(() -&gt; externalService.getData())</span><br><span class="line">            .transformDeferred(circuitBreaker::run)</span><br><span class="line">            .onErrorResume(CallNotPermittedException.class, e -&gt; </span><br><span class="line">                Flux.error(<span class="keyword">new</span> <span class="title class_">ServiceUnavailableException</span>())</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-Utility-Operators"><a href="#7-Utility-Operators" class="headerlink" title="7. Utility Operators"></a><strong>7. Utility Operators</strong></h2><h3 id="Side-Effects"><a href="#Side-Effects" class="headerlink" title="Side Effects"></a><strong>Side Effects</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. doOnNext - Peek at values</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .doOnNext(n -&gt; System.out.println(<span class="string">&quot;Processing: &quot;</span> + n))</span><br><span class="line">    .map(n -&gt; n * <span class="number">2</span>)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. doOnComplete - On completion</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .doOnComplete(() -&gt; System.out.println(<span class="string">&quot;Done!&quot;</span>))</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. doOnError - On error</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">    .doOnError(e -&gt; log.error(<span class="string">&quot;Failed&quot;</span>, e))</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. doOnSubscribe / doOnCancel / doOnRequest</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .doOnSubscribe(s -&gt; System.out.println(<span class="string">&quot;Subscribed&quot;</span>))</span><br><span class="line">    .doOnRequest(n -&gt; System.out.println(<span class="string">&quot;Requested: &quot;</span> + n))</span><br><span class="line">    .doOnCancel(() -&gt; System.out.println(<span class="string">&quot;Cancelled&quot;</span>))</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Request logging</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Data&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dataService.getData()</span><br><span class="line">            .doOnSubscribe(s -&gt; </span><br><span class="line">                log.info(<span class="string">&quot;Request started at &#123;&#125;&quot;</span>, Instant.now())</span><br><span class="line">            )</span><br><span class="line">            .doOnComplete(() -&gt; </span><br><span class="line">                log.info(<span class="string">&quot;Request completed successfully&quot;</span>)</span><br><span class="line">            )</span><br><span class="line">            .doOnError(e -&gt; </span><br><span class="line">                log.error(<span class="string">&quot;Request failed&quot;</span>, e)</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Debugging-Metrics"><a href="#Debugging-Metrics" class="headerlink" title="Debugging &amp; Metrics"></a><strong>Debugging &amp; Metrics</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. log() - Log all signals</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    .log(<span class="string">&quot;my.flux&quot;</span>)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// [my.flux] onSubscribe(FluxRange.RangeSubscription)</span></span><br><span class="line"><span class="comment">// [my.flux] request(unbounded)</span></span><br><span class="line"><span class="comment">// [my.flux] onNext(1)</span></span><br><span class="line"><span class="comment">// [my.flux] onNext(2)</span></span><br><span class="line"><span class="comment">// [my.flux] onNext(3)</span></span><br><span class="line"><span class="comment">// [my.flux] onComplete()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. checkpoint - Add trace for debugging</span></span><br><span class="line">Flux.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Oops&quot;</span>))</span><br><span class="line">    .checkpoint(<span class="string">&quot;errorSource&quot;</span>)</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Stack trace includes &quot;errorSource&quot; marker</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. metrics - Micrometer integration</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .name(<span class="string">&quot;myFlux&quot;</span>)</span><br><span class="line">    .metrics()</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Production monitoring</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Event&gt; <span class="title function_">processEvents</span><span class="params">(Flux&lt;Event&gt; events)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> events</span><br><span class="line">        .name(<span class="string">&quot;event.processor&quot;</span>)</span><br><span class="line">        .tag(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;kafka&quot;</span>)</span><br><span class="line">        .metrics() <span class="comment">// Exposes metrics to Micrometer</span></span><br><span class="line">        .doOnNext(event -&gt; </span><br><span class="line">            Metrics.counter(<span class="string">&quot;events.processed&quot;</span>).increment()</span><br><span class="line">        )</span><br><span class="line">        .doOnError(e -&gt; </span><br><span class="line">            Metrics.counter(<span class="string">&quot;events.failed&quot;</span>).increment()</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Conditional-Operators"><a href="#Conditional-Operators" class="headerlink" title="Conditional Operators"></a><strong>Conditional Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. hasElements / hasElement</span></span><br><span class="line">Mono&lt;Boolean&gt; hasData = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).hasElements();</span><br><span class="line">Mono&lt;Boolean&gt; hasTwo = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).hasElement(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. any / all</span></span><br><span class="line">Mono&lt;Boolean&gt; anyEven = Flux.just(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>).any(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line">Mono&lt;Boolean&gt; allPositive = Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).all(n -&gt; n &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. defaultIfEmpty</span></span><br><span class="line">Flux.empty()</span><br><span class="line">    .defaultIfEmpty(<span class="string">&quot;default&quot;</span>); <span class="comment">// Emits &quot;default&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. switchIfEmpty</span></span><br><span class="line">Flux.empty()</span><br><span class="line">    .switchIfEmpty(Flux.just(<span class="string">&quot;fallback&quot;</span>, <span class="string">&quot;values&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Cache with fallback</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUser</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cache.get(id)</span><br><span class="line">        .switchIfEmpty(</span><br><span class="line">            database.getUser(id)</span><br><span class="line">                .doOnNext(user -&gt; cache.set(id, user))</span><br><span class="line">        )</span><br><span class="line">        .defaultIfEmpty(User.anonymous());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Collecting-Reducing"><a href="#Collecting-Reducing" class="headerlink" title="Collecting &amp; Reducing"></a><strong>Collecting &amp; Reducing</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. collectList / collectMap / collectMultimap</span></span><br><span class="line">Flux.just(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">    .collectList() <span class="comment">// Mono&lt;List&lt;String&gt;&gt;</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line">Flux.just(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Pair</span>(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Pair</span>(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>)</span><br><span class="line">).collectMap(Pair::getKey, Pair::getValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. reduce - Accumulate values</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .reduce(<span class="number">0</span>, Integer::sum); <span class="comment">// Mono with value 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. scan - Emit accumulation steps</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .scan(<span class="number">0</span>, Integer::sum); <span class="comment">// 0,1,3,6,10,15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. count</span></span><br><span class="line">Flux.just(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>).count(); <span class="comment">// Mono with value 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Real-time analytics</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;AggregatedStats&gt; <span class="title function_">streamStats</span><span class="params">(Flux&lt;Event&gt; events)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> events</span><br><span class="line">        .window(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">        .flatMap(window -&gt; </span><br><span class="line">            window</span><br><span class="line">                .reduce(<span class="keyword">new</span> <span class="title class_">StatsAccumulator</span>(), StatsAccumulator::add)</span><br><span class="line">                .map(StatsAccumulator::toStats)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-Schedulers-Threading"><a href="#8-Schedulers-Threading" class="headerlink" title="8. Schedulers &amp; Threading"></a><strong>8. Schedulers &amp; Threading</strong></h2><h3 id="Scheduler-Types"><a href="#Scheduler-Types" class="headerlink" title="Scheduler Types"></a><strong>Scheduler Types</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Schedulers.immediate() - Current thread</span></span><br><span class="line"><span class="comment">// 2. Schedulers.single() - Single dedicated thread</span></span><br><span class="line"><span class="comment">// 3. Schedulers.elastic() - Deprecated, use boundedElastic</span></span><br><span class="line"><span class="comment">// 4. Schedulers.boundedElastic() - For blocking I/O</span></span><br><span class="line"><span class="comment">// 5. Schedulers.parallel() - For CPU-intensive work</span></span><br><span class="line"><span class="comment">// 6. Schedulers.fromExecutorService() - Custom executor</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Threading strategy by operation type</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Result&gt; <span class="title function_">process</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> validate(request) <span class="comment">// Fast, use immediate</span></span><br><span class="line">        .flatMap(validated -&gt; </span><br><span class="line">            Mono.fromCallable(() -&gt; blockingIO(validated))</span><br><span class="line">                .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">        )</span><br><span class="line">        .flatMap(ioResult -&gt; </span><br><span class="line">            Mono.fromCallable(() -&gt; cpuIntensive(ioResult))</span><br><span class="line">                .subscribeOn(Schedulers.parallel())</span><br><span class="line">        )</span><br><span class="line">        .publishOn(Schedulers.single()) <span class="comment">// Switch back to single thread</span></span><br><span class="line">        .doOnNext(result -&gt; </span><br><span class="line">            <span class="comment">// UI updates or single-threaded operations</span></span><br><span class="line">            updateUI(result)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Threading-Operators"><a href="#Threading-Operators" class="headerlink" title="Threading Operators"></a><strong>Threading Operators</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. subscribeOn - Where subscription happens</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .map(n -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Map on: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> n * <span class="number">2</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .subscribeOn(Schedulers.parallel())</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. publishOn - Switch threads downstream</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .map(n -&gt; n * <span class="number">2</span>) <span class="comment">// On subscription thread</span></span><br><span class="line">    .publishOn(Schedulers.single())</span><br><span class="line">    .map(n -&gt; n + <span class="number">1</span>) <span class="comment">// On single thread</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. parallel / runOn - Parallel processing</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .parallel(<span class="number">4</span>) <span class="comment">// Split into 4 rails</span></span><br><span class="line">    .runOn(Schedulers.parallel())</span><br><span class="line">    .map(n -&gt; n * <span class="number">2</span>)</span><br><span class="line">    .sequential(); <span class="comment">// Merge back to single Flux</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Image processing pipeline</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;ProcessedImage&gt; <span class="title function_">processImages</span><span class="params">(Flux&lt;Image&gt; images)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> images</span><br><span class="line">        .parallel(<span class="number">4</span>) <span class="comment">// 4 parallel lanes</span></span><br><span class="line">        .runOn(Schedulers.parallel()) <span class="comment">// Each lane on parallel scheduler</span></span><br><span class="line">        .map(<span class="built_in">this</span>::detectEdges) <span class="comment">// CPU-intensive</span></span><br><span class="line">        .sequential() <span class="comment">// Back to single flux</span></span><br><span class="line">        .publishOn(Schedulers.boundedElastic())</span><br><span class="line">        .flatMap(<span class="built_in">this</span>::saveToStorage) <span class="comment">// I/O intensive</span></span><br><span class="line">        .publishOn(Schedulers.single())</span><br><span class="line">        .doOnNext(<span class="built_in">this</span>::notifyUI);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Context-Propagation"><a href="#Context-Propagation" class="headerlink" title="Context Propagation"></a><strong>Context Propagation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. contextWrite - Write to Context</span></span><br><span class="line">Flux.just(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">    .flatMap(word -&gt; </span><br><span class="line">        Mono.deferContextual(ctx -&gt; </span><br><span class="line">            Mono.just(word + <span class="string">&quot; &quot;</span> + ctx.get(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    .contextWrite(Context.of(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;Alice&quot;</span>))</span><br><span class="line">    .subscribe(System.out::println); <span class="comment">// Hello Alice</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. transformDeferredContextual</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .transformDeferredContextual((flux, ctx) -&gt; </span><br><span class="line">        flux.map(n -&gt; n + ctx.getOrDefault(<span class="string">&quot;offset&quot;</span>, <span class="number">0</span>))</span><br><span class="line">    )</span><br><span class="line">    .contextWrite(Context.of(<span class="string">&quot;offset&quot;</span>, <span class="number">100</span>))</span><br><span class="line">    .subscribe(); <span class="comment">// 101, 102, 103, 104, 105</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Request tracing</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TracingFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange)</span><br><span class="line">            .contextWrite(Context.of(</span><br><span class="line">                <span class="string">&quot;traceId&quot;</span>, exchange.getRequest().getId(),</span><br><span class="line">                <span class="string">&quot;userId&quot;</span>, extractUserId(exchange)</span><br><span class="line">            ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Data&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.deferContextual(ctx -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">traceId</span> <span class="operator">=</span> ctx.get(<span class="string">&quot;traceId&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> dataService.getData()</span><br><span class="line">                .doOnSubscribe(s -&gt; </span><br><span class="line">                    log.info(<span class="string">&quot;Trace &#123;&#125;: Started&quot;</span>, traceId)</span><br><span class="line">                );</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-Backpressure-Operators"><a href="#9-Backpressure-Operators" class="headerlink" title="9. Backpressure Operators"></a><strong>9. Backpressure Operators</strong></h2><h3 id="Backpressure-Strategies"><a href="#Backpressure-Strategies" class="headerlink" title="Backpressure Strategies"></a><strong>Backpressure Strategies</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. onBackpressureBuffer - Buffer with limits</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureBuffer(</span><br><span class="line">        <span class="number">100</span>,                      <span class="comment">// Buffer size</span></span><br><span class="line">        BufferOverflowStrategy.DROP_OLDEST, <span class="comment">// Strategy</span></span><br><span class="line">        buffer -&gt; log.warn(<span class="string">&quot;Buffer overflow: &#123;&#125;&quot;</span>, buffer.size())</span><br><span class="line">    )</span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. onBackpressureDrop - Drop excess</span></span><br><span class="line">fastProducer</span><br><span class="line">    .onBackpressureDrop(dropped -&gt; </span><br><span class="line">        metrics.recordDropped(dropped)</span><br><span class="line">    )</span><br><span class="line">    .subscribe(slowConsumer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. onBackpressureLatest - Keep only latest</span></span><br><span class="line">realTimeData</span><br><span class="line">    .onBackpressureLatest()</span><br><span class="line">    .subscribe(uiUpdater);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. onBackpressureError - Error on overflow</span></span><br><span class="line">Flux.interval(Duration.ofMillis(<span class="number">10</span>))</span><br><span class="line">    .onBackpressureError()</span><br><span class="line">    .subscribe(</span><br><span class="line">        System.out::println,</span><br><span class="line">        e -&gt; log.error(<span class="string">&quot;Backpressure overflow&quot;</span>, e)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: Adaptive backpressure</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Data&gt; <span class="title function_">adaptBackpressure</span><span class="params">(Flux&lt;Data&gt; source, Consumer&lt;Data&gt; processor)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> source</span><br><span class="line">        .onBackpressureBuffer(</span><br><span class="line">            <span class="number">1000</span>,</span><br><span class="line">            BufferOverflowStrategy.DROP_OLDEST,</span><br><span class="line">            buffer -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (buffer.size() &gt; <span class="number">800</span>) &#123;</span><br><span class="line">                    <span class="comment">// Slow down producer</span></span><br><span class="line">                    adjustProducerRate(<span class="number">0.5</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        .doOnNext(processor)</span><br><span class="line">        .doOnRequest(n -&gt; &#123;</span><br><span class="line">            <span class="comment">// Increase rate when buffer is low</span></span><br><span class="line">            <span class="keyword">if</span> (getBufferSize() &lt; <span class="number">200</span>) &#123;</span><br><span class="line">                adjustProducerRate(<span class="number">1.5</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Request-Management"><a href="#Request-Management" class="headerlink" title="Request Management"></a><strong>Request Management</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. limitRequest - Limit total request</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .limitRequest(<span class="number">10</span>) <span class="comment">// Only request 10 elements</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. limitRate - Control request batches</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .limitRate(<span class="number">100</span>, <span class="number">50</span>) <span class="comment">// Request 100, replenish at 50</span></span><br><span class="line">    .subscribe();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. subscribe with request</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .subscribe(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnSubscribe</span><span class="params">(Subscription subscription)</span> &#123;</span><br><span class="line">                request(<span class="number">10</span>); <span class="comment">// Request first 10</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnNext</span><span class="params">(Integer value)</span> &#123;</span><br><span class="line">                process(value);</span><br><span class="line">                <span class="keyword">if</span> (value % <span class="number">10</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    request(<span class="number">10</span>); <span class="comment">// Request more in batches</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">// REAL-WORLD: File streaming with backpressure</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;ByteBuffer&gt; <span class="title function_">streamFile</span><span class="params">(String path, <span class="type">int</span> chunkSize)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.using(</span><br><span class="line">        () -&gt; Files.newInputStream(Paths.get(path)),</span><br><span class="line">        in -&gt; &#123;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[chunkSize];</span><br><span class="line">            <span class="keyword">return</span> Flux.generate(sink -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> in.read(buffer);</span><br><span class="line">                    <span class="keyword">if</span> (read == -<span class="number">1</span>) &#123;</span><br><span class="line">                        sink.complete();</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (read &lt; buffer.length) &#123;</span><br><span class="line">                        sink.next(ByteBuffer.wrap(buffer, <span class="number">0</span>, read));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        sink.next(ByteBuffer.wrap(buffer));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    sink.error(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        in -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123; in.close(); &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="10-Real-World-Patterns"><a href="#10-Real-World-Patterns" class="headerlink" title="10. Real-World Patterns"></a><strong>10. Real-World Patterns</strong></h2><h3 id="Pattern-1-API-Gateway-Aggregation"><a href="#Pattern-1-API-Gateway-Aggregation" class="headerlink" title="Pattern 1: API Gateway Aggregation"></a><strong>Pattern 1: API Gateway Aggregation</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AggregationController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user-dashboard/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Dashboard&gt; <span class="title function_">getUserDashboard</span><span class="params">(<span class="meta">@PathVariable</span> String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.zip(</span><br><span class="line">            userService.getUser(userId).subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            orderService.getOrders(userId).collectList().subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            paymentService.getPayments(userId).collectList().subscribeOn(Schedulers.boundedElastic()),</span><br><span class="line">            notificationService.getNotifications(userId).collectList().subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">        )</span><br><span class="line">        .map(tuple -&gt; <span class="keyword">new</span> <span class="title class_">Dashboard</span>(</span><br><span class="line">            tuple.getT1(),</span><br><span class="line">            tuple.getT2(),</span><br><span class="line">            tuple.getT3(),</span><br><span class="line">            tuple.getT4()</span><br><span class="line">        ))</span><br><span class="line">        .timeout(Duration.ofSeconds(<span class="number">3</span>))</span><br><span class="line">        .onErrorResume(e -&gt; </span><br><span class="line">            fallbackDashboardService.getDashboard(userId)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Product&gt; <span class="title function_">searchProducts</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam</span> String query,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> limit</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.merge(</span><br><span class="line">            productService.search(query).take(limit),</span><br><span class="line">            inventoryService.search(query).take(limit)</span><br><span class="line">        )</span><br><span class="line">        .distinct(Product::getId)</span><br><span class="line">        .sort(Comparator.comparing(Product::getScore).reversed())</span><br><span class="line">        .take(limit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-2-Event-Driven-Processing"><a href="#Pattern-2-Event-Driven-Processing" class="headerlink" title="Pattern 2: Event-Driven Processing"></a><strong>Pattern 2: Event-Driven Processing</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Flux&lt;Event&gt; eventStream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sinks.Many&lt;Event&gt; sink = Sinks.many().multicast().onBackpressureBuffer(<span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EventProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.eventStream = sink.asFlux()</span><br><span class="line">            .publishOn(Schedulers.parallel())</span><br><span class="line">            .name(<span class="string">&quot;event.processor&quot;</span>)</span><br><span class="line">            .metrics();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processEvent</span><span class="params">(Event event)</span> &#123;</span><br><span class="line">        sink.tryEmitNext(event);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        eventStream</span><br><span class="line">            .window(Duration.ofSeconds(<span class="number">1</span>), Duration.ofMillis(<span class="number">500</span>))</span><br><span class="line">            .flatMap(window -&gt; </span><br><span class="line">                window</span><br><span class="line">                    .groupBy(Event::getType)</span><br><span class="line">                    .flatMap(group -&gt; </span><br><span class="line">                        group</span><br><span class="line">                            .bufferTimeout(<span class="number">100</span>, Duration.ofMillis(<span class="number">500</span>))</span><br><span class="line">                            .flatMap(<span class="built_in">this</span>::processBatch)</span><br><span class="line">                    )</span><br><span class="line">            )</span><br><span class="line">            .subscribe(</span><br><span class="line">                result -&gt; log.debug(<span class="string">&quot;Processed: &#123;&#125;&quot;</span>, result),</span><br><span class="line">                error -&gt; log.error(<span class="string">&quot;Processing failed&quot;</span>, error)</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Mono&lt;ProcessResult&gt; <span class="title function_">processBatch</span><span class="params">(List&lt;Event&gt; batch)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// Batch processing logic</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProcessResult</span>(batch.size());</span><br><span class="line">            &#125;)</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">            .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-3-Reactive-Caching"><a href="#Pattern-3-Reactive-Caching" class="headerlink" title="Pattern 3: Reactive Caching"></a><strong>Pattern 3: Reactive Caching</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReactiveCache</span>&lt;K, V&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache&lt;K, Mono&lt;V&gt;&gt; cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Function&lt;K, Mono&lt;V&gt;&gt; loader;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReactiveCache</span><span class="params">(Function&lt;K, Mono&lt;V&gt;&gt; loader, Duration ttl)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.loader = loader;</span><br><span class="line">        <span class="built_in">this</span>.cache = Caffeine.newBuilder()</span><br><span class="line">            .expireAfterWrite(ttl)</span><br><span class="line">            .maximumSize(<span class="number">1000</span>)</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;V&gt; <span class="title function_">get</span><span class="params">(K key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.defer(() -&gt; &#123;</span><br><span class="line">            Mono&lt;V&gt; cached = cache.getIfPresent(key);</span><br><span class="line">            <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> cached;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Use computeIfAbsent to prevent duplicate loads</span></span><br><span class="line">            <span class="keyword">return</span> cache.get(key, k -&gt; </span><br><span class="line">                loader.apply(k)</span><br><span class="line">                    .cache() <span class="comment">// Cache the Mono result</span></span><br><span class="line">                    .doOnError(e -&gt; </span><br><span class="line">                        cache.invalidate(k)</span><br><span class="line">                    )</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Batch loading</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;V&gt; <span class="title function_">getAll</span><span class="params">(List&lt;K&gt; keys)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.fromIterable(keys)</span><br><span class="line">            .flatMap(<span class="built_in">this</span>::get, <span class="number">10</span>) <span class="comment">// Concurrent loading</span></span><br><span class="line">            .collectList()</span><br><span class="line">            .flatMapMany(Flux::fromIterable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage in service</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveCache&lt;String, Product&gt; cache;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProductService</span><span class="params">(ProductRepository repository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cache = <span class="keyword">new</span> <span class="title class_">ReactiveCache</span>&lt;&gt;(</span><br><span class="line">            repository::findById,</span><br><span class="line">            Duration.ofMinutes(<span class="number">5</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Product&gt; <span class="title function_">getProduct</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache.get(id)</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">            .onErrorResume(e -&gt; </span><br><span class="line">                repository.findById(id) <span class="comment">// Fallback to direct call</span></span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-4-WebFlux-Security-Chain"><a href="#Pattern-4-WebFlux-Security-Chain" class="headerlink" title="Pattern 4: WebFlux Security Chain"></a><strong>Pattern 4: WebFlux Security Chain</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityChainFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> extractToken(exchange)</span><br><span class="line">            .flatMap(<span class="built_in">this</span>::validateToken)</span><br><span class="line">            .flatMap(auth -&gt; </span><br><span class="line">                chain.filter(exchange)</span><br><span class="line">                    .contextWrite(Context.of(<span class="string">&quot;auth&quot;</span>, auth))</span><br><span class="line">            )</span><br><span class="line">            .switchIfEmpty(</span><br><span class="line">                chain.filter(exchange)</span><br><span class="line">                    .contextWrite(Context.of(<span class="string">&quot;auth&quot;</span>, Authentication.anonymous()))</span><br><span class="line">            )</span><br><span class="line">            .onErrorResume(AuthenticationException.class, e -&gt; </span><br><span class="line">                handleUnauthorized(exchange, e)</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Mono&lt;Authentication&gt; <span class="title function_">validateToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(() -&gt; </span><br><span class="line">                jwtDecoder.decode(token)</span><br><span class="line">            )</span><br><span class="line">            .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">2</span>))</span><br><span class="line">            .retryWhen(Retry.backoff(<span class="number">2</span>, Duration.ofMillis(<span class="number">100</span>)))</span><br><span class="line">            .map(decoded -&gt; <span class="keyword">new</span> <span class="title class_">Authentication</span>(decoded.getSubject()))</span><br><span class="line">            .onErrorMap(e -&gt; <span class="keyword">new</span> <span class="title class_">AuthenticationException</span>(<span class="string">&quot;Invalid token&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/secure-data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;SecureData&gt; <span class="title function_">getSecureData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.deferContextual(ctx -&gt; &#123;</span><br><span class="line">            <span class="type">Authentication</span> <span class="variable">auth</span> <span class="operator">=</span> ctx.get(<span class="string">&quot;auth&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!auth.hasRole(<span class="string">&quot;ADMIN&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Mono.error(<span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> secureService.getData(auth.getUserId())</span><br><span class="line">                .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">                .retryWhen(Retry.fixedDelay(<span class="number">2</span>, Duration.ofSeconds(<span class="number">1</span>)));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-5-Database-Reactive-Transactions"><a href="#Pattern-5-Database-Reactive-Transactions" class="headerlink" title="Pattern 5: Database Reactive Transactions"></a><strong>Pattern 5: Database Reactive Transactions</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> R2dbcEntityTemplate template;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactiveTransactionManager txManager;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">createOrder</span><span class="params">(OrderRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.usingWhen(</span><br><span class="line">            TransactionSynchronizationManager.forCurrentTransaction()</span><br><span class="line">                .flatMap(status -&gt; </span><br><span class="line">                    Mono.from(txManager.getReactiveTransaction(txManager))</span><br><span class="line">                ),</span><br><span class="line">            transaction -&gt; &#123;</span><br><span class="line">                <span class="comment">// Execute in transaction</span></span><br><span class="line">                <span class="keyword">return</span> template.insert(Order.class)</span><br><span class="line">                    .using(<span class="keyword">new</span> <span class="title class_">Order</span>(request))</span><br><span class="line">                    .flatMap(order -&gt; </span><br><span class="line">                        Flux.fromIterable(request.getItems())</span><br><span class="line">                            .flatMap(item -&gt; </span><br><span class="line">                                template.insert(OrderItem.class)</span><br><span class="line">                                    .using(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(order.getId(), item))</span><br><span class="line">                            )</span><br><span class="line">                            .then(Mono.just(order))</span><br><span class="line">                    )</span><br><span class="line">                    .flatMap(order -&gt; </span><br><span class="line">                        inventoryService.reserveItems(request.getItems())</span><br><span class="line">                            .thenReturn(order)</span><br><span class="line">                    )</span><br><span class="line">                    .flatMap(order -&gt; </span><br><span class="line">                        paymentService.processPayment(request.getPayment())</span><br><span class="line">                            .thenReturn(order)</span><br><span class="line">                    );</span><br><span class="line">            &#125;,</span><br><span class="line">            transaction -&gt; txManager.commit(transaction),</span><br><span class="line">            (transaction, err) -&gt; txManager.rollback(transaction),</span><br><span class="line">            transaction -&gt; txManager.rollback(transaction)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Optimistic locking with retry</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Order&gt; <span class="title function_">updateOrder</span><span class="params">(String orderId, OrderUpdate update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.defer(() -&gt; </span><br><span class="line">            template.select(Order.class)</span><br><span class="line">                .from(<span class="string">&quot;orders&quot;</span>)</span><br><span class="line">                .matching(Query.query(where(<span class="string">&quot;id&quot;</span>).is(orderId))</span><br><span class="line">                    .with(LockMode.PESSIMISTIC_WRITE))</span><br><span class="line">                .one()</span><br><span class="line">                .flatMap(order -&gt; &#123;</span><br><span class="line">                    order.applyUpdate(update);</span><br><span class="line">                    <span class="keyword">return</span> template.update(Order.class)</span><br><span class="line">                        .matching(where(<span class="string">&quot;id&quot;</span>).is(orderId)</span><br><span class="line">                            .and(<span class="string">&quot;version&quot;</span>).is(order.getVersion()))</span><br><span class="line">                        .apply(Update.update(<span class="string">&quot;status&quot;</span>, order.getStatus())</span><br><span class="line">                            .set(<span class="string">&quot;version&quot;</span>, order.getVersion() + <span class="number">1</span>))</span><br><span class="line">                        .flatMap(updated -&gt; &#123;</span><br><span class="line">                            <span class="keyword">if</span> (updated == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">return</span> Mono.error(<span class="keyword">new</span> <span class="title class_">OptimisticLockingFailureException</span>());</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> Mono.just(order);</span><br><span class="line">                        &#125;);</span><br><span class="line">                &#125;)</span><br><span class="line">        )</span><br><span class="line">        .retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofMillis(<span class="number">100</span>))</span><br><span class="line">            .filter(OptimisticLockingFailureException.class::isInstance));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Summary-Cheat-Sheet"><a href="#Summary-Cheat-Sheet" class="headerlink" title="Summary Cheat Sheet"></a><strong>Summary Cheat Sheet</strong></h2><table>
<thead>
<tr>
<th><strong>Category</strong></th>
<th><strong>Operator</strong></th>
<th><strong>Use Case</strong></th>
<th><strong>When to Use</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Creation</strong></td>
<td><code>just</code>, <code>from</code>, <code>defer</code></td>
<td>Initial data</td>
<td>Startup, bridging</td>
</tr>
<tr>
<td><strong>Transformation</strong></td>
<td><code>map</code>, <code>flatMap</code>, <code>concatMap</code></td>
<td>Data transformation</td>
<td>1:1, 1:N, ordered async</td>
</tr>
<tr>
<td><strong>Filtering</strong></td>
<td><code>filter</code>, <code>take</code>, <code>skip</code></td>
<td>Data selection</td>
<td>Conditional logic</td>
</tr>
<tr>
<td><strong>Combining</strong></td>
<td><code>merge</code>, <code>concat</code>, <code>zip</code></td>
<td>Multiple sources</td>
<td>Aggregation, parallelism</td>
</tr>
<tr>
<td><strong>Error Handling</strong></td>
<td><code>onErrorResume</code>, <code>retryWhen</code></td>
<td>Resilience</td>
<td>Fallbacks, retries</td>
</tr>
<tr>
<td><strong>Utility</strong></td>
<td><code>doOnNext</code>, <code>log</code>, <code>metrics</code></td>
<td>Observability</td>
<td>Debugging, monitoring</td>
</tr>
<tr>
<td><strong>Threading</strong></td>
<td><code>subscribeOn</code>, <code>publishOn</code></td>
<td>Concurrency control</td>
<td>I&#x2F;O vs CPU work</td>
</tr>
<tr>
<td><strong>Backpressure</strong></td>
<td><code>onBackpressureBuffer</code>, <code>limitRate</code></td>
<td>Flow control</td>
<td>Fast producer, slow consumer</td>
</tr>
</tbody></table>
<h3 id="Golden-Rules"><a href="#Golden-Rules" class="headerlink" title="Golden Rules:"></a><strong>Golden Rules:</strong></h3><ol>
<li><strong>Use <code>flatMap</code> for async, <code>concatMap</code> for ordered async</strong></li>
<li><strong>Prefer <code>retryWhen</code> over simple <code>retry</code> for production</strong></li>
<li><strong>Use <code>defer</code> for lazy&#x2F;conditional publisher creation</strong></li>
<li><strong>Apply <code>subscribeOn</code> early, <code>publishOn</code> at switching points</strong></li>
<li><strong>Always handle errors in reactive chains</strong></li>
<li><strong>Use backpressure strategies for unbounded streams</strong></li>
<li><strong>Monitor with metrics and structured logging</strong></li>
<li><strong>Test with <code>StepVerifier</code> for reliable tests</strong></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/WebFlux/" rel="tag"><i class="fa fa-tag"></i> WebFlux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/12/02/React-Best-Practices-Guide-2025/" rel="prev" title="React Best Practices Guide - 2025">
                  <i class="fa fa-angle-left"></i> React Best Practices Guide - 2025
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/12/16/Referential-Transparency-RT-Concept/" rel="next" title="Referential Transparency (RT) Concept">
                  Referential Transparency (RT) Concept <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Dazhi Zhang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
